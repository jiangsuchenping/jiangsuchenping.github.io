<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AES加密/解密工具 - 在线工具箱</title>
    <meta name="description" content="在线AES加密解密工具，支持AES-128/192/256位加密，支持CBC、ECB、CTR、GCM等加密模式">
    <meta name="keywords" content="AES加密,AES解密,在线加密,对称加密,CBC模式,ECB模式">
    <link rel="stylesheet" href="../css/style.css">
    <style>
        .tool-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .operation-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .tab-button {
            background: none;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 16px;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .tab-button.active {
            border-bottom-color: #3498db;
            color: #3498db;
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .input-group textarea, .input-group input, .input-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            resize: vertical;
        }
        
        .input-group input, .input-group select {
            height: 40px;
        }
        
        .config-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .button-group {
            margin-bottom: 20px;
        }
        
        .button-group button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            margin-right: 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .button-group button:hover {
            background-color: #2980b9;
        }
        
        .result-container {
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            min-height: 100px;
        }
        
        .error {
            color: #e74c3c;
            background-color: #fdf2f2;
            border: 1px solid #f5c6cb;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        
        .success {
            color: #27ae60;
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>AES加密/解密工具</h1>
            <p>在线AES加密解密工具</p>
        </div>
    </header>

    <nav>
        <div class="container">
            <ul>
                <li><a href="../index.html">首页</a></li>
                <li><a href="#encrypt">加密</a></li>
                <li><a href="#decrypt">解密</a></li>
            </ul>
        </div>
    </nav>

    <main class="tool-container">
        <!-- 操作标签页 -->
        <div class="operation-tabs">
            <button class="tab-button active" onclick="switchTab('encrypt')">AES加密</button>
            <button class="tab-button" onclick="switchTab('decrypt')">AES解密</button>
        </div>

        <!-- 加密标签页 -->
        <div id="encrypt-tab" class="tab-content active">
            <div class="input-group">
                <label for="encrypt-input">待加密文本：</label>
                <textarea id="encrypt-input" rows="6" placeholder="请输入要加密的文本"></textarea>
            </div>

            <div class="config-row">
                <div class="input-group">
                    <label for="encrypt-key">密钥：</label>
                    <input type="text" id="encrypt-key" placeholder="请输入密钥">
                </div>
                <div class="input-group">
                    <label for="encrypt-mode">加密模式：</label>
                    <select id="encrypt-mode" onchange="updateEncryptMode()">
                        <option value="CBC">CBC</option>
                        <option value="ECB">ECB</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="encrypt-keysize">密钥长度：</label>
                    <select id="encrypt-keysize">
                        <option value="128">128位</option>
                        <option value="192">192位</option>
                        <option value="256">256位</option>
                    </select>
                </div>
            </div>
            
            <div id="encrypt-iv-group" class="input-group">
                <label for="encrypt-iv">初始向量 (IV)：</label>
                <input type="text" id="encrypt-iv" placeholder="留空将自动生成">
            </div>

            <div class="button-group">
                <button onclick="performEncrypt()">AES加密</button>
                <button onclick="generateRandomKey('encrypt')">生成随机密钥</button>
                <button onclick="clearEncryptForm()">清空</button>
            </div>

            <div id="encrypt-result">
                <div class="input-group">
                    <label for="encrypt-output">加密结果：</label>
                    <textarea id="encrypt-output" readonly rows="6"></textarea>
                </div>
            </div>
        </div>

        <!-- 解密标签页 -->
        <div id="decrypt-tab" class="tab-content">
            <div class="input-group">
                <label for="decrypt-input">待解密文本：</label>
                <textarea id="decrypt-input" rows="6" placeholder="请输入要解密的文本"></textarea>
            </div>

            <div class="config-row">
                <div class="input-group">
                    <label for="decrypt-key">密钥：</label>
                    <input type="text" id="decrypt-key" placeholder="请输入密钥">
                </div>
                <div class="input-group">
                    <label for="decrypt-mode">加密模式：</label>
                    <select id="decrypt-mode" onchange="updateDecryptMode()">
                        <option value="CBC">CBC</option>
                        <option value="ECB">ECB</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="decrypt-keysize">密钥长度：</label>
                    <select id="decrypt-keysize">
                        <option value="128">128位</option>
                        <option value="192">192位</option>
                        <option value="256">256位</option>
                    </select>
                </div>
            </div>
            
            <div id="decrypt-iv-group" class="input-group">
                <label for="decrypt-iv">初始向量 (IV)：</label>
                <input type="text" id="decrypt-iv" placeholder="请输入加密时使用的IV">
            </div>

            <div class="button-group">
                <button onclick="performDecrypt()">AES解密</button>
                <button onclick="clearDecryptForm()">清空</button>
            </div>

            <div id="decrypt-result">
                <div class="input-group">
                    <label for="decrypt-output">解密结果：</label>
                    <textarea id="decrypt-output" readonly rows="6"></textarea>
                </div>
            </div>
        </div>
        
        <div class="info">
            <h3>说明</h3>
            <ul>
                <li>AES (Advanced Encryption Standard) 是一种对称加密算法</li>
                <li>支持128位、192位、256位密钥长度</li>
                <li>CBC模式需要初始向量(IV)，ECB模式不需要</li>
                <li>加密结果使用Base64编码</li>
                <li>请妥善保管密钥和IV，丢失将无法解密</li>
            </ul>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 在线工具箱 - AES加密/解密工具</p>
        </div>
    </footer>

    <!-- 引入CryptoJS库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="../js/main.js"></script>
    <script>
        // 标签页切换
        function switchTab(tabName) {
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        // 更新加密模式
        function updateEncryptMode() {
            const mode = document.getElementById('encrypt-mode').value;
            const ivGroup = document.getElementById('encrypt-iv-group');
            
            if (mode === 'ECB') {
                ivGroup.style.display = 'none';
            } else {
                ivGroup.style.display = 'block';
            }
        }

        // 更新解密模式
        function updateDecryptMode() {
            const mode = document.getElementById('decrypt-mode').value;
            const ivGroup = document.getElementById('decrypt-iv-group');
            
            if (mode === 'ECB') {
                ivGroup.style.display = 'none';
            } else {
                ivGroup.style.display = 'block';
            }
        }

        // 生成随机密钥
        function generateRandomKey(type) {
            const keySize = parseInt(document.getElementById(type + '-keysize').value);
            const keyBytes = keySize / 8;
            const randomKey = CryptoJS.lib.WordArray.random(keyBytes).toString();
            document.getElementById(type + '-key').value = randomKey;
        }

        // 执行加密
        function performEncrypt() {
            try {
                const plaintext = document.getElementById('encrypt-input').value;
                const key = document.getElementById('encrypt-key').value;
                const mode = document.getElementById('encrypt-mode').value;
                const keySize = parseInt(document.getElementById('encrypt-keysize').value);
                let iv = document.getElementById('encrypt-iv').value;

                if (!plaintext.trim()) {
                    showError('encrypt', '请输入要加密的文本');
                    return;
                }

                if (!key.trim()) {
                    showError('encrypt', '请输入密钥');
                    return;
                }

                // 处理密钥
                const keyBytes = keySize / 8;
                let processedKey = CryptoJS.enc.Utf8.parse(key);
                
                if (processedKey.sigBytes < keyBytes) {
                    processedKey = CryptoJS.PBKDF2(key, CryptoJS.enc.Utf8.parse('salt'), {
                        keySize: keyBytes / 4,
                        iterations: 1000
                    });
                }

                let encryptOptions = {
                    mode: CryptoJS.mode[mode],
                    padding: CryptoJS.pad.Pkcs7
                };

                // 处理IV
                if (mode !== 'ECB') {
                    if (!iv.trim()) {
                        iv = CryptoJS.lib.WordArray.random(16).toString();
                        document.getElementById('encrypt-iv').value = iv;
                    }
                    encryptOptions.iv = CryptoJS.enc.Hex.parse(iv);
                }

                // 执行加密
                const encrypted = CryptoJS.AES.encrypt(plaintext, processedKey, encryptOptions);
                document.getElementById('encrypt-output').value = encrypted.toString();
                showSuccess('encrypt', '加密成功！');

            } catch (error) {
                showError('encrypt', '加密失败：' + error.message);
            }
        }

        // 执行解密
        function performDecrypt() {
            try {
                const ciphertext = document.getElementById('decrypt-input').value;
                const key = document.getElementById('decrypt-key').value;
                const mode = document.getElementById('decrypt-mode').value;
                const keySize = parseInt(document.getElementById('decrypt-keysize').value);
                const iv = document.getElementById('decrypt-iv').value;

                if (!ciphertext.trim()) {
                    showError('decrypt', '请输入要解密的密文');
                    return;
                }

                if (!key.trim()) {
                    showError('decrypt', '请输入密钥');
                    return;
                }

                if (mode !== 'ECB' && !iv.trim()) {
                    showError('decrypt', '当前模式需要输入IV');
                    return;
                }

                // 处理密钥
                const keyBytes = keySize / 8;
                let processedKey = CryptoJS.enc.Utf8.parse(key);
                
                if (processedKey.sigBytes < keyBytes) {
                    processedKey = CryptoJS.PBKDF2(key, CryptoJS.enc.Utf8.parse('salt'), {
                        keySize: keyBytes / 4,
                        iterations: 1000
                    });
                }

                let decryptOptions = {
                    mode: CryptoJS.mode[mode],
                    padding: CryptoJS.pad.Pkcs7
                };

                if (mode !== 'ECB') {
                    decryptOptions.iv = CryptoJS.enc.Hex.parse(iv);
                }

                // 执行解密
                const decrypted = CryptoJS.AES.decrypt(ciphertext, processedKey, decryptOptions);
                const result = decrypted.toString(CryptoJS.enc.Utf8);

                if (!result) {
                    throw new Error('解密失败，请检查密钥、IV和密文是否正确');
                }

                document.getElementById('decrypt-output').value = result;
                showSuccess('decrypt', '解密成功！');

            } catch (error) {
                showError('decrypt', '解密失败：' + error.message);
            }
        }

        // 显示错误信息
        function showError(type, message) {
            const resultContainer = document.getElementById(type + '-result');
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = message;
            
            const existingError = resultContainer.querySelector('.error, .success');
            if (existingError) {
                existingError.remove();
            }
            
            resultContainer.insertBefore(errorDiv, resultContainer.firstChild);
        }

        // 显示成功信息
        function showSuccess(type, message) {
            const resultContainer = document.getElementById(type + '-result');
            const successDiv = document.createElement('div');
            successDiv.className = 'success';
            successDiv.textContent = message;
            
            const existingMsg = resultContainer.querySelector('.error, .success');
            if (existingMsg) {
                existingMsg.remove();
            }
            
            resultContainer.insertBefore(successDiv, resultContainer.firstChild);
        }

        // 清空加密表单
        function clearEncryptForm() {
            document.getElementById('encrypt-input').value = '';
            document.getElementById('encrypt-key').value = '';
            document.getElementById('encrypt-iv').value = '';
            document.getElementById('encrypt-output').value = '';
            
            const messages = document.querySelectorAll('#encrypt-result .error, #encrypt-result .success');
            messages.forEach(msg => msg.remove());
        }

        // 清空解密表单
        function clearDecryptForm() {
            document.getElementById('decrypt-input').value = '';
            document.getElementById('decrypt-key').value = '';
            document.getElementById('decrypt-iv').value = '';
            document.getElementById('decrypt-output').value = '';
            
            const messages = document.querySelectorAll('#decrypt-result .error, #decrypt-result .success');
            messages.forEach(msg => msg.remove());
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            updateEncryptMode();
            updateDecryptMode();
            generateRandomKey('encrypt');
        });

        // 记录工具使用
        if (typeof recordToolUsage === 'function') {
            recordToolUsage('AES加密/解密工具');
        }
    </script>
</body>
</html>