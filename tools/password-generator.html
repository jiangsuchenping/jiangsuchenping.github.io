<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>随机密码生成器 - 在线工具箱</title>
    <link rel="stylesheet" href="../css/style.css">
    <style>
        .tool-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .button-group {
            margin-bottom: 20px;
        }
        
        .button-group button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            margin-right: 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .button-group button:hover {
            background-color: #2980b9;
        }
        
        .result-container {
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            min-height: 100px;
        }
        
        .options-group {
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .option-item {
            display: flex;
            align-items: center;
        }
        
        .option-item input {
            margin-right: 5px;
        }
        
        .option-item select {
            padding: 5px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        
        .option-item label {
            margin-right: 10px;
        }
        
        .number-input {
            width: 60px;
            padding: 5px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        
        .password-result {
            font-family: 'Courier New', monospace;
            font-size: 16px;
            margin-bottom: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            word-break: break-all;
        }
        
        .password-strength {
            margin-top: 5px;
            font-size: 14px;
        }
        
        .strength-weak {
            color: #e74c3c;
        }
        
        .strength-medium {
            color: #f39c12;
        }
        
        .strength-strong {
            color: #27ae60;
        }
        
        .strength-very-strong {
            color: #2980b9;
        }
        
        .slider-container {
            width: 100%;
            margin-bottom: 20px;
        }
        
        .slider-container label {
            display: block;
            margin-bottom: 5px;
        }
        
        .slider-container input[type="range"] {
            width: 100%;
            max-width: 400px;
        }
        
        .slider-value {
            display: inline-block;
            margin-left: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>随机密码生成器</h1>
            <p>在线生成安全的随机密码</p>
        </div>
    </header>

    <nav>
        <div class="container">
            <ul>
                <li><a href="../index.html">首页</a></li>
            </ul>
        </div>
    </nav>

    <main class="tool-container">
        <div class="slider-container">
            <label for="password-length">密码长度: <span id="length-value" class="slider-value">12</span></label>
            <input type="range" id="password-length" min="4" max="64" value="12" oninput="updateLengthValue()">
        </div>

        <div class="options-group">
            <div class="option-item">
                <input type="checkbox" id="include-uppercase" checked>
                <label for="include-uppercase">包含大写字母 (A-Z)</label>
            </div>
            <div class="option-item">
                <input type="checkbox" id="include-lowercase" checked>
                <label for="include-lowercase">包含小写字母 (a-z)</label>
            </div>
            <div class="option-item">
                <input type="checkbox" id="include-numbers" checked>
                <label for="include-numbers">包含数字 (0-9)</label>
            </div>
            <div class="option-item">
                <input type="checkbox" id="include-symbols" checked>
                <label for="include-symbols">包含特殊符号 (!@#$%^&*)</label>
            </div>
            <div class="option-item">
                <input type="checkbox" id="exclude-similar">
                <label for="exclude-similar">排除相似字符 (i, l, 1, L, o, 0, O)</label>
            </div>
            <div class="option-item">
                <input type="checkbox" id="exclude-ambiguous">
                <label for="exclude-ambiguous">排除歧义字符 ({}, [], (), /\, etc.)</label>
            </div>
        </div>

        <div class="input-group">
            <label for="password-count">生成数量：</label>
            <input type="number" id="password-count" class="number-input" min="1" max="20" value="5">
        </div>

        <div class="button-group">
            <button onclick="generatePasswords()">生成密码</button>
            <button onclick="copyToClipboard()">复制到剪贴板</button>
            <button onclick="clearAll()">清空</button>
        </div>

        <div id="result-container" class="result-container">
            <div id="password-results"></div>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 在线工具箱 - 随机密码生成器</p>
        </div>
    </footer>

    <script src="../js/main.js"></script>
    <script>
        // 工具ID，用于保存选项
        const TOOL_ID = 'password-generator';
        /**
         * 更新密码长度显示值
         */
        function updateLengthValue() {
            const lengthSlider = document.getElementById('password-length');
            const lengthValue = document.getElementById('length-value');
            lengthValue.textContent = lengthSlider.value;
        }
        
        /**
         * 生成指定数量的随机密码
         */
        function generatePasswords() {
            const length = parseInt(document.getElementById('password-length').value);
            const count = parseInt(document.getElementById('password-count').value) || 5;
            const includeUppercase = document.getElementById('include-uppercase').checked;
            const includeLowercase = document.getElementById('include-lowercase').checked;
            const includeNumbers = document.getElementById('include-numbers').checked;
            const includeSymbols = document.getElementById('include-symbols').checked;
            const excludeSimilar = document.getElementById('exclude-similar').checked;
            const excludeAmbiguous = document.getElementById('exclude-ambiguous').checked;
            
            const resultsContainer = document.getElementById('password-results');
            
            // 验证选项
            if (!includeUppercase && !includeLowercase && !includeNumbers && !includeSymbols) {
                alert('请至少选择一种字符类型');
                return;
            }
            
            // 保存选项设置
            saveOption(TOOL_ID, 'password-length', length);
            saveOption(TOOL_ID, 'password-count', count);
            saveOption(TOOL_ID, 'include-uppercase', includeUppercase);
            saveOption(TOOL_ID, 'include-lowercase', includeLowercase);
            saveOption(TOOL_ID, 'include-numbers', includeNumbers);
            saveOption(TOOL_ID, 'include-symbols', includeSymbols);
            saveOption(TOOL_ID, 'exclude-similar', excludeSimilar);
            saveOption(TOOL_ID, 'exclude-ambiguous', excludeAmbiguous);
            
            // 记录工具使用频次
            if (typeof recordToolUsage === 'function') {
                recordToolUsage('tools/password-generator.html');
            }
            
            // 清空结果容器
            resultsContainer.innerHTML = '';
            
            // 限制生成数量
            const actualCount = Math.min(Math.max(count, 1), 20);
            
            // 生成指定数量的密码
            for (let i = 0; i < actualCount; i++) {
                const password = generatePassword(length, {
                    includeUppercase,
                    includeLowercase,
                    includeNumbers,
                    includeSymbols,
                    excludeSimilar,
                    excludeAmbiguous
                });
                
                const strength = calculatePasswordStrength(password);
                const strengthClass = getStrengthClass(strength);
                
                const passwordElement = document.createElement('div');
                passwordElement.className = 'password-result';
                passwordElement.innerHTML = password + 
                    `<div class="password-strength ${strengthClass}">${getStrengthText(strength)}</div>`;
                
                resultsContainer.appendChild(passwordElement);
            }
        }
        
        /**
         * 生成一个随机密码
         * @param {number} length - 密码长度
         * @param {Object} options - 生成选项
         * @returns {string} 生成的密码
         */
        function generatePassword(length, options) {
            const {
                includeUppercase,
                includeLowercase,
                includeNumbers,
                includeSymbols,
                excludeSimilar,
                excludeAmbiguous
            } = options;
            
            // 定义字符集
            let uppercaseChars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            let lowercaseChars = 'abcdefghijklmnopqrstuvwxyz';
            let numberChars = '0123456789';
            let symbolChars = '!@#$%^&*()-_=+[]{}|;:,.<>?/';
            
            // 排除相似字符
            if (excludeSimilar) {
                uppercaseChars = uppercaseChars.replace(/[IL0O]/g, '');
                lowercaseChars = lowercaseChars.replace(/[ilo1]/g, '');
                numberChars = numberChars.replace(/[10]/g, '');
            }
            
            // 排除歧义字符
            if (excludeAmbiguous) {
                symbolChars = symbolChars.replace(/[\[\]{}()<>\\/|`~]/g, '');
            }
            
            // 构建字符集
            let charset = '';
            if (includeUppercase) charset += uppercaseChars;
            if (includeLowercase) charset += lowercaseChars;
            if (includeNumbers) charset += numberChars;
            if (includeSymbols) charset += symbolChars;
            
            // 确保至少有一个字符
            if (charset.length === 0) {
                charset = 'abcdefghijklmnopqrstuvwxyz';
            }
            
            // 生成密码
            let password = '';
            
            // 确保密码包含所有选定的字符类型
            const requiredChars = [];
            if (includeUppercase && uppercaseChars.length > 0) {
                requiredChars.push(getRandomChar(uppercaseChars));
            }
            if (includeLowercase && lowercaseChars.length > 0) {
                requiredChars.push(getRandomChar(lowercaseChars));
            }
            if (includeNumbers && numberChars.length > 0) {
                requiredChars.push(getRandomChar(numberChars));
            }
            if (includeSymbols && symbolChars.length > 0) {
                requiredChars.push(getRandomChar(symbolChars));
            }
            
            // 添加必需的字符
            for (let i = 0; i < requiredChars.length && i < length; i++) {
                password += requiredChars[i];
            }
            
            // 填充剩余长度
            for (let i = password.length; i < length; i++) {
                password += getRandomChar(charset);
            }
            
            // 打乱密码顺序
            return shuffleString(password);
        }
        
        /**
         * 从字符串中随机选择一个字符
         * @param {string} str - 字符串
         * @returns {string} 随机字符
         */
        function getRandomChar(str) {
            return str.charAt(Math.floor(Math.random() * str.length));
        }
        
        /**
         * 打乱字符串顺序
         * @param {string} str - 输入字符串
         * @returns {string} 打乱后的字符串
         */
        function shuffleString(str) {
            const array = str.split('');
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array.join('');
        }
        
        /**
         * 计算密码强度（0-100）
         * @param {string} password - 密码
         * @returns {number} 强度分数
         */
        function calculatePasswordStrength(password) {
            let score = 0;
            
            // 基础分数：长度
            score += Math.min(password.length * 4, 40);
            
            // 字符类型多样性
            const hasUppercase = /[A-Z]/.test(password);
            const hasLowercase = /[a-z]/.test(password);
            const hasNumbers = /[0-9]/.test(password);
            const hasSymbols = /[^A-Za-z0-9]/.test(password);
            
            const typesCount = [hasUppercase, hasLowercase, hasNumbers, hasSymbols].filter(Boolean).length;
            score += typesCount * 10;
            
            // 中间数字或符号加分
            if (/[^A-Za-z]/.test(password.substring(1, password.length - 1))) {
                score += 10;
            }
            
            // 连续字符减分
            let deduction = 0;
            for (let i = 1; i < password.length; i++) {
                if (password.charCodeAt(i) === password.charCodeAt(i - 1) + 1) {
                    deduction += 2;
                }
            }
            score = Math.max(0, score - deduction);
            
            // 重复字符减分
            const charCounts = {};
            for (let i = 0; i < password.length; i++) {
                const char = password[i];
                charCounts[char] = (charCounts[char] || 0) + 1;
            }
            
            const repeats = Object.values(charCounts).filter(count => count > 1).reduce((sum, count) => sum + count, 0);
            score = Math.max(0, score - repeats);
            
            // 限制最大分数为100
            return Math.min(score, 100);
        }
        
        /**
         * 获取密码强度文本描述
         * @param {number} strength - 强度分数
         * @returns {string} 强度描述
         */
        function getStrengthText(strength) {
            if (strength < 40) return '弱';
            if (strength < 70) return '中等';
            if (strength < 90) return '强';
            return '非常强';
        }
        
        /**
         * 获取密码强度CSS类
         * @param {number} strength - 强度分数
         * @returns {string} CSS类名
         */
        function getStrengthClass(strength) {
            if (strength < 40) return 'strength-weak';
            if (strength < 70) return 'strength-medium';
            if (strength < 90) return 'strength-strong';
            return 'strength-very-strong';
        }
        
        /**
         * 复制生成的密码到剪贴板
         */
        function copyToClipboard() {
            const resultsContainer = document.getElementById('password-results');
            if (!resultsContainer.textContent.trim()) {
                alert('请先生成密码');
                return;
            }
            
            // 收集所有密码（不包括强度信息）
            const passwordElements = resultsContainer.getElementsByClassName('password-result');
            let textToCopy = '';
            
            for (let i = 0; i < passwordElements.length; i++) {
                // 获取密码文本（不包括强度信息）
                const passwordText = passwordElements[i].textContent.split('弱')[0]
                    .split('中等')[0]
                    .split('强')[0]
                    .split('非常强')[0];
                textToCopy += passwordText.trim() + '\n';
            }
            
            // 创建临时文本区域并复制
            const textarea = document.createElement('textarea');
            textarea.value = textToCopy.trim();
            document.body.appendChild(textarea);
            textarea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    alert('已复制到剪贴板');
                } else {
                    alert('复制失败，请手动复制');
                }
            } catch (err) {
                alert('复制失败: ' + err);
            }
            
            document.body.removeChild(textarea);
        }
        
        /**
         * 清空结果
         */
        function clearAll() {
            document.getElementById('password-results').innerHTML = '';
        }
        
        // 页面加载时自动生成密码
        document.addEventListener('DOMContentLoaded', function() {
            // 加载上次的选项设置
            const length = getOption(TOOL_ID, 'password-length', 12);
            const count = getOption(TOOL_ID, 'password-count', 5);
            const includeUppercase = getOption(TOOL_ID, 'include-uppercase', true);
            const includeLowercase = getOption(TOOL_ID, 'include-lowercase', true);
            const includeNumbers = getOption(TOOL_ID, 'include-numbers', true);
            const includeSymbols = getOption(TOOL_ID, 'include-symbols', true);
            const excludeSimilar = getOption(TOOL_ID, 'exclude-similar', false);
            const excludeAmbiguous = getOption(TOOL_ID, 'exclude-ambiguous', false);
            
            document.getElementById('password-length').value = length;
            document.getElementById('length-value').textContent = length;
            document.getElementById('password-count').value = count;
            document.getElementById('include-uppercase').checked = includeUppercase;
            document.getElementById('include-lowercase').checked = includeLowercase;
            document.getElementById('include-numbers').checked = includeNumbers;
            document.getElementById('include-symbols').checked = includeSymbols;
            document.getElementById('exclude-similar').checked = excludeSimilar;
            document.getElementById('exclude-ambiguous').checked = excludeAmbiguous;
            
            updateLengthValue();
            generatePasswords();
        });
    </script>
</body>
</html>