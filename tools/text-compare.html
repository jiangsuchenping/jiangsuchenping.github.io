<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文本对比工具 - 在线工具箱</title>
    <link rel="stylesheet" href="../css/style.css">
    <style>
        .tool-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .text-compare-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .text-panel {
            flex: 1;
            min-width: 300px;
        }
        
        .text-panel label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .text-panel textarea {
            width: 100%;
            min-height: 200px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            resize: vertical;
        }
        
        .button-group {
            margin-bottom: 20px;
        }
        
        .button-group button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            margin-right: 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .button-group button:hover {
            background-color: #2980b9;
        }
        
        .result-container {
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            min-height: 100px;
        }
        
        .diff-line {
            margin: 2px 0;
            padding: 2px 5px;
            font-family: 'Courier New', monospace;
        }
        
        .diff-line-added {
            background-color: #d4edda;
            color: #155724;
        }
        
        .diff-line-removed {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .diff-line-unchanged {
            background-color: #f8f9fa;
        }
        
        .legend {
            display: flex;
            gap: 20px;
            margin: 10px 0;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            margin-right: 5px;
        }
        
        .legend-added {
            background-color: #d4edda;
        }
        
        .legend-removed {
            background-color: #f8d7da;
        }
        
        .error {
            color: #e74c3c;
            background-color: #fdf2f2;
            border: 1px solid #f5c6cb;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>文本对比工具</h1>
            <p>在线文本差异对比工具</p>
        </div>
    </header>

    <nav>
        <div class="container">
            <ul>
                <li><a href="../index.html">首页</a></li>
                <li><a href="#compare">对比</a></li>
            </ul>
        </div>
    </nav>

    <main class="tool-container">
        <div class="text-compare-container">
            <div class="text-panel">
                <label for="text1">原文本：</label>
                <textarea id="text1" placeholder="输入原文本内容"></textarea>
            </div>
            
            <div class="text-panel">
                <label for="text2">对比文本：</label>
                <textarea id="text2" placeholder="输入要对比的文本内容"></textarea>
            </div>
        </div>

        <div class="button-group">
            <button onclick="compareText()">对比文本</button>
            <button onclick="swapText()">交换文本</button>
            <button onclick="clearAll()">清空</button>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color legend-added"></div>
                <span>新增内容</span>
            </div>
            <div class="legend-item">
                <div class="legend-color legend-removed"></div>
                <span>删除内容</span>
            </div>
        </div>

        <div id="result-container">
            <div class="input-group">
                <label>对比结果：</label>
                <div id="compare-output"></div>
            </div>
        </div>
        
        <div class="info">
            <h3>说明</h3>
            <ul>
                <li>该工具可以对比两段文本的差异</li>
                <li>红色背景表示在原文本中存在但对比文本中删除的内容</li>
                <li>绿色背景表示在对比文本中新增的内容</li>
                <li>支持多行文本对比</li>
            </ul>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 在线工具箱 - 文本对比工具</p>
        </div>
    </footer>

    <script>
        function compareText() {
            const text1 = document.getElementById('text1').value;
            const text2 = document.getElementById('text2').value;
            const output = document.getElementById('compare-output');
            
            if (!text1.trim() && !text2.trim()) {
                output.innerHTML = '<div class="error">请至少输入一段文本</div>';
                return;
            }
            
            try {
                const lines1 = text1.split('\n');
                const lines2 = text2.split('\n');
                
                const diff = diffLines(lines1, lines2);
                
                let resultHTML = '';
                diff.forEach(part => {
                    const className = part.added ? 'diff-line-added' : 
                                     part.removed ? 'diff-line-removed' : 
                                     'diff-line-unchanged';
                    
                    // 处理多行内容
                    const lines = part.value.split('\n');
                    lines.forEach(line => {
                        if (line !== '') {
                            resultHTML += `<div class="diff-line ${className}">${escapeHtml(line)}</div>`;
                        }
                    });
                });
                
                output.innerHTML = resultHTML;
                
                // 记录工具使用频次
                if (typeof recordToolUsage === 'function') {
                    recordToolUsage('文本对比', window.location.href);
                }
            } catch (error) {
                output.innerHTML = `<div class="error">对比错误: ${error.message}</div>`;
            }
        }
        
        // 简单的文本行对比算法
        function diffLines(lines1, lines2) {
            const result = [];
            let i = 0, j = 0;
            
            while (i < lines1.length || j < lines2.length) {
                if (i < lines1.length && j < lines2.length && lines1[i] === lines2[j]) {
                    // 行相同
                    result.push({ value: lines1[i], added: false, removed: false });
                    i++;
                    j++;
                } else {
                    // 检查是否是新增或删除
                    let removedLines = [];
                    let addedLines = [];
                    
                    // 查找删除的行
                    while (i < lines1.length && (j >= lines2.length || lines1[i] !== lines2[j])) {
                        removedLines.push(lines1[i]);
                        i++;
                    }
                    
                    // 查找新增的行
                    while (j < lines2.length && (i >= lines1.length || lines2[j] !== lines1[i])) {
                        addedLines.push(lines2[j]);
                        j++;
                    }
                    
                    // 添加删除的行
                    if (removedLines.length > 0) {
                        result.push({ value: removedLines.join('\n'), added: false, removed: true });
                    }
                    
                    // 添加新增的行
                    if (addedLines.length > 0) {
                        result.push({ value: addedLines.join('\n'), added: true, removed: false });
                    }
                }
            }
            
            return result;
        }
        
        function swapText() {
            const text1 = document.getElementById('text1');
            const text2 = document.getElementById('text2');
            const temp = text1.value;
            text1.value = text2.value;
            text2.value = temp;
            
            // 记录工具使用频次
            if (typeof recordToolUsage === 'function') {
                recordToolUsage('文本对比', window.location.href);
            }
        }
        
        function clearAll() {
            document.getElementById('text1').value = '';
            document.getElementById('text2').value = '';
            document.getElementById('compare-output').innerHTML = '';
            
            // 记录工具使用频次
            if (typeof recordToolUsage === 'function') {
                recordToolUsage('文本对比', window.location.href);
            }
        }
        
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            
            return text.replace(/[&<>"']/g, function(m) { return map[m]; });
        }
        
        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', function() {
            console.log('文本对比工具已加载');
            
            // 为输入框添加事件监听器以记录使用频次
            document.getElementById('text1').addEventListener('input', function() {
                if (typeof recordToolUsage === 'function') {
                    recordToolUsage('文本对比', window.location.href);
                }
            });
            
            document.getElementById('text2').addEventListener('input', function() {
                if (typeof recordToolUsage === 'function') {
                    recordToolUsage('文本对比', window.location.href);
                }
            });
        });
    </script>
</body>
</html>