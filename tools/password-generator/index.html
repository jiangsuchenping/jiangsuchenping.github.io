<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>随机密码生成器 - 在线工具箱</title>
    <link rel="stylesheet" href="../../css/style.css">
    <style>
        .tool-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .button-group {
            margin-bottom: 20px;
        }
        
        .button-group button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            margin-right: 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .button-group button:hover {
            background-color: #2980b9;
        }
        
        .result-container {
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            min-height: 100px;
        }
        
        .options-group {
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .option-item {
            display: flex;
            align-items: center;
        }
        
        .option-item input {
            margin-right: 5px;
        }
        
        .option-item select {
            padding: 5px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        
        .option-item label {
            margin-right: 10px;
        }
        
        .number-input {
            width: 60px;
            padding: 5px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        
        .password-result {
            font-family: 'Courier New', monospace;
            font-size: 16px;
            margin-bottom: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            word-break: break-all;
        }
        
        .password-strength {
            margin-top: 5px;
            font-size: 14px;
        }
        
        .strength-weak {
            color: #e74c3c;
        }
        
        .strength-medium {
            color: #f39c12;
        }
        
        .strength-strong {
            color: #27ae60;
        }
        
        .strength-very-strong {
            color: #2980b9;
        }
        
        .slider-container {
            width: 100%;
            margin-bottom: 20px;
        }
        
        .slider-container label {
            display: block;
            margin-bottom: 5px;
        }
        
        .slider-container input[type="range"] {
            width: 100%;
            max-width: 400px;
        }
        
        .slider-value {
            display: inline-block;
            margin-left: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>随机密码生成器</h1>
            <p>在线生成安全的随机密码</p>
        </div>
    </header>

    <nav>
        <div class="container">
            <ul>
                <li><a href="../../index.html">首页</a></li>
            </ul>
        </div>
    </nav>

    <main class="tool-container">
        <div class="slider-container">
            <label for="password-length">密码长度: <span id="length-value" class="slider-value">12</span></label>
            <input type="range" id="password-length" min="4" max="64" value="12" oninput="updateLengthValue()">
        </div>

        <div class="options-group">
            <div class="option-item">
                <input type="checkbox" id="include-uppercase" checked>
                <label for="include-uppercase">包含大写字母 (A-Z)</label>
            </div>
            <div class="option-item">
                <input type="checkbox" id="include-lowercase" checked>
                <label for="include-lowercase">包含小写字母 (a-z)</label>
            </div>
            <div class="option-item">
                <input type="checkbox" id="include-numbers" checked>
                <label for="include-numbers">包含数字 (0-9)</label>
            </div>
            <div class="option-item">
                <input type="checkbox" id="include-symbols" checked>
                <label for="include-symbols">包含特殊符号 (!@#$%^&*)</label>
            </div>
            <div class="option-item">
                <input type="checkbox" id="exclude-similar">
                <label for="exclude-similar">排除相似字符 (i, l, 1, L, o, 0, O)</label>
            </div>
            <div class="option-item">
                <input type="checkbox" id="exclude-ambiguous">
                <label for="exclude-ambiguous">排除歧义字符 ({}, [], (), /\, etc.)</label>
            </div>
        </div>

        <div class="input-group">
            <label for="password-count">生成数量：</label>
            <input type="number" id="password-count" class="number-input" min="1" max="20" value="5">
        </div>

        <div class="button-group">
            <button onclick="generatePasswords()">生成密码</button>
            <button onclick="copyToClipboard()">复制到剪贴板</button>
            <button onclick="clearAll()">清空</button>
        </div>

        <div id="result-container" class="result-container">
            <div id="password-results"></div>
        </div>
        
        <div class="info">
            <h3>说明</h3>
            <ul>
                <li>密码长度：设置生成密码的长度，范围通常在4到64之间。</li>
                <li>包含字符类型：选择密码中包含的字符类型，如大写字母、小写字母、数字和特殊符号。</li>
                <li>排除相似/歧义字符：为了避免混淆，可以排除一些视觉上相似或容易引起歧义的字符。</li>
                <li>生成数量：一次性生成多个密码，方便选择。</li>
                <li>密码强度：根据密码的长度和包含的字符类型，评估密码的强度。</li>
            </ul>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 在线工具箱 - 随机密码生成器</p>
        </div>
    </footer>

    <script src="../../js/main.js"></script>
    <script>
        recordToolUsage('tools/password-generator/index.html');

        // 字符集定义
        const charSets = {
            uppercase: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
            lowercase: 'abcdefghijklmnopqrstuvwxyz',
            numbers: '0123456789',
            symbols: '!@#$%^&*()-_=+\[\]{}|;:\'",.<>/?`~'
        };

        // 相似字符和歧义字符
        const similarChars = 'il1Lo0O';
        const ambiguousChars = '{}[]()/\\`~,;:\'"<>'.split('');

        /**
         * 更新密码长度显示值
         */
        function updateLengthValue() {
            const lengthSlider = document.getElementById('password-length');
            const lengthValueSpan = document.getElementById('length-value');
            lengthValueSpan.textContent = lengthSlider.value;
        }

        /**
         * 生成随机密码
         * @param {number} length 密码长度
         * @param {boolean} includeUppercase 是否包含大写字母
         * @param {boolean} includeLowercase 是否包含小写字母
         * @param {boolean} includeNumbers 是否包含数字
         * @param {boolean} includeSymbols 是否包含特殊符号
         * @param {boolean} excludeSimilar 是否排除相似字符
         * @param {boolean} excludeAmbiguous 是否排除歧义字符
         * @returns {string} 生成的密码
         */
        function generateRandomPassword(length, includeUppercase, includeLowercase, includeNumbers, includeSymbols, excludeSimilar, excludeAmbiguous) {
            let availableChars = '';
            if (includeUppercase) availableChars += charSets.uppercase;
            if (includeLowercase) availableChars += charSets.lowercase;
            if (includeNumbers) availableChars += charSets.numbers;
            if (includeSymbols) availableChars += charSets.symbols;

            if (excludeSimilar) {
                availableChars = availableChars.split('').filter(char => !similarChars.includes(char)).join('');
            }
            if (excludeAmbiguous) {
                availableChars = availableChars.split('').filter(char => !ambiguousChars.includes(char)).join('');
            }

            if (availableChars.length === 0) {
                return '请至少选择一种字符类型！';
            }

            let password = '';
            for (let i = 0; i < length; i++) {
                const randomIndex = Math.floor(Math.random() * availableChars.length);
                password += availableChars[randomIndex];
            }
            return password;
        }

        /**
         * 评估密码强度
         * @param {string} password 密码字符串
         * @returns {string} 密码强度描述
         */
        function assessPasswordStrength(password) {
            let strength = 0;
            const length = password.length;
            const hasUppercase = /[A-Z]/.test(password);
            const hasLowercase = /[a-z]/.test(password);
            const hasNumbers = /[0-9]/.test(password);
            const hasSymbols = /[!@#$%^&*()-_=+\[\]{}|;:'",.<>/?`~]/.test(password);

            if (length >= 8) strength++;
            if (hasUppercase) strength++;
            if (hasLowercase) strength++;
            if (hasNumbers) strength++;
            if (hasSymbols) strength++;

            if (length >= 12 && (hasUppercase + hasLowercase + hasNumbers + hasSymbols) >= 3) strength++;
            if (length >= 16 && (hasUppercase + hasLowercase + hasNumbers + hasSymbols) >= 4) strength++;

            if (strength <= 2) return '弱';
            if (strength <= 4) return '中';
            if (strength <= 6) return '强';
            return '非常强';
        }

        /**
         * 生成多个密码并显示
         */
        function generatePasswords() {
            recordToolUsage('tools/password-generator/index.html');
            const length = parseInt(document.getElementById('password-length').value);
            const count = parseInt(document.getElementById('password-count').value);
            const includeUppercase = document.getElementById('include-uppercase').checked;
            const includeLowercase = document.getElementById('include-lowercase').checked;
            const includeNumbers = document.getElementById('include-numbers').checked;
            const includeSymbols = document.getElementById('include-symbols').checked;
            const excludeSimilar = document.getElementById('exclude-similar').checked;
            const excludeAmbiguous = document.getElementById('exclude-ambiguous').checked;

            const passwordResultsDiv = document.getElementById('password-results');
            passwordResultsDiv.innerHTML = ''; // 清空之前的密码

            for (let i = 0; i < count; i++) {
                const password = generateRandomPassword(length, includeUppercase, includeLowercase, includeNumbers, includeSymbols, excludeSimilar, excludeAmbiguous);
                const strength = assessPasswordStrength(password);
                const strengthClass = `strength-${strength === '弱' ? 'weak' : strength === '中' ? 'medium' : strength === '强' ? 'strong' : 'very-strong'}`;

                const passwordDiv = document.createElement('div');
                passwordDiv.className = 'password-result';
                passwordDiv.innerHTML = `
                    <div>${password}</div>
                    <div class="password-strength ${strengthClass}">强度: ${strength}</div>
                `;
                passwordResultsDiv.appendChild(passwordDiv);
            }
        }

        /**
         * 复制所有生成的密码到剪贴板
         */
        function copyToClipboard() {
            const passwordResultsDiv = document.getElementById('password-results');
            const passwords = Array.from(passwordResultsDiv.children).map(div => div.firstElementChild.textContent);
            const textToCopy = passwords.join('\n');

            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(textToCopy).then(() => {
                    alert('所有密码已复制到剪贴板！');
                }).catch(err => {
                    console.error('复制失败:', err);
                    alert('复制失败，请手动复制。');
                });
            } else {
                // Fallback for older browsers
                const textarea = document.createElement('textarea');
                textarea.value = textToCopy;
                textarea.style.position = 'fixed'; // Avoid scrolling to bottom
                document.body.appendChild(textarea);
                textarea.focus();
                textarea.select();
                try {
                    document.execCommand('copy');
                    alert('所有密码已复制到剪贴板！');
                } catch (err) {
                    console.error('复制失败:', err);
                    alert('复制失败，请手动复制。');
                }
                document.body.removeChild(textarea);
            }
        }

        /**
         * 清空所有输入和结果
         */
        function clearAll() {
            document.getElementById('password-length').value = 12;
            document.getElementById('length-value').textContent = 12;
            document.getElementById('include-uppercase').checked = true;
            document.getElementById('include-lowercase').checked = true;
            document.getElementById('include-numbers').checked = true;
            document.getElementById('include-symbols').checked = true;
            document.getElementById('exclude-similar').checked = false;
            document.getElementById('exclude-ambiguous').checked = false;
            document.getElementById('password-count').value = 5;
            document.getElementById('password-results').innerHTML = '';
        }

        // 页面加载时更新长度显示
        document.addEventListener('DOMContentLoaded', updateLengthValue);
    </script>
</body>
</html>