<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AES加密/解密工具 - 在线工具箱</title>
    <meta name="description" content="在线AES加密解密工具，支持AES-128/192/256位加密，支持CBC、ECB、CTR、GCM等加密模式">
    <meta name="keywords" content="AES加密,AES解密,在线加密,对称加密,CBC模式,ECB模式,GCM模式">
    <link rel="stylesheet" href="../../css/style.css">
    <style>
        .tool-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .operation-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .tab-button {
            background: none;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 16px;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .tab-button.active {
            border-bottom-color: #3498db;
            color: #3498db;
            font-weight: bold;
        }
        
        .tab-button:hover {
            background-color: #f8f9fa;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        
        .input-group textarea, .input-group input, .input-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
            transition: border-color 0.3s;
        }
        
        .input-group textarea:focus, .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
        }
        
        .input-group input, .input-group select {
            height: 45px;
        }
        
        .config-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            .config-row {
                grid-template-columns: 1fr;
            }
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .button-group button {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s;
            min-width: 120px;
        }
        
        .button-group button:hover {
            background: linear-gradient(135deg, #2980b9, #1f5f8b);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }
        
        .button-group button:active {
            transform: translateY(0);
        }
        
        .button-group .secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        }
        
        .button-group .secondary:hover {
            background: linear-gradient(135deg, #7f8c8d, #6c7b7d);
        }
        
        .result-container {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            min-height: 120px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .error {
            color: #e74c3c;
            background: linear-gradient(135deg, #fdf2f2, #f8d7da);
            border: 1px solid #f5c6cb;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-weight: 500;
        }
        
        .success {
            color: #27ae60;
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            border: 1px solid #c3e6cb;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-weight: 500;
        }
        
        .info-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 30px;
        }
        
        .info-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .info-section ul {
            padding-left: 20px;
        }
        
        .info-section li {
            margin-bottom: 8px;
            line-height: 1.6;
        }
        
        .key-info {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .key-info strong {
            color: #856404;
        }
        
        .advanced-options {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .advanced-options h4 {
            margin-bottom: 15px;
            color: #495057;
        }
        
        .copy-button {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
            transition: background-color 0.3s;
        }
        
        .copy-button:hover {
            background: #218838;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>AES加密/解密工具</h1>
            <p>在线AES加密解密工具，支持多种加密模式和密钥长度</p>
        </div>
    </header>

    <nav>
        <div class="container">
            <ul>
                <li><a href="../../index.html">首页</a></li>
                <li><a href="#encrypt">AES加密</a></li>
                <li><a href="#decrypt">AES解密</a></li>
                <li><a href="#info">使用说明</a></li>
            </ul>
        </div>
    </nav>

    <main class="tool-container">
        <!-- 操作标签页 -->
        <div class="operation-tabs">
            <button class="tab-button active" onclick="switchTab('encrypt')">AES加密</button>
            <button class="tab-button" onclick="switchTab('decrypt')">AES解密</button>
        </div>

        <!-- 加密标签页 -->
        <div id="encrypt-tab" class="tab-content active">
            <h3>AES加密</h3>
            
            <div class="input-group">
                <label for="encrypt-input">待加密文本：</label>
                <textarea id="encrypt-input" rows="6" placeholder="请输入要加密的文本内容"></textarea>
            </div>

            <div class="advanced-options">
                <h4>加密配置</h4>
                <div class="config-row">
                    <div class="input-group">
                        <label for="encrypt-key">密钥（Key）：</label>
                        <input type="text" id="encrypt-key" placeholder="请输入密钥">
                    </div>
                    <div class="input-group">
                        <label for="encrypt-mode">加密模式：</label>
                        <select id="encrypt-mode" onchange="updateEncryptMode()">
                            <option value="CBC">CBC (推荐)</option>
                            <option value="ECB">ECB</option>
                            <option value="CTR">CTR</option>
                            <option value="CFB">CFB</option>
                            <option value="OFB">OFB</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="encrypt-keysize">密钥长度：</label>
                        <select id="encrypt-keysize">
                            <option value="128">128位</option>
                            <option value="192">192位</option>
                            <option value="256">256位 (推荐)</option>
                        </select>
                    </div>
                </div>
                
                <div id="encrypt-iv-group" class="input-group">
                    <label for="encrypt-iv">初始向量 (IV)：</label>
                    <input type="text" id="encrypt-iv" placeholder="留空将自动生成">
                    <button type="button" class="copy-button" onclick="generateIV('encrypt')">生成随机IV</button>
                </div>
            </div>

            <div class="key-info">
                <strong>安全提示：</strong>密钥和IV是AES加密的关键参数，请妥善保管。相同的明文使用相同的密钥和IV会产生相同的密文。
            </div>

            <div class="button-group">
                <button onclick="performEncrypt()">开始加密</button>
                <button class="secondary" onclick="generateRandomKey('encrypt')">生成随机密钥</button>
                <button class="secondary" onclick="clearEncryptForm()">清空表单</button>
            </div>

            <div id="encrypt-result" class="result-container">
                <div class="input-group">
                    <label for="encrypt-output">加密结果（Base64）：</label>
                    <textarea id="encrypt-output" rows="6" readonly></textarea>
                    <button class="copy-button" onclick="copyToClipboard('encrypt-output')">复制结果</button>
                </div>
            </div>
        </div>

        <!-- 解密标签页 -->
        <div id="decrypt-tab" class="tab-content">
            <h3>AES解密</h3>
            
            <div class="input-group">
                <label for="decrypt-input">待解密文本（Base64）：</label>
                <textarea id="decrypt-input" rows="6" placeholder="请输入要解密的Base64编码文本"></textarea>
            </div>

            <div class="advanced-options">
                <h4>解密配置</h4>
                <div class="config-row">
                    <div class="input-group">
                        <label for="decrypt-key">密钥（Key）：</label>
                        <input type="text" id="decrypt-key" placeholder="请输入密钥">
                    </div>
                    <div class="input-group">
                        <label for="decrypt-mode">加密模式：</label>
                        <select id="decrypt-mode" onchange="updateDecryptMode()">
                            <option value="CBC">CBC</option>
                            <option value="ECB">ECB</option>
                            <option value="CTR">CTR</option>
                            <option value="CFB">CFB</option>
                            <option value="OFB">OFB</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="decrypt-keysize">密钥长度：</label>
                        <select id="decrypt-keysize">
                            <option value="128">128位</option>
                            <option value="192">192位</option>
                            <option value="256">256位</option>
                        </select>
                    </div>
                </div>
                
                <div id="decrypt-iv-group" class="input-group">
                    <label for="decrypt-iv">初始向量 (IV)：</label>
                    <input type="text" id="decrypt-iv" placeholder="请输入加密时使用的IV">
                </div>
            </div>

            <div class="button-group">
                <button onclick="performDecrypt()">开始解密</button>
                <button class="secondary" onclick="clearDecryptForm()">清空表单</button>
            </div>

            <div id="decrypt-result" class="result-container">
                <div class="input-group">
                    <label for="decrypt-output">解密结果：</label>
                    <textarea id="decrypt-output" rows="6" readonly></textarea>
                    <button class="copy-button" onclick="copyToClipboard('decrypt-output')">复制结果</button>
                </div>
            </div>
        </div>

        <!-- 使用说明 -->
        <div class="info-section" id="info">
            <h3>AES加密说明</h3>
            <ul>
                <li><strong>AES</strong>（Advanced Encryption Standard）是目前最安全的对称加密算法之一</li>
                <li><strong>密钥长度：</strong>支持128位、192位、256位密钥，位数越高安全性越强</li>
                <li><strong>加密模式：</strong></li>
                <ul>
                    <li><strong>CBC模式：</strong>最常用的模式，需要IV，安全性高（推荐）</li>
                    <li><strong>ECB模式：</strong>最简单的模式，不需要IV，但安全性较低</li>
                    <li><strong>CTR模式：</strong>流加密模式，支持并行处理</li>
                    <li><strong>CFB/OFB模式：</strong>流加密模式，适合实时加密</li>
                </ul>
                <li><strong>初始向量(IV)：</strong>CBC等模式需要IV来增加随机性，提高安全性</li>
                <li><strong>密钥安全：</strong>请使用复杂且足够长的密钥，并妥善保管</li>
                <li><strong>编码格式：</strong>加密结果使用Base64编码，便于传输和存储</li>
            </ul>
        </div>

        <div class="info-section">
            <h3>安全建议</h3>
            <ul>
                <li>使用256位密钥可获得最高安全级别</li>
                <li>CBC模式比ECB模式更安全，建议优先使用</li>
                <li>每次加密使用不同的IV值</li>
                <li>密钥应该是随机生成的，不要使用简单密码</li>
                <li>在生产环境中，密钥应该安全存储，不要硬编码在代码中</li>
                <li>定期更换加密密钥以提高安全性</li>
            </ul>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 在线工具箱 - AES加密/解密工具</p>
        </div>
    </footer>

    <!-- 引入CryptoJS库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="../../js/main.js"></script>
    <script>
        // 标签页切换
        function switchTab(tabName) {
            // 移除所有活动状态
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // 激活选中的标签页
            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        // 更新加密模式
        function updateEncryptMode() {
            const mode = document.getElementById('encrypt-mode').value;
            const ivGroup = document.getElementById('encrypt-iv-group');
            
            if (mode === 'ECB') {
                ivGroup.style.display = 'none';
            } else {
                ivGroup.style.display = 'block';
            }
        }

        // 更新解密模式
        function updateDecryptMode() {
            const mode = document.getElementById('decrypt-mode').value;
            const ivGroup = document.getElementById('decrypt-iv-group');
            
            if (mode === 'ECB') {
                ivGroup.style.display = 'none';
            } else {
                ivGroup.style.display = 'block';
            }
        }

        // 生成随机密钥
        function generateRandomKey(type) {
            const keySize = parseInt(document.getElementById(type + '-keysize').value);
            const keyBytes = keySize / 8; // 转换为字节数
            const randomKey = CryptoJS.lib.WordArray.random(keyBytes).toString();
            document.getElementById(type + '-key').value = randomKey;
        }

        // 生成随机IV
        function generateIV(type) {
            const randomIV = CryptoJS.lib.WordArray.random(16).toString(); // AES块大小固定为16字节
            document.getElementById(type + '-iv').value = randomIV;
        }

        // 执行加密
        function performEncrypt() {
            try {
                const plaintext = document.getElementById('encrypt-input').value;
                const key = document.getElementById('encrypt-key').value;
                const mode = document.getElementById('encrypt-mode').value;
                const keySize = parseInt(document.getElementById('encrypt-keysize').value);
                let iv = document.getElementById('encrypt-iv').value;

                // 验证输入
                if (!plaintext.trim()) {
                    showError('encrypt', '请输入要加密的文本');
                    return;
                }

                if (!key.trim()) {
                    showError('encrypt', '请输入密钥');
                    return;
                }

                // 处理密钥长度
                const keyBytes = keySize / 8;
                let processedKey = CryptoJS.enc.Utf8.parse(key);
                
                // 如果密钥长度不够，使用PBKDF2扩展
                if (processedKey.sigBytes < keyBytes) {
                    processedKey = CryptoJS.PBKDF2(key, CryptoJS.enc.Utf8.parse('salt'), {
                        keySize: keyBytes / 4,
                        iterations: 1000
                    });
                } else if (processedKey.sigBytes > keyBytes) {
                    // 如果密钥过长，截取
                    processedKey = CryptoJS.lib.WordArray.create(processedKey.words.slice(0, keyBytes / 4));
                }

                let encryptOptions = {
                    mode: CryptoJS.mode[mode],
                    padding: CryptoJS.pad.Pkcs7
                };

                // 处理IV
                if (mode !== 'ECB') {
                    if (!iv.trim()) {
                        iv = CryptoJS.lib.WordArray.random(16).toString();
                        document.getElementById('encrypt-iv').value = iv;
                    }
                    encryptOptions.iv = CryptoJS.enc.Hex.parse(iv);
                }

                // 执行加密
                const encrypted = CryptoJS.AES.encrypt(plaintext, processedKey, encryptOptions);
                const result = encrypted.toString();

                document.getElementById('encrypt-output').value = result;
                showSuccess('encrypt', '加密成功！');

            } catch (error) {
                showError('encrypt', '加密失败：' + error.message);
            }
        }

        // 执行解密
        function performDecrypt() {
            try {
                const ciphertext = document.getElementById('decrypt-input').value;
                const key = document.getElementById('decrypt-key').value;
                const mode = document.getElementById('decrypt-mode').value;
                const keySize = parseInt(document.getElementById('decrypt-keysize').value);
                const iv = document.getElementById('decrypt-iv').value;

                // 验证输入
                if (!ciphertext.trim()) {
                    showError('decrypt', '请输入要解密的密文');
                    return;
                }

                if (!key.trim()) {
                    showError('decrypt', '请输入密钥');
                    return;
                }

                if (mode !== 'ECB' && !iv.trim()) {
                    showError('decrypt', '当前模式需要输入IV');
                    return;
                }

                // 处理密钥长度
                const keyBytes = keySize / 8;
                let processedKey = CryptoJS.enc.Utf8.parse(key);
                
                // 如果密钥长度不够，使用PBKDF2扩展
                if (processedKey.sigBytes < keyBytes) {
                    processedKey = CryptoJS.PBKDF2(key, CryptoJS.enc.Utf8.parse('salt'), {
                        keySize: keyBytes / 4,
                        iterations: 1000
                    });
                } else if (processedKey.sigBytes > keyBytes) {
                    // 如果密钥过长，截取
                    processedKey = CryptoJS.lib.WordArray.create(processedKey.words.slice(0, keyBytes / 4));
                }

                let decryptOptions = {
                    mode: CryptoJS.mode[mode],
                    padding: CryptoJS.pad.Pkcs7
                };

                // 处理IV
                if (mode !== 'ECB') {
                    decryptOptions.iv = CryptoJS.enc.Hex.parse(iv);
                }

                // 执行解密
                const decrypted = CryptoJS.AES.decrypt(ciphertext, processedKey, decryptOptions);
                const result = decrypted.toString(CryptoJS.enc.Utf8);

                if (!result) {
                    throw new Error('解密失败，请检查密钥、IV和密文是否正确');
                }

                document.getElementById('decrypt-output').value = result;
                showSuccess('decrypt', '解密成功！');

            } catch (error) {
                showError('decrypt', '解密失败：' + error.message);
            }
        }

        // 显示错误信息
        function showError(type, message) {
            const resultContainer = document.getElementById(type + '-result');
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = message;
            
            // 移除之前的错误信息
            const existingError = resultContainer.querySelector('.error');
            if (existingError) {
                existingError.remove();
            }
            
            resultContainer.insertBefore(errorDiv, resultContainer.firstChild);
            
            // 3秒后自动移除
            setTimeout(() => {
                if (errorDiv.parentNode) {
                    errorDiv.remove();
                }
            }, 3000);
        }

        // 显示成功信息
        function showSuccess(type, message) {
            const resultContainer = document.getElementById(type + '-result');
            const successDiv = document.createElement('div');
            successDiv.className = 'success';
            successDiv.textContent = message;
            
            // 移除之前的信息
            const existingMsg = resultContainer.querySelector('.success, .error');
            if (existingMsg) {
                existingMsg.remove();
            }
            
            resultContainer.insertBefore(successDiv, resultContainer.firstChild);
            
            // 3秒后自动移除
            setTimeout(() => {
                if (successDiv.parentNode) {
                    successDiv.remove();
                }
            }, 3000);
        }

        // 复制到剪贴板
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            element.select();
            document.execCommand('copy');
            
            // 显示复制成功提示
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = '已复制！';
            button.style.background = '#28a745';
            
            setTimeout(() => {
                button.textContent = originalText;
                button.style.background = '';
            }, 2000);
        }

        // 清空加密表单
        function clearEncryptForm() {
            document.getElementById('encrypt-input').value = '';
            document.getElementById('encrypt-key').value = '';
            document.getElementById('encrypt-iv').value = '';
            document.getElementById('encrypt-output').value = '';
            
            // 移除错误和成功信息
            const messages = document.querySelectorAll('#encrypt-result .error, #encrypt-result .success');
            messages.forEach(msg => msg.remove());
        }

        // 清空解密表单
        function clearDecryptForm() {
            document.getElementById('decrypt-input').value = '';
            document.getElementById('decrypt-key').value = '';
            document.getElementById('decrypt-iv').value = '';
            document.getElementById('decrypt-output').value = '';
            
            // 移除错误和成功信息
            const messages = document.querySelectorAll('#decrypt-result .error, #decrypt-result .success');
            messages.forEach(msg => msg.remove());
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化模式显示
            updateEncryptMode();
            updateDecryptMode();
            
            // 生成默认密钥
            generateRandomKey('encrypt');
            generateRandomKey('decrypt');
        });

        // 记录工具使用（如果main.js中有相关功能）
        if (typeof recordToolUsage === 'function') {
            recordToolUsage('AES加密/解密工具');
        }
    </script>
</body>
</html>