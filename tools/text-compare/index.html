<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文本对比工具 - 在线工具</title>
    <meta name="description" content="在线文本对比工具，可以快速比较两段文本的差异，高亮显示新增和删除的内容。">
    <meta name="keywords" content="文本对比,文本比较,文本差异,diff,在线工具">
    <link rel="stylesheet" href="../../css/bootstrap.min.css">
    <link rel="stylesheet" href="../../css/style.css">
    <script src="../../js/common.js"></script>
    <style>
        .diff-line {
            padding: 2px 5px;
            margin: 1px 0;
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            white-space: pre-wrap;
            word-break: break-all;
        }
        .diff-line-added {
            background-color: #e6ffed;
            border-left: 3px solid #34d058;
        }
        .diff-line-removed {
            background-color: #ffeef0;
            border-left: 3px solid #d73a49;
        }
        .diff-line-unchanged {
            background-color: #f6f8fa;
            border-left: 3px solid #d1d5da;
        }
        .legend {
            display: flex;
            margin-top: 10px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin-right: 20px;
        }
        .legend-color {
            width: 16px;
            height: 16px;
            margin-right: 5px;
        }
        .legend-added {
            background-color: #e6ffed;
            border-left: 3px solid #34d058;
        }
        .legend-removed {
            background-color: #ffeef0;
            border-left: 3px solid #d73a49;
        }
        .error {
            color: #d73a49;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="my-4 text-center">文本对比工具</h1>
        
        <div class="row">
            <div class="col-md-6">
                <div class="form-group">
                    <label for="text1">原文本:</label>
                    <textarea id="text1" class="form-control" rows="10" placeholder="请输入原文本..."></textarea>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <label for="text2">对比文本:</label>
                    <textarea id="text2" class="form-control" rows="10" placeholder="请输入对比文本..."></textarea>
                </div>
            </div>
        </div>
        
        <div class="row mt-3 mb-4">
            <div class="col-md-12 text-center">
                <button onclick="compareText()" class="btn btn-primary">对比文本</button>
                <button onclick="swapText()" class="btn btn-secondary">交换文本</button>
                <button onclick="clearAll()" class="btn btn-danger">清空</button>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">差异结果</div>
                    <div class="card-body">
                        <div id="compare-output"></div>
                        <div class="legend">
                            <div class="legend-item">
                                <div class="legend-color legend-added"></div>
                                <span>新增内容</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color legend-removed"></div>
                                <span>删除内容</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        function compareText() {
            const text1 = document.getElementById('text1').value;
            const text2 = document.getElementById('text2').value;
            const output = document.getElementById('compare-output');
            
            if (!text1.trim() && !text2.trim()) {
                output.innerHTML = '<div class="error">请至少输入一段文本</div>';
                return;
            }
            
            try {
                const lines1 = text1.split('\n');
                const lines2 = text2.split('\n');
                
                const diff = diffLines(lines1, lines2);
                
                let resultHTML = '';
                diff.forEach(part => {
                    const className = part.added ? 'diff-line-added' : 
                                     part.removed ? 'diff-line-removed' : 
                                     'diff-line-unchanged';
                    
                    // 处理多行内容
                    const lines = part.value.split('\n');
                    lines.forEach(line => {
                        if (line !== '') {
                            resultHTML += `<div class="diff-line ${className}">${escapeHtml(line)}</div>`;
                        }
                    });
                });
                
                output.innerHTML = resultHTML;
                
                // 记录工具使用频次
                if (typeof recordToolUsage === 'function') {
                    recordToolUsage('文本对比', window.location.href);
                }
            } catch (error) {
                output.innerHTML = `<div class="error">对比错误: ${error.message}</div>`;
            }
        }
        
        // 简单的文本行对比算法
        function diffLines(lines1, lines2) {
            const result = [];
            let i = 0, j = 0;
            
            while (i < lines1.length || j < lines2.length) {
                if (i < lines1.length && j < lines2.length && lines1[i] === lines2[j]) {
                    // 行相同
                    result.push({ value: lines1[i], added: false, removed: false });
                    i++;
                    j++;
                } else {
                    // 检查是否是新增或删除
                    let removedLines = [];
                    let addedLines = [];
                    
                    // 查找删除的行
                    while (i < lines1.length && (j >= lines2.length || lines1[i] !== lines2[j])) {
                        removedLines.push(lines1[i]);
                        i++;
                    }
                    
                    // 查找新增的行
                    while (j < lines2.length && (i >= lines1.length || lines2[j] !== lines1[i])) {
                        addedLines.push(lines2[j]);
                        j++;
                    }
                    
                    // 添加删除的行
                    if (removedLines.length > 0) {
                        result.push({ value: removedLines.join('\n'), added: false, removed: true });
                    }
                    
                    // 添加新增的行
                    if (addedLines.length > 0) {
                        result.push({ value: addedLines.join('\n'), added: true, removed: false });
                    }
                }
            }
            
            return result;
        }
        
        function swapText() {
            const text1 = document.getElementById('text1');
            const text2 = document.getElementById('text2');
            const temp = text1.value;
            text1.value = text2.value;
            text2.value = temp;
            
            // 记录工具使用频次
            if (typeof recordToolUsage === 'function') {
                recordToolUsage('文本对比', window.location.href);
            }
        }
        
        function clearAll() {
            document.getElementById('text1').value = '';
            document.getElementById('text2').value = '';
            document.getElementById('compare-output').innerHTML = '';
            
            // 记录工具使用频次
            if (typeof recordToolUsage === 'function') {
                recordToolUsage('文本对比', window.location.href);
            }
        }
        
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            
            return text.replace(/[&<>"']/g, function(m) { return map[m]; });
        }
        
        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', function() {
            console.log('文本对比工具已加载');
            
            // 为输入框添加事件监听器以记录使用频次
            document.getElementById('text1').addEventListener('input', function() {
                if (typeof recordToolUsage === 'function') {
                    recordToolUsage('文本对比', window.location.href);
                }
            });
            
            document.getElementById('text2').addEventListener('input', function() {
                if (typeof recordToolUsage === 'function') {
                    recordToolUsage('文本对比', window.location.href);
                }
            });
        });
    </script>
</body>
</html>