<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IP地址范围转换工具 - 在线工具箱</title>
    <meta name="description" content="在线IP地址范围转换工具，支持IP范围到CIDR格式转换、CIDR到IP范围转换、子网计算等">
    <meta name="keywords" content="IP地址转换,CIDR转换,子网计算,网络工具,IP范围">
    <link rel="stylesheet" href="../css/style.css">
    <style>
        .tool-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .operation-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .tab-button {
            background: none;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 16px;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .tab-button.active {
            border-bottom-color: #16a085;
            color: #16a085;
            font-weight: bold;
        }
        
        .tab-button:hover {
            background-color: #f8f9fa;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .converter-panel {
            background-color: #f8f9fa;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #16a085;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #1abc9c;
            box-shadow: 0 0 10px rgba(22, 160, 133, 0.3);
        }
        
        .ip-range-input {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 10px;
            align-items: center;
        }
        
        .range-separator {
            text-align: center;
            font-weight: bold;
            color: #16a085;
            font-size: 18px;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .button-group button {
            background: linear-gradient(135deg, #16a085, #1abc9c);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s;
            min-width: 120px;
        }
        
        .button-group button:hover {
            background: linear-gradient(135deg, #1abc9c, #17d1ac);
            transform: translateY(-2px);
        }
        
        .button-group .secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        }
        
        .button-group .secondary:hover {
            background: linear-gradient(135deg, #7f8c8d, #6c7b7d);
        }
        
        .result-section {
            background: linear-gradient(135deg, #e8f8f5, #d5f4e6);
            border: 2px solid #1abc9c;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .result-section h3 {
            color: #16a085;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .result-item {
            background: #ffffff;
            border: 1px solid #1abc9c;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 10px;
            font-family: 'Courier New', monospace;
        }
        
        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .info-card {
            background: #ffffff;
            border-left: 4px solid #1abc9c;
            padding: 15px;
            border-radius: 0 6px 6px 0;
        }
        
        .info-card h4 {
            color: #16a085;
            margin-bottom: 10px;
        }
        
        .error {
            color: #e74c3c;
            background: #fdf2f2;
            border: 1px solid #f5c6cb;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 15px;
        }
        
        .success {
            color: #27ae60;
            background: #d4edda;
            border: 1px solid #c3e6cb;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 15px;
        }
        
        .copy-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
        }
        
        .copy-button:hover {
            background: #2980b9;
        }
        
        .example-section {
            background: #e8f6f3;
            border: 1px solid #7dcea0;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .example-section h4 {
            color: #16a085;
            margin-bottom: 10px;
        }
        
        @media (max-width: 768px) {
            .ip-range-input {
                grid-template-columns: 1fr;
            }
            
            .range-separator {
                display: none;
            }
            
            .result-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>IP地址范围转换工具</h1>
            <p>支持IP范围与CIDR格式互转、子网计算等功能</p>
        </div>
    </header>

    <nav>
        <div class="container">
            <ul>
                <li><a href="../index.html">首页</a></li>
                <li><a href="#range-to-cidr">范围转CIDR</a></li>
                <li><a href="#cidr-to-range">CIDR转范围</a></li>
                <li><a href="#subnet-calc">子网计算</a></li>
            </ul>
        </div>
    </nav>

    <main class="tool-container">
        <!-- 操作标签页 -->
        <div class="operation-tabs">
            <button class="tab-button active" onclick="switchTab('range-to-cidr')">IP范围转CIDR</button>
            <button class="tab-button" onclick="switchTab('cidr-to-range')">CIDR转IP范围</button>
            <button class="tab-button" onclick="switchTab('subnet-calc')">子网计算器</button>
        </div>

        <!-- IP范围转CIDR标签页 -->
        <div id="range-to-cidr-tab" class="tab-content active">
            <div class="converter-panel">
                <h3>IP地址范围转CIDR格式</h3>
                
                <div class="example-section">
                    <h4>示例</h4>
                    <p><strong>输入：</strong>192.168.1.1 - 192.168.1.100</p>
                    <p><strong>输出：</strong>192.168.1.0/25, 192.168.1.128/26, ...</p>
                </div>
                
                <div class="input-group">
                    <label>IP地址范围：</label>
                    <div class="ip-range-input">
                        <input type="text" id="start-ip" placeholder="起始IP (如: 192.168.1.1)" maxlength="15">
                        <div class="range-separator">至</div>
                        <input type="text" id="end-ip" placeholder="结束IP (如: 192.168.1.100)" maxlength="15">
                    </div>
                </div>

                <div class="button-group">
                    <button onclick="convertRangeToCidr()">转换为CIDR</button>
                    <button onclick="fillExampleRange()" class="secondary">填入示例</button>
                    <button onclick="clearRangeForm()" class="secondary">清空</button>
                </div>

                <div id="range-result"></div>
            </div>
        </div>

        <!-- CIDR转IP范围标签页 -->
        <div id="cidr-to-range-tab" class="tab-content">
            <div class="converter-panel">
                <h3>CIDR格式转IP地址范围</h3>
                
                <div class="example-section">
                    <h4>示例</h4>
                    <p><strong>输入：</strong>192.168.1.0/24</p>
                    <p><strong>输出：</strong>192.168.1.1 - 192.168.1.254 (254个可用IP)</p>
                </div>
                
                <div class="input-group">
                    <label for="cidr-input">CIDR格式：</label>
                    <input type="text" id="cidr-input" placeholder="如: 192.168.1.0/24" maxlength="18">
                </div>

                <div class="button-group">
                    <button onclick="convertCidrToRange()">转换为IP范围</button>
                    <button onclick="fillExampleCidr()" class="secondary">填入示例</button>
                    <button onclick="clearCidrForm()" class="secondary">清空</button>
                </div>

                <div id="cidr-result"></div>
            </div>
        </div>

        <!-- 子网计算器标签页 -->
        <div id="subnet-calc-tab" class="tab-content">
            <div class="converter-panel">
                <h3>子网计算器</h3>
                
                <div class="example-section">
                    <h4>示例</h4>
                    <p><strong>输入：</strong>192.168.1.0/24</p>
                    <p><strong>输出：</strong>网络地址、广播地址、子网掩码、可用IP数量等</p>
                </div>
                
                <div class="input-group">
                    <label for="subnet-input">网络地址 (CIDR格式)：</label>
                    <input type="text" id="subnet-input" placeholder="如: 192.168.1.0/24" maxlength="18">
                </div>

                <div class="button-group">
                    <button onclick="calculateSubnet()">计算子网信息</button>
                    <button onclick="fillExampleSubnet()" class="secondary">填入示例</button>
                    <button onclick="clearSubnetForm()" class="secondary">清空</button>
                </div>

                <div id="subnet-result"></div>
            </div>
        </div>
        
        <div class="info-section">
            <h3>工具说明</h3>
            <ul>
                <li><strong>IP范围转CIDR：</strong>将连续的IP地址范围转换为一个或多个CIDR块</li>
                <li><strong>CIDR转IP范围：</strong>将CIDR格式的网络地址转换为具体的IP地址范围</li>
                <li><strong>子网计算器：</strong>根据CIDR计算网络信息，包括网络地址、广播地址、子网掩码等</li>
                <li><strong>CIDR表示法：</strong>如192.168.1.0/24，其中/24表示前24位为网络位</li>
                <li><strong>应用场景：</strong>网络规划、防火墙配置、路由设置等</li>
            </ul>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 在线工具箱 - IP地址范围转换工具</p>
        </div>
    </footer>

    <script src="../js/main.js"></script>
    <script>
        // 标签页切换
        function switchTab(tabName) {
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        // IP地址验证
        function isValidIP(ip) {
            const pattern = /^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/;
            const match = ip.match(pattern);
            if (!match) return false;
            
            return match.slice(1).every(octet => {
                const num = parseInt(octet, 10);
                return num >= 0 && num <= 255;
            });
        }

        // IP地址转数字
        function ipToNumber(ip) {
            const parts = ip.split('.').map(Number);
            return (parts[0] << 24) + (parts[1] << 16) + (parts[2] << 8) + parts[3];
        }

        // 数字转IP地址
        function numberToIp(num) {
            return [
                (num >>> 24) & 255,
                (num >>> 16) & 255,
                (num >>> 8) & 255,
                num & 255
            ].join('.');
        }

        // IP范围转CIDR
        function convertRangeToCidr() {
            try {
                const startIp = document.getElementById('start-ip').value.trim();
                const endIp = document.getElementById('end-ip').value.trim();

                if (!startIp || !endIp) {
                    showError('range', '请输入完整的IP地址范围');
                    return;
                }

                if (!isValidIP(startIp) || !isValidIP(endIp)) {
                    showError('range', '请输入有效的IP地址');
                    return;
                }

                const startNum = ipToNumber(startIp);
                const endNum = ipToNumber(endIp);

                if (startNum > endNum) {
                    showError('range', '起始IP不能大于结束IP');
                    return;
                }

                const cidrBlocks = rangeToCidr(startNum, endNum);
                displayRangeResult(cidrBlocks, endNum - startNum + 1);
                showSuccess('range', '转换成功！');

            } catch (error) {
                showError('range', '转换失败：' + error.message);
            }
        }

        // 计算IP范围对应的CIDR块
        function rangeToCidr(start, end) {
            const result = [];
            let current = start;

            while (current <= end) {
                let maxPrefixLength = 32;
                let blockSize = 1;

                // 找到能包含当前范围的最大CIDR块
                for (let prefixLength = 0; prefixLength <= 32; prefixLength++) {
                    const currentBlockSize = Math.pow(2, 32 - prefixLength);
                    const blockStart = current & (~(currentBlockSize - 1));
                    const blockEnd = blockStart + currentBlockSize - 1;

                    if (blockStart === current && blockEnd <= end) {
                        maxPrefixLength = prefixLength;
                        blockSize = currentBlockSize;
                    } else {
                        break;
                    }
                }

                if (maxPrefixLength === 32) {
                    let trailingZeros = 0;
                    let temp = current;
                    while (temp > 0 && (temp & 1) === 0) {
                        trailingZeros++;
                        temp >>>= 1;
                    }
                    
                    let testPrefixLength = 32 - trailingZeros;
                    let testBlockSize = Math.pow(2, trailingZeros);
                    
                    while (current + testBlockSize - 1 > end && testPrefixLength < 32) {
                        testPrefixLength++;
                        testBlockSize = Math.pow(2, 32 - testPrefixLength);
                    }
                    
                    maxPrefixLength = testPrefixLength;
                    blockSize = testBlockSize;
                }

                const networkAddress = numberToIp(current);
                result.push(`${networkAddress}/${maxPrefixLength}`);
                current += blockSize;
            }

            return result;
        }

        // CIDR转IP范围
        function convertCidrToRange() {
            try {
                const cidr = document.getElementById('cidr-input').value.trim();

                if (!cidr) {
                    showError('cidr', '请输入CIDR格式的网络地址');
                    return;
                }

                const cidrPattern = /^(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})\/(\d{1,2})$/;
                const match = cidr.match(cidrPattern);

                if (!match) {
                    showError('cidr', '请输入有效的CIDR格式 (如: 192.168.1.0/24)');
                    return;
                }

                const [, network, prefixStr] = match;
                const prefix = parseInt(prefixStr, 10);

                if (!isValidIP(network)) {
                    showError('cidr', '请输入有效的网络地址');
                    return;
                }

                if (prefix < 0 || prefix > 32) {
                    showError('cidr', '前缀长度必须在0-32之间');
                    return;
                }

                const result = cidrToRange(network, prefix);
                displayCidrResult(result);
                showSuccess('cidr', '转换成功！');

            } catch (error) {
                showError('cidr', '转换失败：' + error.message);
            }
        }

        // 计算CIDR对应的IP范围
        function cidrToRange(network, prefix) {
            const networkNum = ipToNumber(network);
            const subnetMask = (0xFFFFFFFF << (32 - prefix)) >>> 0;
            const networkAddress = (networkNum & subnetMask) >>> 0;
            const broadcastAddress = (networkAddress | (0xFFFFFFFF >>> prefix)) >>> 0;
            const hostBits = 32 - prefix;
            const totalHosts = Math.pow(2, hostBits);
            const usableHosts = totalHosts > 2 ? totalHosts - 2 : totalHosts;

            return {
                networkAddress: numberToIp(networkAddress),
                broadcastAddress: numberToIp(broadcastAddress),
                firstUsableIp: totalHosts > 2 ? numberToIp(networkAddress + 1) : numberToIp(networkAddress),
                lastUsableIp: totalHosts > 2 ? numberToIp(broadcastAddress - 1) : numberToIp(broadcastAddress),
                subnetMask: numberToIp(subnetMask),
                totalHosts: totalHosts,
                usableHosts: usableHosts,
                prefix: prefix
            };
        }

        // 子网计算
        function calculateSubnet() {
            try {
                const subnet = document.getElementById('subnet-input').value.trim();

                if (!subnet) {
                    showError('subnet', '请输入CIDR格式的网络地址');
                    return;
                }

                const cidrPattern = /^(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})\/(\d{1,2})$/;
                const match = subnet.match(cidrPattern);

                if (!match) {
                    showError('subnet', '请输入有效的CIDR格式 (如: 192.168.1.0/24)');
                    return;
                }

                const [, network, prefixStr] = match;
                const prefix = parseInt(prefixStr, 10);

                if (!isValidIP(network)) {
                    showError('subnet', '请输入有效的网络地址');
                    return;
                }

                if (prefix < 0 || prefix > 32) {
                    showError('subnet', '前缀长度必须在0-32之间');
                    return;
                }

                const result = cidrToRange(network, prefix);
                displaySubnetResult(result);
                showSuccess('subnet', '计算成功！');

            } catch (error) {
                showError('subnet', '计算失败：' + error.message);
            }
        }

        // 显示结果函数
        function displayRangeResult(cidrBlocks, totalIps) {
            const resultDiv = document.getElementById('range-result');
            
            let html = `
                <div class="result-section">
                    <h3>转换结果</h3>
                    <div class="info-card">
                        <h4>总计</h4>
                        <p><strong>IP地址数量：</strong>${totalIps} 个</p>
                        <p><strong>CIDR块数量：</strong>${cidrBlocks.length} 个</p>
                    </div>
                    <h4>CIDR块列表：</h4>
            `;

            cidrBlocks.forEach((cidr) => {
                const [network, prefix] = cidr.split('/');
                const prefixNum = parseInt(prefix, 10);
                const hostCount = Math.pow(2, 32 - prefixNum);
                
                html += `
                    <div class="result-item">
                        <strong>${cidr}</strong>
                        <button class="copy-button" onclick="copyToClipboard('${cidr}')">复制</button>
                        <br><small>包含 ${hostCount} 个IP地址</small>
                    </div>
                `;
            });

            html += '</div>';
            resultDiv.innerHTML = html;
        }

        function displayCidrResult(result) {
            const resultDiv = document.getElementById('cidr-result');
            
            const html = `
                <div class="result-section">
                    <h3>网络信息</h3>
                    <div class="result-grid">
                        <div class="info-card">
                            <h4>网络地址</h4>
                            <p>${result.networkAddress}</p>
                        </div>
                        <div class="info-card">
                            <h4>IP地址范围</h4>
                            <p>${result.firstUsableIp} - ${result.lastUsableIp}</p>
                        </div>
                        <div class="info-card">
                            <h4>子网掩码</h4>
                            <p>${result.subnetMask}</p>
                        </div>
                        <div class="info-card">
                            <h4>可用IP数量</h4>
                            <p>${result.usableHosts} 个</p>
                        </div>
                    </div>
                </div>
            `;
            
            resultDiv.innerHTML = html;
        }

        function displaySubnetResult(result) {
            const resultDiv = document.getElementById('subnet-result');
            
            let subnetClass = '';
            const firstOctet = parseInt(result.networkAddress.split('.')[0]);
            if (firstOctet >= 1 && firstOctet <= 126) subnetClass = 'A类';
            else if (firstOctet >= 128 && firstOctet <= 191) subnetClass = 'B类';
            else if (firstOctet >= 192 && firstOctet <= 223) subnetClass = 'C类';

            const html = `
                <div class="result-section">
                    <h3>详细子网信息</h3>
                    <div class="result-grid">
                        <div class="info-card">
                            <h4>网络地址</h4>
                            <p>${result.networkAddress}/${result.prefix}</p>
                        </div>
                        <div class="info-card">
                            <h4>子网掩码</h4>
                            <p>${result.subnetMask}</p>
                            <small>前缀长度: /${result.prefix}</small>
                        </div>
                        <div class="info-card">
                            <h4>广播地址</h4>
                            <p>${result.broadcastAddress}</p>
                        </div>
                        <div class="info-card">
                            <h4>网络类别</h4>
                            <p>${subnetClass}网络</p>
                        </div>
                        <div class="info-card">
                            <h4>可用IP范围</h4>
                            <p>${result.firstUsableIp} - ${result.lastUsableIp}</p>
                        </div>
                        <div class="info-card">
                            <h4>总IP / 可用IP</h4>
                            <p>${result.totalHosts} / ${result.usableHosts}</p>
                        </div>
                    </div>
                </div>
            `;
            
            resultDiv.innerHTML = html;
        }

        // 辅助函数
        function showError(type, message) {
            const resultContainer = document.getElementById(type + '-result');
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${message}`;
            resultContainer.innerHTML = '';
            resultContainer.appendChild(errorDiv);
        }

        function showSuccess(type, message) {
            // 成功消息会在结果显示后覆盖，这里可以添加临时成功提示
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('已复制到剪贴板: ' + text);
            }).catch(() => {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('已复制到剪贴板: ' + text);
            });
        }

        // 示例填充函数
        function fillExampleRange() {
            document.getElementById('start-ip').value = '192.168.1.1';
            document.getElementById('end-ip').value = '192.168.1.100';
        }

        function fillExampleCidr() {
            document.getElementById('cidr-input').value = '192.168.1.0/24';
        }

        function fillExampleSubnet() {
            document.getElementById('subnet-input').value = '192.168.1.0/24';
        }

        // 清空函数
        function clearRangeForm() {
            document.getElementById('start-ip').value = '';
            document.getElementById('end-ip').value = '';
            document.getElementById('range-result').innerHTML = '';
        }

        function clearCidrForm() {
            document.getElementById('cidr-input').value = '';
            document.getElementById('cidr-result').innerHTML = '';
        }

        function clearSubnetForm() {
            document.getElementById('subnet-input').value = '';
            document.getElementById('subnet-result').innerHTML = '';
        }

        // 记录工具使用
        if (typeof recordToolUsage === 'function') {
            recordToolUsage('IP地址范围转换工具');
        }
    </script>
</body>
</html>