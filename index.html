<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>幼儿园大班学习乐园</title>
  
  <!-- 智能资源管理器 -->
  <script src="assets/js/smart-resource-manager.js"></script>
  <script src="assets/js/cdn-manager.js"></script>
  
  <!-- Bootstrap CSS 备用方案 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.min.css" rel="stylesheet">
  
  <style>
    body {
      font-family: '幼圆', '微软雅黑', sans-serif;
      background: linear-gradient(135deg, #6ecbf5 0%, #cdefff 100%);
      min-height: 100vh;
      padding-bottom: 20px;
    }
    
    /* 解决Vue页面加载时的闪现问题 */
    [v-cloak] {
      display: none;
    }
    
    .header {
      background: linear-gradient(to right, #ff9966, #ff5e62);
      color: white;
      border-radius: 0 0 20px 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      padding: 15px 0;
    }
    
    .subject-card {
      border-radius: 20px;
      transition: all 0.3s ease;
      cursor: pointer;
      height: 100%;
      box-shadow: 0 6px 12px rgba(0,0,0,0.1);
    }
    
    .subject-card:hover {
      transform: translateY(-10px);
      box-shadow: 0 12px 20px rgba(0,0,0,0.15);
    }
    
    .subject-icon {
      font-size: 3rem;
      margin-bottom: 15px;
    }
    
    .content-area {
      background: white;
      border-radius: 20px;
      box-shadow: 0 6px 15px rgba(0,0,0,0.1);
      padding: 20px;
      min-height: 400px;
      margin-top: 20px;
    }
    
    .back-btn {
      position: absolute;
      top: 20px;
      left: 20px;
      z-index: 100;
    }
    
    .activity-card {
      border-radius: 15px;
      transition: all 0.3s;
      cursor: pointer;
      border: 2px solid #eee;
    }
    
    .activity-card:hover {
      transform: scale(1.03);
      border-color: #6ecbf5;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .btn-primary {
      background: linear-gradient(to right, #4facfe 0%, #00f2fe 100%);
      border: none;
    }
    
    .btn-success {
      background: linear-gradient(to right, #0ba360 0%, #3cba92 100%);
      border: none;
    }
    
    .btn-warning {
      background: linear-gradient(to right, #ff758c 0%, #ff7eb3 100%);
      border: none;
    }
    
    h1, h2, h3, h4 {
      font-weight: bold;
    }
    
    .alphabet-card {
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s;
      border: 2px solid #dee2e6;
      border-radius: 10px;
      margin: 5px;
    }
    
    .alphabet-card:hover {
      transform: scale(1.1);
      border-color: #4facfe;
      background-color: #f8f9fa;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .number-card {
      height: 100px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s;
      border: 2px solid #dee2e6;
      border-radius: 10px;
      margin: 5px;
    }
    
    .number-card:hover {
      transform: scale(1.1);
      border-color: #4facfe;
      background-color: #f8f9fa;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .word-card {
      min-height: 120px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
      border: 2px solid #dee2e6;
      border-radius: 15px;
      margin: 10px;
      padding: 15px;
    }
    
    .word-card:hover {
      transform: scale(1.05);
      border-color: #4facfe;
      background-color: #f8f9fa;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .word-image {
      width: 80px;
      height: 80px;
      object-fit: contain;
      margin-bottom: 10px;
    }
    
    /* 关键帧动画优化 */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .fade-in {
      animation: fadeIn 0.5s ease-in;
    }
    
    .result-icon {
      font-size: 5rem;
      margin: 20px 0;
    }
    
    .question-option {
      border: 2px solid #dee2e6;
      border-radius: 10px;
      padding: 15px;
      margin: 10px 0;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .question-option:hover {
      border-color: #4facfe;
      background-color: #f8f9fa;
    }
    
    .question-option.selected {
      border-color: #4facfe;
      background-color: #e6f7ff;
      box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.2);
    }
    
    /* 图片加载状态样式 */
    .image-placeholder {
      width: 80px;
      height: 80px;
      background-color: #f0f0f0;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 10px;
      border-radius: 5px;
    }
    
    .image-placeholder i {
      font-size: 2rem;
      color: #ccc;
    }
    
    /* 页脚样式 */
    .footer {
      background: linear-gradient(to right, #2c3e50, #34495e);
      color: white;
      padding: 30px 0;
      margin-top: 50px;
      border-radius: 20px 20px 0 0;
      box-shadow: 0 -4px 8px rgba(0,0,0,0.1);
    }
    
    .footer h5 {
      color: #ecf0f1;
      font-weight: bold;
      margin-bottom: 15px;
    }
    
    .footer p {
      color: #bdc3c7;
      margin-bottom: 8px;
      font-size: 0.95rem;
    }
    
    .footer a {
      color: #3498db;
      text-decoration: none;
      transition: color 0.3s ease;
    }
    
    .footer a:hover {
      color: #5dade2;
      text-decoration: underline;
    }
    
    .contact-info {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 15px;
      margin-top: 10px;
    }
    
    .contact-item {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
    }
    
    .contact-item i {
      margin-right: 10px;
      color: #3498db;
      width: 20px;
    }

    /* 历史记录表格样式 */
    .table-responsive {
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .table th {
      border: none;
      font-weight: 600;
      text-align: center;
      vertical-align: middle;
    }

    .table td {
      border: none;
      text-align: center;
      vertical-align: middle;
      padding: 12px 8px;
    }

    .table-striped > tbody > tr:nth-of-type(odd) > td {
      background-color: rgba(0,0,0,0.02);
    }

    .table-hover > tbody > tr:hover > td {
      background-color: rgba(79, 172, 254, 0.1);
    }

    /* 统计卡片样式 */
    .card {
      border-radius: 15px;
      border: none;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      transition: transform 0.2s ease;
    }

    .card:hover {
      transform: translateY(-2px);
    }

    /* 练习区域样式 */
    .practice-area {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }

    /* 统计区域样式 */
    .stats-section {
      background: white;
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      border: 1px solid #e9ecef;
    }

    /* 历史记录区域样式 */
    .history-section {
      background: white;
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      border: 1px solid #e9ecef;
    }

    .history-summary {
      border: 2px dashed #dee2e6;
      transition: all 0.3s ease;
    }

    .history-summary:hover {
      border-color: #6ecbf5;
      background-color: #f8f9fa !important;
    }

    .history-details {
      animation: slideDown 0.3s ease-out;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* 按钮样式优化 */
    .btn-outline-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .btn-outline-warning:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- 主页 -->
    <div v-if="currentPage === 'home'" class="fade-in">
      <div class="header text-center py-4 mb-4">
        <h1><i class="bi bi-stars"></i> 幼儿园大班学习乐园 <i class="bi bi-stars"></i></h1>
        <p class="lead">欢迎来到快乐学习世界！</p>
      </div>
      
      <div class="container">
        <div class="row">
          <div class="col-md-4 mb-4">
            <div class="subject-card card bg-primary text-white" @click="selectSubject('chinese')">
              <div class="card-body text-center">
                <div class="subject-icon">
                  <i class="bi bi-book"></i>
                </div>
                <h3 class="card-title">语文</h3>
                <p class="card-text">学习汉字、拼音和词语</p>
              </div>
            </div>
          </div>
          
          <div class="col-md-4 mb-4">
            <div class="subject-card card bg-success text-white" @click="selectSubject('math')">
              <div class="card-body text-center">
                <div class="subject-icon">
                  <i class="bi bi-calculator"></i>
                </div>
                <h3 class="card-title">数学</h3>
                <p class="card-text">学习数字、计算和图形</p>
              </div>
            </div>
          </div>
          
          <div class="col-md-4 mb-4">
            <div class="subject-card card bg-warning text-white" @click="selectSubject('english')">
              <div class="card-body text-center">
                <div class="subject-icon">
                  <i class="bi bi-globe"></i>
                </div>
                <h3 class="card-title">英语</h3>
                <p class="card-text">学习字母、单词和简单句子</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 学科页面 -->
    <div v-else class="fade-in" v-cloak>
      <button class="btn btn-secondary back-btn" @click="goHome">
        <i class="bi bi-arrow-left-circle"></i> 返回主页
      </button>
      
      <div class="header text-center py-4 mb-4">
        <h1>{{ currentSubject.title }}</h1>
      </div>
      
      <div class="container">
        <div class="content-area">
          <!-- 语文内容 -->
          <div v-if="currentSubject.key === 'chinese'">
            <ul class="nav nav-tabs" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link" 
                        :class="{ active: activeChineseTab === 'pinyin' }"
                        data-bs-toggle="tab" 
                        data-bs-target="#pinyin" 
                        type="button" 
                        role="tab"
                        @click="setActiveTab('chinese', 'pinyin')">拼音学习</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" 
                        :class="{ active: activeChineseTab === 'characters' }"
                        data-bs-toggle="tab" 
                        data-bs-target="#characters" 
                        type="button" 
                        role="tab"
                        @click="setActiveTab('chinese', 'characters')">汉字学习</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" 
                        :class="{ active: activeChineseTab === 'words' }"
                        data-bs-toggle="tab" 
                        data-bs-target="#words" 
                        type="button" 
                        role="tab"
                        @click="setActiveTab('chinese', 'words')">词语学习</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" 
                        :class="{ active: activeChineseTab === 'idioms' }"
                        data-bs-toggle="tab" 
                        data-bs-target="#idioms" 
                        type="button" 
                        role="tab"
                        @click="setActiveTab('chinese', 'idioms')">成语学习</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" 
                        :class="{ active: activeChineseTab === 'poems' }"
                        data-bs-toggle="tab" 
                        data-bs-target="#poems" 
                        type="button" 
                        role="tab"
                        @click="setActiveTab('chinese', 'poems')">古诗词学习</button>
              </li>
            </ul>
            <div class="tab-content">
              <div class="tab-pane fade" 
                   :class="{ 'show active': activeChineseTab === 'pinyin' }" 
                   id="pinyin" 
                   role="tabpanel">
                <h3 class="mt-3">声母学习</h3>
                <div class="row">
                  <div v-for="initial in chinese.initials" :key="initial" class="col-2 mb-3">
                    <div class="alphabet-card bg-light" @click="speak(initial)">
                      {{ initial }}
                    </div>
                  </div>
                </div>
                
                <h3 class="mt-4">韵母学习</h3>
                <div class="row">
                  <div v-for="final in chinese.finals" :key="final" class="col-2 mb-3">
                    <div class="alphabet-card bg-light" @click="speak(final)">
                      {{ final }}
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="tab-pane fade" 
                   :class="{ 'show active': activeChineseTab === 'characters' }" 
                   id="characters" 
                   role="tabpanel">
                <h3 class="mt-3">基础汉字</h3>
                <div class="row">
                  <div v-for="character in chinese.characters" :key="character.char" class="col-3 col-md-2 mb-3">
                    <div class="number-card bg-light" @click="speak(character.pinyin)">
                      <div class="character">{{ character.char }}</div>
                      <div class="pinyin text-muted small">{{ character.pinyin }}</div>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="tab-pane fade" 
                   :class="{ 'show active': activeChineseTab === 'words' }" 
                   id="words" 
                   role="tabpanel">
                <h3 class="mt-3">常用词语</h3>
                <div class="row">
                  <div v-for="word in chinese.words" :key="word.word" class="col-6 col-md-3 mb-3">
                    <div class="word-card bg-light" @click="speak(word.word)">
                      <div class="word">{{ word.word }}</div>
                      <div class="pinyin text-muted small">{{ word.pinyin }}</div>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="tab-pane fade" 
                   :class="{ 'show active': activeChineseTab === 'idioms' }" 
                   id="idioms" 
                   role="tabpanel">
                <h3 class="mt-3">常用成语</h3>
                <div class="row">
                  <div v-for="idiom in chinese.idioms" :key="idiom.idiom" class="col-6 col-md-3 mb-3">
                    <div class="word-card bg-light" @click="speak(idiom.idiom)">
                      <div class="word">{{ idiom.idiom }}</div>
                      <div class="pinyin text-muted small">{{ idiom.pinyin }}</div>
                      <div class="meaning text-muted small">{{ idiom.meaning }}</div>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="tab-pane fade" 
                   :class="{ 'show active': activeChineseTab === 'poems' }" 
                   id="poems" 
                   role="tabpanel">
                <h3 class="mt-3">经典古诗词</h3>
                <div class="row">
                  <div v-for="poem in chinese.poems" :key="poem.title" class="col-12 col-md-6 mb-4">
                    <div class="poem-card bg-light p-3 h-100">
                      <div class="poem-title fw-bold fs-5 mb-2">{{ poem.title }}</div>
                      <div class="poem-author text-muted small mb-2">{{ poem.author }}</div>
                      <div class="poem-content mb-2">{{ poem.content }}</div>
                      <div class="poem-meaning text-muted">{{ poem.meaning }}</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- 数学内容 -->
          <div v-if="currentSubject.key === 'math'">
            <ul class="nav nav-tabs" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link" 
                        :class="{ active: activeMathTab === 'numbers' }"
                        data-bs-toggle="tab" 
                        data-bs-target="#numbers" 
                        type="button" 
                        role="tab"
                        @click="setActiveTab('math', 'numbers')">数字认知</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" 
                        :class="{ active: activeMathTab === 'counting' }"
                        data-bs-toggle="tab" 
                        data-bs-target="#counting" 
                        type="button" 
                        role="tab"
                        @click="setActiveTab('math', 'counting')">数数练习</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link"
                        :class="{ active: activeMathTab === 'addition' }"
                        data-bs-toggle="tab"
                        data-bs-target="#addition"
                        type="button"
                        role="tab"
                        @click="setActiveTab('math', 'addition')">加法练习</button>
              </li>
            </ul>
            <div class="tab-content">
              <div class="tab-pane fade" 
                   :class="{ 'show active': activeMathTab === 'numbers' }" 
                   id="numbers" 
                   role="tabpanel">
                <h3 class="mt-3">数字1-20</h3>
                <div class="row">
                  <div v-for="n in 20" :key="n" class="col-3 col-md-2 mb-3">
                    <div class="number-card bg-light" @click="speak(n.toString())">
                      <div class="number">{{ n }}</div>
                      <div class="chinese-number text-muted small">{{ chineseNumbers[n-1] }}</div>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="tab-pane fade" 
                   :class="{ 'show active': activeMathTab === 'counting' }" 
                   id="counting" 
                   role="tabpanel">
                <h3 class="mt-3">数一数有几个？</h3>
                <div class="text-center my-4">
                  <div class="question-display">
                    <div class="d-flex justify-content-center flex-wrap">
                      <i v-for="i in countingQuestion.count" :key="i" class="bi bi-apple" style="font-size: 2rem; color: red; margin: 5px;"></i>
                    </div>
                  </div>
                  
                  <div class="options mt-4">
                    <div v-for="option in countingQuestion.options" :key="option" 
                         class="question-option d-inline-block mx-2" 
                         :class="{ selected: selectedCountingAnswer === option }"
                         @click="selectCountingAnswer(option)">
                      {{ option }}
                    </div>
                  </div>
                  
                  <div class="mt-3" v-if="countingResult !== null">
                    <div v-if="countingResult" class="text-success">
                      <i class="bi bi-check-circle-fill result-icon"></i>
                      <h4>答对了！真棒！</h4>
                    </div>
                    <div v-else class="text-danger">
                      <i class="bi bi-x-circle-fill result-icon"></i>
                      <h4>再试试看哦！</h4>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="tab-pane fade"
                   :class="{ 'show active': activeMathTab === 'addition' }"
                   id="addition"
                   role="tabpanel">
                <h3 class="mt-3">加法练习</h3>

                <!-- 练习区域 -->
                <div class="practice-area">
                  <div class="text-center my-4">
                    <div class="question-display">
                      <h4>{{ additionQuestion.a }} + {{ additionQuestion.b }} = ?</h4>
                    </div>

                    <div class="options mt-4">
                      <div v-for="option in additionQuestion.options" :key="option"
                           class="question-option d-inline-block mx-2"
                           :class="{ selected: selectedAdditionAnswer === option }"
                           @click="selectAdditionAnswer(option)">
                        {{ option }}
                      </div>
                    </div>

                    <div class="mt-3" v-if="additionResult !== null">
                      <div v-if="additionResult" class="text-success">
                        <i class="bi bi-check-circle-fill result-icon"></i>
                        <h4>答对了！真棒！</h4>
                      </div>
                      <div v-else class="text-danger">
                        <i class="bi bi-x-circle-fill result-icon"></i>
                        <h4>再试试看哦！</h4>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- 统计卡片 -->
                <div class="stats-section mt-5">
                  <h4 class="mb-3">
                    <i class="bi bi-calendar-day"></i> 今日练习统计
                    <small class="text-muted ms-2">{{ getCurrentDateString() }}</small>
                  </h4>
                  <div class="row">
                    <div class="col-md-3 col-6 mb-3">
                      <div class="card bg-primary text-white">
                        <div class="card-body text-center">
                          <h5>总题数</h5>
                          <h3>{{ additionStats.totalQuestions }}</h3>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                      <div class="card bg-success text-white">
                        <div class="card-body text-center">
                          <h5>答对</h5>
                          <h3>{{ additionStats.correctAnswers }}</h3>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                      <div class="card bg-danger text-white">
                        <div class="card-body text-center">
                          <h5>答错</h5>
                          <h3>{{ additionStats.wrongAnswers }}</h3>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                      <div class="card bg-info text-white">
                        <div class="card-body text-center">
                          <h5>正确率</h5>
                          <h3>{{ additionStats.accuracy }}%</h3>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- 历史记录展开区域 -->
                <div class="history-section mt-5">
                  <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="mb-0">
                      <i class="bi bi-clock-history"></i> 答题历史
                    </h4>
                    <div>
                      <button class="btn btn-outline-primary btn-sm me-2"
                              @click="toggleHistoryExpanded">
                        <i class="bi" :class="historyExpanded ? 'bi-chevron-up' : 'bi-chevron-down'"></i>
                        {{ historyExpanded ? '收起' : '展开' }}详细记录
                      </button>
                      <button class="btn btn-outline-info btn-sm me-2"
                              @click="resetTodayStats"
                              v-if="additionStats.totalQuestions > 0">
                        <i class="bi bi-arrow-clockwise"></i> 重置今日
                      </button>
                      <button class="btn btn-outline-warning btn-sm"
                              @click="clearPracticeHistory('addition')"
                              v-if="Object.keys(additionHistory).length > 0">
                        <i class="bi bi-trash"></i> 清空全部
                      </button>
                    </div>
                  </div>

                  <!-- 简要统计 -->
                  <div class="history-summary p-3 bg-light rounded">
                    <div class="row text-center">
                      <div class="col-3">
                        <div class="fw-bold text-primary">{{ Object.keys(additionHistory).length }}</div>
                        <small class="text-muted">累计题目</small>
                      </div>
                      <div class="col-3">
                        <div class="fw-bold text-success">{{ allTimeStats.correctAnswers }}</div>
                        <small class="text-muted">累计答对</small>
                      </div>
                      <div class="col-3">
                        <div class="fw-bold text-danger">{{ allTimeStats.wrongAnswers }}</div>
                        <small class="text-muted">累计答错</small>
                      </div>
                      <div class="col-3">
                        <div class="fw-bold text-info">{{ allTimeStats.accuracy }}%</div>
                        <small class="text-muted">累计正确率</small>
                      </div>
                    </div>
                  </div>

                  <!-- 详细历史记录 -->
                  <div v-show="historyExpanded" class="history-details mt-3">
                    <div v-if="Object.keys(additionHistory).length === 0" class="text-center text-muted py-5">
                      <i class="bi bi-clipboard-x" style="font-size: 3rem;"></i>
                      <h5 class="mt-3">暂无历史记录</h5>
                      <p>开始练习加法题目后，这里会显示你的答题历史</p>
                    </div>

                    <div v-else class="table-responsive">
                      <table class="table table-striped table-hover">
                        <thead class="table-dark">
                          <tr>
                            <th>题目</th>
                            <th>正确次数</th>
                            <th>错误次数</th>
                            <th>总次数</th>
                            <th>正确率</th>
                            <th>最后答题时间</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr v-for="(record, question) in sortedAdditionHistory" :key="question">
                            <td class="fw-bold">{{ question }}</td>
                            <td class="text-success">{{ record.correct }}</td>
                            <td class="text-danger">{{ record.wrong }}</td>
                            <td>{{ record.correct + record.wrong }}</td>
                            <td>
                              <span class="badge" :class="getAccuracyBadgeClass(record.correct, record.wrong)">
                                {{ Math.round(record.correct / (record.correct + record.wrong) * 100) }}%
                              </span>
                            </td>
                            <td class="text-muted">{{ formatTime(record.lastTime) }}</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- 英语内容 -->
          <div v-if="currentSubject.key === 'english'">
            <ul class="nav nav-tabs" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link" 
                        :class="{ active: activeEnglishTab === 'alphabet' }"
                        data-bs-toggle="tab" 
                        data-bs-target="#alphabet" 
                        type="button" 
                        role="tab"
                        @click="setActiveTab('english', 'alphabet')">字母学习</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" 
                        :class="{ active: activeEnglishTab === 'words' }"
                        data-bs-toggle="tab" 
                        data-bs-target="#english-words" 
                        type="button" 
                        role="tab"
                        @click="setActiveTab('english', 'words')">单词学习</button>
              </li>
            </ul>
            <div class="tab-content">
              <div class="tab-pane fade" 
                   :class="{ 'show active': activeEnglishTab === 'alphabet' }" 
                   id="alphabet" 
                   role="tabpanel">
                <h3 class="mt-3">英文字母</h3>
                <div class="row">
                  <div v-for="letter in english.alphabet" :key="letter" class="col-2 mb-3">
                    <div class="alphabet-card bg-light" @click="speak(letter)">
                      {{ letter }}
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="tab-pane fade" 
                   :class="{ 'show active': activeEnglishTab === 'words' }" 
                   id="english-words" 
                   role="tabpanel">
                <h3 class="mt-3">基础单词</h3>
                <div class="row">
                  <div v-for="word in english.words" :key="word.word" class="col-6 col-md-3 mb-3">
                    <div class="word-card bg-light" @click="speak(word.word)">
                      <img :src="getEmojiImageUrl(word.emojiCode)" 
                           :alt="word.word" 
                           class="word-image" 
                           loading="lazy"
                           @error="handleImageError($event, word.emojiCode)">
                      <div class="word">{{ word.word }}</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 页脚 -->
    <footer class="footer">
      <div class="container">
        <div class="row">
          <div class="col-md-6">
            <h5><i class="bi bi-info-circle"></i> 关于我们</h5>
            <p>幼儿园大班学习乐园致力于为孩子们提供有趣、互动、有效的学习体验。</p>
            <p>通过游戏化的学习方式，让孩子们在快乐中掌握基础知识。</p>
          </div>
          <div class="col-md-6">
            <h5><i class="bi bi-envelope"></i> 联系我们</h5>
            <div class="contact-info">
              <div class="contact-item">
                <i class="bi bi-qq"></i>
                <span>QQ号码：<strong>1638988</strong>（可添加微信）</span>
              </div>
              <div class="contact-item">
                <i class="bi bi-envelope"></i>
                <span>邮箱：<a href="mailto:1638988@qq.com">1638988@qq.com</a></span>
              </div>
              <div class="contact-item">
                <i class="bi bi-envelope"></i>
                <span>备用邮箱：<a href="mailto:chenping@live.cn">chenping@live.cn</a></span>
              </div>
              <div class="contact-item">
                <i class="bi bi-chat-dots"></i>
                <span>欢迎反馈问题或提出建议！</span>
              </div>
            </div>
          </div>
        </div>
        <div class="row mt-3">
          <div class="col-12 text-center">
            <p class="mb-0">&copy; 2024 幼儿园大班学习乐园. 让学习变得更有趣！</p>
          </div>
        </div>
      </div>
    </footer>
  </div>

  <script>
    // 页面加载时使用智能资源管理器加载资源
    document.addEventListener('DOMContentLoaded', function() {
      console.log('页面加载完成，开始智能加载资源...');
      
      if (window.smartResourceManager) {
        // 使用智能资源管理器重新加载CSS（会覆盖备用方案）
        setTimeout(() => {
          window.smartResourceManager.loadCSS('bootstrap-css');
          window.smartResourceManager.loadCSS('bootstrap-icons');
        }, 100);
        
        // 使用智能资源管理器加载JS
        window.smartResourceManager.loadJS('vue-js');
        window.smartResourceManager.loadJS('bootstrap-js');
        
        // 等待Vue.js加载完成后初始化应用
        const checkVueLoaded = setInterval(() => {
          if (window.Vue) {
            clearInterval(checkVueLoaded);
            console.log('Vue.js加载完成，初始化应用...');
            initializeApp();
          }
        }, 100);
      } else {
        console.warn('智能资源管理器未找到，使用备用方案...');
        // 备用方案 - 直接加载JS
        const fallbackJS = [
          'https://cdn.jsdelivr.net/npm/vue@3.3.4/dist/vue.global.min.js',
          'https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js'
        ];
        
        let loadedCount = 0;
        fallbackJS.forEach(src => {
          const script = document.createElement('script');
          script.src = src;
          script.onload = () => {
            loadedCount++;
            if (loadedCount === fallbackJS.length) {
              initializeApp();
            }
          };
          document.head.appendChild(script);
        });
      }
    });
  </script>
  
  <script>
    // 简化的Vue应用初始化
    function initializeApp() {
      if (!window.Vue) {
        console.error('Vue未加载，无法初始化应用');
        return;
      }
      
      const { createApp, ref, reactive, computed, onMounted } = Vue;
      
      createApp({
        setup() {
          // 页面状态
          const currentPage = ref('home');
          const currentSubject = ref(null);
          
          // 标签页状态
          const activeChineseTab = ref('pinyin');
          const activeMathTab = ref('numbers');
          const activeEnglishTab = ref('alphabet');
          
          // 学科数据
          const subjects = {
            chinese: {
              key: 'chinese',
              title: '语文学习',
              icon: 'book'
            },
            math: {
              key: 'math',
              title: '数学学习',
              icon: 'calculator'
            },
            english: {
              key: 'english',
              title: '英语学习',
              icon: 'globe'
            }
          };
          
          // 语文内容
          const chinese = {
            initials: ['b', 'p', 'm', 'f', 'd', 't', 'n', 'l', 'g', 'k', 'h', 'j', 'q', 'x', 'zh', 'ch', 'sh', 'r', 'z', 'c', 's', 'y', 'w'],
            finals: ['a', 'o', 'e', 'i', 'u', 'ü', 'ai', 'ei', 'ui', 'ao', 'ou', 'iu', 'ie', 'üe', 'er', 'an', 'en', 'in', 'un', 'ün', 'ang', 'eng', 'ing', 'ong'],
            characters: [
              { char: '一', pinyin: 'yī' },
              { char: '二', pinyin: 'èr' },
              { char: '三', pinyin: 'sān' },
              { char: '四', pinyin: 'sì' },
              { char: '五', pinyin: 'wǔ' },
              { char: '六', pinyin: 'liù' },
              { char: '七', pinyin: 'qī' },
              { char: '八', pinyin: 'bā' },
              { char: '九', pinyin: 'jiǔ' },
              { char: '十', pinyin: 'shí' },
              { char: '人', pinyin: 'rén' },
              { char: '口', pinyin: 'kǒu' },
              { char: '手', pinyin: 'shǒu' },
              { char: '水', pinyin: 'shuǐ' },
              { char: '火', pinyin: 'huǒ' },
              { char: '山', pinyin: 'shān' },
              { char: '石', pinyin: 'shí' },
              { char: '田', pinyin: 'tián' },
              { char: '土', pinyin: 'tǔ' },
              { char: '木', pinyin: 'mù' }
            ],
            words: [
              { word: '太阳', pinyin: 'tài yáng' },
              { word: '月亮', pinyin: 'yuè liàng' },
              { word: '星星', pinyin: 'xīng xīng' },
              { word: '花朵', pinyin: 'huā duǒ' },
              { word: '草地', pinyin: 'cǎo dì' },
              { word: '大树', pinyin: 'dà shù' },
              { word: '小鸟', pinyin: 'xiǎo niǎo' },
              { word: '小鱼', pinyin: 'xiǎo yú' },
              { word: '妈妈', pinyin: 'mā ma' },
              { word: '爸爸', pinyin: 'bà ba' },
              { word: '老师', pinyin: 'lǎo shī' },
              { word: '学校', pinyin: 'xué xiào' }
            ],
            poems: [
              { title: '静夜思', author: '李白', content: '床前明月光，疑是地上霜。举头望明月，低头思故乡。', meaning: '这首诗描写了秋日夜晚，诗人看到月光洒在床前，以为是地上的霜，抬头望月，低头思念故乡的情景。' },
              { title: '春晓', author: '孟浩然', content: '春眠不觉晓，处处闻啼鸟。夜来风雨声，花落知多少。', meaning: '这首诗描写了春天早晨醒来后，听到鸟儿啼叫，想起夜里风雨声，不知有多少花儿被吹落的情景。' },
              { title: '咏鹅', author: '骆宾王', content: '鹅，鹅，鹅，曲项向天歌。白毛浮绿水，红掌拨清波。', meaning: '这首诗描写了鹅的形象，鹅弯曲着脖子向天鸣叫，白色的羽毛浮在绿色的水面上，红色的脚掌拨动着清澈的水波。' },
              { title: '登鹳雀楼', author: '王之涣', content: '白日依山尽，黄河入海流。欲穷千里目，更上一层楼。', meaning: '这首诗描写了诗人登楼远眺的所见所感，太阳依着山峦落下，黄河奔流入海，要想看到更远的景色，就要再上一层楼。' },
              { title: '悯农', author: '李绅', content: '锄禾日当午，汗滴禾下土。谁知盘中餐，粒粒皆辛苦。', meaning: '这首诗描写了农民在烈日下锄禾的辛苦劳作，表达了对农民辛勤劳动的同情和对粮食来之不易的感慨。' },
              { title: '江雪', author: '柳宗元', content: '千山鸟飞绝，万径人踪灭。孤舟蓑笠翁，独钓寒江雪。', meaning: '这首诗描绘了一幅江雪独钓的画面，千山万径都没有鸟飞人行的踪迹，只有一位老翁独自在江上雪中垂钓。' }
            ],
            idioms: [
              { idiom: '一心一意', pinyin: 'yī xīn yī yì', meaning: '形容做事专心一意，一门心思。' },
              { idiom: '一心二用', pinyin: 'yī xīn èr yòng', meaning: '形容同时做两件事，注意力分散。' },
              { idiom: '三心二意', pinyin: 'sān xīn èr yì', meaning: '形容意志不坚定，犹豫不决。' },
              { idiom: '四海为家', pinyin: 'sì hǎi wéi jiā', meaning: '形容到处都可以安家立业。' },
              { idiom: '五湖四海', pinyin: 'wǔ hú sì hǎi', meaning: '形容全国各地，有时也指世界各地。' },
              { idiom: '六神无主', pinyin: 'liù shén wú zhǔ', meaning: '形容惊慌着急，没有主意。' },
              { idiom: '七上八下', pinyin: 'qī shàng bā xià', meaning: '形容心里慌乱不安，或事物零落不齐。' },
              { idiom: '八仙过海', pinyin: 'bā xiān guò hǎi', meaning: '比喻各自有一套办法，或各自施展本领，互相竞赛。' },
              { idiom: '九牛一毛', pinyin: 'jiǔ niú yī máo', meaning: '形容极大数量中的极小部分，微不足道。' },
              { idiom: '十全十美', pinyin: 'shí quán shí měi', meaning: '形容事物完美无缺，各方面都非常好。' },
              { idiom: '百折不挠', pinyin: 'bǎi zhé bù náo', meaning: '形容意志坚强，无论受到多少挫折都不退缩。' },
              { idiom: '千方百计', pinyin: 'qiān fāng bǎi jì', meaning: '形容想尽一切办法，费尽心机。' }
            ]
          };
          
          // 英语内容
          const english = {
            alphabet: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split(''),
            words: [
              { word: 'Apple', emojiCode: '1f34e' },
              { word: 'Ball', emojiCode: '1f3c0' },
              { word: 'Cat', emojiCode: '1f431' },
              { word: 'Dog', emojiCode: '1f436' },
              { word: 'Elephant', emojiCode: '1f418' },
              { word: 'Fish', emojiCode: '1f41f' },
              { word: 'Giraffe', emojiCode: '1f992' },
              { word: 'House', emojiCode: '1f3e0' },
              { word: 'Ice cream', emojiCode: '1f368' },
              { word: 'Juice', emojiCode: '1f9c3' },
              { word: 'Kite', emojiCode: '1fa81' },
              { word: 'Lion', emojiCode: '1f981' }
            ]
          };
          
          // 数学内容
          const chineseNumbers = ['一', '二', '三', '四', '五', '六', '七', '八', '九', '十', '十一', '十二', '十三', '十四', '十五', '十六', '十七', '十八', '十九', '二十'];
          
          // 数数练习题目
          const countingQuestion = reactive({
            count: 0,
            options: []
          });
          
          // 加法练习题目
          const additionQuestion = reactive({
            a: 0,
            b: 0,
            options: []
          });
          
          // 用户选择的答案
          const selectedCountingAnswer = ref(null);
          const selectedAdditionAnswer = ref(null);
          
          // 答题结果
          const countingResult = ref(null);
          const additionResult = ref(null);

          // 历史记录展开状态
          const historyExpanded = ref(false);

          // 加法练习历史记录
          const additionHistory = reactive({});

          // 加法练习统计数据（今日）
          const additionStats = reactive({
            totalQuestions: 0,
            correctAnswers: 0,
            wrongAnswers: 0,
            accuracy: 0
          });

          // 加法练习今日记录
          const additionTodayHistory = reactive({});

          // 加法练习累计统计数据
          const allTimeStats = reactive({
            totalQuestions: 0,
            correctAnswers: 0,
            wrongAnswers: 0,
            accuracy: 0
          });

          // 未来扩展示例：减法练习历史记录和统计数据
          // const subtractionHistory = reactive({});
          // const subtractionStats = reactive({
          //   totalQuestions: 0,
          //   correctAnswers: 0,
          //   wrongAnswers: 0,
          //   accuracy: 0
          // });

          // 未来扩展示例：数数练习历史记录和统计数据
          // const countingHistory = reactive({});
          // const countingStats = reactive({
          //   totalQuestions: 0,
          //   correctAnswers: 0,
          //   wrongAnswers: 0,
          //   accuracy: 0
          // });
          
          // 设置活动标签页
          const setActiveTab = (subject, tab) => {
            switch(subject) {
              case 'chinese':
                activeChineseTab.value = tab;
                break;
              case 'math':
                activeMathTab.value = tab;
                break;
              case 'english':
                activeEnglishTab.value = tab;
                break;
            }
            
            // 保存标签页状态到localStorage
            localStorage.setItem(`activeTab_${subject}`, tab);
            
            // 更新URL参数
            if (currentSubject.value) {
              const url = new URL(window.location);
              url.searchParams.set('subject', currentSubject.value.key);
              
              switch(currentSubject.value.key) {
                case 'chinese':
                  url.searchParams.set('tab', activeChineseTab.value);
                  break;
                case 'math':
                  url.searchParams.set('tab', activeMathTab.value);
                  break;
                case 'english':
                  url.searchParams.set('tab', activeEnglishTab.value);
                  break;
              }
              
              window.history.replaceState({}, '', url);
            }
          };
          
          // 从localStorage恢复标签页状态
          const restoreTabState = () => {
            const chineseTab = localStorage.getItem('activeTab_chinese');
            const mathTab = localStorage.getItem('activeTab_math');
            const englishTab = localStorage.getItem('activeTab_english');
            
            if (chineseTab) activeChineseTab.value = chineseTab;
            if (mathTab) activeMathTab.value = mathTab;
            if (englishTab) activeEnglishTab.value = englishTab;
          };
          
          // 选择学科
          const selectSubject = (subjectKey, updateUrl = true) => {
            currentSubject.value = subjects[subjectKey];
            currentPage.value = 'subject';
            
            // 初始化题目
            if (subjectKey === 'math') {
              generateCountingQuestion();
              generateAdditionQuestion();
            }
            
            // 更新URL参数
            if (updateUrl) {
              const url = new new URL(window.location);
              url.searchParams.set('subject', subjectKey);
              
              // 设置默认标签页
              let defaultTab = '';
              switch(subjectKey) {
                case 'chinese':
                  defaultTab = activeChineseTab.value;
                  break;
                case 'math':
                  defaultTab = activeMathTab.value;
                  break;
                case 'english':
                  defaultTab = activeEnglishTab.value;
                  break;
              }
              
              url.searchParams.set('tab', defaultTab);
              window.history.replaceState({}, '', url);
            }
          };
          
          // 返回主页
          const goHome = () => {
            currentPage.value = 'home';
            currentSubject.value = null;
            
            // 清理URL参数
            const url = new URL(window.location);
            url.searchParams.delete('subject');
            url.searchParams.delete('tab');
            window.history.replaceState({}, '', url);
          };
          
          // 生成数数题目
          const generateCountingQuestion = () => {
            countingQuestion.count = Math.floor(Math.random() * 10) + 1; // 1-10
            const correctAnswer = countingQuestion.count;
            const options = new Set([correctAnswer]);
            
            // 生成3个错误选项
            while (options.size < 4) {
              const wrong = correctAnswer + Math.floor(Math.random() * 5) - 2;
              if (wrong > 0 && wrong <= 12 && wrong !== correctAnswer) {
                options.add(wrong);
              }
            }
            
            countingQuestion.options = Array.from(options).sort(() => Math.random() - 0.5);
            selectedCountingAnswer.value = null;
            countingResult.value = null;
          };
          
          // 生成加法题目
          const generateAdditionQuestion = () => {
            additionQuestion.a = Math.floor(Math.random() * 10) + 1; // 1-10
            additionQuestion.b = Math.floor(Math.random() * (10 - additionQuestion.a)) + 1; // 确保和不超过10
            const correctAnswer = additionQuestion.a + additionQuestion.b;
            const options = new Set([correctAnswer]);
            
            // 生成3个错误选项
            while (options.size < 4) {
              const wrong = correctAnswer + Math.floor(Math.random() * 5) - 2;
              if (wrong >= 0 && wrong <= 20 && wrong !== correctAnswer) {
                options.add(wrong);
              }
            }
            
            additionQuestion.options = Array.from(options).sort(() => Math.random() - 0.5);
            selectedAdditionAnswer.value = null;
            additionResult.value = null;
          };
          
          // 选择答案并立即提交
          const selectCountingAnswer = (answer) => {
            selectedCountingAnswer.value = answer;
            // 自动检查答案
            checkCountingAnswer();
            // 1.5秒后自动进入下一题
            setTimeout(() => {
              nextCountingQuestion();
            }, 1500);
          };
          
          const selectAdditionAnswer = (answer) => {
            selectedAdditionAnswer.value = answer;
            // 自动检查答案
            checkAdditionAnswer();
            // 记录答题历史
            recordAdditionAnswer(answer);
            // 1.5秒后自动进入下一题
            setTimeout(() => {
              nextAdditionQuestion();
            }, 1500);
          };
          
          // 检查答案
          const checkCountingAnswer = () => {
            countingResult.value = selectedCountingAnswer.value === countingQuestion.count;
          };
          
          const checkAdditionAnswer = () => {
            additionResult.value = selectedAdditionAnswer.value === (additionQuestion.a + additionQuestion.b);
          };
          
          // 下一题
          const nextCountingQuestion = () => {
            generateCountingQuestion();
          };
          
          const nextAdditionQuestion = () => {
            generateAdditionQuestion();
          };
          
          // 通用的练习答题记录方法
          const recordPracticeAnswer = (practiceType, question, userAnswer, correctAnswer) => {
            let history, saveFunction;

            // 根据练习类型选择对应的数据结构
            switch(practiceType) {
              case 'addition':
                history = additionHistory;
                saveFunction = saveAdditionHistory;
                break;
              // 未来可以添加其他练习类型
              // case 'subtraction':
              //   history = subtractionHistory;
              //   saveFunction = saveSubtractionHistory;
              //   break;
              default:
                console.warn(`未知的练习类型: ${practiceType}`);
                return;
            }

            const isCorrect = userAnswer === correctAnswer;

            // 初始化题目记录
            if (!history[question]) {
              history[question] = {
                correct: 0,
                wrong: 0,
                lastTime: null
              };
            }

            // 更新记录
            if (isCorrect) {
              history[question].correct++;
            } else {
              history[question].wrong++;
            }

            history[question].lastTime = new Date().toISOString();

            // 保存到localStorage
            saveFunction();

            // 重新计算今日统计（仅对加法练习）
            if (practiceType === 'addition') {
              calculateTodayStats();
            }
          };

          // 加法练习专用的记录方法（保持向后兼容）
          const recordAdditionAnswer = (answer) => {
            const question = `${additionQuestion.a} + ${additionQuestion.b}`;
            const correctAnswer = additionQuestion.a + additionQuestion.b;
            recordPracticeAnswer('addition', question, answer, correctAnswer);
          };

          // 保存历史记录到localStorage
          const saveAdditionHistory = () => {
            localStorage.setItem('additionHistory', JSON.stringify(additionHistory));
            // 注意：不再保存统计数据，因为统计数据现在是基于今日动态计算的
          };

          // 从localStorage加载历史记录
          const loadAdditionHistory = () => {
            const savedHistory = localStorage.getItem('additionHistory');
            const savedExpanded = localStorage.getItem('historyExpanded');

            if (savedHistory) {
              const parsedHistory = JSON.parse(savedHistory);
              Object.assign(additionHistory, parsedHistory);
            }

            if (savedExpanded) {
              historyExpanded.value = savedExpanded === 'true';
            }

            // 加载完成后计算今日统计
            calculateTodayStats();
          };

          // 切换历史记录展开状态
          const toggleHistoryExpanded = () => {
            historyExpanded.value = !historyExpanded.value;
            // 保存展开状态到localStorage
            localStorage.setItem('historyExpanded', historyExpanded.value.toString());
          };

          // 重置今日统计（清除今日的答题记录）
          const resetTodayStats = () => {
            if (confirm('确定要重置今日练习统计吗？这将清除今天的所有答题记录，但保留历史记录。')) {
              // 遍历历史记录，清除今日的答题次数
              Object.entries(additionHistory).forEach(([question, record]) => {
                if (isToday(record.lastTime)) {
                  // 如果这道题只在今天答过，则完全删除
                  // 否则保留题目但清零今日的答题次数（这里简化处理，直接删除今日记录）
                  delete additionHistory[question];
                }
              });

              // 保存更改并重新计算统计
              saveAdditionHistory();
              calculateTodayStats();
            }
          };

          // 通用的练习历史记录清空方法
          const clearPracticeHistory = (practiceType) => {
            const practiceNames = {
              'addition': '加法练习',
              'subtraction': '减法练习',
              'counting': '数数练习'
            };

            const practiceName = practiceNames[practiceType] || '练习';

            if (confirm(`确定要清空${practiceName}的所有历史记录吗？此操作不可恢复。`)) {
              switch(practiceType) {
                case 'addition':
                  Object.keys(additionHistory).forEach(key => delete additionHistory[key]);
                  Object.keys(additionTodayHistory).forEach(key => delete additionTodayHistory[key]);
                  additionStats.totalQuestions = 0;
                  additionStats.correctAnswers = 0;
                  additionStats.wrongAnswers = 0;
                  additionStats.accuracy = 0;
                  allTimeStats.totalQuestions = 0;
                  allTimeStats.correctAnswers = 0;
                  allTimeStats.wrongAnswers = 0;
                  allTimeStats.accuracy = 0;
                  saveAdditionHistory();
                  break;
                // 未来可以添加其他练习类型的清空逻辑
                // case 'subtraction':
                //   clearSubtractionHistory();
                //   break;
                // case 'counting':
                //   clearCountingHistory();
                //   break;
              }
            }
          };

          // 获取正确率徽章样式
          const getAccuracyBadgeClass = (correct, wrong) => {
            const accuracy = correct / (correct + wrong) * 100;
            if (accuracy >= 90) return 'bg-success';
            if (accuracy >= 70) return 'bg-warning';
            return 'bg-danger';
          };

          // 格式化时间显示
          const formatTime = (timeString) => {
            if (!timeString) return '未知';
            const date = new Date(timeString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);

            if (diffMins < 1) return '刚刚';
            if (diffMins < 60) return `${diffMins}分钟前`;
            if (diffHours < 24) return `${diffHours}小时前`;
            if (diffDays < 7) return `${diffDays}天前`;

            return date.toLocaleDateString('zh-CN', {
              year: 'numeric',
              month: 'short',
              day: 'numeric',
              hour: '2-digit',
              minute: '2-digit'
            });
          };

          // 获取当前日期字符串（YYYY-MM-DD格式）
          const getCurrentDateString = () => {
            const today = new Date();
            return today.toLocaleDateString('zh-CN', {
              year: 'numeric',
              month: '2-digit',
              day: '2-digit'
            }).replace(/\//g, '-');
          };

          // 检查是否为今天的记录
          const isToday = (timeString) => {
            if (!timeString) return false;
            const recordDate = new Date(timeString);
            const today = new Date();
            return recordDate.toDateString() === today.toDateString();
          };

          // 计算今日统计和累计统计数据
          const calculateTodayStats = () => {
            let todayCorrect = 0;
            let todayWrong = 0;
            let todayTotal = 0;

            let allTimeCorrect = 0;
            let allTimeWrong = 0;
            let allTimeTotal = 0;

            // 清空今日历史记录
            Object.keys(additionTodayHistory).forEach(key => delete additionTodayHistory[key]);

            // 遍历所有历史记录
            Object.entries(additionHistory).forEach(([question, record]) => {
              // 累计所有时间的统计
              allTimeCorrect += record.correct;
              allTimeWrong += record.wrong;
              allTimeTotal += record.correct + record.wrong;

              // 筛选今日的记录
              if (isToday(record.lastTime)) {
                // 添加到今日历史记录
                additionTodayHistory[question] = { ...record };

                // 累计今日统计
                todayCorrect += record.correct;
                todayWrong += record.wrong;
                todayTotal += record.correct + record.wrong;
              }
            });

            // 更新今日统计数据
            additionStats.totalQuestions = todayTotal;
            additionStats.correctAnswers = todayCorrect;
            additionStats.wrongAnswers = todayWrong;
            additionStats.accuracy = todayTotal > 0
              ? Math.round((todayCorrect / todayTotal) * 100)
              : 0;

            // 更新累计统计数据
            allTimeStats.totalQuestions = allTimeTotal;
            allTimeStats.correctAnswers = allTimeCorrect;
            allTimeStats.wrongAnswers = allTimeWrong;
            allTimeStats.accuracy = allTimeTotal > 0
              ? Math.round((allTimeCorrect / allTimeTotal) * 100)
              : 0;
          };

          // 语音播放功能（简化版）
          const speak = (text) => {
            console.log("播放语音: " + text);
          };

          // 获取emoji图片URL（使用可靠的CDN）
          const getEmojiImageUrl = (emojiCode) => {
            return `https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/${emojiCode}.png`;
          };

          // 处理图片加载错误
          const handleImageError = (event, emojiCode) => {
            console.warn(`图片加载失败: ${emojiCode}`);
            // 显示占位符
            event.target.style.display = 'none';
            const placeholder = document.createElement('div');
            placeholder.className = 'image-placeholder';
            placeholder.innerHTML = '<i class="bi bi-image"></i>';
            event.target.parentNode.insertBefore(placeholder, event.target);
          };
          
          // 计算属性：按最后答题时间排序的历史记录
          const sortedAdditionHistory = computed(() => {
            const entries = Object.entries(additionHistory);
            return entries.sort((a, b) => {
              const timeA = new Date(a[1].lastTime || 0);
              const timeB = new Date(b[1].lastTime || 0);
              return timeB - timeA; // 最新的在前
            }).reduce((obj, [key, value]) => {
              obj[key] = value;
              return obj;
            }, {});
          });

          // 组件挂载时恢复状态
          onMounted(() => {
            restoreTabState();
            loadAdditionHistory(); // 加载历史记录

            // 从URL参数恢复状态
            const urlParams = new URLSearchParams(window.location.search);
            const subjectParam = urlParams.get('subject');
            const tabParam = urlParams.get('tab');

            if (subjectParam && subjects[subjectParam]) {
              selectSubject(subjectParam, false); // 不更新URL，因为我们正在从URL恢复

              if (tabParam) {
                setTimeout(() => {
                  setActiveTab(subjectParam, tabParam);
                }, 0);
              }
            }
          });
          
          return {
            currentPage,
            currentSubject,
            activeChineseTab,
            activeMathTab,
            activeEnglishTab,
            chinese,
            english,
            chineseNumbers,
            countingQuestion,
            additionQuestion,
            selectedCountingAnswer,
            selectedAdditionAnswer,
            countingResult,
            additionResult,
            historyExpanded,
            additionHistory,
            additionTodayHistory,
            additionStats,
            allTimeStats,
            sortedAdditionHistory,
            selectSubject,
            goHome,
            generateCountingQuestion,
            generateAdditionQuestion,
            selectCountingAnswer,
            selectAdditionAnswer,
            checkCountingAnswer,
            checkAdditionAnswer,
            nextCountingQuestion,
            nextAdditionQuestion,
            setActiveTab,
            speak,
            getEmojiImageUrl,
            handleImageError,
            recordAdditionAnswer,
            recordPracticeAnswer,
            toggleHistoryExpanded,
            resetTodayStats,
            clearPracticeHistory,
            getAccuracyBadgeClass,
            formatTime,
            getCurrentDateString,
            calculateTodayStats
          };
        }
      }).mount('#app');
    }
  </script>
</body>
</html>