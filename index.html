<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>幼儿园大班学习乐园</title>
  
  <!-- 智能资源管理器 -->
  <script src="assets/js/smart-resource-manager.js"></script>
  <script src="assets/js/cdn-manager.js"></script>
  
  <!-- Bootstrap CSS 备用方案 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.min.css" rel="stylesheet">
  
  <style>
    body {
      font-family: '幼圆', '微软雅黑', sans-serif;
      background: linear-gradient(135deg, #6ecbf5 0%, #cdefff 100%);
      min-height: 100vh;
      padding-bottom: 20px;
    }
    
    /* 解决Vue页面加载时的闪现问题 */
    [v-cloak] {
      display: none;
    }
    
    .header {
      background: linear-gradient(to right, #ff9966, #ff5e62);
      color: white;
      border-radius: 0 0 20px 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      padding: 15px 0;
    }
    
    .subject-card {
      border-radius: 20px;
      transition: all 0.3s ease;
      cursor: pointer;
      height: 100%;
      box-shadow: 0 6px 12px rgba(0,0,0,0.1);
    }
    
    .subject-card:hover {
      transform: translateY(-10px);
      box-shadow: 0 12px 20px rgba(0,0,0,0.15);
    }
    
    .subject-icon {
      font-size: 3rem;
      margin-bottom: 15px;
    }
    
    .content-area {
      background: white;
      border-radius: 20px;
      box-shadow: 0 6px 15px rgba(0,0,0,0.1);
      padding: 20px;
      min-height: 400px;
      margin-top: 20px;
    }
    
    .back-btn {
      position: absolute;
      top: 20px;
      left: 20px;
      z-index: 100;
    }
    
    .activity-card {
      border-radius: 15px;
      transition: all 0.3s;
      cursor: pointer;
      border: 2px solid #eee;
    }
    
    .activity-card:hover {
      transform: scale(1.03);
      border-color: #6ecbf5;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .btn-primary {
      background: linear-gradient(to right, #4facfe 0%, #00f2fe 100%);
      border: none;
    }
    
    .btn-success {
      background: linear-gradient(to right, #0ba360 0%, #3cba92 100%);
      border: none;
    }
    
    .btn-warning {
      background: linear-gradient(to right, #ff758c 0%, #ff7eb3 100%);
      border: none;
    }
    
    h1, h2, h3, h4 {
      font-weight: bold;
    }
    
    .alphabet-card {
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s;
      border: 2px solid #dee2e6;
      border-radius: 10px;
      margin: 5px;
    }
    
    .alphabet-card:hover {
      transform: scale(1.1);
      border-color: #4facfe;
      background-color: #f8f9fa;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .number-card {
      height: 100px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s;
      border: 2px solid #dee2e6;
      border-radius: 10px;
      margin: 5px;
    }
    
    .number-card:hover {
      transform: scale(1.1);
      border-color: #4facfe;
      background-color: #f8f9fa;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .word-card {
      min-height: 120px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
      border: 2px solid #dee2e6;
      border-radius: 15px;
      margin: 10px;
      padding: 15px;
    }
    
    .word-card:hover {
      transform: scale(1.05);
      border-color: #4facfe;
      background-color: #f8f9fa;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .word-image {
      width: 80px;
      height: 80px;
      object-fit: contain;
      margin-bottom: 10px;
    }
    
    /* 关键帧动画优化 */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .fade-in {
      animation: fadeIn 0.5s ease-in;
    }
    
    .result-icon {
      font-size: 5rem;
      margin: 20px 0;
    }
    
    .question-option {
      border: 2px solid #dee2e6;
      border-radius: 10px;
      padding: 15px;
      margin: 10px 0;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .question-option:hover {
      border-color: #4facfe;
      background-color: #f8f9fa;
    }
    
    .question-option.selected {
      border-color: #4facfe;
      background-color: #e6f7ff;
      box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.2);
    }
    
    /* 图片加载状态样式 */
    .image-placeholder {
      width: 80px;
      height: 80px;
      background-color: #f0f0f0;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 10px;
      border-radius: 5px;
    }
    
    .image-placeholder i {
      font-size: 2rem;
      color: #ccc;
    }
    
    /* 页脚样式 */
    .footer {
      background: linear-gradient(to right, #2c3e50, #34495e);
      color: white;
      padding: 30px 0;
      margin-top: 50px;
      border-radius: 20px 20px 0 0;
      box-shadow: 0 -4px 8px rgba(0,0,0,0.1);
    }
    
    .footer h5 {
      color: #ecf0f1;
      font-weight: bold;
      margin-bottom: 15px;
    }
    
    .footer p {
      color: #bdc3c7;
      margin-bottom: 8px;
      font-size: 0.95rem;
    }
    
    .footer a {
      color: #3498db;
      text-decoration: none;
      transition: color 0.3s ease;
    }
    
    .footer a:hover {
      color: #5dade2;
      text-decoration: underline;
    }
    
    .contact-info {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 15px;
      margin-top: 10px;
    }
    
    .contact-item {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
    }
    
    .contact-item i {
      margin-right: 10px;
      color: #3498db;
      width: 20px;
    }

    /* 历史记录表格样式 */
    .table-responsive {
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .table th {
      border: none;
      font-weight: 600;
      text-align: center;
      vertical-align: middle;
    }

    .table td {
      border: none;
      text-align: center;
      vertical-align: middle;
      padding: 12px 8px;
    }

    .table-striped > tbody > tr:nth-of-type(odd) > td {
      background-color: rgba(0,0,0,0.02);
    }

    .table-hover > tbody > tr:hover > td {
      background-color: rgba(79, 172, 254, 0.1);
    }

    /* 统计卡片样式 */
    .card {
      border-radius: 15px;
      border: none;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      transition: transform 0.2s ease;
    }

    .card:hover {
      transform: translateY(-2px);
    }

    /* 识字测试汉字显示样式 */
    .character-display {
      font-size: 6rem;
      font-weight: bold;
      color: #2c3e50;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
      margin: 20px 0;
      font-family: '楷体', '华文楷体', serif;
    }

    /* 练习区域样式 */
    .practice-area {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }

    /* 统计区域样式 */
    .stats-section {
      background: white;
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      border: 1px solid #e9ecef;
    }

    /* 历史记录区域样式 */
    .history-section {
      background: white;
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      border: 1px solid #e9ecef;
    }

    .history-summary {
      border: 2px dashed #dee2e6;
      transition: all 0.3s ease;
    }

    .history-summary:hover {
      border-color: #6ecbf5;
      background-color: #f8f9fa !important;
    }

    .history-details {
      animation: slideDown 0.3s ease-out;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* 按钮样式优化 */
    .btn-outline-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .btn-outline-warning:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- 主页 -->
    <div v-if="currentPage === 'home'" class="fade-in">
      <div class="header text-center py-4 mb-4">
        <h1><i class="bi bi-stars"></i> 幼儿园大班学习乐园 <i class="bi bi-stars"></i></h1>
        <p class="lead">欢迎来到快乐学习世界！</p>
      </div>
      
      <div class="container">
        <div class="row">
          <div class="col-md-4 mb-4">
            <div class="subject-card card bg-primary text-white" @click="selectSubject('chinese')">
              <div class="card-body text-center">
                <div class="subject-icon">
                  <i class="bi bi-book"></i>
                </div>
                <h3 class="card-title">语文</h3>
                <p class="card-text">学习汉字、拼音和词语</p>
              </div>
            </div>
          </div>
          
          <div class="col-md-4 mb-4">
            <div class="subject-card card bg-success text-white" @click="selectSubject('math')">
              <div class="card-body text-center">
                <div class="subject-icon">
                  <i class="bi bi-calculator"></i>
                </div>
                <h3 class="card-title">数学</h3>
                <p class="card-text">学习数字、计算和图形</p>
              </div>
            </div>
          </div>
          
          <div class="col-md-4 mb-4">
            <div class="subject-card card bg-warning text-white" @click="selectSubject('english')">
              <div class="card-body text-center">
                <div class="subject-icon">
                  <i class="bi bi-globe"></i>
                </div>
                <h3 class="card-title">英语</h3>
                <p class="card-text">学习字母、单词和简单句子</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 学科页面 -->
    <div v-else class="fade-in" v-cloak>
      <button class="btn btn-secondary back-btn" @click="goHome">
        <i class="bi bi-arrow-left-circle"></i> 返回主页
      </button>
      
      <div class="header text-center py-4 mb-4">
        <h1>{{ currentSubject.title }}</h1>
      </div>
      
      <div class="container">
        <div class="content-area">
          <!-- 语文内容 -->
          <div v-if="currentSubject.key === 'chinese'">
            <ul class="nav nav-tabs" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link" 
                        :class="{ active: activeChineseTab === 'pinyin' }"
                        data-bs-toggle="tab" 
                        data-bs-target="#pinyin" 
                        type="button" 
                        role="tab"
                        @click="setActiveTab('chinese', 'pinyin')">拼音学习</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" 
                        :class="{ active: activeChineseTab === 'characters' }"
                        data-bs-toggle="tab" 
                        data-bs-target="#characters" 
                        type="button" 
                        role="tab"
                        @click="setActiveTab('chinese', 'characters')">汉字学习</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" 
                        :class="{ active: activeChineseTab === 'words' }"
                        data-bs-toggle="tab" 
                        data-bs-target="#words" 
                        type="button" 
                        role="tab"
                        @click="setActiveTab('chinese', 'words')">词语学习</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" 
                        :class="{ active: activeChineseTab === 'idioms' }"
                        data-bs-toggle="tab" 
                        data-bs-target="#idioms" 
                        type="button" 
                        role="tab"
                        @click="setActiveTab('chinese', 'idioms')">成语学习</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link"
                        :class="{ active: activeChineseTab === 'poems' }"
                        data-bs-toggle="tab"
                        data-bs-target="#poems"
                        type="button"
                        role="tab"
                        @click="setActiveTab('chinese', 'poems')">古诗词学习</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link"
                        :class="{ active: activeChineseTab === 'test' }"
                        data-bs-toggle="tab"
                        data-bs-target="#test"
                        type="button"
                        role="tab"
                        @click="setActiveTab('chinese', 'test')">识字测试</button>
              </li>
            </ul>
            <div class="tab-content">
              <div class="tab-pane fade" 
                   :class="{ 'show active': activeChineseTab === 'pinyin' }" 
                   id="pinyin" 
                   role="tabpanel">
                <h3 class="mt-3">声母学习</h3>
                <div class="row">
                  <div v-for="initial in chinese.initials" :key="initial" class="col-2 mb-3">
                    <div class="alphabet-card bg-light" @click="speak(initial)">
                      {{ initial }}
                    </div>
                  </div>
                </div>
                
                <h3 class="mt-4">韵母学习</h3>
                <div class="row">
                  <div v-for="final in chinese.finals" :key="final" class="col-2 mb-3">
                    <div class="alphabet-card bg-light" @click="speak(final)">
                      {{ final }}
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="tab-pane fade" 
                   :class="{ 'show active': activeChineseTab === 'characters' }" 
                   id="characters" 
                   role="tabpanel">
                <h3 class="mt-3">基础汉字</h3>
                <div class="row">
                  <div v-for="character in chinese.characters" :key="character.char" class="col-3 col-md-2 mb-3">
                    <div class="number-card bg-light" @click="speak(character.pinyin)">
                      <div class="character">{{ character.char }}</div>
                      <div class="pinyin text-muted small">{{ character.pinyin }}</div>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="tab-pane fade" 
                   :class="{ 'show active': activeChineseTab === 'words' }" 
                   id="words" 
                   role="tabpanel">
                <h3 class="mt-3">常用词语</h3>
                <div class="row">
                  <div v-for="word in chinese.words" :key="word.word" class="col-6 col-md-3 mb-3">
                    <div class="word-card bg-light" @click="speak(word.word)">
                      <div class="word">{{ word.word }}</div>
                      <div class="pinyin text-muted small">{{ word.pinyin }}</div>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="tab-pane fade" 
                   :class="{ 'show active': activeChineseTab === 'idioms' }" 
                   id="idioms" 
                   role="tabpanel">
                <h3 class="mt-3">常用成语</h3>
                <div class="row">
                  <div v-for="idiom in chinese.idioms" :key="idiom.idiom" class="col-6 col-md-3 mb-3">
                    <div class="word-card bg-light" @click="speak(idiom.idiom)">
                      <div class="word">{{ idiom.idiom }}</div>
                      <div class="pinyin text-muted small">{{ idiom.pinyin }}</div>
                      <div class="meaning text-muted small">{{ idiom.meaning }}</div>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="tab-pane fade"
                   :class="{ 'show active': activeChineseTab === 'poems' }"
                   id="poems"
                   role="tabpanel">
                <h3 class="mt-3">经典古诗词</h3>
                <div class="row">
                  <div v-for="poem in chinese.poems" :key="poem.title" class="col-12 col-md-6 mb-4">
                    <div class="poem-card bg-light p-3 h-100">
                      <div class="poem-title fw-bold fs-5 mb-2">{{ poem.title }}</div>
                      <div class="poem-author text-muted small mb-2">{{ poem.author }}</div>
                      <div class="poem-content mb-2">{{ poem.content }}</div>
                      <div class="poem-meaning text-muted">{{ poem.meaning }}</div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="tab-pane fade"
                   :class="{ 'show active': activeChineseTab === 'test' }"
                   id="test"
                   role="tabpanel">
                <h3 class="mt-3">识字测试</h3>

                <!-- 练习区域 -->
                <div class="practice-area">
                  <div class="text-center my-4">
                    <div class="question-display">
                      <h2 class="character-display">{{ characterQuestion.char }}</h2>
                      <p class="text-muted">请选择这个汉字的正确拼音</p>
                    </div>

                    <div class="options mt-4">
                      <div v-for="option in characterQuestion.options" :key="option"
                           class="question-option d-inline-block mx-2"
                           :class="{ selected: selectedCharacterAnswer === option }"
                           @click="selectCharacterAnswer(option)">
                        {{ option }}
                      </div>
                    </div>

                    <div class="mt-3" v-if="characterResult !== null">
                      <div v-if="characterResult" class="text-success">
                        <i class="bi bi-check-circle-fill result-icon"></i>
                        <h4>答对了！真棒！</h4>
                      </div>
                      <div v-else class="text-danger">
                        <i class="bi bi-x-circle-fill result-icon"></i>
                        <h4>再试试看哦！</h4>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- 统计卡片 -->
                <div class="stats-section mt-5">
                  <h4 class="mb-3">
                    <i class="bi bi-calendar-day"></i> 今日测试统计
                    <small class="text-muted ms-2">{{ getCurrentDateString() }}</small>
                  </h4>
                  <div class="row">
                    <div class="col-md-3 col-6 mb-3">
                      <div class="card bg-primary text-white">
                        <div class="card-body text-center">
                          <h5>总题数</h5>
                          <h3>{{ characterStats.totalQuestions }}</h3>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                      <div class="card bg-success text-white">
                        <div class="card-body text-center">
                          <h5>答对</h5>
                          <h3>{{ characterStats.correctAnswers }}</h3>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                      <div class="card bg-danger text-white">
                        <div class="card-body text-center">
                          <h5>答错</h5>
                          <h3>{{ characterStats.wrongAnswers }}</h3>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                      <div class="card bg-info text-white">
                        <div class="card-body text-center">
                          <h5>正确率</h5>
                          <h3>{{ characterStats.accuracy }}%</h3>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- 历史记录展开区域 -->
                <div class="history-section mt-5">
                  <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="mb-0">
                      <i class="bi bi-clock-history"></i> 测试历史
                    </h4>
                    <div>
                      <button class="btn btn-outline-primary btn-sm me-2"
                              @click="toggleHistoryExpanded">
                        <i class="bi" :class="historyExpanded ? 'bi-chevron-up' : 'bi-chevron-down'"></i>
                        {{ historyExpanded ? '收起' : '展开' }}详细记录
                      </button>
                      <button class="btn btn-outline-info btn-sm me-2"
                              @click="resetTodayStats('character')"
                              v-if="characterStats.totalQuestions > 0">
                        <i class="bi bi-arrow-clockwise"></i> 重置今日
                      </button>
                      <button class="btn btn-outline-warning btn-sm"
                              @click="clearPracticeHistory('character')"
                              v-if="Object.keys(characterHistory).length > 0">
                        <i class="bi bi-trash"></i> 清空全部
                      </button>
                    </div>
                  </div>

                  <!-- 简要统计 -->
                  <div class="history-summary p-3 bg-light rounded">
                    <div class="row text-center">
                      <div class="col-3">
                        <div class="fw-bold text-primary">{{ Object.keys(characterHistory).length }}</div>
                        <small class="text-muted">累计题目</small>
                      </div>
                      <div class="col-3">
                        <div class="fw-bold text-success">{{ characterAllTimeStats.correctAnswers }}</div>
                        <small class="text-muted">累计答对</small>
                      </div>
                      <div class="col-3">
                        <div class="fw-bold text-danger">{{ characterAllTimeStats.wrongAnswers }}</div>
                        <small class="text-muted">累计答错</small>
                      </div>
                      <div class="col-3">
                        <div class="fw-bold text-info">{{ characterAllTimeStats.accuracy }}%</div>
                        <small class="text-muted">累计正确率</small>
                      </div>
                    </div>
                  </div>

                  <!-- 详细历史记录 -->
                  <div v-show="historyExpanded" class="history-details mt-3">
                    <div v-if="Object.keys(characterHistory).length === 0" class="text-center text-muted py-5">
                      <i class="bi bi-clipboard-x" style="font-size: 3rem;"></i>
                      <h5 class="mt-3">暂无历史记录</h5>
                      <p>开始识字测试后，这里会显示你的测试历史</p>
                    </div>

                    <div v-else class="table-responsive">
                      <table class="table table-striped table-hover">
                        <thead class="table-dark">
                          <tr>
                            <th>汉字</th>
                            <th>拼音</th>
                            <th>正确次数</th>
                            <th>错误次数</th>
                            <th>总次数</th>
                            <th>正确率</th>
                            <th>最后测试时间</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr v-for="(record, question) in sortedCharacterHistory" :key="question">
                            <td class="fw-bold fs-5">{{ question.split(' - ')[0] }}</td>
                            <td class="text-primary">{{ question.split(' - ')[1] }}</td>
                            <td class="text-success">{{ record.correct }}</td>
                            <td class="text-danger">{{ record.wrong }}</td>
                            <td>{{ record.correct + record.wrong }}</td>
                            <td>
                              <span class="badge" :class="getAccuracyBadgeClass(record.correct, record.wrong)">
                                {{ Math.round(record.correct / (record.correct + record.wrong) * 100) }}%
                              </span>
                            </td>
                            <td class="text-muted">{{ formatTime(record.lastTime) }}</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- 数学内容 -->
          <div v-if="currentSubject.key === 'math'">
            <ul class="nav nav-tabs" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link" 
                        :class="{ active: activeMathTab === 'numbers' }"
                        data-bs-toggle="tab" 
                        data-bs-target="#numbers" 
                        type="button" 
                        role="tab"
                        @click="setActiveTab('math', 'numbers')">数字认知</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" 
                        :class="{ active: activeMathTab === 'counting' }"
                        data-bs-toggle="tab" 
                        data-bs-target="#counting" 
                        type="button" 
                        role="tab"
                        @click="setActiveTab('math', 'counting')">数数练习</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link"
                        :class="{ active: activeMathTab === 'addition' }"
                        data-bs-toggle="tab"
                        data-bs-target="#addition"
                        type="button"
                        role="tab"
                        @click="setActiveTab('math', 'addition')">加法练习</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link"
                        :class="{ active: activeMathTab === 'subtraction' }"
                        data-bs-toggle="tab"
                        data-bs-target="#subtraction"
                        type="button"
                        role="tab"
                        @click="setActiveTab('math', 'subtraction')">减法练习</button>
              </li>
            </ul>
            <div class="tab-content">
              <div class="tab-pane fade" 
                   :class="{ 'show active': activeMathTab === 'numbers' }" 
                   id="numbers" 
                   role="tabpanel">
                <h3 class="mt-3">数字1-20</h3>
                <div class="row">
                  <div v-for="n in 20" :key="n" class="col-3 col-md-2 mb-3">
                    <div class="number-card bg-light" @click="speak(n.toString())">
                      <div class="number">{{ n }}</div>
                      <div class="chinese-number text-muted small">{{ chineseNumbers[n-1] }}</div>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="tab-pane fade" 
                   :class="{ 'show active': activeMathTab === 'counting' }" 
                   id="counting" 
                   role="tabpanel">
                <h3 class="mt-3">数一数有几个？</h3>
                <div class="text-center my-4">
                  <div class="question-display">
                    <div class="d-flex justify-content-center flex-wrap">
                      <i v-for="i in countingQuestion.count" :key="i" class="bi bi-apple" style="font-size: 2rem; color: red; margin: 5px;"></i>
                    </div>
                  </div>
                  
                  <div class="options mt-4">
                    <div v-for="option in countingQuestion.options" :key="option" 
                         class="question-option d-inline-block mx-2" 
                         :class="{ selected: selectedCountingAnswer === option }"
                         @click="selectCountingAnswer(option)">
                      {{ option }}
                    </div>
                  </div>
                  
                  <div class="mt-3" v-if="countingResult !== null">
                    <div v-if="countingResult" class="text-success">
                      <i class="bi bi-check-circle-fill result-icon"></i>
                      <h4>答对了！真棒！</h4>
                    </div>
                    <div v-else class="text-danger">
                      <i class="bi bi-x-circle-fill result-icon"></i>
                      <h4>再试试看哦！</h4>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="tab-pane fade"
                   :class="{ 'show active': activeMathTab === 'addition' }"
                   id="addition"
                   role="tabpanel">
                <h3 class="mt-3">加法练习</h3>

                <!-- 练习区域 -->
                <div class="practice-area">
                  <div class="text-center my-4">
                    <div class="question-display">
                      <h4>{{ additionQuestion.a }} + {{ additionQuestion.b }} = ?</h4>
                    </div>

                    <div class="options mt-4">
                      <div v-for="option in additionQuestion.options" :key="option"
                           class="question-option d-inline-block mx-2"
                           :class="{ selected: selectedAdditionAnswer === option }"
                           @click="selectAdditionAnswer(option)">
                        {{ option }}
                      </div>
                    </div>

                    <div class="mt-3" v-if="additionResult !== null">
                      <div v-if="additionResult" class="text-success">
                        <i class="bi bi-check-circle-fill result-icon"></i>
                        <h4>答对了！真棒！</h4>
                      </div>
                      <div v-else class="text-danger">
                        <i class="bi bi-x-circle-fill result-icon"></i>
                        <h4>再试试看哦！</h4>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- 统计卡片 -->
                <div class="stats-section mt-5">
                  <h4 class="mb-3">
                    <i class="bi bi-calendar-day"></i> 今日练习统计
                    <small class="text-muted ms-2">{{ getCurrentDateString() }}</small>
                  </h4>
                  <div class="row">
                    <div class="col-md-3 col-6 mb-3">
                      <div class="card bg-primary text-white">
                        <div class="card-body text-center">
                          <h5>总题数</h5>
                          <h3>{{ additionStats.totalQuestions }}</h3>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                      <div class="card bg-success text-white">
                        <div class="card-body text-center">
                          <h5>答对</h5>
                          <h3>{{ additionStats.correctAnswers }}</h3>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                      <div class="card bg-danger text-white">
                        <div class="card-body text-center">
                          <h5>答错</h5>
                          <h3>{{ additionStats.wrongAnswers }}</h3>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                      <div class="card bg-info text-white">
                        <div class="card-body text-center">
                          <h5>正确率</h5>
                          <h3>{{ additionStats.accuracy }}%</h3>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- 历史记录展开区域 -->
                <div class="history-section mt-5">
                  <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="mb-0">
                      <i class="bi bi-clock-history"></i> 答题历史
                    </h4>
                    <div>
                      <button class="btn btn-outline-primary btn-sm me-2"
                              @click="toggleHistoryExpanded">
                        <i class="bi" :class="historyExpanded ? 'bi-chevron-up' : 'bi-chevron-down'"></i>
                        {{ historyExpanded ? '收起' : '展开' }}详细记录
                      </button>
                      <button class="btn btn-outline-info btn-sm me-2"
                              @click="resetTodayStats"
                              v-if="additionStats.totalQuestions > 0">
                        <i class="bi bi-arrow-clockwise"></i> 重置今日
                      </button>
                      <button class="btn btn-outline-warning btn-sm"
                              @click="clearPracticeHistory('addition')"
                              v-if="Object.keys(additionHistory).length > 0">
                        <i class="bi bi-trash"></i> 清空全部
                      </button>
                    </div>
                  </div>

                  <!-- 简要统计 -->
                  <div class="history-summary p-3 bg-light rounded">
                    <div class="row text-center">
                      <div class="col-3">
                        <div class="fw-bold text-primary">{{ Object.keys(additionHistory).length }}</div>
                        <small class="text-muted">累计题目</small>
                      </div>
                      <div class="col-3">
                        <div class="fw-bold text-success">{{ allTimeStats.correctAnswers }}</div>
                        <small class="text-muted">累计答对</small>
                      </div>
                      <div class="col-3">
                        <div class="fw-bold text-danger">{{ allTimeStats.wrongAnswers }}</div>
                        <small class="text-muted">累计答错</small>
                      </div>
                      <div class="col-3">
                        <div class="fw-bold text-info">{{ allTimeStats.accuracy }}%</div>
                        <small class="text-muted">累计正确率</small>
                      </div>
                    </div>
                  </div>

                  <!-- 详细历史记录 -->
                  <div v-show="historyExpanded" class="history-details mt-3">
                    <div v-if="Object.keys(additionHistory).length === 0" class="text-center text-muted py-5">
                      <i class="bi bi-clipboard-x" style="font-size: 3rem;"></i>
                      <h5 class="mt-3">暂无历史记录</h5>
                      <p>开始练习加法题目后，这里会显示你的答题历史</p>
                    </div>

                    <div v-else class="table-responsive">
                      <table class="table table-striped table-hover">
                        <thead class="table-dark">
                          <tr>
                            <th>题目</th>
                            <th>正确次数</th>
                            <th>错误次数</th>
                            <th>总次数</th>
                            <th>正确率</th>
                            <th>最后答题时间</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr v-for="(record, question) in sortedAdditionHistory" :key="question">
                            <td class="fw-bold">{{ question }}</td>
                            <td class="text-success">{{ record.correct }}</td>
                            <td class="text-danger">{{ record.wrong }}</td>
                            <td>{{ record.correct + record.wrong }}</td>
                            <td>
                              <span class="badge" :class="getAccuracyBadgeClass(record.correct, record.wrong)">
                                {{ Math.round(record.correct / (record.correct + record.wrong) * 100) }}%
                              </span>
                            </td>
                            <td class="text-muted">{{ formatTime(record.lastTime) }}</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>

              <div class="tab-pane fade"
                   :class="{ 'show active': activeMathTab === 'subtraction' }"
                   id="subtraction"
                   role="tabpanel">
                <h3 class="mt-3">减法练习</h3>

                <!-- 练习区域 -->
                <div class="practice-area">
                  <div class="text-center my-4">
                    <div class="question-display">
                      <h4>{{ subtractionQuestion.a }} - {{ subtractionQuestion.b }} = ?</h4>
                    </div>

                    <div class="options mt-4">
                      <div v-for="option in subtractionQuestion.options" :key="option"
                           class="question-option d-inline-block mx-2"
                           :class="{ selected: selectedSubtractionAnswer === option }"
                           @click="selectSubtractionAnswer(option)">
                        {{ option }}
                      </div>
                    </div>

                    <div class="mt-3" v-if="subtractionResult !== null">
                      <div v-if="subtractionResult" class="text-success">
                        <i class="bi bi-check-circle-fill result-icon"></i>
                        <h4>答对了！真棒！</h4>
                      </div>
                      <div v-else class="text-danger">
                        <i class="bi bi-x-circle-fill result-icon"></i>
                        <h4>再试试看哦！</h4>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- 统计卡片 -->
                <div class="stats-section mt-5">
                  <h4 class="mb-3">
                    <i class="bi bi-calendar-day"></i> 今日练习统计
                    <small class="text-muted ms-2">{{ getCurrentDateString() }}</small>
                  </h4>
                  <div class="row">
                    <div class="col-md-3 col-6 mb-3">
                      <div class="card bg-primary text-white">
                        <div class="card-body text-center">
                          <h5>总题数</h5>
                          <h3>{{ subtractionStats.totalQuestions }}</h3>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                      <div class="card bg-success text-white">
                        <div class="card-body text-center">
                          <h5>答对</h5>
                          <h3>{{ subtractionStats.correctAnswers }}</h3>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                      <div class="card bg-danger text-white">
                        <div class="card-body text-center">
                          <h5>答错</h5>
                          <h3>{{ subtractionStats.wrongAnswers }}</h3>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                      <div class="card bg-info text-white">
                        <div class="card-body text-center">
                          <h5>正确率</h5>
                          <h3>{{ subtractionStats.accuracy }}%</h3>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- 历史记录展开区域 -->
                <div class="history-section mt-5">
                  <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="mb-0">
                      <i class="bi bi-clock-history"></i> 答题历史
                    </h4>
                    <div>
                      <button class="btn btn-outline-primary btn-sm me-2"
                              @click="toggleHistoryExpanded">
                        <i class="bi" :class="historyExpanded ? 'bi-chevron-up' : 'bi-chevron-down'"></i>
                        {{ historyExpanded ? '收起' : '展开' }}详细记录
                      </button>
                      <button class="btn btn-outline-info btn-sm me-2"
                              @click="resetTodayStats('subtraction')"
                              v-if="subtractionStats.totalQuestions > 0">
                        <i class="bi bi-arrow-clockwise"></i> 重置今日
                      </button>
                      <button class="btn btn-outline-warning btn-sm"
                              @click="clearPracticeHistory('subtraction')"
                              v-if="Object.keys(subtractionHistory).length > 0">
                        <i class="bi bi-trash"></i> 清空全部
                      </button>
                    </div>
                  </div>

                  <!-- 简要统计 -->
                  <div class="history-summary p-3 bg-light rounded">
                    <div class="row text-center">
                      <div class="col-3">
                        <div class="fw-bold text-primary">{{ Object.keys(subtractionHistory).length }}</div>
                        <small class="text-muted">累计题目</small>
                      </div>
                      <div class="col-3">
                        <div class="fw-bold text-success">{{ subtractionAllTimeStats.correctAnswers }}</div>
                        <small class="text-muted">累计答对</small>
                      </div>
                      <div class="col-3">
                        <div class="fw-bold text-danger">{{ subtractionAllTimeStats.wrongAnswers }}</div>
                        <small class="text-muted">累计答错</small>
                      </div>
                      <div class="col-3">
                        <div class="fw-bold text-info">{{ subtractionAllTimeStats.accuracy }}%</div>
                        <small class="text-muted">累计正确率</small>
                      </div>
                    </div>
                  </div>

                  <!-- 详细历史记录 -->
                  <div v-show="historyExpanded" class="history-details mt-3">
                    <div v-if="Object.keys(subtractionHistory).length === 0" class="text-center text-muted py-5">
                      <i class="bi bi-clipboard-x" style="font-size: 3rem;"></i>
                      <h5 class="mt-3">暂无历史记录</h5>
                      <p>开始练习减法题目后，这里会显示你的答题历史</p>
                    </div>

                    <div v-else class="table-responsive">
                      <table class="table table-striped table-hover">
                        <thead class="table-dark">
                          <tr>
                            <th>题目</th>
                            <th>正确次数</th>
                            <th>错误次数</th>
                            <th>总次数</th>
                            <th>正确率</th>
                            <th>最后答题时间</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr v-for="(record, question) in sortedSubtractionHistory" :key="question">
                            <td class="fw-bold">{{ question }}</td>
                            <td class="text-success">{{ record.correct }}</td>
                            <td class="text-danger">{{ record.wrong }}</td>
                            <td>{{ record.correct + record.wrong }}</td>
                            <td>
                              <span class="badge" :class="getAccuracyBadgeClass(record.correct, record.wrong)">
                                {{ Math.round(record.correct / (record.correct + record.wrong) * 100) }}%
                              </span>
                            </td>
                            <td class="text-muted">{{ formatTime(record.lastTime) }}</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- 英语内容 -->
          <div v-if="currentSubject.key === 'english'">
            <ul class="nav nav-tabs" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link" 
                        :class="{ active: activeEnglishTab === 'alphabet' }"
                        data-bs-toggle="tab" 
                        data-bs-target="#alphabet" 
                        type="button" 
                        role="tab"
                        @click="setActiveTab('english', 'alphabet')">字母学习</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" 
                        :class="{ active: activeEnglishTab === 'words' }"
                        data-bs-toggle="tab" 
                        data-bs-target="#english-words" 
                        type="button" 
                        role="tab"
                        @click="setActiveTab('english', 'words')">单词学习</button>
              </li>
            </ul>
            <div class="tab-content">
              <div class="tab-pane fade" 
                   :class="{ 'show active': activeEnglishTab === 'alphabet' }" 
                   id="alphabet" 
                   role="tabpanel">
                <h3 class="mt-3">英文字母</h3>
                <div class="row">
                  <div v-for="letter in english.alphabet" :key="letter" class="col-2 mb-3">
                    <div class="alphabet-card bg-light" @click="speak(letter)">
                      {{ letter }}
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="tab-pane fade" 
                   :class="{ 'show active': activeEnglishTab === 'words' }" 
                   id="english-words" 
                   role="tabpanel">
                <h3 class="mt-3">基础单词</h3>
                <div class="row">
                  <div v-for="word in english.words" :key="word.word" class="col-6 col-md-3 mb-3">
                    <div class="word-card bg-light" @click="speak(word.word)">
                      <img :src="getEmojiImageUrl(word.emojiCode)" 
                           :alt="word.word" 
                           class="word-image" 
                           loading="lazy"
                           @error="handleImageError($event, word.emojiCode)">
                      <div class="word">{{ word.word }}</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 页脚 -->
    <footer class="footer">
      <div class="container">
        <div class="row">
          <div class="col-md-6">
            <h5><i class="bi bi-info-circle"></i> 关于我们</h5>
            <p>幼儿园大班学习乐园致力于为孩子们提供有趣、互动、有效的学习体验。</p>
            <p>通过游戏化的学习方式，让孩子们在快乐中掌握基础知识。</p>
          </div>
          <div class="col-md-6">
            <h5><i class="bi bi-envelope"></i> 联系我们</h5>
            <div class="contact-info">
              <div class="contact-item">
                <i class="bi bi-qq"></i>
                <span>QQ号码：<strong>1638988</strong>（可添加微信）</span>
              </div>
              <div class="contact-item">
                <i class="bi bi-envelope"></i>
                <span>邮箱：<a href="mailto:1638988@qq.com">1638988@qq.com</a></span>
              </div>
              <div class="contact-item">
                <i class="bi bi-envelope"></i>
                <span>备用邮箱：<a href="mailto:chenping@live.cn">chenping@live.cn</a></span>
              </div>
              <div class="contact-item">
                <i class="bi bi-chat-dots"></i>
                <span>欢迎反馈问题或提出建议！</span>
              </div>
            </div>
          </div>
        </div>
        <div class="row mt-3">
          <div class="col-12 text-center">
            <p class="mb-0">&copy; 2024 幼儿园大班学习乐园. 让学习变得更有趣！</p>
          </div>
        </div>
      </div>
    </footer>
  </div>

  <script>
    // 页面加载时使用智能资源管理器加载资源
    document.addEventListener('DOMContentLoaded', function() {
      console.log('页面加载完成，开始智能加载资源...');
      
      if (window.smartResourceManager) {
        // 使用智能资源管理器重新加载CSS（会覆盖备用方案）
        setTimeout(() => {
          window.smartResourceManager.loadCSS('bootstrap-css');
          window.smartResourceManager.loadCSS('bootstrap-icons');
        }, 100);
        
        // 使用智能资源管理器加载JS
        window.smartResourceManager.loadJS('vue-js');
        window.smartResourceManager.loadJS('bootstrap-js');
        
        // 等待Vue.js加载完成后初始化应用
        const checkVueLoaded = setInterval(() => {
          if (window.Vue) {
            clearInterval(checkVueLoaded);
            console.log('Vue.js加载完成，初始化应用...');
            initializeApp();
          }
        }, 100);
      } else {
        console.warn('智能资源管理器未找到，使用备用方案...');
        // 备用方案 - 直接加载JS
        const fallbackJS = [
          'https://cdn.jsdelivr.net/npm/vue@3.3.4/dist/vue.global.min.js',
          'https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js'
        ];
        
        let loadedCount = 0;
        fallbackJS.forEach(src => {
          const script = document.createElement('script');
          script.src = src;
          script.onload = () => {
            loadedCount++;
            if (loadedCount === fallbackJS.length) {
              initializeApp();
            }
          };
          document.head.appendChild(script);
        });
      }
    });
  </script>
  
  <script>
    // 简化的Vue应用初始化
    function initializeApp() {
      if (!window.Vue) {
        console.error('Vue未加载，无法初始化应用');
        return;
      }
      
      const { createApp, ref, reactive, computed, onMounted } = Vue;
      
      createApp({
        setup() {
          // 页面状态
          const currentPage = ref('home');
          const currentSubject = ref(null);
          
          // 标签页状态
          const activeChineseTab = ref('pinyin');
          const activeMathTab = ref('numbers');
          const activeEnglishTab = ref('alphabet');
          
          // 学科数据
          const subjects = {
            chinese: {
              key: 'chinese',
              title: '语文学习',
              icon: 'book'
            },
            math: {
              key: 'math',
              title: '数学学习',
              icon: 'calculator'
            },
            english: {
              key: 'english',
              title: '英语学习',
              icon: 'globe'
            }
          };
          
          // 语文内容
          const chinese = {
            initials: ['b', 'p', 'm', 'f', 'd', 't', 'n', 'l', 'g', 'k', 'h', 'j', 'q', 'x', 'zh', 'ch', 'sh', 'r', 'z', 'c', 's', 'y', 'w'],
            finals: ['a', 'o', 'e', 'i', 'u', 'ü', 'ai', 'ei', 'ui', 'ao', 'ou', 'iu', 'ie', 'üe', 'er', 'an', 'en', 'in', 'un', 'ün', 'ang', 'eng', 'ing', 'ong'],
            characters: [
              // 数字汉字
              { char: '一', pinyin: 'yī' },
              { char: '二', pinyin: 'èr' },
              { char: '三', pinyin: 'sān' },
              { char: '四', pinyin: 'sì' },
              { char: '五', pinyin: 'wǔ' },
              { char: '六', pinyin: 'liù' },
              { char: '七', pinyin: 'qī' },
              { char: '八', pinyin: 'bā' },
              { char: '九', pinyin: 'jiǔ' },
              { char: '十', pinyin: 'shí' },
              { char: '百', pinyin: 'bǎi' },
              { char: '千', pinyin: 'qiān' },

              // 基础汉字
              { char: '人', pinyin: 'rén' },
              { char: '口', pinyin: 'kǒu' },
              { char: '手', pinyin: 'shǒu' },
              { char: '足', pinyin: 'zú' },
              { char: '目', pinyin: 'mù' },
              { char: '耳', pinyin: 'ěr' },
              { char: '心', pinyin: 'xīn' },
              { char: '头', pinyin: 'tóu' },

              // 自然类
              { char: '水', pinyin: 'shuǐ' },
              { char: '火', pinyin: 'huǒ' },
              { char: '山', pinyin: 'shān' },
              { char: '石', pinyin: 'shí' },
              { char: '田', pinyin: 'tián' },
              { char: '土', pinyin: 'tǔ' },
              { char: '木', pinyin: 'mù' },
              { char: '林', pinyin: 'lín' },
              { char: '森', pinyin: 'sēn' },
              { char: '日', pinyin: 'rì' },
              { char: '月', pinyin: 'yuè' },
              { char: '星', pinyin: 'xīng' },
              { char: '云', pinyin: 'yún' },
              { char: '雨', pinyin: 'yǔ' },
              { char: '风', pinyin: 'fēng' },
              { char: '雪', pinyin: 'xuě' },

              // 动物类
              { char: '牛', pinyin: 'niú' },
              { char: '马', pinyin: 'mǎ' },
              { char: '羊', pinyin: 'yáng' },
              { char: '猪', pinyin: 'zhū' },
              { char: '狗', pinyin: 'gǒu' },
              { char: '猫', pinyin: 'māo' },
              { char: '鸟', pinyin: 'niǎo' },
              { char: '鱼', pinyin: 'yú' },
              { char: '虫', pinyin: 'chóng' },

              // 植物类
              { char: '花', pinyin: 'huā' },
              { char: '草', pinyin: 'cǎo' },
              { char: '叶', pinyin: 'yè' },
              { char: '果', pinyin: 'guǒ' },

              // 家庭类
              { char: '爸', pinyin: 'bà' },
              { char: '妈', pinyin: 'mā' },
              { char: '爷', pinyin: 'yé' },
              { char: '奶', pinyin: 'nǎi' },
              { char: '哥', pinyin: 'gē' },
              { char: '姐', pinyin: 'jiě' },
              { char: '弟', pinyin: 'dì' },
              { char: '妹', pinyin: 'mèi' },

              // 常用字
              { char: '大', pinyin: 'dà' },
              { char: '小', pinyin: 'xiǎo' },
              { char: '多', pinyin: 'duō' },
              { char: '少', pinyin: 'shǎo' },
              { char: '好', pinyin: 'hǎo' },
              { char: '坏', pinyin: 'huài' },
              { char: '上', pinyin: 'shàng' },
              { char: '下', pinyin: 'xià' },
              { char: '左', pinyin: 'zuǒ' },
              { char: '右', pinyin: 'yòu' },
              { char: '前', pinyin: 'qián' },
              { char: '后', pinyin: 'hòu' },
              { char: '里', pinyin: 'lǐ' },
              { char: '外', pinyin: 'wài' },
              { char: '中', pinyin: 'zhōng' },
              { char: '来', pinyin: 'lái' },
              { char: '去', pinyin: 'qù' },
              { char: '有', pinyin: 'yǒu' },
              { char: '无', pinyin: 'wú' },
              { char: '是', pinyin: 'shì' },
              { char: '不', pinyin: 'bù' }
            ],
            words: [
              // 自然类
              { word: '太阳', pinyin: 'tài yáng' },
              { word: '月亮', pinyin: 'yuè liàng' },
              { word: '星星', pinyin: 'xīng xīng' },
              { word: '白云', pinyin: 'bái yún' },
              { word: '彩虹', pinyin: 'cǎi hóng' },
              { word: '大海', pinyin: 'dà hǎi' },
              { word: '河流', pinyin: 'hé liú' },
              { word: '高山', pinyin: 'gāo shān' },

              // 植物类
              { word: '花朵', pinyin: 'huā duǒ' },
              { word: '草地', pinyin: 'cǎo dì' },
              { word: '大树', pinyin: 'dà shù' },
              { word: '森林', pinyin: 'sēn lín' },
              { word: '果实', pinyin: 'guǒ shí' },
              { word: '种子', pinyin: 'zhǒng zi' },

              // 动物类
              { word: '小鸟', pinyin: 'xiǎo niǎo' },
              { word: '小鱼', pinyin: 'xiǎo yú' },
              { word: '蝴蝶', pinyin: 'hú dié' },
              { word: '蜜蜂', pinyin: 'mì fēng' },
              { word: '小猫', pinyin: 'xiǎo māo' },
              { word: '小狗', pinyin: 'xiǎo gǒu' },
              { word: '兔子', pinyin: 'tù zi' },
              { word: '熊猫', pinyin: 'xióng māo' },

              // 家庭类
              { word: '妈妈', pinyin: 'mā ma' },
              { word: '爸爸', pinyin: 'bà ba' },
              { word: '爷爷', pinyin: 'yé ye' },
              { word: '奶奶', pinyin: 'nǎi nai' },
              { word: '哥哥', pinyin: 'gē ge' },
              { word: '姐姐', pinyin: 'jiě jie' },
              { word: '弟弟', pinyin: 'dì di' },
              { word: '妹妹', pinyin: 'mèi mei' },
              { word: '家庭', pinyin: 'jiā tíng' },

              // 学习类
              { word: '老师', pinyin: 'lǎo shī' },
              { word: '学校', pinyin: 'xué xiào' },
              { word: '同学', pinyin: 'tóng xué' },
              { word: '朋友', pinyin: 'péng yǒu' },
              { word: '书本', pinyin: 'shū běn' },
              { word: '铅笔', pinyin: 'qiān bǐ' },
              { word: '橡皮', pinyin: 'xiàng pí' },
              { word: '课堂', pinyin: 'kè táng' },

              // 生活类
              { word: '房子', pinyin: 'fáng zi' },
              { word: '汽车', pinyin: 'qì chē' },
              { word: '玩具', pinyin: 'wán jù' },
              { word: '衣服', pinyin: 'yī fu' },
              { word: '鞋子', pinyin: 'xié zi' },
              { word: '帽子', pinyin: 'mào zi' },
              { word: '食物', pinyin: 'shí wù' },
              { word: '水果', pinyin: 'shuǐ guǒ' },
              { word: '蔬菜', pinyin: 'shū cài' },
              { word: '牛奶', pinyin: 'niú nǎi' }
            ],
            poems: [
              { title: '静夜思', author: '李白', content: '床前明月光，疑是地上霜。举头望明月，低头思故乡。', meaning: '这首诗描写了秋日夜晚，诗人看到月光洒在床前，以为是地上的霜，抬头望月，低头思念故乡的情景。' },
              { title: '春晓', author: '孟浩然', content: '春眠不觉晓，处处闻啼鸟。夜来风雨声，花落知多少。', meaning: '这首诗描写了春天早晨醒来后，听到鸟儿啼叫，想起夜里风雨声，不知有多少花儿被吹落的情景。' },
              { title: '咏鹅', author: '骆宾王', content: '鹅，鹅，鹅，曲项向天歌。白毛浮绿水，红掌拨清波。', meaning: '这首诗描写了鹅的形象，鹅弯曲着脖子向天鸣叫，白色的羽毛浮在绿色的水面上，红色的脚掌拨动着清澈的水波。' },
              { title: '登鹳雀楼', author: '王之涣', content: '白日依山尽，黄河入海流。欲穷千里目，更上一层楼。', meaning: '这首诗描写了诗人登楼远眺的所见所感，太阳依着山峦落下，黄河奔流入海，要想看到更远的景色，就要再上一层楼。' },
              { title: '悯农', author: '李绅', content: '锄禾日当午，汗滴禾下土。谁知盘中餐，粒粒皆辛苦。', meaning: '这首诗描写了农民在烈日下锄禾的辛苦劳作，表达了对农民辛勤劳动的同情和对粮食来之不易的感慨。' },
              { title: '江雪', author: '柳宗元', content: '千山鸟飞绝，万径人踪灭。孤舟蓑笠翁，独钓寒江雪。', meaning: '这首诗描绘了一幅江雪独钓的画面，千山万径都没有鸟飞人行的踪迹，只有一位老翁独自在江上雪中垂钓。' },
              { title: '草', author: '白居易', content: '离离原上草，一岁一枯荣。野火烧不尽，春风吹又生。', meaning: '这首诗描写了草原上的野草，一年一度枯萎又繁荣，野火烧不完，春风一吹又重新生长，赞美了草的顽强生命力。' },
              { title: '望庐山瀑布', author: '李白', content: '日照香炉生紫烟，遥看瀑布挂前川。飞流直下三千尺，疑是银河落九天。', meaning: '这首诗描写了庐山瀑布的壮观景象，阳光照射下香炉峰升起紫色烟雾，远看瀑布像挂在山前的白练，飞流直下，好像银河从天上落下来。' },
              { title: '早发白帝城', author: '李白', content: '朝辞白帝彩云间，千里江陵一日还。两岸猿声啼不住，轻舟已过万重山。', meaning: '这首诗描写了诗人从白帝城出发，乘船顺流而下的愉快心情，两岸猿猴的叫声还在耳边，轻快的小船已经穿过了万重山峦。' },
              { title: '黄鹤楼送孟浩然之广陵', author: '李白', content: '故人西辞黄鹤楼，烟花三月下扬州。孤帆远影碧空尽，唯见长江天际流。', meaning: '这首诗描写了诗人在黄鹤楼送别好友孟浩然去扬州，在烟花盛开的三月，看着朋友的船帆渐渐消失在碧空中，只见长江水滚滚流向天边。' },
              { title: '山行', author: '杜牧', content: '远上寒山石径斜，白云深处有人家。停车坐爱枫林晚，霜叶红于二月花。', meaning: '这首诗描写了秋天山中的美景，沿着弯曲的石径上山，白云深处有人家居住，停下车来欣赏枫林晚景，经霜的红叶比二月的花还要红艳。' },
              { title: '小池', author: '杨万里', content: '泉眼无声惜细流，树阴照水爱晴柔。小荷才露尖尖角，早有蜻蜓立上头。', meaning: '这首诗描写了初夏小池的美景，泉眼悄无声息地流淌着细流，树荫倒映在水中，小荷花刚刚露出尖尖的角，就有蜻蜓停在上面了。' },
              { title: '村居', author: '高鼎', content: '草长莺飞二月天，拂堤杨柳醉春烟。儿童散学归来早，忙趁东风放纸鸢。', meaning: '这首诗描写了二月春天的乡村景象，草木茂盛，黄莺飞舞，杨柳拂堤，孩子们放学回来得早，趁着东风放风筝。' },
              { title: '所见', author: '袁枚', content: '牧童骑黄牛，歌声振林樾。意欲捕鸣蝉，忽然闭口立。', meaning: '这首诗描写了一个牧童骑着黄牛，唱着歌，歌声在树林中回荡，突然想要捕捉鸣蝉，立刻停止歌唱，静静地站着的情景。' },
              { title: '赠汪伦', author: '李白', content: '李白乘舟将欲行，忽闻岸上踏歌声。桃花潭水深千尺，不及汪伦送我情。', meaning: '这首诗表达了诗人对朋友汪伦的深厚友谊，李白乘船要走时，听到岸上汪伦踏歌送别，桃花潭水虽然深达千尺，也比不上汪伦送别的深情。' }
            ],
            idioms: [
              // 数字成语
              { idiom: '一心一意', pinyin: 'yī xīn yī yì', meaning: '形容做事专心一意，一门心思。' },
              { idiom: '二话不说', pinyin: 'èr huà bù shuō', meaning: '形容说话干脆，行动果断。' },
              { idiom: '三心二意', pinyin: 'sān xīn èr yì', meaning: '形容意志不坚定，犹豫不决。' },
              { idiom: '四面八方', pinyin: 'sì miàn bā fāng', meaning: '形容各个方向，到处都是。' },
              { idiom: '五颜六色', pinyin: 'wǔ yán liù sè', meaning: '形容颜色繁多，色彩丰富。' },
              { idiom: '七上八下', pinyin: 'qī shàng bā xià', meaning: '形容心里慌乱不安。' },
              { idiom: '九牛一毛', pinyin: 'jiǔ niú yī máo', meaning: '形容极小的部分，微不足道。' },
              { idiom: '十全十美', pinyin: 'shí quán shí měi', meaning: '形容事物完美无缺。' },

              // 动物成语
              { idiom: '画龙点睛', pinyin: 'huà lóng diǎn jīng', meaning: '比喻在关键地方加上一笔，使作品更加生动。' },
              { idiom: '守株待兔', pinyin: 'shǒu zhū dài tù', meaning: '比喻不主动努力，只想不劳而获。' },
              { idiom: '亡羊补牢', pinyin: 'wáng yáng bǔ láo', meaning: '比喻出了问题及时补救，还不算晚。' },
              { idiom: '狐假虎威', pinyin: 'hú jiǎ hǔ wēi', meaning: '比喻依仗别人的威势欺压人。' },
              { idiom: '鸡鸣狗盗', pinyin: 'jī míng gǒu dào', meaning: '比喻有一技之长的人。' },

              // 自然成语
              { idiom: '春暖花开', pinyin: 'chūn nuǎn huā kāi', meaning: '形容春天气候温暖，花朵盛开。' },
              { idiom: '秋高气爽', pinyin: 'qiū gāo qì shuǎng', meaning: '形容秋天天空高远，气候凉爽。' },
              { idiom: '风和日丽', pinyin: 'fēng hé rì lì', meaning: '形容天气晴朗温和。' },
              { idiom: '鸟语花香', pinyin: 'niǎo yǔ huā xiāng', meaning: '形容春天美好的景象。' },

              // 品德成语
              { idiom: '助人为乐', pinyin: 'zhù rén wéi lè', meaning: '形容乐于帮助别人。' },
              { idiom: '诚实守信', pinyin: 'chéng shí shǒu xìn', meaning: '形容为人诚实，遵守诺言。' },
              { idiom: '勤学苦练', pinyin: 'qín xué kǔ liàn', meaning: '形容学习勤奋刻苦。' },
              { idiom: '团结友爱', pinyin: 'tuán jié yǒu ài', meaning: '形容大家和睦相处，互相关爱。' },

              // 学习成语
              { idiom: '学而时习', pinyin: 'xué ér shí xí', meaning: '形容经常复习学过的知识。' },
              { idiom: '温故知新', pinyin: 'wēn gù zhī xīn', meaning: '复习旧知识能够获得新的理解。' },
              { idiom: '百折不挠', pinyin: 'bǎi zhé bù náo', meaning: '形容意志坚强，不怕困难。' },
              { idiom: '持之以恒', pinyin: 'chí zhī yǐ héng', meaning: '形容做事有恒心，能够坚持。' }
            ]
          };
          
          // 英语内容
          const english = {
            alphabet: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split(''),
            words: [
              // 动物类
              { word: 'Cat', emojiCode: '1f431' },
              { word: 'Dog', emojiCode: '1f436' },
              { word: 'Fish', emojiCode: '1f41f' },
              { word: 'Bird', emojiCode: '1f426' },
              { word: 'Rabbit', emojiCode: '1f430' },
              { word: 'Bear', emojiCode: '1f43b' },
              { word: 'Lion', emojiCode: '1f981' },
              { word: 'Tiger', emojiCode: '1f405' },
              { word: 'Elephant', emojiCode: '1f418' },
              { word: 'Giraffe', emojiCode: '1f992' },
              { word: 'Monkey', emojiCode: '1f412' },
              { word: 'Pig', emojiCode: '1f437' },

              // 食物类
              { word: 'Apple', emojiCode: '1f34e' },
              { word: 'Banana', emojiCode: '1f34c' },
              { word: 'Orange', emojiCode: '1f34a' },
              { word: 'Cake', emojiCode: '1f370' },
              { word: 'Bread', emojiCode: '1f35e' },
              { word: 'Milk', emojiCode: '1f95b' },
              { word: 'Egg', emojiCode: '1f95a' },
              { word: 'Ice cream', emojiCode: '1f368' },
              { word: 'Cookie', emojiCode: '1f36a' },

              // 颜色类
              { word: 'Red', emojiCode: '1f534' },
              { word: 'Blue', emojiCode: '1f535' },
              { word: 'Yellow', emojiCode: '1f7e1' },
              { word: 'Green', emojiCode: '1f7e2' },

              // 身体部位
              { word: 'Eye', emojiCode: '1f441' },
              { word: 'Hand', emojiCode: '270b' },
              { word: 'Foot', emojiCode: '1f9b6' },

              // 家庭成员
              { word: 'Mom', emojiCode: '1f469' },
              { word: 'Dad', emojiCode: '1f468' },
              { word: 'Baby', emojiCode: '1f476' },

              // 物品类
              { word: 'Ball', emojiCode: '1f3c0' },
              { word: 'Book', emojiCode: '1f4d6' },
              { word: 'Car', emojiCode: '1f697' },
              { word: 'House', emojiCode: '1f3e0' },
              { word: 'Tree', emojiCode: '1f333' },
              { word: 'Flower', emojiCode: '1f33c' },
              { word: 'Sun', emojiCode: '2600' },
              { word: 'Moon', emojiCode: '1f319' },
              { word: 'Star', emojiCode: '2b50' },
              { word: 'Water', emojiCode: '1f4a7' },
              { word: 'Fire', emojiCode: '1f525' }
            ]
          };
          
          // 数学内容
          const chineseNumbers = ['一', '二', '三', '四', '五', '六', '七', '八', '九', '十', '十一', '十二', '十三', '十四', '十五', '十六', '十七', '十八', '十九', '二十'];
          
          // 数数练习题目
          const countingQuestion = reactive({
            count: 0,
            options: []
          });
          
          // 加法练习题目
          const additionQuestion = reactive({
            a: 0,
            b: 0,
            options: []
          });

          // 减法练习题目
          const subtractionQuestion = reactive({
            a: 0,
            b: 0,
            options: []
          });

          // 识字测试题目
          const characterQuestion = reactive({
            char: '',
            pinyin: '',
            options: []
          });

          // 用户选择的答案
          const selectedCountingAnswer = ref(null);
          const selectedAdditionAnswer = ref(null);
          const selectedSubtractionAnswer = ref(null);
          const selectedCharacterAnswer = ref(null);

          // 答题结果
          const countingResult = ref(null);
          const additionResult = ref(null);
          const subtractionResult = ref(null);
          const characterResult = ref(null);

          // 历史记录展开状态
          const historyExpanded = ref(false);

          // 加法练习历史记录
          const additionHistory = reactive({});

          // 加法练习统计数据（今日）
          const additionStats = reactive({
            totalQuestions: 0,
            correctAnswers: 0,
            wrongAnswers: 0,
            accuracy: 0
          });

          // 加法练习今日记录
          const additionTodayHistory = reactive({});

          // 加法练习累计统计数据
          const allTimeStats = reactive({
            totalQuestions: 0,
            correctAnswers: 0,
            wrongAnswers: 0,
            accuracy: 0
          });

          // 减法练习历史记录和统计数据
          const subtractionHistory = reactive({});
          const subtractionTodayHistory = reactive({});
          const subtractionStats = reactive({
            totalQuestions: 0,
            correctAnswers: 0,
            wrongAnswers: 0,
            accuracy: 0
          });
          const subtractionAllTimeStats = reactive({
            totalQuestions: 0,
            correctAnswers: 0,
            wrongAnswers: 0,
            accuracy: 0
          });

          // 识字测试历史记录和统计数据
          const characterHistory = reactive({});
          const characterTodayHistory = reactive({});
          const characterStats = reactive({
            totalQuestions: 0,
            correctAnswers: 0,
            wrongAnswers: 0,
            accuracy: 0
          });
          const characterAllTimeStats = reactive({
            totalQuestions: 0,
            correctAnswers: 0,
            wrongAnswers: 0,
            accuracy: 0
          });

          // 未来扩展示例：减法练习历史记录和统计数据
          // const subtractionHistory = reactive({});
          // const subtractionStats = reactive({
          //   totalQuestions: 0,
          //   correctAnswers: 0,
          //   wrongAnswers: 0,
          //   accuracy: 0
          // });

          // 未来扩展示例：数数练习历史记录和统计数据
          // const countingHistory = reactive({});
          // const countingStats = reactive({
          //   totalQuestions: 0,
          //   correctAnswers: 0,
          //   wrongAnswers: 0,
          //   accuracy: 0
          // });
          
          // 设置活动标签页
          const setActiveTab = (subject, tab) => {
            switch(subject) {
              case 'chinese':
                activeChineseTab.value = tab;
                break;
              case 'math':
                activeMathTab.value = tab;
                break;
              case 'english':
                activeEnglishTab.value = tab;
                break;
            }
            
            // 保存标签页状态到localStorage
            localStorage.setItem(`activeTab_${subject}`, tab);
            
            // 更新URL参数
            if (currentSubject.value) {
              const url = new URL(window.location);
              url.searchParams.set('subject', currentSubject.value.key);
              
              switch(currentSubject.value.key) {
                case 'chinese':
                  url.searchParams.set('tab', activeChineseTab.value);
                  break;
                case 'math':
                  url.searchParams.set('tab', activeMathTab.value);
                  break;
                case 'english':
                  url.searchParams.set('tab', activeEnglishTab.value);
                  break;
              }
              
              window.history.replaceState({}, '', url);
            }
          };
          
          // 从localStorage恢复标签页状态
          const restoreTabState = () => {
            const chineseTab = localStorage.getItem('activeTab_chinese');
            const mathTab = localStorage.getItem('activeTab_math');
            const englishTab = localStorage.getItem('activeTab_english');
            
            if (chineseTab) activeChineseTab.value = chineseTab;
            if (mathTab) activeMathTab.value = mathTab;
            if (englishTab) activeEnglishTab.value = englishTab;
          };
          
          // 选择学科
          const selectSubject = (subjectKey, updateUrl = true) => {
            currentSubject.value = subjects[subjectKey];
            currentPage.value = 'subject';

            // 初始化题目
            if (subjectKey === 'math') {
              generateCountingQuestion();
              generateAdditionQuestion();
              generateSubtractionQuestion();
            } else if (subjectKey === 'chinese') {
              generateCharacterQuestion();
            }

            // 更新URL参数
            if (updateUrl) {
              const url = new new URL(window.location);
              url.searchParams.set('subject', subjectKey);

              // 设置默认标签页
              let defaultTab = '';
              switch(subjectKey) {
                case 'chinese':
                  defaultTab = activeChineseTab.value;
                  break;
                case 'math':
                  defaultTab = activeMathTab.value;
                  break;
                case 'english':
                  defaultTab = activeEnglishTab.value;
                  break;
              }

              url.searchParams.set('tab', defaultTab);
              window.history.replaceState({}, '', url);
            }
          };
          
          // 返回主页
          const goHome = () => {
            currentPage.value = 'home';
            currentSubject.value = null;
            
            // 清理URL参数
            const url = new URL(window.location);
            url.searchParams.delete('subject');
            url.searchParams.delete('tab');
            window.history.replaceState({}, '', url);
          };
          
          // 生成数数题目
          const generateCountingQuestion = () => {
            countingQuestion.count = Math.floor(Math.random() * 10) + 1; // 1-10
            const correctAnswer = countingQuestion.count;
            const options = new Set([correctAnswer]);
            
            // 生成3个错误选项
            while (options.size < 4) {
              const wrong = correctAnswer + Math.floor(Math.random() * 5) - 2;
              if (wrong > 0 && wrong <= 12 && wrong !== correctAnswer) {
                options.add(wrong);
              }
            }
            
            countingQuestion.options = Array.from(options).sort(() => Math.random() - 0.5);
            selectedCountingAnswer.value = null;
            countingResult.value = null;
          };
          
          // 生成加法题目
          const generateAdditionQuestion = () => {
            additionQuestion.a = Math.floor(Math.random() * 10) + 1; // 1-10
            additionQuestion.b = Math.floor(Math.random() * (10 - additionQuestion.a)) + 1; // 确保和不超过10
            const correctAnswer = additionQuestion.a + additionQuestion.b;
            const options = new Set([correctAnswer]);

            // 生成3个错误选项
            while (options.size < 4) {
              const wrong = correctAnswer + Math.floor(Math.random() * 5) - 2;
              if (wrong >= 0 && wrong <= 20 && wrong !== correctAnswer) {
                options.add(wrong);
              }
            }

            additionQuestion.options = Array.from(options).sort(() => Math.random() - 0.5);
            selectedAdditionAnswer.value = null;
            additionResult.value = null;
          };

          // 生成减法题目
          const generateSubtractionQuestion = () => {
            subtractionQuestion.a = Math.floor(Math.random() * 10) + 1; // 1-10
            subtractionQuestion.b = Math.floor(Math.random() * subtractionQuestion.a); // 0到a-1，确保结果不小于0
            const correctAnswer = subtractionQuestion.a - subtractionQuestion.b;
            const options = new Set([correctAnswer]);

            // 生成3个错误选项
            let attempts = 0;
            while (options.size < 4 && attempts < 50) {
              const wrong = Math.floor(Math.random() * 11); // 0-10的随机数
              if (wrong !== correctAnswer) {
                options.add(wrong);
              }
              attempts++;
            }

            // 如果仍然没有足够的选项，添加一些固定的选项
            if (options.size < 4) {
              for (let i = 0; i <= 10; i++) {
                if (i !== correctAnswer && options.size < 4) {
                  options.add(i);
                }
              }
            }

            subtractionQuestion.options = Array.from(options).sort(() => Math.random() - 0.5);
            selectedSubtractionAnswer.value = null;
            subtractionResult.value = null;
          };

          // 生成识字测试题目
          const generateCharacterQuestion = () => {
            const characters = chinese.characters;
            const randomIndex = Math.floor(Math.random() * characters.length);
            const selectedChar = characters[randomIndex];

            characterQuestion.char = selectedChar.char;
            characterQuestion.pinyin = selectedChar.pinyin;

            const options = new Set([selectedChar.pinyin]);

            // 生成3个错误选项
            while (options.size < 4) {
              const wrongIndex = Math.floor(Math.random() * characters.length);
              const wrongPinyin = characters[wrongIndex].pinyin;
              if (wrongPinyin !== selectedChar.pinyin) {
                options.add(wrongPinyin);
              }
            }

            characterQuestion.options = Array.from(options).sort(() => Math.random() - 0.5);
            selectedCharacterAnswer.value = null;
            characterResult.value = null;
          };
          
          // 选择答案并立即提交
          const selectCountingAnswer = (answer) => {
            selectedCountingAnswer.value = answer;
            // 自动检查答案
            checkCountingAnswer();
            // 1.5秒后自动进入下一题
            setTimeout(() => {
              nextCountingQuestion();
            }, 1500);
          };
          
          const selectAdditionAnswer = (answer) => {
            selectedAdditionAnswer.value = answer;
            // 自动检查答案
            checkAdditionAnswer();
            // 记录答题历史
            recordAdditionAnswer(answer);
            // 1.5秒后自动进入下一题
            setTimeout(() => {
              nextAdditionQuestion();
            }, 1500);
          };

          const selectSubtractionAnswer = (answer) => {
            selectedSubtractionAnswer.value = answer;
            // 自动检查答案
            checkSubtractionAnswer();
            // 记录答题历史
            recordSubtractionAnswer(answer);
            // 1.5秒后自动进入下一题
            setTimeout(() => {
              nextSubtractionQuestion();
            }, 1500);
          };

          const selectCharacterAnswer = (answer) => {
            selectedCharacterAnswer.value = answer;
            // 自动检查答案
            checkCharacterAnswer();
            // 记录答题历史
            recordCharacterAnswer(answer);
            // 1.5秒后自动进入下一题
            setTimeout(() => {
              nextCharacterQuestion();
            }, 1500);
          };
          
          // 检查答案
          const checkCountingAnswer = () => {
            countingResult.value = selectedCountingAnswer.value === countingQuestion.count;
          };

          const checkAdditionAnswer = () => {
            additionResult.value = selectedAdditionAnswer.value === (additionQuestion.a + additionQuestion.b);
          };

          const checkSubtractionAnswer = () => {
            subtractionResult.value = selectedSubtractionAnswer.value === (subtractionQuestion.a - subtractionQuestion.b);
          };

          const checkCharacterAnswer = () => {
            characterResult.value = selectedCharacterAnswer.value === characterQuestion.pinyin;
          };
          
          // 下一题
          const nextCountingQuestion = () => {
            generateCountingQuestion();
          };

          const nextAdditionQuestion = () => {
            generateAdditionQuestion();
          };

          const nextSubtractionQuestion = () => {
            generateSubtractionQuestion();
          };

          const nextCharacterQuestion = () => {
            generateCharacterQuestion();
          };
          
          // 通用的练习答题记录方法
          const recordPracticeAnswer = (practiceType, question, userAnswer, correctAnswer) => {
            let history, saveFunction;

            // 根据练习类型选择对应的数据结构
            switch(practiceType) {
              case 'addition':
                history = additionHistory;
                saveFunction = saveAdditionHistory;
                break;
              case 'subtraction':
                history = subtractionHistory;
                saveFunction = saveSubtractionHistory;
                break;
              case 'character':
                history = characterHistory;
                saveFunction = saveCharacterHistory;
                break;
              default:
                console.warn(`未知的练习类型: ${practiceType}`);
                return;
            }

            const isCorrect = userAnswer === correctAnswer;

            // 初始化题目记录
            if (!history[question]) {
              history[question] = {
                correct: 0,
                wrong: 0,
                lastTime: null
              };
            }

            // 更新记录
            if (isCorrect) {
              history[question].correct++;
            } else {
              history[question].wrong++;
            }

            history[question].lastTime = new Date().toISOString();

            // 保存到localStorage
            saveFunction();

            // 重新计算今日统计
            switch(practiceType) {
              case 'addition':
                calculateTodayStats();
                break;
              case 'subtraction':
                calculateSubtractionStats();
                break;
              case 'character':
                calculateCharacterStats();
                break;
            }
          };

          // 专用的记录方法
          const recordAdditionAnswer = (answer) => {
            const question = `${additionQuestion.a} + ${additionQuestion.b}`;
            const correctAnswer = additionQuestion.a + additionQuestion.b;
            recordPracticeAnswer('addition', question, answer, correctAnswer);
          };

          const recordSubtractionAnswer = (answer) => {
            const question = `${subtractionQuestion.a} - ${subtractionQuestion.b}`;
            const correctAnswer = subtractionQuestion.a - subtractionQuestion.b;
            recordPracticeAnswer('subtraction', question, answer, correctAnswer);
          };

          const recordCharacterAnswer = (answer) => {
            const question = `${characterQuestion.char} - ${characterQuestion.pinyin}`;
            const correctAnswer = characterQuestion.pinyin;
            recordPracticeAnswer('character', question, answer, correctAnswer);
          };

          // 保存历史记录到localStorage
          const saveAdditionHistory = () => {
            localStorage.setItem('additionHistory', JSON.stringify(additionHistory));
          };

          const saveSubtractionHistory = () => {
            localStorage.setItem('subtractionHistory', JSON.stringify(subtractionHistory));
          };

          const saveCharacterHistory = () => {
            localStorage.setItem('characterHistory', JSON.stringify(characterHistory));
          };

          // 从localStorage加载历史记录
          const loadAdditionHistory = () => {
            const savedHistory = localStorage.getItem('additionHistory');
            const savedExpanded = localStorage.getItem('historyExpanded');

            if (savedHistory) {
              const parsedHistory = JSON.parse(savedHistory);
              Object.assign(additionHistory, parsedHistory);
            }

            if (savedExpanded) {
              historyExpanded.value = savedExpanded === 'true';
            }

            // 加载完成后计算今日统计
            calculateTodayStats();
          };

          const loadSubtractionHistory = () => {
            const savedHistory = localStorage.getItem('subtractionHistory');

            if (savedHistory) {
              const parsedHistory = JSON.parse(savedHistory);
              Object.assign(subtractionHistory, parsedHistory);
            }

            // 加载完成后计算统计
            calculateSubtractionStats();
          };

          const loadCharacterHistory = () => {
            const savedHistory = localStorage.getItem('characterHistory');

            if (savedHistory) {
              const parsedHistory = JSON.parse(savedHistory);
              Object.assign(characterHistory, parsedHistory);
            }

            // 加载完成后计算统计
            calculateCharacterStats();
          };

          // 切换历史记录展开状态
          const toggleHistoryExpanded = () => {
            historyExpanded.value = !historyExpanded.value;
            // 保存展开状态到localStorage
            localStorage.setItem('historyExpanded', historyExpanded.value.toString());
          };

          // 重置今日统计（清除今日的答题记录）
          const resetTodayStats = (practiceType = 'addition') => {
            const practiceNames = {
              'addition': '加法练习',
              'subtraction': '减法练习',
              'character': '识字测试'
            };

            const practiceName = practiceNames[practiceType] || '练习';

            if (confirm(`确定要重置今日${practiceName}统计吗？这将清除今天的所有答题记录，但保留历史记录。`)) {
              let history, saveFunction, calculateFunction;

              switch(practiceType) {
                case 'addition':
                  history = additionHistory;
                  saveFunction = saveAdditionHistory;
                  calculateFunction = calculateTodayStats;
                  break;
                case 'subtraction':
                  history = subtractionHistory;
                  saveFunction = saveSubtractionHistory;
                  calculateFunction = calculateSubtractionStats;
                  break;
                case 'character':
                  history = characterHistory;
                  saveFunction = saveCharacterHistory;
                  calculateFunction = calculateCharacterStats;
                  break;
                default:
                  return;
              }

              // 遍历历史记录，清除今日的答题次数
              Object.entries(history).forEach(([question, record]) => {
                if (isToday(record.lastTime)) {
                  delete history[question];
                }
              });

              // 保存更改并重新计算统计
              saveFunction();
              calculateFunction();
            }
          };

          // 通用的练习历史记录清空方法
          const clearPracticeHistory = (practiceType) => {
            const practiceNames = {
              'addition': '加法练习',
              'subtraction': '减法练习',
              'character': '识字测试'
            };

            const practiceName = practiceNames[practiceType] || '练习';

            if (confirm(`确定要清空${practiceName}的所有历史记录吗？此操作不可恢复。`)) {
              switch(practiceType) {
                case 'addition':
                  Object.keys(additionHistory).forEach(key => delete additionHistory[key]);
                  Object.keys(additionTodayHistory).forEach(key => delete additionTodayHistory[key]);
                  additionStats.totalQuestions = 0;
                  additionStats.correctAnswers = 0;
                  additionStats.wrongAnswers = 0;
                  additionStats.accuracy = 0;
                  allTimeStats.totalQuestions = 0;
                  allTimeStats.correctAnswers = 0;
                  allTimeStats.wrongAnswers = 0;
                  allTimeStats.accuracy = 0;
                  saveAdditionHistory();
                  break;
                case 'subtraction':
                  Object.keys(subtractionHistory).forEach(key => delete subtractionHistory[key]);
                  Object.keys(subtractionTodayHistory).forEach(key => delete subtractionTodayHistory[key]);
                  subtractionStats.totalQuestions = 0;
                  subtractionStats.correctAnswers = 0;
                  subtractionStats.wrongAnswers = 0;
                  subtractionStats.accuracy = 0;
                  subtractionAllTimeStats.totalQuestions = 0;
                  subtractionAllTimeStats.correctAnswers = 0;
                  subtractionAllTimeStats.wrongAnswers = 0;
                  subtractionAllTimeStats.accuracy = 0;
                  saveSubtractionHistory();
                  break;
                case 'character':
                  Object.keys(characterHistory).forEach(key => delete characterHistory[key]);
                  Object.keys(characterTodayHistory).forEach(key => delete characterTodayHistory[key]);
                  characterStats.totalQuestions = 0;
                  characterStats.correctAnswers = 0;
                  characterStats.wrongAnswers = 0;
                  characterStats.accuracy = 0;
                  characterAllTimeStats.totalQuestions = 0;
                  characterAllTimeStats.correctAnswers = 0;
                  characterAllTimeStats.wrongAnswers = 0;
                  characterAllTimeStats.accuracy = 0;
                  saveCharacterHistory();
                  break;
              }
            }
          };

          // 获取正确率徽章样式
          const getAccuracyBadgeClass = (correct, wrong) => {
            const accuracy = correct / (correct + wrong) * 100;
            if (accuracy >= 90) return 'bg-success';
            if (accuracy >= 70) return 'bg-warning';
            return 'bg-danger';
          };

          // 格式化时间显示
          const formatTime = (timeString) => {
            if (!timeString) return '未知';
            const date = new Date(timeString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);

            if (diffMins < 1) return '刚刚';
            if (diffMins < 60) return `${diffMins}分钟前`;
            if (diffHours < 24) return `${diffHours}小时前`;
            if (diffDays < 7) return `${diffDays}天前`;

            return date.toLocaleDateString('zh-CN', {
              year: 'numeric',
              month: 'short',
              day: 'numeric',
              hour: '2-digit',
              minute: '2-digit'
            });
          };

          // 获取当前日期字符串（YYYY-MM-DD格式）
          const getCurrentDateString = () => {
            const today = new Date();
            return today.toLocaleDateString('zh-CN', {
              year: 'numeric',
              month: '2-digit',
              day: '2-digit'
            }).replace(/\//g, '-');
          };

          // 检查是否为今天的记录
          const isToday = (timeString) => {
            if (!timeString) return false;
            const recordDate = new Date(timeString);
            const today = new Date();
            return recordDate.toDateString() === today.toDateString();
          };

          // 计算今日统计和累计统计数据
          const calculateTodayStats = () => {
            let todayCorrect = 0;
            let todayWrong = 0;
            let todayTotal = 0;

            let allTimeCorrect = 0;
            let allTimeWrong = 0;
            let allTimeTotal = 0;

            // 清空今日历史记录
            Object.keys(additionTodayHistory).forEach(key => delete additionTodayHistory[key]);

            // 遍历所有历史记录
            Object.entries(additionHistory).forEach(([question, record]) => {
              // 累计所有时间的统计
              allTimeCorrect += record.correct;
              allTimeWrong += record.wrong;
              allTimeTotal += record.correct + record.wrong;

              // 筛选今日的记录
              if (isToday(record.lastTime)) {
                // 添加到今日历史记录
                additionTodayHistory[question] = { ...record };

                // 累计今日统计
                todayCorrect += record.correct;
                todayWrong += record.wrong;
                todayTotal += record.correct + record.wrong;
              }
            });

            // 更新今日统计数据
            additionStats.totalQuestions = todayTotal;
            additionStats.correctAnswers = todayCorrect;
            additionStats.wrongAnswers = todayWrong;
            additionStats.accuracy = todayTotal > 0
              ? Math.round((todayCorrect / todayTotal) * 100)
              : 0;

            // 更新累计统计数据
            allTimeStats.totalQuestions = allTimeTotal;
            allTimeStats.correctAnswers = allTimeCorrect;
            allTimeStats.wrongAnswers = allTimeWrong;
            allTimeStats.accuracy = allTimeTotal > 0
              ? Math.round((allTimeCorrect / allTimeTotal) * 100)
              : 0;
          };

          // 计算减法练习统计数据
          const calculateSubtractionStats = () => {
            let todayCorrect = 0, todayWrong = 0, todayTotal = 0;
            let allTimeCorrect = 0, allTimeWrong = 0, allTimeTotal = 0;

            Object.keys(subtractionTodayHistory).forEach(key => delete subtractionTodayHistory[key]);

            Object.entries(subtractionHistory).forEach(([question, record]) => {
              allTimeCorrect += record.correct;
              allTimeWrong += record.wrong;
              allTimeTotal += record.correct + record.wrong;

              if (isToday(record.lastTime)) {
                subtractionTodayHistory[question] = { ...record };
                todayCorrect += record.correct;
                todayWrong += record.wrong;
                todayTotal += record.correct + record.wrong;
              }
            });

            subtractionStats.totalQuestions = todayTotal;
            subtractionStats.correctAnswers = todayCorrect;
            subtractionStats.wrongAnswers = todayWrong;
            subtractionStats.accuracy = todayTotal > 0 ? Math.round((todayCorrect / todayTotal) * 100) : 0;

            subtractionAllTimeStats.totalQuestions = allTimeTotal;
            subtractionAllTimeStats.correctAnswers = allTimeCorrect;
            subtractionAllTimeStats.wrongAnswers = allTimeWrong;
            subtractionAllTimeStats.accuracy = allTimeTotal > 0 ? Math.round((allTimeCorrect / allTimeTotal) * 100) : 0;
          };

          // 计算识字测试统计数据
          const calculateCharacterStats = () => {
            let todayCorrect = 0, todayWrong = 0, todayTotal = 0;
            let allTimeCorrect = 0, allTimeWrong = 0, allTimeTotal = 0;

            Object.keys(characterTodayHistory).forEach(key => delete characterTodayHistory[key]);

            Object.entries(characterHistory).forEach(([question, record]) => {
              allTimeCorrect += record.correct;
              allTimeWrong += record.wrong;
              allTimeTotal += record.correct + record.wrong;

              if (isToday(record.lastTime)) {
                characterTodayHistory[question] = { ...record };
                todayCorrect += record.correct;
                todayWrong += record.wrong;
                todayTotal += record.correct + record.wrong;
              }
            });

            characterStats.totalQuestions = todayTotal;
            characterStats.correctAnswers = todayCorrect;
            characterStats.wrongAnswers = todayWrong;
            characterStats.accuracy = todayTotal > 0 ? Math.round((todayCorrect / todayTotal) * 100) : 0;

            characterAllTimeStats.totalQuestions = allTimeTotal;
            characterAllTimeStats.correctAnswers = allTimeCorrect;
            characterAllTimeStats.wrongAnswers = allTimeWrong;
            characterAllTimeStats.accuracy = allTimeTotal > 0 ? Math.round((allTimeCorrect / allTimeTotal) * 100) : 0;
          };

          // 语音播放功能（简化版）
          const speak = (text) => {
            console.log("播放语音: " + text);
          };

          // 获取emoji图片URL（使用可靠的CDN）
          const getEmojiImageUrl = (emojiCode) => {
            return `https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/${emojiCode}.png`;
          };

          // 处理图片加载错误
          const handleImageError = (event, emojiCode) => {
            console.warn(`图片加载失败: ${emojiCode}`);
            // 显示占位符
            event.target.style.display = 'none';
            const placeholder = document.createElement('div');
            placeholder.className = 'image-placeholder';
            placeholder.innerHTML = '<i class="bi bi-image"></i>';
            event.target.parentNode.insertBefore(placeholder, event.target);
          };
          
          // 计算属性：按最后答题时间排序的历史记录
          const sortedAdditionHistory = computed(() => {
            const entries = Object.entries(additionHistory);
            return entries.sort((a, b) => {
              const timeA = new Date(a[1].lastTime || 0);
              const timeB = new Date(b[1].lastTime || 0);
              return timeB - timeA; // 最新的在前
            }).reduce((obj, [key, value]) => {
              obj[key] = value;
              return obj;
            }, {});
          });

          const sortedSubtractionHistory = computed(() => {
            const entries = Object.entries(subtractionHistory);
            return entries.sort((a, b) => {
              const timeA = new Date(a[1].lastTime || 0);
              const timeB = new Date(b[1].lastTime || 0);
              return timeB - timeA;
            }).reduce((obj, [key, value]) => {
              obj[key] = value;
              return obj;
            }, {});
          });

          const sortedCharacterHistory = computed(() => {
            const entries = Object.entries(characterHistory);
            return entries.sort((a, b) => {
              const timeA = new Date(a[1].lastTime || 0);
              const timeB = new Date(b[1].lastTime || 0);
              return timeB - timeA;
            }).reduce((obj, [key, value]) => {
              obj[key] = value;
              return obj;
            }, {});
          });

          // 组件挂载时恢复状态
          onMounted(() => {
            restoreTabState();
            loadAdditionHistory(); // 加载加法练习历史记录
            loadSubtractionHistory(); // 加载减法练习历史记录
            loadCharacterHistory(); // 加载识字测试历史记录

            // 从URL参数恢复状态
            const urlParams = new URLSearchParams(window.location.search);
            const subjectParam = urlParams.get('subject');
            const tabParam = urlParams.get('tab');

            if (subjectParam && subjects[subjectParam]) {
              selectSubject(subjectParam, false); // 不更新URL，因为我们正在从URL恢复

              if (tabParam) {
                setTimeout(() => {
                  setActiveTab(subjectParam, tabParam);
                }, 0);
              }
            }
          });
          
          return {
            currentPage,
            currentSubject,
            activeChineseTab,
            activeMathTab,
            activeEnglishTab,
            chinese,
            english,
            chineseNumbers,
            countingQuestion,
            additionQuestion,
            subtractionQuestion,
            characterQuestion,
            selectedCountingAnswer,
            selectedAdditionAnswer,
            selectedSubtractionAnswer,
            selectedCharacterAnswer,
            countingResult,
            additionResult,
            subtractionResult,
            characterResult,
            historyExpanded,
            additionHistory,
            additionTodayHistory,
            additionStats,
            allTimeStats,
            subtractionHistory,
            subtractionTodayHistory,
            subtractionStats,
            subtractionAllTimeStats,
            characterHistory,
            characterTodayHistory,
            characterStats,
            characterAllTimeStats,
            sortedAdditionHistory,
            sortedSubtractionHistory,
            sortedCharacterHistory,
            selectSubject,
            goHome,
            generateCountingQuestion,
            generateAdditionQuestion,
            generateSubtractionQuestion,
            generateCharacterQuestion,
            selectCountingAnswer,
            selectAdditionAnswer,
            selectSubtractionAnswer,
            selectCharacterAnswer,
            checkCountingAnswer,
            checkAdditionAnswer,
            checkSubtractionAnswer,
            checkCharacterAnswer,
            nextCountingQuestion,
            nextAdditionQuestion,
            nextSubtractionQuestion,
            nextCharacterQuestion,
            setActiveTab,
            speak,
            getEmojiImageUrl,
            handleImageError,
            recordAdditionAnswer,
            recordSubtractionAnswer,
            recordCharacterAnswer,
            recordPracticeAnswer,
            toggleHistoryExpanded,
            resetTodayStats,
            clearPracticeHistory,
            getAccuracyBadgeClass,
            formatTime,
            getCurrentDateString,
            calculateTodayStats,
            calculateSubtractionStats,
            calculateCharacterStats
          };
        }
      }).mount('#app');
    }
  </script>
</body>
</html>