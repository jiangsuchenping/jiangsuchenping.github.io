<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¹˜æ³•å£è¯€æ™ºèƒ½è®­ç»ƒ - å¹¼å„¿æ•°å­¦ç»ƒä¹ å·¥å…·</title>
    <meta name="description" content="ä¸“ä¸ºå¹¼å„¿è®¾è®¡çš„ä¹˜æ³•å£è¯€æ™ºèƒ½è®­ç»ƒå·¥å…·ï¼Œå¸®åŠ©å­©å­è½»æ¾æŒæ¡åŸºç¡€ä¹˜æ³•è¿ç®—ã€‚">
    <meta name="keywords" content="å¹¼å„¿æ•°å­¦,ä¹˜æ³•ç»ƒä¹ ,ä¹˜æ³•å£è¯€,æ•°å­¦è®­ç»ƒ,å„¿ç«¥æ•™è‚²">
    <meta name="author" content="jiangsuchenping">
    <meta property="og:title" content="ä¹˜æ³•å£è¯€æ™ºèƒ½è®­ç»ƒ - å¹¼å„¿æ•°å­¦ç»ƒä¹ å·¥å…·">
    <meta property="og:description" content="ä¸“ä¸ºå¹¼å„¿è®¾è®¡çš„ä¹˜æ³•å£è¯€æ™ºèƒ½è®­ç»ƒå·¥å…·ï¼Œå¸®åŠ©å­©å­è½»æ¾æŒæ¡åŸºç¡€ä¹˜æ³•è¿ç®—ã€‚">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://jiangsuchenping.github.io/youeryuan/multiplication-training.html">
    <meta property="og:image" content="https://jiangsuchenping.github.io/youeryuan/math-training-preview.png">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="ä¹˜æ³•å£è¯€æ™ºèƒ½è®­ç»ƒ - å¹¼å„¿æ•°å­¦ç»ƒä¹ å·¥å…·">
    <meta name="twitter:description" content="ä¸“ä¸ºå¹¼å„¿è®¾è®¡çš„ä¹˜æ³•å£è¯€æ™ºèƒ½è®­ç»ƒå·¥å…·ï¼Œå¸®åŠ©å­©å­è½»æ¾æŒæ¡åŸºç¡€ä¹˜æ³•è¿ç®—ã€‚">
    <meta name="twitter:image" content="https://jiangsuchenping.github.io/youeryuan/math-training-preview.png">
    <!-- é¢„è¿æ¥å…³é”®CDNåŸŸå -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    
    <!-- å…³é”®CSSèµ„æºé¢„åŠ è½½ -->
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    
    <!-- å¤‡ç”¨CSSåŠ è½½ -->
    <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"></noscript>
    <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"></noscript>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Arial', sans-serif;
            min-height: 100vh;
        }
        
        .main-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            margin: 20px auto;
            max-width: 800px;
            padding: 30px;
        }
        
        .question-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-radius: 15px;
            padding: 40px;
            margin: 20px 0;
            text-align: center;
            font-size: 2.5rem;
            font-weight: bold;
            box-shadow: 0 10px 25px rgba(240, 147, 251, 0.3);
        }
        
        .answer-btn {
            font-size: 1.5rem;
            padding: 20px;
            margin: 10px;
            border-radius: 15px;
            border: none;
            transition: all 0.3s ease;
            min-width: 120px;
        }
        
        .answer-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .correct {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%) !important;
            color: white;
        }
        
        .incorrect {
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%) !important;
            color: white;
        }
        
        .stats-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 10px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .progress-ring {
            width: 120px;
            height: 120px;
            margin: 0 auto;
        }
        
        .daily-limit {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
            font-weight: bold;
        }
        
        .history-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 10px;
            margin: 5px 0;
            border-left: 4px solid #007bff;
        }
        
        .emoji-feedback {
            font-size: 3rem;
            margin: 20px 0;
        }
        
        .hidden {
            display: none;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        /* è‰¾å®¾æµ©æ–¯è®°å¿†æ›²çº¿å¤ä¹ æé†’æ ·å¼ */
        #reviewAlert {
            margin-bottom: 15px;
            border-left: 4px solid #ffc107;
            animation: fadeIn 0.5s ease-in-out;
        }
        
        /* å¤ä¹ é¢˜ç›®æ ‡è®°æ ·å¼ */
        .badge.bg-warning {
            font-size: 0.8rem;
            padding: 0.3rem 0.5rem;
            margin-right: 0.5rem;
            vertical-align: middle;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-container">
            <h1 class="text-center mb-4">
                <i class="bi bi-calculator-fill text-primary"></i>
                ä¹˜æ³•å£è¯€æ™ºèƒ½è®­ç»ƒ
            </h1>
            
            <!-- ç»Ÿè®¡é¢æ¿ -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="stats-card">
                        <h5><i class="bi bi-graph-up"></i> ä»Šæ—¥ç»Ÿè®¡</h5>
                        <div class="row text-center">
                            <div class="col-4">
                                <h3 id="todayTotal" class="text-primary">0</h3>
                                <small>æ€»é¢˜æ•°</small>
                            </div>
                            <div class="col-4">
                                <h3 id="todayCorrect" class="text-success">0</h3>
                                <small>æ­£ç¡®æ•°</small>
                            </div>
                            <div class="col-4">
                                <h3 id="todayAccuracy" class="text-warning">0%</h3>
                                <small>æ­£ç¡®ç‡</small>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="stats-card">
                        <h5><i class="bi bi-trophy"></i> æ€»ç»Ÿè®¡</h5>
                        <div class="row text-center">
                            <div class="col-4">
                                <h3 id="totalQuestions" class="text-primary">0</h3>
                                <small>æ€»é¢˜æ•°</small>
                            </div>
                            <div class="col-4">
                                <h3 id="totalCorrect" class="text-success">0</h3>
                                <small>æ­£ç¡®æ•°</small>
                            </div>
                            <div class="col-4">
                                <h3 id="totalAccuracy" class="text-warning">0%</h3>
                                <small>æ­£ç¡®ç‡</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- æ¯æ—¥é™åˆ¶æç¤º -->
            <div id="dailyLimitAlert" class="daily-limit hidden">
                <div class="d-flex justify-content-between align-items-center">
                    <div id="limitText">
                        <i class="bi bi-exclamation-triangle-fill"></i>
                        ä»Šæ—¥è®­ç»ƒå·²è¾¾åˆ°ä¸Šé™ï¼ˆ20é¢˜ï¼‰ï¼Œæ˜å¤©å†æ¥ç»§ç»­å§ï¼
                    </div>
                    <div>
                        <button id="resetLimitBtn" class="btn btn-sm btn-warning">
                            <i class="bi bi-plus-circle"></i> å¢åŠ ä¸Šé™
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- è®­ç»ƒåŒºåŸŸ -->
             <div id="trainingArea" class="text-center">
                 <div class="question-card" id="questionCard">
                     <span id="question">å‡†å¤‡å¼€å§‹</span>
                 </div>
                 
                 <div id="answerOptions" class="row">
                     <div class="col-6 col-md-3">
                         <button class="btn btn-primary answer-btn" id="optionA">A</button>
                     </div>
                     <div class="col-6 col-md-3">
                         <button class="btn btn-primary answer-btn" id="optionB">B</button>
                     </div>
                     <div class="col-6 col-md-3">
                         <button class="btn btn-primary answer-btn" id="optionC">C</button>
                     </div>
                     <div class="col-6 col-md-3">
                         <button class="btn btn-primary answer-btn" id="optionD">D</button>
                     </div>
                 </div>
                 
                 <div id="feedback" class="emoji-feedback hidden"></div>
             </div>
            
            <!-- å†å²è®°å½• -->
            <div class="mt-5">
                <h4><i class="bi bi-clock-history"></i> ä»Šæ—¥ç­”é¢˜è®°å½•</h4>
                <div id="historyList" class="mt-3"></div>
            </div>
            
            <!-- æ‰€æœ‰å†å²è®°å½• -->
            <div class="mt-5">
                <h4><i class="bi bi-clock-history"></i> å†å²ç»Ÿè®¡</h4>
                <div class="row mb-3">
                    <div class="col-md-4">
                        <div class="stats-card">
                            <h5>ç´¯è®¡ç­”é¢˜</h5>
                            <h3 id="allTimeTotal" class="text-primary">0</h3>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="stats-card">
                            <h5>æ­£ç¡®ç­”é¢˜</h5>
                            <h3 id="allTimeCorrect" class="text-success">0</h3>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="stats-card">
                            <h5>æ­£ç¡®ç‡</h5>
                            <h3 id="allTimeAccuracy" class="text-warning">0%</h3>
                        </div>
                    </div>
                </div>
                <div class="mt-3">
                    <button id="showAllHistoryBtn" class="btn btn-info">
                        <i class="bi bi-list"></i> æŸ¥çœ‹è¯¦ç»†å†å²è®°å½•
                    </button>
                    <button id="showQuestionStatsBtn" class="btn btn-success ms-2">
                        <i class="bi bi-bar-chart"></i> é¢˜ç›®ç»Ÿè®¡è¯¦æƒ…
                    </button>
                    <div id="allHistoryContainer" class="mt-3" style="display: none;">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h5>è¯¦ç»†å†å²è®°å½•</h5>
                            <button id="hideAllHistoryBtn" class="btn btn-sm btn-secondary">
                                <i class="bi bi-eye-slash"></i> éšè—
                            </button>
                        </div>
                        <div id="allHistoryList"></div>
                    </div>
                    <div id="questionStatsContainer" class="mt-3" style="display: none;">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h5>é¢˜ç›®ç»Ÿè®¡è¯¦æƒ…</h5>
                            <button id="hideQuestionStatsBtn" class="btn btn-sm btn-secondary">
                                <i class="bi bi-eye-slash"></i> éšè—
                            </button>
                        </div>
                        
                        <!-- é¢˜ç›®æ±‡æ€»ç»Ÿè®¡åŒºåŸŸ -->
                        <div id="questionSummaryStats" class="mb-4">
                            <h6 class="mb-3"><i class="bi bi-pie-chart-fill"></i> é¢˜ç›®æ±‡æ€»ç»Ÿè®¡</h6>
                            <div class="row">
                                <div class="col-md-3 mb-2">
                                    <div class="card bg-light">
                                        <div class="card-body text-center">
                                            <h3 id="totalUniqueQuestions" class="text-primary">0</h3>
                                            <small>ä¸åŒé¢˜ç›®æ•°</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3 mb-2">
                                    <div class="card bg-light">
                                        <div class="card-body text-center">
                                            <h3 id="averageAccuracy" class="text-success">0%</h3>
                                            <small>å¹³å‡æ­£ç¡®ç‡</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3 mb-2">
                                    <div class="card bg-light">
                                        <div class="card-body text-center">
                                            <h3 id="mostFrequentQuestion" class="text-info">-</h3>
                                            <small>æœ€å¸¸è§é¢˜ç›®</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3 mb-2">
                                    <div class="card bg-light">
                                        <div class="card-body text-center">
                                            <h3 id="lowestAccuracyQuestion" class="text-danger">-</h3>
                                            <small>æœ€ä½æ­£ç¡®ç‡é¢˜ç›®</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="questionStatsList" class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>é¢˜ç›®</th>
                                        <th>æ€»æ¬¡æ•°</th>
                                        <th>æ­£ç¡®æ¬¡æ•°</th>
                                        <th>é”™è¯¯æ¬¡æ•°</th>
                                        <th>æ­£ç¡®ç‡</th>
                                        <th>æœ€åç­”é¢˜æ—¶é—´</th>
                                    </tr>
                                </thead>
                                <tbody id="questionStatsTableBody">
                                    <!-- é¢˜ç›®ç»Ÿè®¡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- å¼‚æ­¥åŠ è½½Bootstrap JSï¼Œå¸¦ç¼“å­˜å’Œé”™è¯¯å¤„ç† -->
    <script>
        /**
         * å¼‚æ­¥åŠ è½½Bootstrap Bundle JS
         * ä½¿ç”¨CDNå¤±è´¥æ—¶çš„æœ¬åœ°å›é€€æœºåˆ¶
         */
        (function() {
            const cdnUrl = 'https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js';
            const fallbackUrl = '/assets/js/bootstrap.bundle.min.js';
            
            // åˆ›å»ºè„šæœ¬å…ƒç´ 
            const script = document.createElement('script');
            script.src = cdnUrl;
            script.async = true;
            script.crossOrigin = 'anonymous';
            
            // è®¾ç½®åŠ è½½è¶…æ—¶
            const timeout = setTimeout(() => {
                console.warn('Bootstrap JS CDNåŠ è½½è¶…æ—¶ï¼Œåˆ‡æ¢åˆ°æœ¬åœ°å›é€€');
                loadFallback();
            }, 5000);
            
            // æˆåŠŸåŠ è½½
            script.onload = () => {
                clearTimeout(timeout);
                console.log('Bootstrap JS CDNåŠ è½½æˆåŠŸ');
            };
            
            // åŠ è½½å¤±è´¥
            script.onerror = () => {
                clearTimeout(timeout);
                console.warn('Bootstrap JS CDNåŠ è½½å¤±è´¥ï¼Œåˆ‡æ¢åˆ°æœ¬åœ°å›é€€');
                loadFallback();
            };
            
            // åŠ è½½æœ¬åœ°å›é€€
            function loadFallback() {
                const fallbackScript = document.createElement('script');
                fallbackScript.src = fallbackUrl;
                fallbackScript.async = true;
                document.head.appendChild(fallbackScript);
            }
            
            document.head.appendChild(script);
        })();
    </script>
    <script>
        /**
         * ä¹˜æ³•å£è¯€æ™ºèƒ½è®­ç»ƒç³»ç»Ÿ
         * åŠŸèƒ½ï¼šæ™ºèƒ½å‡ºé¢˜ã€å†å²è®°å½•ã€æ¯æ—¥é™åˆ¶ã€è‡ªé€‚åº”éš¾åº¦
         */
        class MathTrainingSystem {
            constructor() {
                console.log('åˆå§‹åŒ–ä¹˜æ³•å£è¯€æ™ºèƒ½è®­ç»ƒç³»ç»Ÿ...');
                this.dailyLimit = 20; // æ¯æ—¥è®­ç»ƒä¸Šé™
                this.currentQuestion = null;
                this.answers = [];
                
                console.log('åŠ è½½å†å²è®°å½•...');
                this.history = this.loadHistory();
                console.log('å†å²è®°å½•åŠ è½½å®Œæˆï¼Œå…±', this.history.length, 'æ¡è®°å½•');
                
                this.today = new Date().toISOString().split('T')[0];
                console.log('ä»Šæ—¥æ—¥æœŸ:', this.today);
                
                // ç¼“å­˜DOMå…ƒç´ ä»¥æé«˜æ€§èƒ½
                console.log('åˆå§‹åŒ–DOMç¼“å­˜...');
                this.initializeDOMCache();
                
                // åˆå§‹åŒ–ä»Šæ—¥å†å²è®°å½•
                this.todayHistory = this.getTodayHistory();
                console.log('ä»Šæ—¥å†å²è®°å½•:', this.todayHistory.length, 'æ¡');
                
                // åŠ è½½è‰¾å®¾æµ©æ–¯è®°å¿†æ›²çº¿æ•°æ®
                console.log('åŠ è½½è‰¾å®¾æµ©æ–¯è®°å¿†æ›²çº¿æ•°æ®...');
                this.ebbinghausData = this.loadEbbinghausData();
                
                // é˜²æŠ–å’ŒèŠ‚æµç¼“å­˜
                this.debounceTimer = null;
                this.throttleTimer = null;
                this.lastThrottleTime = 0;
                
                console.log('åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨...');
                this.initializeEventListeners();
                
                console.log('æ›´æ–°ç»Ÿè®¡æ•°æ®...');
                this.updateStats();
                this.updateAllTimeStats();
                this.updateHistoryList(); // ç¡®ä¿åœ¨é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºå†å²è®°å½•
                
                // æ£€æŸ¥ä»Šæ—¥æ˜¯å¦æœ‰éœ€è¦å¤ä¹ çš„é¢˜ç›®
                console.log('æ£€æŸ¥ä»Šæ—¥å¤ä¹ é¢˜ç›®...');
                this.checkTodayReviews();
                
                // æ£€æŸ¥æ¯æ—¥è®­ç»ƒä¸Šé™å¹¶è‡ªåŠ¨å¼€å§‹è®­ç»ƒ
                console.log('æ£€æŸ¥æ¯æ—¥è®­ç»ƒä¸Šé™...');
                const isLimited = this.checkDailyLimit();
                if (!isLimited) {
                    // è‡ªåŠ¨å¼€å§‹è®­ç»ƒ
                    console.log('å¼€å§‹è®­ç»ƒ...');
                    this.startTraining();
                }
                
                console.log('ä¹˜æ³•å£è¯€æ™ºèƒ½è®­ç»ƒç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
            }
            
            /**
             * åˆå§‹åŒ–DOMç¼“å­˜
             * æ‰¹é‡åˆå§‹åŒ–æ‰€æœ‰éœ€è¦çš„DOMå…ƒç´ å¼•ç”¨
             */
            initializeDOMCache() {
                console.log('å¼€å§‹åˆå§‹åŒ–DOMç¼“å­˜...');
                
                // å®šä¹‰éœ€è¦ç¼“å­˜çš„å…ƒç´ IDåˆ—è¡¨åŠå…¶é‡è¦æ€§
                const elementConfigs = [
                    // æ ¸å¿ƒå…ƒç´  - è¿™äº›å…ƒç´ å¯¹ç³»ç»ŸåŠŸèƒ½è‡³å…³é‡è¦
                    {id: 'dailyLimitAlert', critical: true},
                    {id: 'trainingArea', critical: true},
                    {id: 'answerOptions', critical: true},
                    {id: 'feedback', critical: true},
                    {id: 'historyList', critical: true},
                    {id: 'question', critical: true},
                    {id: 'optionA', critical: true},
                    {id: 'optionB', critical: true},
                    {id: 'optionC', critical: true},
                    {id: 'optionD', critical: true},
                    
                    // ç»Ÿè®¡æ˜¾ç¤ºå…ƒç´ 
                    {id: 'todayTotal', critical: true},
                    {id: 'todayCorrect', critical: true},
                    {id: 'todayAccuracy', critical: true},
                    {id: 'totalQuestions', critical: true},
                    {id: 'totalCorrect', critical: true},
                    {id: 'totalAccuracy', critical: true},
                    {id: 'allTimeTotal', critical: true},
                    {id: 'allTimeCorrect', critical: true},
                    {id: 'allTimeAccuracy', critical: true},
                    
                    // åŠŸèƒ½æŒ‰é’®å’Œå®¹å™¨
                    {id: 'resetLimitBtn', critical: false},
                    {id: 'limitText', critical: false},
                    {id: 'showAllHistoryBtn', critical: true},
                    {id: 'hideAllHistoryBtn', critical: false},
                    {id: 'allHistoryContainer', critical: true},
                    {id: 'allHistoryList', critical: true},
                    {id: 'showQuestionStatsBtn', critical: true},
                    {id: 'hideQuestionStatsBtn', critical: false},
                    {id: 'questionStatsContainer', critical: true},
                    {id: 'questionStatsTableBody', critical: true},
                    {id: 'questionSummaryStats', critical: true},
                    {id: 'totalUniqueQuestions', critical: false},
                    {id: 'averageAccuracy', critical: false},
                    {id: 'mostFrequentQuestion', critical: false},
                    {id: 'lowestAccuracyQuestion', critical: false}
                ];
                
                // åˆ›å»ºDOMç¼“å­˜å¯¹è±¡
                this.domCache = {};
                
                // æ‰¹é‡è·å–DOMå…ƒç´ å¼•ç”¨
                let missingElements = [];
                let missingCriticalElements = [];
                
                elementConfigs.forEach(config => {
                    const element = document.getElementById(config.id);
                    this.domCache[config.id] = element;
                    
                    // æ£€æŸ¥å…ƒç´ æ˜¯å¦å­˜åœ¨
                    if (!element) {
                        missingElements.push(config.id);
                        if (config.critical) {
                            missingCriticalElements.push(config.id);
                        }
                    } else {
                        console.log(`DOMå…ƒç´ å·²ç¼“å­˜: ${config.id}`);
                    }
                });
                
                // å¦‚æœæœ‰ç¼ºå¤±çš„å…ƒç´ ï¼Œè¾“å‡ºè­¦å‘Š
                if (missingElements.length > 0) {
                    console.warn('ä»¥ä¸‹DOMå…ƒç´ æœªæ‰¾åˆ°:', missingElements.join(', '));
                    
                    // å¦‚æœæœ‰å…³é”®å…ƒç´ ç¼ºå¤±ï¼Œæ˜¾ç¤ºé”™è¯¯
                    if (missingCriticalElements.length > 0) {
                        console.error('å…³é”®DOMå…ƒç´ ç¼ºå¤±ï¼Œç³»ç»Ÿå¯èƒ½æ— æ³•æ­£å¸¸å·¥ä½œ:', missingCriticalElements.join(', '));
                        
                        // å°è¯•åˆ›å»ºé”™è¯¯æç¤ºå…ƒç´ 
                        try {
                            const errorAlert = document.createElement('div');
                            errorAlert.className = 'alert alert-danger';
                            errorAlert.innerHTML = `<strong>é”™è¯¯:</strong> é¡µé¢å…³é”®å…ƒç´ ç¼ºå¤±ï¼Œè¯·åˆ·æ–°é¡µé¢æˆ–è”ç³»ç®¡ç†å‘˜ã€‚`;
                            document.body.insertBefore(errorAlert, document.body.firstChild);
                        } catch (e) {
                            console.error('æ— æ³•åˆ›å»ºé”™è¯¯æç¤ºå…ƒç´ :', e);
                        }
                    }
                } else {
                    console.log('æ‰€æœ‰DOMå…ƒç´ å·²æˆåŠŸç¼“å­˜');
                }
                
                console.log('DOMç¼“å­˜åˆå§‹åŒ–å®Œæˆ');
            }
            
            /**
             * åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
             */
            initializeEventListeners() {
                // ä½¿ç”¨äº‹ä»¶å§”æ‰˜ä¼˜åŒ–æ€§èƒ½
                this.domCache.answerOptions.addEventListener('click', (e) => {
                    if (e.target.classList.contains('answer-btn')) {
                        this.checkAnswer(e.target);
                    }
                });
                
                // æ·»åŠ é‡ç½®æŒ‰é’®äº‹ä»¶ç›‘å¬å™¨
                if (this.domCache.resetLimitBtn) {
                    this.domCache.resetLimitBtn.addEventListener('click', () => this.resetDailyLimit());
                }
                
                // æ·»åŠ å†å²è®°å½•æŒ‰é’®äº‹ä»¶ç›‘å¬å™¨
                this.domCache.showAllHistoryBtn.addEventListener('click', () => {
                    // éšè—é¢˜ç›®ç»Ÿè®¡å®¹å™¨
                    this.domCache.questionStatsContainer.style.display = 'none';
                    // æ˜¾ç¤ºå†å²è®°å½•å®¹å™¨
                    this.domCache.allHistoryContainer.style.display = 'block';
                    this.updateAllHistoryList();
                });
                
                this.domCache.hideAllHistoryBtn.addEventListener('click', () => {
                    this.domCache.allHistoryContainer.style.display = 'none';
                });
                
                // æ·»åŠ é¢˜ç›®ç»Ÿè®¡è¯¦æƒ…æŒ‰é’®äº‹ä»¶ç›‘å¬å™¨
                this.domCache.showQuestionStatsBtn.addEventListener('click', () => {
                    // éšè—å†å²è®°å½•å®¹å™¨
                    this.domCache.allHistoryContainer.style.display = 'none';
                    // æ˜¾ç¤ºé¢˜ç›®ç»Ÿè®¡å®¹å™¨
                    this.domCache.questionStatsContainer.style.display = 'block';
                    this.updateQuestionStats();
                });
                
                this.domCache.hideQuestionStatsBtn.addEventListener('click', () => {
                    this.domCache.questionStatsContainer.style.display = 'none';
                });
            }
            
            /**
             * æ£€æŸ¥æ¯æ—¥è®­ç»ƒä¸Šé™ï¼ˆæ”¯æŒé¢å¤–å¢åŠ çš„é¢˜ç›®æ•°é‡ï¼‰
             */
            checkDailyLimit() {
                // æ›´æ–°ç¼“å­˜çš„ä»Šæ—¥å†å²è®°å½•
                this.todayHistory = this.getTodayHistory();
                
                // è·å–é¢å¤–å¢åŠ çš„é¢˜ç›®æ•°é‡
                const extraKey = `multiplicationTrainingExtra_${this.today}`;
                const extraCount = parseInt(localStorage.getItem(extraKey) || '0');
                
                // è®¡ç®—å®é™…çš„ä¸Šé™ï¼ˆåŸºç¡€ä¸Šé™ + é¢å¤–å¢åŠ çš„é¢˜ç›®ï¼‰
                const actualLimit = this.dailyLimit + extraCount;
                
                // æ£€æŸ¥ä»Šæ—¥æ˜¯å¦å·²è¾¾åˆ°è®­ç»ƒä¸Šé™
                if (this.todayHistory.length >= actualLimit) {
                    // æ˜¾ç¤ºæ¯æ—¥é™åˆ¶æç¤º
                    this.domCache.dailyLimitAlert.classList.remove('hidden');
                    
                    // éšè—è®­ç»ƒåŒºåŸŸ
                    this.domCache.trainingArea.classList.add('hidden');
                    
                    // éšè—ç­”æ¡ˆé€‰é¡¹åŒºåŸŸ
                    this.domCache.answerOptions.classList.add('hidden');
                    
                    // æ›´æ–°æç¤ºä¿¡æ¯
                    if (this.domCache.limitText) {
                        if (extraCount > 0) {
                            this.domCache.limitText.innerHTML = `<i class="bi bi-exclamation-triangle-fill"></i> ä»Šæ—¥å·²ç­”${this.todayHistory.length}é¢˜ï¼Œå·²è¾¾åˆ°${actualLimit}é¢˜ä¸Šé™ï¼ˆå«${extraCount}é“é¢å¤–é¢˜ç›®ï¼‰ï¼`;
                        } else {
                            this.domCache.limitText.innerHTML = `<i class="bi bi-exclamation-triangle-fill"></i> ä»Šæ—¥è®­ç»ƒå·²è¾¾åˆ°ä¸Šé™ï¼ˆ${this.dailyLimit}é¢˜ï¼‰ï¼Œæ˜å¤©å†æ¥ç»§ç»­å§ï¼`;
                        }
                    }
                    
                    return true; // å·²è¾¾åˆ°é™åˆ¶
                } else {
                    // æœªè¾¾åˆ°ä¸Šé™ï¼Œéšè—é™åˆ¶æç¤º
                    this.domCache.dailyLimitAlert.classList.add('hidden');
                    this.domCache.trainingArea.classList.remove('hidden');
                    
                    // æ˜¾ç¤ºç­”æ¡ˆé€‰é¡¹åŒºåŸŸ
                    this.domCache.answerOptions.classList.remove('hidden');
                    
                    return false; // æœªè¾¾åˆ°é™åˆ¶
                }
            }
            
            /**
             * å¢åŠ å½“æ—¥è®­ç»ƒä¸Šé™ï¼ˆæ¯æ¬¡å¢åŠ 10é“é¢˜ï¼‰
             */
            resetDailyLimit() {
                // ç¡®è®¤ç”¨æˆ·æ˜¯å¦è¦å¢åŠ è®­ç»ƒä¸Šé™
                if (confirm(`ç¡®å®šè¦å¢åŠ ä»Šæ—¥è®­ç»ƒä¸Šé™å—ï¼Ÿå°†é¢å¤–å¢åŠ 10é“é¢˜ï¼ˆå½“å‰å·²ç­”ï¼š${this.todayHistory.length}é“ï¼‰`)) {
                    // åœ¨localStorageä¸­å­˜å‚¨å¢åŠ çš„é¢˜ç›®æ•°é‡
                    const extraKey = `multiplicationTrainingExtra_${this.today}`;
                    let extraCount = parseInt(localStorage.getItem(extraKey) || '0');
                    extraCount += 10; // æ¯æ¬¡å¢åŠ 10é“é¢˜
                    localStorage.setItem(extraKey, extraCount.toString());
                    
                    // éšè—æ¯æ—¥é™åˆ¶æç¤º
                    this.domCache.dailyLimitAlert.classList.add('hidden');
                    
                    // æ˜¾ç¤ºè®­ç»ƒåŒºåŸŸ
                    this.domCache.trainingArea.classList.remove('hidden');
                    
                    // æ˜¾ç¤ºå¢åŠ æˆåŠŸçš„åé¦ˆ
                    this.showFeedback(`âœ… ä»Šæ—¥è®­ç»ƒä¸Šé™å·²å¢åŠ 10é“é¢˜ï¼ï¼ˆé¢å¤–ï¼š${extraCount}é“ï¼‰`, 'success');
                    
                    // ç”Ÿæˆç¬¬ä¸€é¢˜
                    this.generateNextQuestion();
                }
            }
            
            /**
             * å¼€å§‹è®­ç»ƒ
             */
            startTraining() {
                // æ£€æŸ¥æ˜¯å¦è¾¾åˆ°æ¯æ—¥é™åˆ¶
                const isLimited = this.checkDailyLimit();
                
                // å¦‚æœæœªè¾¾åˆ°é™åˆ¶ï¼Œåˆ™å¼€å§‹è®­ç»ƒ
                if (!isLimited) {
                    // æ˜¾ç¤ºç­”æ¡ˆé€‰é¡¹åŒºåŸŸ
                    this.domCache.answerOptions.classList.remove('hidden');
                    // ç”Ÿæˆç¬¬ä¸€ä¸ªé—®é¢˜
                    this.generateNextQuestion();
                }
                
                // æ›´æ–°å¤ä¹ æé†’çŠ¶æ€
                this.updateReviewAlert();
            }
            
            /**
             * ç”Ÿæˆä¸‹ä¸€é¢˜
             */
            nextQuestion() {
                this.currentQuestion = this.generateSmartQuestion();
                this.displayQuestion();
                
                const nextBtn = document.getElementById('nextBtn');
                if (nextBtn) nextBtn.classList.add('hidden');
                
                this.domCache.feedback.classList.add('hidden');
                this.enableAnswerButtons();
            }
            
            /**
             * æ ¹æ®å†å²ç­”é¢˜æƒ…å†µæ™ºèƒ½ç”Ÿæˆä¹˜æ³•å£è¯€é¢˜ç›®
             * æ ¹æ®ç”¨æˆ·ç­”é¢˜å†å²ã€æ¨¡å¼åˆ†æå’Œè‰¾å®¾æµ©æ–¯è®°å¿†æ›²çº¿è°ƒæ•´éš¾åº¦å’Œé¢˜å‹
             */
            generateSmartQuestion() {
                console.log('å¼€å§‹ç”Ÿæˆä¹˜æ³•å£è¯€é¢˜ç›®...');
                
                // é»˜è®¤å‚æ•°
                let maxNumber = 9; // ä¹˜æ³•å£è¯€è¡¨æœ€å¤§åˆ°9
                let useWeakNumbers = false;
                let weakNumbers = [];
                
                // æ£€æŸ¥æ˜¯å¦æœ‰éœ€è¦å¤ä¹ çš„é¢˜ç›®ï¼ˆè‰¾å®¾æµ©æ–¯è®°å¿†æ›²çº¿ï¼‰
                const reviewQuestion = this.getReviewQuestionByEbbinghaus();
                if (reviewQuestion) {
                    console.log('æ‰¾åˆ°éœ€è¦å¤ä¹ çš„é¢˜ç›®:', reviewQuestion);
                    return reviewQuestion;
                }
                
                // åˆ†æå†å²ç­”é¢˜æƒ…å†µï¼Œæ‰¾å‡ºå¼±ç‚¹æ•°å­—
                if (this.history.length > 10) {
                    console.log('åˆ†æå†å²ç­”é¢˜æƒ…å†µï¼Œå¯»æ‰¾å¼±ç‚¹...');
                    const questionStats = this.getQuestionStats();
                    const weakQuestions = [];
                    
                    // æ‰¾å‡ºæ­£ç¡®ç‡ä½äº70%çš„é¢˜ç›®
                    questionStats.forEach((stats, question) => {
                        if (stats.total >= 3 && (stats.correct / stats.total) < 0.7) {
                            weakQuestions.push(question);
                        }
                    });
                    
                    if (weakQuestions.length > 0) {
                        console.log('å‘ç°å¼±ç‚¹é¢˜ç›®:', weakQuestions);
                        // æœ‰30%çš„æ¦‚ç‡å‡ºä¸€é“å¼±ç‚¹é¢˜ç›®
                        if (Math.random() < 0.3) {
                            const randomWeakQuestion = weakQuestions[Math.floor(Math.random() * weakQuestions.length)];
                            console.log('é€‰æ‹©å¼±ç‚¹é¢˜ç›®è¿›è¡Œè®­ç»ƒ:', randomWeakQuestion);
                            
                            // è§£æå¼±ç‚¹é¢˜ç›®ï¼Œæå–æ•°å­—
                            const match = randomWeakQuestion.match(/(\d+)\s*[Ã—xX]\s*(\d+)\s*=\s*(\d+)/);
                            if (match) {
                                const num1 = parseInt(match[1]);
                                const num2 = parseInt(match[2]);
                                return this.generateMultiplicationQuestion(num1, num2);
                            }
                        }
                        
                        // æå–å¼±ç‚¹æ•°å­—
                        weakQuestions.forEach(q => {
                            const match = q.match(/(\d+)\s*[Ã—xX]\s*(\d+)\s*=\s*(\d+)/);
                            if (match) {
                                weakNumbers.push(parseInt(match[1]));
                                weakNumbers.push(parseInt(match[2]));
                            }
                        });
                        
                        // å»é‡
                        weakNumbers = [...new Set(weakNumbers)];
                        useWeakNumbers = weakNumbers.length > 0;
                        console.log('æå–çš„å¼±ç‚¹æ•°å­—:', weakNumbers);
                    }
                }
                
                // ç”Ÿæˆä¹˜æ³•å£è¯€é¢˜ç›®
                let num1, num2;
                
                if (useWeakNumbers && Math.random() < 0.6) {
                    // 60%çš„æ¦‚ç‡ä½¿ç”¨å¼±ç‚¹æ•°å­—
                    num1 = weakNumbers[Math.floor(Math.random() * weakNumbers.length)];
                    num2 = Math.floor(Math.random() * maxNumber) + 1;
                    
                    // ç¡®ä¿num1 <= num2ï¼Œç¬¦åˆä¹˜æ³•å£è¯€è¡¨çš„ä¹ æƒ¯
                    if (num1 > num2) {
                        [num1, num2] = [num2, num1];
                    }
                    
                    console.log('ä½¿ç”¨å¼±ç‚¹æ•°å­—ç”Ÿæˆé¢˜ç›®:', num1, num2);
                } else {
                    // éšæœºç”Ÿæˆä¹˜æ³•å£è¯€é¢˜ç›®
                    num1 = Math.floor(Math.random() * maxNumber) + 1;
                    num2 = Math.floor(Math.random() * maxNumber) + 1;
                    
                    // ç¡®ä¿num1 <= num2ï¼Œç¬¦åˆä¹˜æ³•å£è¯€è¡¨çš„ä¹ æƒ¯
                    if (num1 > num2) {
                        [num1, num2] = [num2, num1];
                    }
                    
                    console.log('éšæœºç”Ÿæˆä¹˜æ³•å£è¯€é¢˜ç›®:', num1, num2);
                }
                
                return this.generateMultiplicationQuestion(num1, num2);
            }
            
            /**
             * ç”Ÿæˆä¹˜æ³•å£è¯€é¢˜ç›®
             * @param {number} num1 - ç¬¬ä¸€ä¸ªæ•°å­—
             * @param {number} num2 - ç¬¬äºŒä¸ªæ•°å­—
             * @returns {Object} é¢˜ç›®å¯¹è±¡
             */
            generateMultiplicationQuestion(num1, num2) {
                // ç¡®ä¿num1 <= num2ï¼Œç¬¦åˆä¹˜æ³•å£è¯€è¡¨çš„ä¹ æƒ¯
                if (num1 > num2) {
                    [num1, num2] = [num2, num1];
                }
                
                const correctAnswer = num1 * num2;
                
                // ç”Ÿæˆå¹²æ‰°é€‰é¡¹
                let options = [correctAnswer];
                
                while (options.length < 4) {
                    // ç”Ÿæˆå¹²æ‰°é€‰é¡¹çš„ç­–ç•¥ï¼š
                    // 1. ç›¸é‚»æ•°å­—çš„ä¹˜ç§¯
                    // 2. åŠ å‡1æˆ–2çš„ä¹˜ç§¯
                    // 3. å®Œå…¨éšæœºçš„ä¹˜ç§¯
                    let wrongAnswer;
                    
                    const strategy = Math.random();
                    if (strategy < 0.4) {
                        // ç›¸é‚»æ•°å­—çš„ä¹˜ç§¯
                        const offset1 = Math.random() < 0.5 ? 1 : -1;
                        const offset2 = Math.random() < 0.5 ? 1 : -1;
                        const newNum1 = Math.max(1, Math.min(9, num1 + offset1));
                        const newNum2 = Math.max(1, Math.min(9, num2 + offset2));
                        wrongAnswer = newNum1 * newNum2;
                    } else if (strategy < 0.7) {
                        // åŠ å‡1æˆ–2çš„ç»“æœ
                        const offset = Math.random() < 0.5 ? 
                                      (Math.random() < 0.5 ? 1 : 2) : 
                                      (Math.random() < 0.5 ? -1 : -2);
                        wrongAnswer = correctAnswer + offset;
                    } else {
                        // å®Œå…¨éšæœºçš„ä¹˜ç§¯ï¼ˆ1-9èŒƒå›´å†…ï¼‰
                        const randNum1 = Math.floor(Math.random() * 9) + 1;
                        const randNum2 = Math.floor(Math.random() * 9) + 1;
                        wrongAnswer = randNum1 * randNum2;
                    }
                    
                    // ç¡®ä¿é€‰é¡¹åœ¨åˆç†èŒƒå›´å†…ä¸”ä¸é‡å¤
                    if (wrongAnswer > 0 && wrongAnswer <= 81 && !options.includes(wrongAnswer)) {
                        options.push(wrongAnswer);
                    }
                }
                
                // æ‰“ä¹±é€‰é¡¹é¡ºåº
                options = this.shuffleArray(options);
                
                // è®°å½•æ­£ç¡®ç­”æ¡ˆçš„ç´¢å¼•
                const correctIndex = options.indexOf(correctAnswer);
                
                return {
                    question: `${num1} Ã— ${num2} = ?`,
                    options: options,
                    correctIndex: correctIndex,
                    correctAnswer: correctAnswer,
                    isReview: false
                };
            }
            
            /**
             * æ‰“ä¹±æ•°ç»„é¡ºåº
             * @param {Array} array - è¦æ‰“ä¹±çš„æ•°ç»„
             * @returns {Array} æ‰“ä¹±åçš„æ•°ç»„
             */
            shuffleArray(array) {
                const newArray = [...array];
                for (let i = newArray.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
                }
                return newArray;
            }
            
            /**
             * æ˜¾ç¤ºå½“å‰é¢˜ç›®
             */
            displayQuestion() {
                if (!this.currentQuestion) return;
                
                // æ˜¾ç¤ºé¢˜ç›®
                this.domCache.question.textContent = this.currentQuestion.question;
                
                // å¦‚æœæ˜¯å¤ä¹ é¢˜ç›®ï¼Œæ·»åŠ å¤ä¹ æ ‡è®°
                if (this.currentQuestion.isReview) {
                    const reviewBadge = document.createElement('span');
                    reviewBadge.className = 'badge bg-warning';
                    reviewBadge.textContent = 'å¤ä¹ ';
                    this.domCache.question.prepend(reviewBadge);
                }
                
                // æ˜¾ç¤ºé€‰é¡¹
                this.domCache.optionA.textContent = this.currentQuestion.options[0];
                this.domCache.optionB.textContent = this.currentQuestion.options[1];
                this.domCache.optionC.textContent = this.currentQuestion.options[2];
                this.domCache.optionD.textContent = this.currentQuestion.options[3];
                
                // é‡ç½®æŒ‰é’®æ ·å¼
                const buttons = document.querySelectorAll('.answer-btn');
                buttons.forEach(btn => {
                    btn.classList.remove('correct', 'incorrect');
                    btn.classList.add('btn-primary');
                });
            }
            
            /**
             * æ£€æŸ¥ç­”æ¡ˆ
             * @param {HTMLElement} selectedButton - ç”¨æˆ·é€‰æ‹©çš„æŒ‰é’®
             */
            checkAnswer(selectedButton) {
                if (!this.currentQuestion) return;
                
                // ç¦ç”¨æ‰€æœ‰æŒ‰é’®ï¼Œé˜²æ­¢é‡å¤ç‚¹å‡»
                this.disableAnswerButtons();
                
                // è·å–ç”¨æˆ·é€‰æ‹©çš„ç­”æ¡ˆç´¢å¼•
                const buttons = [this.domCache.optionA, this.domCache.optionB, this.domCache.optionC, this.domCache.optionD];
                const selectedIndex = buttons.indexOf(selectedButton);
                
                // åˆ¤æ–­ç­”æ¡ˆæ˜¯å¦æ­£ç¡®
                const isCorrect = selectedIndex === this.currentQuestion.correctIndex;
                
                // æ›´æ–°æŒ‰é’®æ ·å¼
                if (isCorrect) {
                    selectedButton.classList.remove('btn-primary');
                    selectedButton.classList.add('correct');
                    this.showFeedback('ğŸ‘ ç­”å¯¹äº†ï¼', 'success');
                } else {
                    selectedButton.classList.remove('btn-primary');
                    selectedButton.classList.add('incorrect');
                    
                    // æ˜¾ç¤ºæ­£ç¡®ç­”æ¡ˆ
                    const correctButton = buttons[this.currentQuestion.correctIndex];
                    correctButton.classList.remove('btn-primary');
                    correctButton.classList.add('correct');
                    
                    this.showFeedback('âŒ ç­”é”™äº†ï¼Œå†æ¥å†å‰ï¼', 'danger');
                }
                
                // è®°å½•ç­”é¢˜ç»“æœ
                this.recordAnswer(isCorrect);
                
                // å¦‚æœæ˜¯å¤ä¹ é¢˜ç›®ï¼Œæ›´æ–°å¤ä¹ çŠ¶æ€
                if (this.currentQuestion.isReview) {
                    this.updateReviewStatus(this.currentQuestion.question, isCorrect);
                }
                
                // è‡ªåŠ¨è¿›å…¥ä¸‹ä¸€é¢˜
                setTimeout(() => {
                    // æ£€æŸ¥æ˜¯å¦è¾¾åˆ°æ¯æ—¥é™åˆ¶
                    const isLimited = this.checkDailyLimit();
                    if (!isLimited) {
                        this.nextQuestion();
                    }
                }, isCorrect ? 1000 : 1500);
            }
            
            /**
             * ç¦ç”¨ç­”æ¡ˆæŒ‰é’®
             */
            disableAnswerButtons() {
                const buttons = document.querySelectorAll('.answer-btn');
                buttons.forEach(btn => {
                    btn.disabled = true;
                });
            }
            
            /**
             * å¯ç”¨ç­”æ¡ˆæŒ‰é’®
             */
            enableAnswerButtons() {
                const buttons = document.querySelectorAll('.answer-btn');
                buttons.forEach(btn => {
                    btn.disabled = false;
                    btn.classList.remove('correct', 'incorrect');
                    btn.classList.add('btn-primary');
                });
            }
            
            /**
             * æ˜¾ç¤ºåé¦ˆä¿¡æ¯
             * @param {string} message - åé¦ˆä¿¡æ¯
             * @param {string} type - åé¦ˆç±»å‹ï¼ˆsuccess/dangerï¼‰
             */
            showFeedback(message, type) {
                this.domCache.feedback.textContent = message;
                this.domCache.feedback.className = `emoji-feedback text-${type} fade-in`;
                this.domCache.feedback.classList.remove('hidden');
            }
            
            /**
             * è®°å½•ç­”é¢˜ç»“æœ
             * @param {boolean} isCorrect - æ˜¯å¦å›ç­”æ­£ç¡®
             */
            recordAnswer(isCorrect) {
                console.log('è®°å½•ç­”é¢˜å¼€å§‹...');
                
                // åˆ›å»ºç­”é¢˜è®°å½•
                const answer = {
                    question: this.currentQuestion.question,
                    isCorrect: isCorrect,
                    date: this.today,
                    timestamp: new Date().toISOString()
                };
                
                console.log('ç­”é¢˜è¯¦æƒ…:', answer);
                
                // æ·»åŠ åˆ°å†å²è®°å½•
                this.history.push(answer);
                this.todayHistory.push(answer);
                
                console.log('å†å²è®°å½•æ€»æ•°:', this.history.length);
                console.log('ä»Šæ—¥ç­”é¢˜æ•°:', this.todayHistory.length);
                
                // æ›´æ–°ç»Ÿè®¡æ•°æ®
                this.updateStats();
                this.updateAllTimeStats();
                this.updateHistoryList();
                
                // ä¿å­˜å†å²è®°å½•ï¼ˆä½¿ç”¨é˜²æŠ–ï¼Œé¿å…é¢‘ç¹ä¿å­˜ï¼‰
                this.debounceSaveHistory();
                
                // æ›´æ–°é¢˜ç›®ç»Ÿè®¡
                const questionStats = this.getQuestionStats();
                const currentQuestionStats = questionStats.get(this.currentQuestion.question) || { total: 0, correct: 0, incorrect: 0, lastAnswered: null };
                console.log('å½“å‰é¢˜ç›®ç»Ÿè®¡æ›´æ–°:', this.currentQuestion.question, currentQuestionStats);
                
                // å¦‚æœé¢˜ç›®ç»Ÿè®¡å®¹å™¨å¯è§ï¼Œæ›´æ–°é¢˜ç›®ç»Ÿè®¡
                if (this.domCache.questionStatsContainer.style.display === 'block') {
                    this.updateQuestionStats();
                }
                
                // å¦‚æœç­”é”™äº†ï¼Œæ·»åŠ åˆ°è‰¾å®¾æµ©æ–¯è®°å¿†æ›²çº¿ä¸­è¿›è¡Œå¤ä¹ 
                if (!isCorrect) {
                    this.updateEbbinghausData(this.currentQuestion.question);
                }
            }
            
            /**
             * è·å–ä»Šæ—¥å†å²è®°å½•
             * @returns {Array} ä»Šæ—¥çš„å†å²è®°å½•æ•°ç»„
             */
            getTodayHistory() {
                console.log('è·å–ä»Šæ—¥å†å²è®°å½•...');
                
                if (!this.history || !Array.isArray(this.history)) {
                    console.error('å†å²è®°å½•ä¸æ˜¯æœ‰æ•ˆæ•°ç»„');
                    return [];
                }
                
                // ç¡®ä¿todayæ˜¯æœ‰æ•ˆçš„æ—¥æœŸå­—ç¬¦ä¸²
                if (!this.today) {
                    this.today = new Date().toISOString().split('T')[0];
                    console.log('é‡æ–°åˆå§‹åŒ–ä»Šæ—¥æ—¥æœŸ:', this.today);
                }
                
                const todayRecords = this.history.filter(h => h && h.date === this.today);
                console.log(`ç­›é€‰å‡º${todayRecords.length}æ¡ä»Šæ—¥(${this.today})å†å²è®°å½•`);
                
                return todayRecords;
            }
            
            /**
             * æ›´æ–°ç»Ÿè®¡æ•°æ®
             */
            updateStats() {
                console.log('æ›´æ–°ç»Ÿè®¡æ•°æ®...');
                
                // ç¡®ä¿ä»Šæ—¥å†å²è®°å½•æ˜¯æœ€æ–°çš„
                this.todayHistory = this.getTodayHistory();
                console.log('ä»Šæ—¥å†å²è®°å½•æ•°é‡:', this.todayHistory.length);
                
                // è®¡ç®—ä»Šæ—¥ç»Ÿè®¡
                const todayTotal = this.todayHistory.length;
                const todayCorrect = this.todayHistory.filter(h => h.isCorrect).length;
                const todayAccuracy = todayTotal > 0 ? Math.round((todayCorrect / todayTotal) * 100) : 0;
                
                console.log('ä»Šæ—¥ç»Ÿè®¡:', {
                    total: todayTotal,
                    correct: todayCorrect,
                    accuracy: todayAccuracy
                });
                
                // æ›´æ–°ä»Šæ—¥ç»Ÿè®¡æ˜¾ç¤º
                if (this.domCache.todayTotal) {
                    this.domCache.todayTotal.textContent = todayTotal;
                    this.domCache.todayCorrect.textContent = todayCorrect;
                    this.domCache.todayAccuracy.textContent = `${todayAccuracy}%`;
                } else {
                    console.error('DOMå…ƒç´ æœªæ‰¾åˆ°: todayTotal');
                }
                
                // è®¡ç®—æ€»ä½“ç»Ÿè®¡
                const totalQuestions = this.history.length;
                const totalCorrect = this.history.filter(h => h.isCorrect).length;
                const totalAccuracy = totalQuestions > 0 ? Math.round((totalCorrect / totalQuestions) * 100) : 0;
                
                console.log('æ€»ä½“ç»Ÿè®¡:', {
                    total: totalQuestions,
                    correct: totalCorrect,
                    accuracy: totalAccuracy
                });
                
                // æ›´æ–°æ€»ä½“ç»Ÿè®¡æ˜¾ç¤º
                if (this.domCache.totalQuestions) {
                    this.domCache.totalQuestions.textContent = totalQuestions;
                    this.domCache.totalCorrect.textContent = totalCorrect;
                    this.domCache.totalAccuracy.textContent = `${totalAccuracy}%`;
                } else {
                    console.error('DOMå…ƒç´ æœªæ‰¾åˆ°: totalQuestions');
                }
                
                // å¦‚æœé¢˜ç›®ç»Ÿè®¡å®¹å™¨å·²åˆå§‹åŒ–ï¼Œæ›´æ–°é¢˜ç›®ç»Ÿè®¡
                if (this.domCache.questionStatsContainer && this.domCache.questionSummaryStats) {
                    this.updateQuestionStats();
                }
            }
            
            /**
             * æ›´æ–°æ‰€æœ‰æ—¶é—´çš„ç»Ÿè®¡æ•°æ®
             */
            updateAllTimeStats() {
                console.log('æ›´æ–°æ‰€æœ‰æ—¶é—´çš„ç»Ÿè®¡æ•°æ®...');
                
                // è®¡ç®—æ‰€æœ‰æ—¶é—´çš„ç»Ÿè®¡
                const allTimeTotal = this.history.length;
                const allTimeCorrect = this.history.filter(h => h.isCorrect).length;
                const allTimeAccuracy = allTimeTotal > 0 ? Math.round((allTimeCorrect / allTimeTotal) * 100) : 0;
                
                console.log('æ‰€æœ‰æ—¶é—´ç»Ÿè®¡:', {
                    total: allTimeTotal,
                    correct: allTimeCorrect,
                    accuracy: allTimeAccuracy
                });
                
                // æ›´æ–°æ‰€æœ‰æ—¶é—´çš„ç»Ÿè®¡æ˜¾ç¤º
                if (this.domCache.allTimeTotal) {
                    this.domCache.allTimeTotal.textContent = allTimeTotal;
                    this.domCache.allTimeCorrect.textContent = allTimeCorrect;
                    this.domCache.allTimeAccuracy.textContent = `${allTimeAccuracy}%`;
                } else {
                    console.error('DOMå…ƒç´ æœªæ‰¾åˆ°: allTimeTotal');
                }
            }
            
            /**
             * æ›´æ–°å†å²è®°å½•åˆ—è¡¨
             */
            updateHistoryList() {
                console.log('æ›´æ–°å†å²è®°å½•åˆ—è¡¨...');
                
                // ç¡®ä¿ä»Šæ—¥å†å²è®°å½•æ˜¯æœ€æ–°çš„
                this.todayHistory = this.getTodayHistory();
                console.log('ä»Šæ—¥å†å²è®°å½•æ•°é‡:', this.todayHistory.length);
                
                // æ£€æŸ¥DOMå…ƒç´ æ˜¯å¦å­˜åœ¨
                if (!this.domCache.historyList) {
                    console.error('DOMå…ƒç´ æœªæ‰¾åˆ°: historyList');
                    return;
                }
                
                // æ¸…ç©ºå†å²è®°å½•åˆ—è¡¨
                this.domCache.historyList.innerHTML = '';
                
                // å¦‚æœæ²¡æœ‰ä»Šæ—¥å†å²è®°å½•ï¼Œæ˜¾ç¤ºæç¤º
                if (this.todayHistory.length === 0) {
                    this.domCache.historyList.innerHTML = '<div class="alert alert-info">ä»Šæ—¥è¿˜æ²¡æœ‰ç­”é¢˜è®°å½•</div>';
                    return;
                }
                
                // æ˜¾ç¤ºä»Šæ—¥å†å²è®°å½•ï¼ˆæœ€æ–°çš„5æ¡ï¼‰
                const recentHistory = [...this.todayHistory].reverse().slice(0, 5);
                console.log('æ˜¾ç¤ºæœ€è¿‘å†å²è®°å½•:', recentHistory.length, 'æ¡');
                
                recentHistory.forEach(item => {
                    const historyItem = document.createElement('div');
                    historyItem.className = `history-item ${item.isCorrect ? 'border-success' : 'border-danger'}`;
                    
                    const time = new Date(item.timestamp).toLocaleTimeString('zh-CN', {
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit'
                    });
                    
                    historyItem.innerHTML = `
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <span class="badge ${item.isCorrect ? 'bg-success' : 'bg-danger'} me-2">
                                    ${item.isCorrect ? 'âœ“' : 'âœ—'}
                                </span>
                                ${item.question}
                            </div>
                            <small class="text-muted">${time}</small>
                        </div>
                    `;
                    
                    this.domCache.historyList.appendChild(historyItem);
                });
                
                // å¦‚æœä»Šæ—¥ç­”é¢˜è¶…è¿‡5é¢˜ï¼Œæ˜¾ç¤ºæŸ¥çœ‹æ›´å¤šæŒ‰é’®
                if (this.todayHistory.length > 5) {
                    const viewMoreBtn = document.createElement('button');
                    viewMoreBtn.className = 'btn btn-sm btn-outline-primary mt-2';
                    viewMoreBtn.textContent = `æŸ¥çœ‹æ›´å¤šï¼ˆå…±${this.todayHistory.length}é¢˜ï¼‰`;
                    viewMoreBtn.addEventListener('click', () => {
                        if (this.domCache.showAllHistoryBtn) {
                            this.domCache.showAllHistoryBtn.click();
                        } else {
                            console.error('DOMå…ƒç´ æœªæ‰¾åˆ°: showAllHistoryBtn');
                        }
                    });
                    
                    this.domCache.historyList.appendChild(viewMoreBtn);
                }
                
                console.log('å†å²è®°å½•åˆ—è¡¨æ›´æ–°å®Œæˆ');
            }
            
            /**
             * æ›´æ–°æ‰€æœ‰å†å²è®°å½•åˆ—è¡¨
             */
            updateAllHistoryList() {
                console.log('æ›´æ–°æ‰€æœ‰å†å²è®°å½•åˆ—è¡¨...');
                
                // æ£€æŸ¥DOMå…ƒç´ æ˜¯å¦å­˜åœ¨
                if (!this.domCache.allHistoryList) {
                    console.error('DOMå…ƒç´ æœªæ‰¾åˆ°: allHistoryList');
                    return;
                }
                
                // æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•åˆ—è¡¨
                this.domCache.allHistoryList.innerHTML = '';
                
                // å¦‚æœæ²¡æœ‰å†å²è®°å½•ï¼Œæ˜¾ç¤ºæç¤º
                if (this.history.length === 0) {
                    this.domCache.allHistoryList.innerHTML = '<div class="alert alert-info">æš‚æ— å†å²è®°å½•</div>';
                    console.log('æ²¡æœ‰å†å²è®°å½•å¯æ˜¾ç¤º');
                    return;
                }
                
                console.log('å†å²è®°å½•æ€»æ•°:', this.history.length);
                
                // æŒ‰æ—¥æœŸåˆ†ç»„å†å²è®°å½•
                const groupedHistory = {};
                
                this.history.forEach(item => {
                    if (!groupedHistory[item.date]) {
                        groupedHistory[item.date] = [];
                    }
                    groupedHistory[item.date].push(item);
                });
                
                // æŒ‰æ—¥æœŸå€’åºæ’åˆ—
                const sortedDates = Object.keys(groupedHistory).sort().reverse();
                console.log('æŒ‰æ—¥æœŸåˆ†ç»„åçš„è®°å½•æ•°:', sortedDates.length);
                
                // æ˜¾ç¤ºåˆ†ç»„åçš„å†å²è®°å½•
                sortedDates.forEach(date => {
                    const dateGroup = document.createElement('div');
                    dateGroup.className = 'mb-3';
                    
                    // æ ¼å¼åŒ–æ—¥æœŸ
                    const formattedDate = new Date(date).toLocaleDateString('zh-CN', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                    
                    // è®¡ç®—å½“æ—¥ç»Ÿè®¡
                    const dailyRecords = groupedHistory[date];
                    const dailyTotal = dailyRecords.length;
                    const dailyCorrect = dailyRecords.filter(h => h.isCorrect).length;
                    const dailyAccuracy = dailyTotal > 0 ? Math.round((dailyCorrect / dailyTotal) * 100) : 0;
                    
                    console.log(`${formattedDate} ç»Ÿè®¡:`, {
                        total: dailyTotal,
                        correct: dailyCorrect,
                        accuracy: dailyAccuracy
                    });
                    
                    // åˆ›å»ºæ—¥æœŸæ ‡é¢˜å’Œç»Ÿè®¡ä¿¡æ¯
                    dateGroup.innerHTML = `
                        <h5 class="d-flex justify-content-between align-items-center">
                            <span>${formattedDate}</span>
                            <span class="badge bg-info">${dailyTotal}é¢˜ / ${dailyCorrect}æ­£ç¡® / ${dailyAccuracy}%æ­£ç¡®ç‡</span>
                        </h5>
                        <div class="list-group">
                            ${dailyRecords.reverse().map(item => {
                                const time = new Date(item.timestamp).toLocaleTimeString('zh-CN', {
                                    hour: '2-digit',
                                    minute: '2-digit'
                                });
                                
                                return `
                                    <div class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                                        <div>
                                            <span class="badge ${item.isCorrect ? 'bg-success' : 'bg-danger'} me-2">
                                                ${item.isCorrect ? 'âœ“' : 'âœ—'}
                                            </span>
                                            ${item.question}
                                        </div>
                                        <small class="text-muted">${time}</small>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    `;
                    
                    this.domCache.allHistoryList.appendChild(dateGroup);
                });
                
                console.log('æ‰€æœ‰å†å²è®°å½•åˆ—è¡¨æ›´æ–°å®Œæˆ');
            }
            
            /**
             * è·å–é¢˜ç›®ç»Ÿè®¡æ•°æ®
             * ç»Ÿè®¡æ¯é“é¢˜çš„ç­”é¢˜æ¬¡æ•°ã€æ­£ç¡®æ¬¡æ•°ã€é”™è¯¯æ¬¡æ•°ã€æ­£ç¡®ç‡å’Œæœ€åç­”é¢˜æ—¶é—´
             * @returns {Map} é¢˜ç›®ç»Ÿè®¡æ•°æ®Mapå¯¹è±¡
             */
            getQuestionStats() {
                console.log('è·å–é¢˜ç›®ç»Ÿè®¡æ•°æ®...');
                
                // åˆ›å»ºMapå­˜å‚¨é¢˜ç›®ç»Ÿè®¡æ•°æ®
                const questionStats = new Map();
                
                // æ£€æŸ¥å†å²è®°å½•æ˜¯å¦å­˜åœ¨
                if (!this.history || !Array.isArray(this.history)) {
                    console.error('å†å²è®°å½•ä¸å­˜åœ¨æˆ–æ ¼å¼ä¸æ­£ç¡®:', this.history);
                    return questionStats;
                }
                
                console.log('å†å²è®°å½•æ€»æ•°:', this.history.length);
                
                // éå†å†å²è®°å½•ï¼Œç»Ÿè®¡æ¯é“é¢˜çš„æƒ…å†µ
                this.history.forEach((item, index) => {
                    // æ£€æŸ¥å†å²è®°å½•é¡¹æ˜¯å¦æœ‰æ•ˆ
                    if (!item || typeof item !== 'object') {
                        console.error(`å†å²è®°å½•é¡¹ #${index} æ— æ•ˆ:`, item);
                        return;
                    }
                    
                    const question = item.question;
                    const isCorrect = item.isCorrect;
                    const timestamp = item.timestamp;
                    
                    // æ£€æŸ¥å¿…è¦å­—æ®µæ˜¯å¦å­˜åœ¨
                    if (!question) {
                        console.error(`å†å²è®°å½•é¡¹ #${index} ç¼ºå°‘é¢˜ç›®:`, item);
                        return;
                    }
                    
                    if (typeof isCorrect !== 'boolean') {
                        console.error(`å†å²è®°å½•é¡¹ #${index} ç¼ºå°‘æ­£ç¡®æ€§æ ‡è®°:`, item);
                        return;
                    }
                    
                    if (!timestamp) {
                        console.error(`å†å²è®°å½•é¡¹ #${index} ç¼ºå°‘æ—¶é—´æˆ³:`, item);
                        return;
                    }
                    
                    // å¦‚æœé¢˜ç›®ä¸å­˜åœ¨äºMapä¸­ï¼Œåˆå§‹åŒ–ç»Ÿè®¡æ•°æ®
                    if (!questionStats.has(question)) {
                        questionStats.set(question, {
                            total: 0,
                            correct: 0,
                            incorrect: 0,
                            lastAnswered: null
                        });
                    }
                    
                    // è·å–å½“å‰é¢˜ç›®çš„ç»Ÿè®¡æ•°æ®
                    const stats = questionStats.get(question);
                    
                    // æ›´æ–°ç»Ÿè®¡æ•°æ®
                    stats.total += 1;
                    if (isCorrect) {
                        stats.correct += 1;
                    } else {
                        stats.incorrect += 1;
                    }
                    
                    // æ›´æ–°æœ€åç­”é¢˜æ—¶é—´
                    if (!stats.lastAnswered || new Date(timestamp) > new Date(stats.lastAnswered)) {
                        stats.lastAnswered = timestamp;
                    }
                });
                
                console.log('é¢˜ç›®ç»Ÿè®¡æ•°æ®è·å–å®Œæˆï¼Œå…±ç»Ÿè®¡', questionStats.size, 'é“é¢˜ç›®');
                return questionStats;
            }
            
            /**
             * æ›´æ–°é¢˜ç›®ç»Ÿè®¡è¯¦æƒ…
             */
            updateQuestionStats() {
                console.log('æ›´æ–°é¢˜ç›®ç»Ÿè®¡è¯¦æƒ…...');
                
                // æ£€æŸ¥DOMå…ƒç´ æ˜¯å¦å­˜åœ¨
                if (!this.domCache.questionStatsTableBody) {
                    console.error('DOMå…ƒç´ æœªæ‰¾åˆ°: questionStatsTableBody');
                    return;
                }
                
                // æ¸…ç©ºé¢˜ç›®ç»Ÿè®¡è¡¨æ ¼
                this.domCache.questionStatsTableBody.innerHTML = '';
                
                // è·å–é¢˜ç›®ç»Ÿè®¡æ•°æ®å’Œè¯¦ç»†æŠ¥å‘Š
                const questionStats = this.getQuestionStats();
                const detailedReport = this.getDetailedQuestionReport();
                console.log('é¢˜ç›®ç»Ÿè®¡æ•°æ®è·å–å®Œæˆï¼Œé¢˜ç›®æ•°é‡:', questionStats.size);
                
                // æ›´æ–°é¢˜ç›®æ±‡æ€»ç»Ÿè®¡åŒºåŸŸ
                this.updateQuestionSummaryStats(detailedReport);
                
                // å¦‚æœæ²¡æœ‰ç»Ÿè®¡æ•°æ®ï¼Œæ˜¾ç¤ºæç¤º
                if (questionStats.size === 0) {
                    console.warn('æ²¡æœ‰é¢˜ç›®ç»Ÿè®¡æ•°æ®å¯æ˜¾ç¤º');
                    const emptyRow = document.createElement('tr');
                    emptyRow.innerHTML = '<td colspan="6" class="text-center">æš‚æ— é¢˜ç›®ç»Ÿè®¡æ•°æ®</td>';
                    this.domCache.questionStatsTableBody.appendChild(emptyRow);
                    return;
                }
                
                // å°†Mapè½¬æ¢ä¸ºæ•°ç»„ï¼Œä¾¿äºæ’åº
                const statsArray = [];
                questionStats.forEach((stats, question) => {
                    statsArray.push({
                        question,
                        ...stats
                    });
                });
                
                // æŒ‰æ€»æ¬¡æ•°é™åºæ’åº
                statsArray.sort((a, b) => b.total - a.total);
                console.log('é¢˜ç›®ç»Ÿè®¡æ•°æ®å·²æ’åºï¼Œå‡†å¤‡æ˜¾ç¤º', statsArray.length, 'æ¡è®°å½•');
                
                // æ˜¾ç¤ºé¢˜ç›®ç»Ÿè®¡æ•°æ®
                statsArray.forEach(stats => {
                    const row = document.createElement('tr');
                    
                    // è®¡ç®—æ­£ç¡®ç‡
                    const accuracy = stats.total > 0 ? Math.round((stats.correct / stats.total) * 100) : 0;
                    
                    // æ ¼å¼åŒ–æœ€åç­”é¢˜æ—¶é—´
                    const lastAnsweredDate = stats.lastAnswered ? 
                        new Date(stats.lastAnswered).toLocaleString('zh-CN', {
                            year: 'numeric',
                            month: '2-digit',
                            day: '2-digit',
                            hour: '2-digit',
                            minute: '2-digit'
                        }) : 'æ— è®°å½•';
                    
                    console.log(`é¢˜ç›® ${stats.question} ç»Ÿè®¡:`, {
                        total: stats.total,
                        correct: stats.correct,
                        incorrect: stats.incorrect,
                        accuracy: accuracy,
                        lastAnswered: lastAnsweredDate
                    });
                    
                    // è®¾ç½®è¡Œå†…å®¹
                    row.innerHTML = `
                        <td>${stats.question}</td>
                        <td>${stats.total}</td>
                        <td>${stats.correct}</td>
                        <td>${stats.incorrect}</td>
                        <td>
                            <span class="badge ${accuracy >= 80 ? 'bg-success' : accuracy >= 60 ? 'bg-warning' : 'bg-danger'}">
                                ${accuracy}%
                            </span>
                        </td>
                        <td>${lastAnsweredDate}</td>
                    `;
                    
                    this.domCache.questionStatsTableBody.appendChild(row);
                });
                
                console.log('é¢˜ç›®ç»Ÿè®¡è¯¦æƒ…æ›´æ–°å®Œæˆ');
            }
            
            /**
             * æ›´æ–°é¢˜ç›®æ±‡æ€»ç»Ÿè®¡åŒºåŸŸ
             * @param {Object} report - è¯¦ç»†çš„é¢˜ç›®ç»Ÿè®¡æŠ¥å‘Š
             */
            updateQuestionSummaryStats(report) {
                console.log('æ›´æ–°é¢˜ç›®æ±‡æ€»ç»Ÿè®¡åŒºåŸŸ...');
                
                // æ£€æŸ¥DOMå…ƒç´ æ˜¯å¦å­˜åœ¨
                if (!this.domCache.questionSummaryStats) {
                    console.error('DOMå…ƒç´ æœªæ‰¾åˆ°: questionSummaryStats');
                    return;
                }
                
                // è·å–æ±‡æ€»ç»Ÿè®¡æ•°æ®
                const { summaryStats } = report;
                
                if (!summaryStats) {
                    console.error('æ±‡æ€»ç»Ÿè®¡æ•°æ®ä¸å­˜åœ¨');
                    return;
                }
                
                // æ›´æ–°é¢˜ç›®æ±‡æ€»ç»Ÿè®¡åŒºåŸŸ
                this.domCache.totalUniqueQuestions.textContent = summaryStats.totalUniqueQuestions || 0;
                this.domCache.averageAccuracy.textContent = `${summaryStats.averageAccuracy || 0}%`;
                this.domCache.mostFrequentQuestion.textContent = summaryStats.mostFrequentQuestion || '-';
                this.domCache.lowestAccuracyQuestion.textContent = summaryStats.lowestAccuracyQuestion || '-';
                
                console.log('é¢˜ç›®æ±‡æ€»ç»Ÿè®¡åŒºåŸŸæ›´æ–°å®Œæˆ');
            }
            
            /**
             * è·å–è¯¦ç»†çš„é¢˜ç›®æŠ¥å‘Š
             * @returns {Object} è¯¦ç»†çš„é¢˜ç›®ç»Ÿè®¡æŠ¥å‘Š
             */
            getDetailedQuestionReport() {
                const questionStats = this.getQuestionStats();
                const statsArray = [];
                
                questionStats.forEach((stats, question) => {
                    statsArray.push({
                        question,
                        ...stats,
                        accuracy: stats.total > 0 ? (stats.correct / stats.total) * 100 : 0
                    });
                });
                
                // æŒ‰æ€»æ¬¡æ•°é™åºæ’åº
                statsArray.sort((a, b) => b.total - a.total);
                
                // è®¡ç®—æ±‡æ€»ç»Ÿè®¡ä¿¡æ¯
                const totalQuestions = statsArray.length;
                const totalAnswers = statsArray.reduce((sum, item) => sum + item.total, 0);
                
                // è®¡ç®—é¢˜ç›®æ±‡æ€»ç»Ÿè®¡æ•°æ®
                const summaryStats = {
                    totalUniqueQuestions: totalQuestions,
                    averageAccuracy: 0,
                    mostFrequentQuestion: null,
                    lowestAccuracyQuestion: null
                };
                
                // è®¡ç®—å¹³å‡æ­£ç¡®ç‡
                if (statsArray.length > 0) {
                    const totalAccuracy = statsArray.reduce((sum, item) => sum + item.accuracy, 0);
                    summaryStats.averageAccuracy = Math.round(totalAccuracy / statsArray.length);
                    
                    // æ‰¾å‡ºæœ€å¸¸è§çš„é¢˜ç›®ï¼ˆç­”é¢˜æ¬¡æ•°æœ€å¤šçš„ï¼‰
                    summaryStats.mostFrequentQuestion = statsArray[0]?.question || '-';
                    
                    // æ‰¾å‡ºæ­£ç¡®ç‡æœ€ä½çš„é¢˜ç›®ï¼ˆè‡³å°‘ç­”è¿‡3æ¬¡çš„é¢˜ç›®ä¸­ï¼‰
                    const filteredByAttempts = statsArray.filter(item => item.total >= 3);
                    if (filteredByAttempts.length > 0) {
                        // æŒ‰æ­£ç¡®ç‡å‡åºæ’åº
                        filteredByAttempts.sort((a, b) => a.accuracy - b.accuracy);
                        summaryStats.lowestAccuracyQuestion = filteredByAttempts[0]?.question || '-';
                    }
                }
                const averageAccuracy = statsArray.length > 0 ?
                    statsArray.reduce((sum, item) => sum + item.accuracy, 0) / statsArray.length : 0;
                
                // æ‰¾å‡ºæ­£ç¡®ç‡æœ€é«˜å’Œæœ€ä½çš„é¢˜ç›®
                let highestAccuracy = { question: 'æ— ', accuracy: 0 };
                let lowestAccuracy = { question: 'æ— ', accuracy: 100 };
                
                statsArray.forEach(item => {
                    if (item.total >= 3) { // åªè€ƒè™‘è‡³å°‘ç­”è¿‡3æ¬¡çš„é¢˜ç›®
                        if (item.accuracy > highestAccuracy.accuracy) {
                            highestAccuracy = item;
                        }
                        if (item.accuracy < lowestAccuracy.accuracy) {
                            lowestAccuracy = item;
                        }
                    }
                });
                
                return {
                    summary: {
                        totalQuestions,
                        totalAnswers,
                        averageAccuracy: Math.round(averageAccuracy),
                        highestAccuracy: {
                            question: highestAccuracy.question,
                            accuracy: Math.round(highestAccuracy.accuracy)
                        },
                        lowestAccuracy: {
                            question: lowestAccuracy.question,
                            accuracy: Math.round(lowestAccuracy.accuracy)
                        }
                    },
                    summaryStats,
                    details: statsArray
                };
            }
            
            /**
             * é˜²æŠ–ä¿å­˜å†å²è®°å½•
             * é¿å…é¢‘ç¹ä¿å­˜å¯¼è‡´æ€§èƒ½é—®é¢˜
             */
            debounceSaveHistory() {
                clearTimeout(this.debounceTimer);
                this.debounceTimer = setTimeout(() => {
                    this.saveHistory();
                }, 500); // 500msåæ‰§è¡Œä¿å­˜
            }
            
            /**
             * ä¿å­˜å†å²è®°å½•åˆ°localStorage
             */
            saveHistory() {
                console.log('å¼€å§‹ä¿å­˜å†å²è®°å½•...');
                try {
                    // æ£€æŸ¥å†å²è®°å½•æ˜¯å¦ä¸ºæ•°ç»„
                    if (!Array.isArray(this.history)) {
                        console.error('ä¿å­˜å†å²è®°å½•å¤±è´¥: å†å²è®°å½•ä¸æ˜¯æ•°ç»„', this.history);
                        return;
                    }
                    
                    // æ£€æŸ¥å†å²è®°å½•æ˜¯å¦ä¸ºç©º
                    if (this.history.length === 0) {
                        console.warn('å†å²è®°å½•ä¸ºç©ºï¼Œè·³è¿‡ä¿å­˜');
                        return;
                    }
                    
                    // éªŒè¯å†å²è®°å½•æ ¼å¼
                    let validRecords = [];
                    let invalidRecords = 0;
                    
                    for (let i = 0; i < this.history.length; i++) {
                        const record = this.history[i];
                        // æ£€æŸ¥è®°å½•æ˜¯å¦åŒ…å«å¿…è¦çš„å­—æ®µ
                        if (record && 
                            typeof record === 'object' && 
                            'question' in record && 
                            'isCorrect' in record && 
                            'timestamp' in record) {
                            validRecords.push(record);
                        } else {
                            invalidRecords++;
                            console.warn(`å‘ç°æ— æ•ˆè®°å½• #${i}:`, record);
                        }
                    }
                    
                    if (invalidRecords > 0) {
                        console.warn(`å†å²è®°å½•ä¸­æœ‰ ${invalidRecords} æ¡æ— æ•ˆè®°å½•ï¼Œå·²è¿‡æ»¤`);
                        this.history = validRecords;
                    }
                    
                    // å‹ç¼©å†å²æ•°æ®ä»¥èŠ‚çœç©ºé—´
                    console.log(`å¼€å§‹å‹ç¼© ${this.history.length} æ¡å†å²è®°å½•...`);
                    const compressedHistory = this.compressHistoryData(this.history);
                    console.log(`å†å²è®°å½•å‹ç¼©å®Œæˆï¼Œå‹ç¼©åå¤§å°: ${compressedHistory.length} å­—ç¬¦`);
                    
                    // ä¿å­˜åˆ°localStorage
                    const mainKey = 'multiplicationTrainingHistory';
                    localStorage.setItem(mainKey, compressedHistory);
                    console.log(`å†å²è®°å½•å·²ä¿å­˜åˆ°é”®å ${mainKey}ï¼Œå…± ${this.history.length} æ¡è®°å½•`);
                    
                    // æ£€æŸ¥ä»Šæ—¥å†å²è®°å½•
                    const today = new Date().toISOString().split('T')[0];
                    const todayRecords = this.history.filter(record => record.date === today);
                    console.log(`ä»Šæ—¥(${today})å†å²è®°å½•: ${todayRecords.length} æ¡`);
                } catch (error) {
                    console.error('ä¿å­˜å†å²è®°å½•å¤±è´¥:', error);
                    console.error('é”™è¯¯å †æ ˆ:', error.stack);
                }
            }
            
            /**
             * åŠ è½½å†å²è®°å½•
             * @returns {Array} å†å²è®°å½•æ•°ç»„
             */
            loadHistory() {
                console.log('å¼€å§‹åŠ è½½å†å²è®°å½•...');
                try {
                    // å°è¯•ä»æ­£ç¡®çš„é”®ååŠ è½½
                    const mainKey = 'multiplicationTrainingHistory';
                    console.log(`å°è¯•ä»ä¸»é”®å ${mainKey} åŠ è½½å†å²è®°å½•`);
                    let compressedHistory = localStorage.getItem(mainKey);
                    let loadedFromKey = mainKey;
                    
                    // å¦‚æœæ²¡æœ‰æ‰¾åˆ°æ•°æ®ï¼Œå°è¯•ä»å¯èƒ½çš„å¤‡é€‰é”®ååŠ è½½
                    if (!compressedHistory) {
                        console.log('æœªæ‰¾åˆ°å†å²è®°å½•ï¼Œå°è¯•ä»å¤‡é€‰é”®ååŠ è½½');
                        // å¯èƒ½çš„å¤‡é€‰é”®å
                        const alternativeKeys = ['mathTrainingHistory', 'multiplicationHistory'];
                        
                        for (const key of alternativeKeys) {
                            console.log(`å°è¯•ä»å¤‡é€‰é”®å ${key} åŠ è½½å†å²è®°å½•`);
                            const altData = localStorage.getItem(key);
                            if (altData) {
                                console.log(`ä»å¤‡é€‰é”®å ${key} åŠ è½½æˆåŠŸï¼Œæ•°æ®é•¿åº¦: ${altData.length}`);
                                compressedHistory = altData;
                                loadedFromKey = key;
                                // è¿ç§»æ•°æ®åˆ°æ­£ç¡®çš„é”®å
                                console.log(`å°†å†å²è®°å½•ä» ${key} è¿ç§»åˆ° ${mainKey}`);
                                localStorage.setItem(mainKey, altData);
                                localStorage.removeItem(key);
                                break;
                            }
                        }
                    } else {
                        console.log(`ä»ä¸»é”®å ${mainKey} åŠ è½½æˆåŠŸï¼Œæ•°æ®é•¿åº¦: ${compressedHistory.length}`);
                    }
                    
                    if (!compressedHistory) {
                        console.log('æœªæ‰¾åˆ°ä»»ä½•å†å²è®°å½•æ•°æ®ï¼Œåˆå§‹åŒ–ä¸ºç©ºæ•°ç»„');
                        return [];
                    }
                    
                    // è§£å‹ç¼©å†å²æ•°æ®
                    console.log('å¼€å§‹è§£å‹ç¼©å†å²æ•°æ®...');
                    const result = this.decompressHistoryData(compressedHistory);
                    console.log(`å†å²è®°å½•è§£å‹ç¼©æˆåŠŸï¼Œå…± ${result.length} æ¡è®°å½•`);
                    
                    // éªŒè¯å†å²è®°å½•æ ¼å¼
                    console.log('éªŒè¯å†å²è®°å½•æ ¼å¼...');
                    let validRecords = [];
                    let invalidRecords = 0;
                    
                    for (let i = 0; i < result.length; i++) {
                        const record = result[i];
                        // æ£€æŸ¥è®°å½•æ˜¯å¦åŒ…å«å¿…è¦çš„å­—æ®µ
                        if (record && 
                            typeof record === 'object' && 
                            'question' in record && 
                            'isCorrect' in record && 
                            'timestamp' in record) {
                            validRecords.push(record);
                        } else {
                            invalidRecords++;
                            console.warn(`å‘ç°æ— æ•ˆè®°å½• #${i}:`, record);
                        }
                    }
                    
                    if (invalidRecords > 0) {
                        console.warn(`ä» ${loadedFromKey} åŠ è½½çš„å†å²è®°å½•ä¸­æœ‰ ${invalidRecords} æ¡æ— æ•ˆè®°å½•ï¼Œå·²è¿‡æ»¤`);
                        
                        // ä¿å­˜ä¿®å¤åçš„å†å²è®°å½•
                        try {
                            const fixedData = this.compressHistoryData(validRecords);
                            localStorage.setItem(mainKey, fixedData);
                            console.log('å·²ä¿å­˜ä¿®å¤åçš„å†å²è®°å½•');
                        } catch (e) {
                            console.error('ä¿å­˜ä¿®å¤åçš„å†å²è®°å½•æ—¶å‡ºé”™:', e);
                        }
                        
                        return validRecords;
                    }
                    
                    // æ£€æŸ¥ä»Šæ—¥å†å²è®°å½•
                    const today = new Date().toISOString().split('T')[0];
                    const todayRecords = result.filter(record => record.date === today);
                    console.log(`ä»Šæ—¥(${today})å†å²è®°å½•: ${todayRecords.length} æ¡`);
                    
                    return result;
                } catch (error) {
                    console.error('åŠ è½½å†å²è®°å½•å¤±è´¥:', error);
                    console.error('é”™è¯¯å †æ ˆ:', error.stack);
                    return [];
                }
            }
            
            /**
             * å‹ç¼©å†å²æ•°æ®
             * @param {Array} history - å†å²è®°å½•æ•°ç»„
             * @returns {string} å‹ç¼©åçš„å†å²æ•°æ®
             */
            compressHistoryData(history) {
                console.log('å¼€å§‹å‹ç¼©å†å²æ•°æ®...');
                try {
                    // æ£€æŸ¥è¾“å…¥æ˜¯å¦ä¸ºæ•°ç»„
                    if (!Array.isArray(history)) {
                        console.error('å‹ç¼©å†å²æ•°æ®å¤±è´¥: è¾“å…¥ä¸æ˜¯æ•°ç»„', history);
                        return JSON.stringify([]);
                    }
                    
                    // æ£€æŸ¥å†å²è®°å½•æ˜¯å¦ä¸ºç©º
                    if (history.length === 0) {
                        console.log('å†å²è®°å½•ä¸ºç©ºï¼Œè¿”å›ç©ºæ•°ç»„');
                        return JSON.stringify([]);
                    }
                    
                    console.log(`å‹ç¼©å‰å†å²è®°å½•æ•°é‡: ${history.length} æ¡`);
                    
                    // åªä¿ç•™æœ€è¿‘500æ¡è®°å½•ï¼Œé¿å…localStorageè¶…å‡ºé™åˆ¶
                    let processedHistory = history;
                    if (history.length > 500) {
                        console.log(`å†å²è®°å½•è¶…è¿‡500æ¡ï¼Œåªä¿ç•™æœ€è¿‘500æ¡`);
                        processedHistory = history.slice(-500);
                    }
                    
                    // ä½¿ç”¨æ›´ç´§å‡‘çš„æ ¼å¼å­˜å‚¨
                    const compressedData = [];
                    let invalidItems = 0;
                    
                    for (let i = 0; i < processedHistory.length; i++) {
                        const item = processedHistory[i];
                        
                        // æ£€æŸ¥é¡¹ç›®æ˜¯å¦åŒ…å«å¿…è¦çš„å­—æ®µ
                        if (item && 
                            typeof item === 'object' && 
                            'question' in item && 
                            'isCorrect' in item && 
                            'timestamp' in item) {
                            
                            compressedData.push({
                                q: item.question,
                                c: item.isCorrect ? 1 : 0,
                                d: item.date || new Date(item.timestamp).toISOString().split('T')[0], // å¦‚æœæ²¡æœ‰æ—¥æœŸï¼Œä»æ—¶é—´æˆ³ç”Ÿæˆ
                                t: item.timestamp
                            });
                        } else {
                            invalidItems++;
                            console.warn(`å‘ç°æ— æ•ˆè®°å½•é¡¹ #${i}:`, item);
                        }
                    }
                    
                    if (invalidItems > 0) {
                        console.warn(`å‹ç¼©è¿‡ç¨‹ä¸­è¿‡æ»¤äº† ${invalidItems} æ¡æ— æ•ˆè®°å½•`);
                    }
                    
                    const result = JSON.stringify(compressedData);
                    console.log(`å‹ç¼©å®Œæˆï¼Œå‹ç¼©åæ•°æ®é•¿åº¦: ${result.length} å­—ç¬¦ï¼Œè®°å½•æ•°: ${compressedData.length} æ¡`);
                    return result;
                } catch (error) {
                    console.error('å‹ç¼©å†å²æ•°æ®å¤±è´¥:', error);
                    console.error('é”™è¯¯å †æ ˆ:', error.stack);
                    return JSON.stringify([]);
                }
            }
            
            /**
             * è§£å‹ç¼©å†å²æ•°æ®
             * @param {string} compressedData - å‹ç¼©åçš„å†å²æ•°æ®
             * @returns {Array} è§£å‹ç¼©åçš„å†å²è®°å½•æ•°ç»„
             */
            decompressHistoryData(compressedData) {
                console.log('å¼€å§‹è§£å‹ç¼©å†å²æ•°æ®ï¼Œæ•°æ®é•¿åº¦:', compressedData.length);
                try {
                    // æ£€æŸ¥è¾“å…¥æ•°æ®æ˜¯å¦ä¸ºç©º
                    if (!compressedData || compressedData.trim() === '') {
                        console.warn('è§£å‹ç¼©å†å²æ•°æ®å¤±è´¥: è¾“å…¥æ•°æ®ä¸ºç©º');
                        return [];
                    }
                    
                    // å°è¯•è§£æJSONæ•°æ®
                    const parsedData = JSON.parse(compressedData);
                    
                    // æ£€æŸ¥è§£æåçš„æ•°æ®æ˜¯å¦ä¸ºæ•°ç»„
                    if (!Array.isArray(parsedData)) {
                        console.warn('è§£å‹ç¼©å†å²æ•°æ®å¤±è´¥: è§£æåçš„æ•°æ®ä¸æ˜¯æ•°ç»„', parsedData);
                        return [];
                    }
                    
                    console.log(`æˆåŠŸè§£æJSONæ•°æ®ï¼ŒåŒ…å« ${parsedData.length} æ¡è®°å½•`);
                    
                    // è½¬æ¢å›åŸå§‹æ ¼å¼
                    const result = [];
                    let invalidItems = 0;
                    
                    for (let i = 0; i < parsedData.length; i++) {
                        const item = parsedData[i];
                        
                        // æ£€æŸ¥é¡¹ç›®æ˜¯å¦åŒ…å«å¿…è¦çš„å­—æ®µ
                        if (item && typeof item === 'object' && 'q' in item && 'c' in item && 't' in item) {
                            result.push({
                                question: item.q,
                                isCorrect: item.c === 1,
                                date: item.d || new Date(item.t).toISOString().split('T')[0], // å¦‚æœæ²¡æœ‰æ—¥æœŸï¼Œä»æ—¶é—´æˆ³ç”Ÿæˆ
                                timestamp: item.t
                            });
                        } else {
                            invalidItems++;
                            console.warn(`å‘ç°æ— æ•ˆçš„å‹ç¼©è®°å½•é¡¹ #${i}:`, item);
                        }
                    }
                    
                    if (invalidItems > 0) {
                        console.warn(`è§£å‹ç¼©è¿‡ç¨‹ä¸­è¿‡æ»¤äº† ${invalidItems} æ¡æ— æ•ˆè®°å½•`);
                    }
                    
                    console.log(`è§£å‹ç¼©å®Œæˆï¼Œå…±è½¬æ¢ ${result.length} æ¡è®°å½•`);
                    return result;
                } catch (error) {
                    console.error('è§£å‹ç¼©å†å²æ•°æ®å¤±è´¥:', error);
                    console.error('é”™è¯¯å †æ ˆ:', error.stack);
                    console.error('åŸå§‹æ•°æ®å‰50ä¸ªå­—ç¬¦:', compressedData.substring(0, 50));
                    return [];
                }
            }
            
            /**
             * åŠ è½½è‰¾å®¾æµ©æ–¯è®°å¿†æ›²çº¿æ•°æ®
             * @returns {Object} è‰¾å®¾æµ©æ–¯è®°å¿†æ›²çº¿æ•°æ®
             */
            loadEbbinghausData() {
                try {
                    // å°è¯•ä»æ­£ç¡®çš„é”®ååŠ è½½
                    let data = localStorage.getItem('multiplicationTrainingEbbinghaus');
                    
                    // å¦‚æœæ²¡æœ‰æ‰¾åˆ°æ•°æ®ï¼Œå°è¯•ä»å¯èƒ½çš„å¤‡é€‰é”®ååŠ è½½
                    if (!data) {
                        console.log('æœªæ‰¾åˆ°è‰¾å®¾æµ©æ–¯æ•°æ®ï¼Œå°è¯•ä»å¤‡é€‰é”®ååŠ è½½');
                        // å¯èƒ½çš„å¤‡é€‰é”®å
                        const alternativeKeys = ['mathTrainingEbbinghaus', 'multiplicationEbbinghaus'];
                        
                        for (const key of alternativeKeys) {
                            const altData = localStorage.getItem(key);
                            if (altData) {
                                console.log('ä»å¤‡é€‰é”®ååŠ è½½è‰¾å®¾æµ©æ–¯æ•°æ®æˆåŠŸ:', key);
                                data = altData;
                                // è¿ç§»æ•°æ®åˆ°æ­£ç¡®çš„é”®å
                                localStorage.setItem('multiplicationTrainingEbbinghaus', altData);
                                break;
                            }
                        }
                    }
                    
                    const result = data ? JSON.parse(data) : { reviewList: [], reviewDates: {} };
                    console.log('åŠ è½½è‰¾å®¾æµ©æ–¯æ•°æ®:', result);
                    return result;
                } catch (error) {
                    console.error('åŠ è½½è‰¾å®¾æµ©æ–¯æ•°æ®å¤±è´¥:', error);
                    return { reviewList: [], reviewDates: {} };
                }
            }
            
            /**
             * ä¿å­˜è‰¾å®¾æµ©æ–¯è®°å¿†æ›²çº¿æ•°æ®
             */
            saveEbbinghausData() {
                try {
                    localStorage.setItem('multiplicationTrainingEbbinghaus', JSON.stringify(this.ebbinghausData));
                    console.log('ä¿å­˜è‰¾å®¾æµ©æ–¯æ•°æ®æˆåŠŸï¼Œé”®å:', 'multiplicationTrainingEbbinghaus');
                } catch (error) {
                    console.error('ä¿å­˜è‰¾å®¾æµ©æ–¯æ•°æ®å¤±è´¥:', error);
                }
            }
            
            /**
             * æ›´æ–°è‰¾å®¾æµ©æ–¯è®°å¿†æ›²çº¿æ•°æ®
             * @param {string} question - éœ€è¦å¤ä¹ çš„é¢˜ç›®
             */
            updateEbbinghausData(question) {
                console.log('æ›´æ–°è‰¾å®¾æµ©æ–¯æ•°æ®:', question);
                
                // è·å–å½“å‰æ—¥æœŸ
                const today = new Date();
                const todayStr = today.toISOString().split('T')[0];
                
                // è®¡ç®—å¤ä¹ æ—¥æœŸ
                const reviewDates = [
                    1,  // 1å¤©åå¤ä¹ 
                    2,  // 2å¤©åå¤ä¹ 
                    4,  // 4å¤©åå¤ä¹ 
                    7,  // 7å¤©åå¤ä¹ 
                    15, // 15å¤©åå¤ä¹ 
                    30  // 30å¤©åå¤ä¹ 
                ];
                
                // è®¾ç½®å¤ä¹ æ—¥æœŸ
                const dates = {};
                reviewDates.forEach((days, index) => {
                    const reviewDate = new Date(today);
                    reviewDate.setDate(reviewDate.getDate() + days);
                    dates[index + 1] = reviewDate.toISOString().split('T')[0];
                });
                
                // æ›´æ–°è‰¾å®¾æµ©æ–¯æ•°æ®
                this.ebbinghausData.reviewDates[question] = {
                    dates: dates,
                    currentStage: 1, // ä»ç¬¬ä¸€é˜¶æ®µå¼€å§‹
                    lastReviewed: todayStr
                };
                
                // ä¿å­˜è‰¾å®¾æµ©æ–¯æ•°æ®
                this.saveEbbinghausData();
                
                console.log('è‰¾å®¾æµ©æ–¯æ•°æ®å·²æ›´æ–°:', this.ebbinghausData);
            }
            
            /**
             * æ£€æŸ¥ä»Šæ—¥æ˜¯å¦æœ‰éœ€è¦å¤ä¹ çš„é¢˜ç›®
             */
            checkTodayReviews() {
                console.log('æ£€æŸ¥ä»Šæ—¥å¤ä¹ é¢˜ç›®...');
                
                // è·å–å½“å‰æ—¥æœŸ
                const today = new Date().toISOString().split('T')[0];
                
                // å¾…å¤ä¹ çš„é¢˜ç›®åˆ—è¡¨
                const reviewList = [];
                
                // éå†æ‰€æœ‰éœ€è¦å¤ä¹ çš„é¢˜ç›®
                Object.entries(this.ebbinghausData.reviewDates).forEach(([question, data]) => {
                    const currentStage = data.currentStage;
                    const reviewDate = data.dates[currentStage];
                    
                    // å¦‚æœä»Šå¤©éœ€è¦å¤ä¹ 
                    if (reviewDate === today) {
                        reviewList.push(question);
                    }
                });
                
                // æ›´æ–°å¾…å¤ä¹ åˆ—è¡¨
                this.ebbinghausData.reviewList = reviewList;
                
                // ä¿å­˜è‰¾å®¾æµ©æ–¯æ•°æ®
                this.saveEbbinghausData();
                
                // å¦‚æœæœ‰éœ€è¦å¤ä¹ çš„é¢˜ç›®ï¼Œæ˜¾ç¤ºå¤ä¹ æé†’
                if (reviewList.length > 0) {
                    this.showReviewAlert(reviewList.length);
                }
                
                console.log('ä»Šæ—¥å¾…å¤ä¹ é¢˜ç›®:', reviewList);
            }
            
            /**
             * æ˜¾ç¤ºå¤ä¹ æé†’
             * @param {number} count - éœ€è¦å¤ä¹ çš„é¢˜ç›®æ•°é‡
             */
            showReviewAlert(count) {
                // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨å¤ä¹ æé†’
                let reviewAlert = document.getElementById('reviewAlert');
                
                if (!reviewAlert) {
                    // åˆ›å»ºå¤ä¹ æé†’å…ƒç´ 
                    reviewAlert = document.createElement('div');
                    reviewAlert.id = 'reviewAlert';
                    reviewAlert.className = 'alert alert-warning';
                    reviewAlert.innerHTML = `
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <i class="bi bi-lightbulb-fill"></i>
                                <strong>å¤ä¹ æé†’ï¼š</strong> ä»Šå¤©æœ‰ ${count} é“é¢˜ç›®éœ€è¦å¤ä¹ 
                            </div>
                        </div>
                    `;
                    
                    // æ’å…¥åˆ°è®­ç»ƒåŒºåŸŸå‰é¢
                    this.domCache.trainingArea.parentNode.insertBefore(reviewAlert, this.domCache.trainingArea);
                }
            }
            
            /**
             * æ›´æ–°å¤ä¹ æé†’
             */
            updateReviewAlert() {
                // è·å–å¾…å¤ä¹ åˆ—è¡¨
                const reviewList = this.ebbinghausData.reviewList || [];
                
                // æ›´æ–°å¤ä¹ æé†’
                const reviewAlert = document.getElementById('reviewAlert');
                
                if (reviewList.length > 0 && reviewAlert) {
                    reviewAlert.querySelector('div > div').innerHTML = `
                        <i class="bi bi-lightbulb-fill"></i>
                        <strong>å¤ä¹ æé†’ï¼š</strong> ä»Šå¤©è¿˜æœ‰ ${reviewList.length} é“é¢˜ç›®éœ€è¦å¤ä¹ 
                    `;
                } else if (reviewAlert) {
                    // å¦‚æœæ²¡æœ‰å¾…å¤ä¹ é¢˜ç›®ï¼Œç§»é™¤æé†’
                    reviewAlert.remove();
                }
            }
            
            /**
             * æ ¹æ®è‰¾å®¾æµ©æ–¯è®°å¿†æ›²çº¿è·å–å¤ä¹ é¢˜ç›®
             * @returns {Object|null} å¤ä¹ é¢˜ç›®å¯¹è±¡æˆ–null
             */
            getReviewQuestionByEbbinghaus() {
                console.log('æ£€æŸ¥è‰¾å®¾æµ©æ–¯å¤ä¹ é¢˜...');
                
                // è·å–å¾…å¤ä¹ åˆ—è¡¨
                const reviewList = this.ebbinghausData.reviewList || [];
                
                // å¦‚æœæ²¡æœ‰å¾…å¤ä¹ é¢˜ç›®ï¼Œè¿”å›null
                if (reviewList.length === 0) {
                    console.log('æ²¡æœ‰å¾…å¤ä¹ é¢˜ç›®');
                    return null;
                }
                
                console.log('å¾…å¤ä¹ é¢˜ç›®åˆ—è¡¨:', reviewList);
                
                // éšæœºé€‰æ‹©ä¸€é“å¾…å¤ä¹ é¢˜ç›®
                const randomIndex = Math.floor(Math.random() * reviewList.length);
                const questionText = reviewList[randomIndex];
                
                console.log('é€‰æ‹©çš„å¤ä¹ é¢˜ç›®:', questionText);
                
                // ä»å¾…å¤ä¹ åˆ—è¡¨ä¸­ç§»é™¤è¯¥é¢˜ç›®
                reviewList.splice(randomIndex, 1);
                
                // ä¿å­˜è‰¾å®¾æµ©æ–¯æ•°æ®
                this.saveEbbinghausData();
                
                // è§£æé¢˜ç›®ï¼Œæå–æ•°å­—
                const match = questionText.match(/(\d+)\s*[Ã—xX]\s*(\d+)\s*=\s*\?/);
                if (!match) {
                    console.log('é¢˜ç›®æ ¼å¼ä¸æ­£ç¡®:', questionText);
                    return null;
                }
                
                const num1 = parseInt(match[1]);
                const num2 = parseInt(match[2]);
                
                // ç”Ÿæˆå¤ä¹ é¢˜ç›®
                const question = this.generateMultiplicationQuestion(num1, num2);
                
                // æ ‡è®°ä¸ºå¤ä¹ é¢˜ç›®
                question.isReview = true;
                
                console.log('ç”Ÿæˆçš„å¤ä¹ é¢˜ç›®:', question);
                
                return question;
            }
            
            /**
             * æ›´æ–°å¤ä¹ çŠ¶æ€
             * @param {string} question - é¢˜ç›®æ–‡æœ¬
             * @param {boolean} isCorrect - æ˜¯å¦å›ç­”æ­£ç¡®
             */
            updateReviewStatus(question, isCorrect) {
                console.log('æ›´æ–°å¤ä¹ çŠ¶æ€:', question, isCorrect);
                
                // è·å–å½“å‰æ—¥æœŸ
                const today = new Date().toISOString().split('T')[0];
                
                // è·å–é¢˜ç›®çš„è‰¾å®¾æµ©æ–¯æ•°æ®
                const reviewData = this.ebbinghausData.reviewDates[question];
                
                if (!reviewData) {
                    console.log('æœªæ‰¾åˆ°é¢˜ç›®çš„è‰¾å®¾æµ©æ–¯æ•°æ®');
                    return;
                }
                
                // æ›´æ–°æœ€åå¤ä¹ æ—¥æœŸ
                reviewData.lastReviewed = today;
                
                // å¦‚æœå›ç­”æ­£ç¡®ï¼Œè¿›å…¥ä¸‹ä¸€é˜¶æ®µ
                if (isCorrect) {
                    reviewData.currentStage += 1;
                    
                    // å¦‚æœå·²å®Œæˆæ‰€æœ‰é˜¶æ®µï¼Œä»è‰¾å®¾æµ©æ–¯æ•°æ®ä¸­ç§»é™¤
                    if (reviewData.currentStage > Object.keys(reviewData.dates).length) {
                        delete this.ebbinghausData.reviewDates[question];
                        console.log('é¢˜ç›®å·²å®Œæˆæ‰€æœ‰å¤ä¹ é˜¶æ®µï¼Œä»è‰¾å®¾æµ©æ–¯æ•°æ®ä¸­ç§»é™¤');
                    }
                } else {
                    // å¦‚æœå›ç­”é”™è¯¯ï¼Œé‡ç½®ä¸ºç¬¬ä¸€é˜¶æ®µ
                    reviewData.currentStage = 1;
                    
                    // é‡æ–°è®¡ç®—å¤ä¹ æ—¥æœŸ
                    const reviewDates = [1, 2, 4, 7, 15, 30];
                    const dates = {};
                    
                    reviewDates.forEach((days, index) => {
                        const reviewDate = new Date(today);
                        reviewDate.setDate(reviewDate.getDate() + days);
                        dates[index + 1] = reviewDate.toISOString().split('T')[0];
                    });
                    
                    reviewData.dates = dates;
                }
                
                // ä¿å­˜è‰¾å®¾æµ©æ–¯æ•°æ®
                this.saveEbbinghausData();
                
                // æ›´æ–°å¤ä¹ æé†’
                this.updateReviewAlert();
                
                console.log('å¤ä¹ çŠ¶æ€å·²æ›´æ–°:', reviewData);
            }
            
            /**
             * ç”Ÿæˆä¸‹ä¸€ä¸ªé—®é¢˜
             */
            generateNextQuestion() {
                this.nextQuestion();
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–è®­ç»ƒç³»ç»Ÿ
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOMå·²åŠ è½½ï¼Œå¼€å§‹åˆå§‹åŒ–ä¹˜æ³•è®­ç»ƒç³»ç»Ÿ...');
            try {
                window.mathTrainingSystem = new MathTrainingSystem();
                console.log('ä¹˜æ³•è®­ç»ƒç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
                // ç«‹å³å¯åŠ¨è®­ç»ƒ
                window.mathTrainingSystem.startTraining();
            } catch (error) {
                console.error('åˆå§‹åŒ–å¤±è´¥:', error);
                // å¦‚æœå¤æ‚ç³»ç»Ÿå¤±è´¥ï¼Œä½¿ç”¨ç®€åŒ–ç‰ˆæœ¬
                console.log('ä½¿ç”¨ç®€åŒ–ç‰ˆæœ¬å¯åŠ¨...');
                startSimpleTraining();
            }
        });
        
        /**
         * ç®€åŒ–ç‰ˆä¹˜æ³•è®­ç»ƒç³»ç»Ÿ
         * ç¡®ä¿é¡µé¢èƒ½å¤Ÿæ­£å¸¸å¯åŠ¨å’Œè¿è¡Œ
         */
        function startSimpleTraining() {
            class SimpleMultiplicationTraining {
                constructor() {
                    this.currentQuestion = null;
                    this.correctAnswer = null;
                    this.initializeElements();
                    this.startFirstQuestion();
                }
                
                initializeElements() {
                    this.questionEl = document.getElementById('question');
                    this.answerOptionsEl = document.getElementById('answerOptions');
                    this.optionA = document.getElementById('optionA');
                    this.optionB = document.getElementById('optionB');
                    this.optionC = document.getElementById('optionC');
                    this.optionD = document.getElementById('optionD');
                }
                
                startFirstQuestion() {
                    this.generateQuestion();
                }
                
                generateQuestion() {
                    const num1 = Math.floor(Math.random() * 9) + 1;
                    const num2 = Math.floor(Math.random() * 9) + 1;
                    
                    this.currentQuestion = `${num1} Ã— ${num2}`;
                    this.correctAnswer = num1 * num2;
                    
                    // ç”Ÿæˆé€‰é¡¹
                    const options = [this.correctAnswer];
                    const used = new Set([this.correctAnswer]);
                    
                    while (options.length < 4) {
                        let wrong = this.correctAnswer + (Math.floor(Math.random() * 10) - 5);
                        wrong = Math.max(1, Math.min(81, wrong));
                        if (!used.has(wrong)) {
                            used.add(wrong);
                            options.push(wrong);
                        }
                    }
                    
                    // æ‰“ä¹±é¡ºåº
                    const shuffled = options.sort(() => Math.random() - 0.5);
                    
                    this.displayQuestion(shuffled);
                }
                
                displayQuestion(options) {
                    this.questionEl.textContent = `${this.currentQuestion} = ?`;
                    
                    const buttons = [this.optionA, this.optionB, this.optionC, this.optionD];
                    buttons.forEach((btn, index) => {
                        btn.textContent = options[index];
                        btn.className = 'btn btn-primary answer-btn';
                        btn.onclick = () => this.checkAnswer(options[index], btn);
                    });
                }
                
                checkAnswer(selected, button) {
                    const isCorrect = selected === this.correctAnswer;
                    
                    if (isCorrect) {
                        button.className = 'btn btn-success answer-btn';
                        setTimeout(() => {
                            this.generateQuestion();
                        }, 1000);
                    } else {
                        button.className = 'btn btn-danger answer-btn';
                        setTimeout(() => {
                            this.generateQuestion();
                        }, 1500);
                    }
                }
            }
            
            // éšè—å¤æ‚ç³»ç»Ÿçš„å…ƒç´ ï¼Œæ˜¾ç¤ºç®€åŒ–ç³»ç»Ÿ
            const dailyLimitAlert = document.getElementById('dailyLimitAlert');
            if (dailyLimitAlert) dailyLimitAlert.classList.add('hidden');
            
            const trainingArea = document.getElementById('trainingArea');
            if (trainingArea) trainingArea.classList.remove('hidden');
            
            new SimpleMultiplicationTraining();
        }
    </script>
</body>
</html>