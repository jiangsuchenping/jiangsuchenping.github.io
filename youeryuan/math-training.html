<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>30ä»¥å†…åŠ å‡æ³•æ™ºèƒ½è®­ç»ƒ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Arial', sans-serif;
            min-height: 100vh;
        }
        
        .main-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            margin: 20px auto;
            max-width: 800px;
            padding: 30px;
        }
        
        .question-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-radius: 15px;
            padding: 40px;
            margin: 20px 0;
            text-align: center;
            font-size: 2.5rem;
            font-weight: bold;
            box-shadow: 0 10px 25px rgba(240, 147, 251, 0.3);
        }
        
        .answer-btn {
            font-size: 1.5rem;
            padding: 20px;
            margin: 10px;
            border-radius: 15px;
            border: none;
            transition: all 0.3s ease;
            min-width: 120px;
        }
        
        .answer-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .correct {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%) !important;
            color: white;
        }
        
        .incorrect {
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%) !important;
            color: white;
        }
        
        .stats-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 10px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .progress-ring {
            width: 120px;
            height: 120px;
            margin: 0 auto;
        }
        
        .daily-limit {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
            font-weight: bold;
        }
        
        .history-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 10px;
            margin: 5px 0;
            border-left: 4px solid #007bff;
        }
        
        .emoji-feedback {
            font-size: 3rem;
            margin: 20px 0;
        }
        
        .hidden {
            display: none;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-container">
            <h1 class="text-center mb-4">
                <i class="bi bi-calculator-fill text-primary"></i>
                30ä»¥å†…åŠ å‡æ³•æ™ºèƒ½è®­ç»ƒ
            </h1>
            
            <!-- ç»Ÿè®¡é¢æ¿ -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="stats-card">
                        <h5><i class="bi bi-graph-up"></i> ä»Šæ—¥ç»Ÿè®¡</h5>
                        <div class="row text-center">
                            <div class="col-4">
                                <h3 id="todayTotal" class="text-primary">0</h3>
                                <small>æ€»é¢˜æ•°</small>
                            </div>
                            <div class="col-4">
                                <h3 id="todayCorrect" class="text-success">0</h3>
                                <small>æ­£ç¡®æ•°</small>
                            </div>
                            <div class="col-4">
                                <h3 id="todayAccuracy" class="text-warning">0%</h3>
                                <small>æ­£ç¡®ç‡</small>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="stats-card">
                        <h5><i class="bi bi-trophy"></i> æ€»ç»Ÿè®¡</h5>
                        <div class="row text-center">
                            <div class="col-4">
                                <h3 id="totalQuestions" class="text-primary">0</h3>
                                <small>æ€»é¢˜æ•°</small>
                            </div>
                            <div class="col-4">
                                <h3 id="totalCorrect" class="text-success">0</h3>
                                <small>æ­£ç¡®æ•°</small>
                            </div>
                            <div class="col-4">
                                <h3 id="totalAccuracy" class="text-warning">0%</h3>
                                <small>æ­£ç¡®ç‡</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- æ¯æ—¥é™åˆ¶æç¤º -->
            <div id="dailyLimitAlert" class="daily-limit hidden">
                <i class="bi bi-exclamation-triangle-fill"></i>
                ä»Šæ—¥è®­ç»ƒå·²è¾¾åˆ°ä¸Šé™ï¼ˆ20é¢˜ï¼‰ï¼Œæ˜å¤©å†æ¥ç»§ç»­å§ï¼
            </div>
            
            <!-- è®­ç»ƒåŒºåŸŸ -->
            <div id="trainingArea" class="text-center">
                <div class="question-card" id="questionCard">
                    <span id="question">å‡†å¤‡å¼€å§‹</span>
                </div>
                
                <div id="answerOptions" class="row">
                    <div class="col-6 col-md-3">
                        <button class="btn btn-primary answer-btn" id="optionA">A</button>
                    </div>
                    <div class="col-6 col-md-3">
                        <button class="btn btn-primary answer-btn" id="optionB">B</button>
                    </div>
                    <div class="col-6 col-md-3">
                        <button class="btn btn-primary answer-btn" id="optionC">C</button>
                    </div>
                    <div class="col-6 col-md-3">
                        <button class="btn btn-primary answer-btn" id="optionD">D</button>
                    </div>
                </div>
                
                <div id="feedback" class="emoji-feedback hidden"></div>
                
                <button id="startBtn" class="btn btn-success btn-lg">
                    <i class="bi bi-play-fill"></i> å¼€å§‹è®­ç»ƒ
                </button>
                
                <button id="nextBtn" class="btn btn-primary btn-lg hidden">
                    <i class="bi bi-arrow-right"></i> ä¸‹ä¸€é¢˜
                </button>
            </div>
            
            <!-- å†å²è®°å½• -->
            <div class="mt-5">
                <h4><i class="bi bi-clock-history"></i> ä»Šæ—¥ç­”é¢˜è®°å½•</h4>
                <div id="historyList" class="mt-3"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        /**
         * 30ä»¥å†…åŠ å‡æ³•æ™ºèƒ½è®­ç»ƒç³»ç»Ÿ
         * åŠŸèƒ½ï¼šæ™ºèƒ½å‡ºé¢˜ã€å†å²è®°å½•ã€æ¯æ—¥é™åˆ¶ã€è‡ªé€‚åº”éš¾åº¦
         */
        class MathTrainingSystem {
            constructor() {
                this.dailyLimit = 20; // æ¯æ—¥è®­ç»ƒä¸Šé™
                this.currentQuestion = null;
                this.answers = [];
                this.history = this.loadHistory();
                this.today = new Date().toISOString().split('T')[0];
                
                this.initializeEventListeners();
                this.updateStats();
                this.checkDailyLimit();
            }
            
            /**
             * åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
             */
            initializeEventListeners() {
                document.getElementById('startBtn').addEventListener('click', () => this.startTraining());
                document.getElementById('nextBtn').addEventListener('click', () => this.nextQuestion());
                
                ['optionA', 'optionB', 'optionC', 'optionD'].forEach(id => {
                    document.getElementById(id).addEventListener('click', (e) => this.checkAnswer(e.target));
                });
            }
            
            /**
             * æ£€æŸ¥æ¯æ—¥è®­ç»ƒä¸Šé™
             */
            checkDailyLimit() {
                const todayHistory = this.history.filter(h => h.date === this.today);
                if (todayHistory.length >= this.dailyLimit) {
                    document.getElementById('dailyLimitAlert').classList.remove('hidden');
                    document.getElementById('trainingArea').classList.add('hidden');
                }
            }
            
            /**
             * å¼€å§‹è®­ç»ƒ
             */
            startTraining() {
                document.getElementById('startBtn').classList.add('hidden');
                document.getElementById('answerOptions').classList.remove('hidden');
                this.nextQuestion();
            }
            
            /**
             * ç”Ÿæˆä¸‹ä¸€é¢˜
             */
            nextQuestion() {
                this.currentQuestion = this.generateSmartQuestion();
                this.displayQuestion();
                
                document.getElementById('nextBtn').classList.add('hidden');
                document.getElementById('feedback').classList.add('hidden');
                this.enableAnswerButtons();
            }
            
            /**
             * æ ¹æ®å†å²ç­”é¢˜æƒ…å†µæ™ºèƒ½ç”Ÿæˆé¢˜ç›®
             */
            generateSmartQuestion() {
                const todayHistory = this.history.filter(h => h.date === this.today);
                
                // æ ¹æ®ä»Šæ—¥ç­”é¢˜æƒ…å†µè°ƒæ•´éš¾åº¦
                let maxNumber = 30;
                if (todayHistory.length > 0) {
                    const accuracy = todayHistory.filter(h => h.correct).length / todayHistory.length;
                    if (accuracy < 0.6) {
                        maxNumber = 15; // é™ä½éš¾åº¦
                    } else if (accuracy > 0.9) {
                        maxNumber = 30; // ä¿æŒé«˜éš¾åº¦
                    }
                }
                
                const num1 = Math.floor(Math.random() * maxNumber) + 1;
                const num2 = Math.floor(Math.random() * maxNumber) + 1;
                const isAddition = Math.random() > 0.5;
                
                let question, answer;
                if (isAddition) {
                    question = `${num1} + ${num2} = ?`;
                    answer = num1 + num2;
                } else {
                    // ç¡®ä¿å‡æ³•ç»“æœä¸ºæ­£æ•°
                    const larger = Math.max(num1, num2);
                    const smaller = Math.min(num1, num2);
                    question = `${larger} - ${smaller} = ?`;
                    answer = larger - smaller;
                }
                
                return { question, answer, num1, num2, isAddition };
            }
            
            /**
             * ç”Ÿæˆå…·æœ‰è¿·æƒ‘æ€§çš„å¹²æ‰°é€‰é¡¹
             */
            generateOptions(correctAnswer) {
                const options = [correctAnswer];
                const todayHistory = this.history.filter(h => h.date === this.today);
                
                // æ ¹æ®å†å²é”™è¯¯æ¨¡å¼ç”Ÿæˆå¹²æ‰°é¡¹
                const commonMistakes = this.getCommonMistakes();
                
                while (options.length < 4) {
                    let wrongOption;
                    const mistakeType = Math.random();
                    
                    if (mistakeType < 0.3 && commonMistakes.length > 0) {
                        // ä½¿ç”¨å¸¸è§é”™è¯¯æ¨¡å¼
                        const mistake = commonMistakes[Math.floor(Math.random() * commonMistakes.length)];
                        wrongOption = correctAnswer + mistake.offset;
                    } else if (mistakeType < 0.6) {
                        // ç›¸é‚»æ•°å­—é”™è¯¯
                        wrongOption = correctAnswer + (Math.random() > 0.5 ? 1 : -1) * (Math.floor(Math.random() * 3) + 1);
                    } else {
                        // è®¡ç®—é”™è¯¯
                        wrongOption = correctAnswer + (Math.random() > 0.5 ? 10 : -10);
                    }
                    
                    // ç¡®ä¿é€‰é¡¹åœ¨åˆç†èŒƒå›´å†…ä¸”å”¯ä¸€
                    wrongOption = Math.max(0, Math.min(60, wrongOption));
                    if (!options.includes(wrongOption)) {
                        options.push(wrongOption);
                    }
                }
                
                return this.shuffleArray(options);
            }
            
            /**
             * è·å–å¸¸è§é”™è¯¯æ¨¡å¼
             */
            getCommonMistakes() {
                const mistakes = [];
                const wrongAnswers = this.history.filter(h => !h.correct);
                
                wrongAnswers.forEach(record => {
                    const offset = record.selectedAnswer - record.correctAnswer;
                    if (Math.abs(offset) <= 5) {
                        mistakes.push({ offset, count: 1 });
                    }
                });
                
                return mistakes;
            }
            
            /**
             * æ˜¾ç¤ºé¢˜ç›®
             */
            displayQuestion() {
                document.getElementById('question').textContent = this.currentQuestion.question;
                
                const options = this.generateOptions(this.currentQuestion.answer);
                const buttons = ['optionA', 'optionB', 'optionC', 'optionD'];
                
                buttons.forEach((id, index) => {
                    const button = document.getElementById(id);
                    button.textContent = options[index];
                    button.className = 'btn btn-primary answer-btn';
                    button.disabled = false;
                });
            }
            
            /**
             * æ£€æŸ¥ç­”æ¡ˆ
             */
            checkAnswer(button) {
                const selectedAnswer = parseInt(button.textContent);
                const isCorrect = selectedAnswer === this.currentQuestion.answer;
                
                // æ›´æ–°æŒ‰é’®æ ·å¼
                if (isCorrect) {
                    button.classList.add('correct');
                    this.showFeedback('ğŸ‰ å¤ªæ£’äº†ï¼', 'success');
                } else {
                    button.classList.add('incorrect');
                    // æ ‡è®°æ­£ç¡®ç­”æ¡ˆ
                    ['optionA', 'optionB', 'optionC', 'optionD'].forEach(id => {
                        const btn = document.getElementById(id);
                        if (parseInt(btn.textContent) === this.currentQuestion.answer) {
                            btn.classList.add('correct');
                        }
                    });
                    this.showFeedback('ğŸ’ª å†è¯•ä¸€æ¬¡ï¼', 'danger');
                }
                
                // ç¦ç”¨æ‰€æœ‰æŒ‰é’®
                this.disableAnswerButtons();
                
                // è®°å½•ç­”é¢˜å†å²
                this.recordAnswer(isCorrect, selectedAnswer);
                
                // æ˜¾ç¤ºä¸‹ä¸€é¢˜æŒ‰é’®
                setTimeout(() => {
                    document.getElementById('nextBtn').classList.remove('hidden');
                }, 1500);
            }
            
            /**
             * è®°å½•ç­”é¢˜å†å²
             */
            recordAnswer(isCorrect, selectedAnswer) {
                const record = {
                    date: this.today,
                    time: new Date().toLocaleTimeString(),
                    question: this.currentQuestion.question,
                    correctAnswer: this.currentQuestion.answer,
                    selectedAnswer: selectedAnswer,
                    correct: isCorrect,
                    type: this.currentQuestion.isAddition ? 'addition' : 'subtraction'
                };
                
                this.history.push(record);
                this.saveHistory();
                this.updateStats();
                this.updateHistoryList();
                this.checkDailyLimit();
            }
            
            /**
             * æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
             */
            updateStats() {
                const todayHistory = this.history.filter(h => h.date === this.today);
                const totalToday = todayHistory.length;
                const correctToday = todayHistory.filter(h => h.correct).length;
                const accuracyToday = totalToday > 0 ? Math.round((correctToday / totalToday) * 100) : 0;
                
                const totalAll = this.history.length;
                const correctAll = this.history.filter(h => h.correct).length;
                const accuracyAll = totalAll > 0 ? Math.round((correctAll / totalAll) * 100) : 0;
                
                document.getElementById('todayTotal').textContent = totalToday;
                document.getElementById('todayCorrect').textContent = correctToday;
                document.getElementById('todayAccuracy').textContent = accuracyToday + '%';
                
                document.getElementById('totalQuestions').textContent = totalAll;
                document.getElementById('totalCorrect').textContent = correctAll;
                document.getElementById('totalAccuracy').textContent = accuracyAll + '%';
            }
            
            /**
             * æ›´æ–°å†å²è®°å½•åˆ—è¡¨
             */
            updateHistoryList() {
                const historyList = document.getElementById('historyList');
                const todayHistory = this.history.filter(h => h.date === this.today).slice(-5);
                
                historyList.innerHTML = '';
                
                todayHistory.reverse().forEach(record => {
                    const item = document.createElement('div');
                    item.className = 'history-item fade-in';
                    item.innerHTML = `
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>${record.question}</strong>
                                <br>
                                <small class="text-muted">${record.time}</small>
                            </div>
                            <div>
                                <span class="badge ${record.correct ? 'bg-success' : 'bg-danger'}">
                                    ${record.correct ? 'âœ“' : 'âœ—'} ${record.selectedAnswer}
                                </span>
                            </div>
                        </div>
                    `;
                    historyList.appendChild(item);
                });
            }
            
            /**
             * æ˜¾ç¤ºåé¦ˆä¿¡æ¯
             */
            showFeedback(message, type) {
                const feedback = document.getElementById('feedback');
                feedback.textContent = message;
                feedback.className = `emoji-feedback fade-in text-${type}`;
                feedback.classList.remove('hidden');
            }
            
            /**
             * å¯ç”¨ç­”æ¡ˆæŒ‰é’®
             */
            enableAnswerButtons() {
                ['optionA', 'optionB', 'optionC', 'optionD'].forEach(id => {
                    document.getElementById(id).disabled = false;
                });
            }
            
            /**
             * ç¦ç”¨ç­”æ¡ˆæŒ‰é’®
             */
            disableAnswerButtons() {
                ['optionA', 'optionB', 'optionC', 'optionD'].forEach(id => {
                    document.getElementById(id).disabled = true;
                });
            }
            
            /**
             * æ‰“ä¹±æ•°ç»„é¡ºåº
             */
            shuffleArray(array) {
                const shuffled = [...array];
                for (let i = shuffled.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                }
                return shuffled;
            }
            
            /**
             * åŠ è½½å†å²è®°å½•
             */
            loadHistory() {
                const saved = localStorage.getItem('mathTrainingHistory');
                return saved ? JSON.parse(saved) : [];
            }
            
            /**
             * ä¿å­˜å†å²è®°å½•
             */
            saveHistory() {
                localStorage.setItem('mathTrainingHistory', JSON.stringify(this.history));
            }
        }
        
        // åˆå§‹åŒ–ç³»ç»Ÿ
        document.addEventListener('DOMContentLoaded', () => {
            new MathTrainingSystem();
        });
    </script>
</body>
</html>