<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>幼儿园大班学习乐园</title>
  
  <!-- Favicon图标 - V1版本 -->
  <link rel="icon" type="image/svg+xml" href="assets/images/favicon.svg">
  <link rel="shortcut icon" href="assets/images/favicon.svg">
  
  <!-- 智能资源管理器 -->
  <script src="assets/js/smart-resource-manager.js"></script>
  <script src="assets/js/cdn-manager.js"></script>
  
  <!-- Bootstrap CSS 备用方案 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.min.css" rel="stylesheet">
  
  <style>
    body {
      font-family: '幼圆', '微软雅黑', sans-serif;
      background: linear-gradient(135deg, #6ecbf5 0%, #cdefff 100%);
      min-height: 100vh;
      padding-bottom: 20px;
    }
    
    /* 解决Vue页面加载时的闪现问题 */
    [v-cloak] {
      display: none;
    }
    
    .header {
      background: linear-gradient(to right, #ff9966, #ff5e62);
      color: white;
      border-radius: 0 0 20px 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      padding: 15px 0;
    }
    
    .subject-card {
      border-radius: 20px;
      transition: all 0.3s ease;
      cursor: pointer;
      height: 100%;
      box-shadow: 0 6px 12px rgba(0,0,0,0.1);
    }
    
    .subject-card:hover {
      transform: translateY(-10px);
      box-shadow: 0 12px 20px rgba(0,0,0,0.15);
    }
    
    .subject-icon {
      font-size: 3rem;
      margin-bottom: 15px;
    }
    
    .content-area {
      background: white;
      border-radius: 20px;
      box-shadow: 0 6px 15px rgba(0,0,0,0.1);
      padding: 20px;
      min-height: 400px;
      margin-top: 20px;
    }
    
    .back-btn {
      position: absolute;
      top: 20px;
      left: 20px;
      z-index: 100;
    }
    
    /* 快捷菜单样式 */
    .quick-nav {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: linear-gradient(to right, #4facfe 0%, #00f2fe 100%);
      padding: 10px 0;
      z-index: 1060;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .quick-nav-item {
      position: relative;
      display: inline-block;
      margin: 0 5px;
    }
    
    .quick-nav-btn {
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      transition: all 0.3s ease;
      font-size: 14px;
      cursor: pointer;
    }
    
    .quick-nav-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    
    .quick-nav-btn.active {
      background: white;
      color: #4facfe;
    }
    
    /* 下拉菜单样式 */
    .quick-nav-dropdown {
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%) translateY(10px);
      background: white;
      border-radius: 10px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
      padding: 10px 0;
      min-width: 180px;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
      margin-top: 5px;
      z-index: 1070;
      border: 1px solid rgba(0,0,0,0.1);
    }
    
    .quick-nav-item:hover .quick-nav-dropdown {
      opacity: 1;
      visibility: visible;
      transform: translateX(-50%) translateY(0);
    }

    /* 增强下拉菜单的交互体验 */
    .quick-nav-item:hover .quick-nav-btn {
      background: rgba(255, 255, 255, 0.4);
      transform: translateY(-1px);
    }

    /* 防止下拉菜单意外关闭 */
    .quick-nav-dropdown:hover {
      opacity: 1;
      visibility: visible;
    }
    
    .quick-nav-dropdown-item {
      display: block;
      padding: 8px 20px;
      color: #333;
      text-decoration: none;
      font-size: 13px;
      transition: all 0.2s ease;
      cursor: pointer;
      border: none;
      background: none;
      width: 100%;
      text-align: left;
    }
    
    .quick-nav-dropdown-item:hover {
      background: #f8f9fa;
      color: #4facfe;
      transform: translateX(5px);
    }
    
    .quick-nav-dropdown-item.active {
      background: #e3f2fd;
      color: #1976d2;
      font-weight: 500;
    }

    /* 为页面内容添加顶部间距，避免被快捷菜单遮挡 */
    .page-content {
      margin-top: 60px;
    }

    /* 响应式设计 - 快速导航菜单 */
    @media (max-width: 768px) {
      .quick-nav {
        padding: 8px 0;
        font-size: 12px;
      }

      .quick-nav-btn {
        padding: 6px 12px;
        font-size: 12px;
        margin: 0 2px;
      }

      .quick-nav-dropdown {
        min-width: 160px;
        left: 0;
        transform: translateX(0) translateY(10px);
        margin-top: 3px;
      }

      .quick-nav-dropdown-item {
        padding: 6px 15px;
        font-size: 12px;
      }

      .page-content {
        margin-top: 50px;
      }

      .nav-tabs-sticky {
        top: 50px;
      }
    }

    @media (max-width: 576px) {
      .quick-nav {
        padding: 5px 0;
      }

      .quick-nav-btn {
        padding: 4px 8px;
        font-size: 11px;
        border-radius: 15px;
      }

      .quick-nav-dropdown {
        min-width: 140px;
        font-size: 11px;
      }

      .quick-nav-dropdown-item {
        padding: 5px 12px;
        font-size: 11px;
      }
    }
    
    .activity-card {
      border-radius: 15px;
      transition: all 0.3s;
      cursor: pointer;
      border: 2px solid #eee;
    }
    
    .activity-card:hover {
      transform: scale(1.03);
      border-color: #6ecbf5;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .btn-primary {
      background: linear-gradient(to right, #4facfe 0%, #00f2fe 100%);
      border: none;
    }
    
    .btn-success {
      background: linear-gradient(to right, #0ba360 0%, #3cba92 100%);
      border: none;
    }
    
    .btn-warning {
      background: linear-gradient(to right, #ff758c 0%, #ff7eb3 100%);
      border: none;
    }
    
    h1, h2, h3, h4 {
      font-weight: bold;
    }
    
    /* 图形认知样式 */
    .shape-card {
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
      cursor: pointer;
      height: 180px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    
    .shape-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 15px rgba(0,0,0,0.15);
    }
    
    .shape-circle {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background-color: #ff7eb3;
    }
    
    .shape-square {
      width: 80px;
      height: 80px;
      background-color: #4facfe;
    }
    
    .shape-triangle {
      width: 0;
      height: 0;
      border-left: 40px solid transparent;
      border-right: 40px solid transparent;
      border-bottom: 80px solid #3cba92;
    }
    
    .shape-rectangle {
      width: 100px;
      height: 60px;
      background-color: #ff758c;
    }
    
    .shape-oval {
      width: 100px;
      height: 60px;
      border-radius: 50%;
      background-color: #ffcf5c;
    }
    
    .shape-pentagon {
      width: 80px;
      height: 80px;
      background-color: #8e44ad;
      clip-path: polygon(50% 0%, 100% 38%, 82% 100%, 18% 100%, 0% 38%);
    }
    
    .shape-hexagon {
      width: 80px;
      height: 80px;
      background-color: #16a085;
      clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%);
    }
    
    .shape-star {
      width: 80px;
      height: 80px;
      background-color: #f1c40f;
      clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
    }
    
    .shape-name {
      font-weight: bold;
      margin-top: 10px;
    }
    
    /* 返回顶部按钮样式 */
    .back-to-top {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background-color: rgba(255, 255, 255, 0.9);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 1000;
      transition: all 0.3s ease;
    }
    
    .back-to-top:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
    
    .back-to-top i {
      font-size: 1.5rem;
      color: #4facfe;
    }
    
    .alphabet-card {
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s;
      border: 2px solid #dee2e6;
      border-radius: 10px;
      margin: 5px;
    }
    
    .alphabet-card:hover {
      transform: scale(1.1);
      border-color: #4facfe;
      background-color: #f8f9fa;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .number-card {
      height: 100px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s;
      border: 2px solid #dee2e6;
      border-radius: 10px;
      margin: 5px;
    }
    
    .number-card:hover {
      transform: scale(1.1);
      border-color: #4facfe;
      background-color: #f8f9fa;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .word-card {
      min-height: 120px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
      border: 2px solid #dee2e6;
      border-radius: 15px;
      margin: 10px;
      padding: 15px;
    }
    
    .word-card:hover {
      transform: scale(1.05);
      border-color: #4facfe;
      background-color: #f8f9fa;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .word-image {
      width: 80px;
      height: 80px;
      object-fit: contain;
      margin-bottom: 10px;
    }
    
    /* 关键帧动画优化 */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .fade-in {
      animation: fadeIn 0.5s ease-in;
    }
    
    .result-icon {
      font-size: 5rem;
      margin: 20px 0;
    }
    
    .question-option {
      border: 2px solid #dee2e6;
      border-radius: 10px;
      padding: 15px;
      margin: 10px 0;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .question-option:hover {
      border-color: #4facfe;
      background-color: #f8f9fa;
    }
    
    .question-option.selected {
      border-color: #4facfe;
      background-color: #e6f7ff;
      box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.2);
    }
    
    /* 图片加载状态样式 */
    .image-placeholder {
      width: 80px;
      height: 80px;
      background-color: #f0f0f0;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 10px;
      border-radius: 5px;
    }
    
    .image-placeholder i {
      font-size: 2rem;
      color: #ccc;
    }
    
    /* 页脚样式 */
    .footer {
      background: linear-gradient(to right, #2c3e50, #34495e);
      color: white;
      padding: 30px 0;
      margin-top: 50px;
      border-radius: 20px 20px 0 0;
      box-shadow: 0 -4px 8px rgba(0,0,0,0.1);
    }
    
    .footer h5 {
      color: #ecf0f1;
      font-weight: bold;
      margin-bottom: 15px;
    }
    
    .footer p {
      color: #bdc3c7;
      margin-bottom: 8px;
      font-size: 0.95rem;
    }
    
    .footer a {
      color: #3498db;
      text-decoration: none;
      transition: color 0.3s ease;
    }
    
    .footer a:hover {
      color: #5dade2;
      text-decoration: underline;
    }
    
    .contact-info {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 15px;
      margin-top: 10px;
    }
    
    .contact-item {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
    }
    
    .contact-item i {
      margin-right: 10px;
      color: #3498db;
      width: 20px;
    }

    /* 历史记录表格样式 */
    .table-responsive {
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .table th {
      border: none;
      font-weight: 600;
      text-align: center;
      vertical-align: middle;
    }

    .table td {
      border: none;
      text-align: center;
      vertical-align: middle;
      padding: 12px 8px;
    }

    .table-striped > tbody > tr:nth-of-type(odd) > td {
      background-color: rgba(0,0,0,0.02);
    }

    /* 固定标签导航样式 */
    .nav-tabs-sticky {
      position: sticky;
      top: 60px;
      z-index: 1020;
      background: white;
      padding: 10px 0;
      margin: -20px -20px 20px -20px;
      border-radius: 20px 20px 0 0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .nav-tabs-sticky .nav-tabs {
      margin-bottom: 0;
      border-bottom: 1px solid #dee2e6;
    }

    .nav-tabs-sticky .nav-link {
      border-radius: 8px 8px 0 0;
      margin-right: 5px;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .nav-tabs-sticky .nav-link:hover {
      background-color: #f8f9fa;
      border-color: #dee2e6;
    }

    .nav-tabs-sticky .nav-link.active {
      background-color: #4facfe;
      border-color: #4facfe;
      color: white;
    }

    /* 为固定导航添加内边距 */
    .content-area-with-sticky {
      padding-top: 0;
    }

    .table-hover > tbody > tr:hover > td {
      background-color: rgba(79, 172, 254, 0.1);
    }

    /* 统计卡片样式 */
    .card {
      border-radius: 15px;
      border: none;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      transition: transform 0.2s ease;
    }

    .card:hover {
      transform: translateY(-2px);
    }

    /* 识字测试汉字显示样式 */
    .character-display {
      font-size: 6rem;
      font-weight: bold;
      color: #2c3e50;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
      margin: 20px 0;
      font-family: '楷体', '华文楷体', serif;
    }

    /* 练习区域样式 */
    .practice-area {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }

    /* 统计区域样式 */
    .stats-section {
      background: white;
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      border: 1px solid #e9ecef;
    }

    /* 历史记录区域样式 */
    .history-section {
      background: white;
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      border: 1px solid #e9ecef;
    }

    .history-summary {
      border: 2px dashed #dee2e6;
      transition: all 0.3s ease;
    }

    .history-summary:hover {
      border-color: #6ecbf5;
      background-color: #f8f9fa !important;
    }

    .history-details {
      animation: slideDown 0.3s ease-out;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* 按钮样式优化 */
    .btn-outline-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .btn-outline-warning:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- 快捷菜单 -->
    <div class="quick-nav" v-if="currentPage !== 'home'">
      <div class="container">
        <div class="d-flex justify-content-center align-items-center">
          <!-- 语文学科下拉菜单 -->
          <div class="quick-nav-item">
            <button class="btn quick-nav-btn" 
                    :class="{ active: currentSubject.key === 'chinese' }"
                    @click="selectSubject('chinese')">
              <i class="bi bi-book"></i> 语文
            </button>
            <div class="quick-nav-dropdown">
              <button class="quick-nav-dropdown-item" 
                      :class="{ active: currentSubject.key === 'chinese' && activeChineseTab === 'pinyin' }"
                      @click="selectSubjectAndTab('chinese', 'pinyin')">
                <i class="bi bi-music-note"></i> 拼音学习
              </button>
              <button class="quick-nav-dropdown-item" 
                      :class="{ active: currentSubject.key === 'chinese' && activeChineseTab === 'characters' }"
                      @click="selectSubjectAndTab('chinese', 'characters')">
                <i class="bi bi-fonts"></i> 汉字学习
              </button>
              <button class="quick-nav-dropdown-item" 
                      :class="{ active: currentSubject.key === 'chinese' && activeChineseTab === 'words' }"
                      @click="selectSubjectAndTab('chinese', 'words')">
                <i class="bi bi-chat-text"></i> 词语学习
              </button>
              <button class="quick-nav-dropdown-item" 
                      :class="{ active: currentSubject.key === 'chinese' && activeChineseTab === 'idioms' }"
                      @click="selectSubjectAndTab('chinese', 'idioms')">
                <i class="bi bi-gem"></i> 成语学习
              </button>
              <button class="quick-nav-dropdown-item" 
                      :class="{ active: currentSubject.key === 'chinese' && activeChineseTab === 'poems' }"
                      @click="selectSubjectAndTab('chinese', 'poems')">
                <i class="bi bi-journal-text"></i> 古诗词学习
              </button>
              <button class="quick-nav-dropdown-item" 
                      :class="{ active: currentSubject.key === 'chinese' && activeChineseTab === 'test' }"
                      @click="selectSubjectAndTab('chinese', 'test')">
                <i class="bi bi-clipboard-check"></i> 识字测试
              </button>
              <button class="quick-nav-dropdown-item" 
                      :class="{ active: currentSubject.key === 'chinese' && activeChineseTab === 'sayings' }"
                      @click="selectSubjectAndTab('chinese', 'sayings')">
                <i class="bi bi-chat-quote"></i> 歇后语
              </button>
              <button class="quick-nav-dropdown-item" 
                      :class="{ active: currentSubject.key === 'chinese' && activeChineseTab === 'fables' }"
                      @click="selectSubjectAndTab('chinese', 'fables')">
                <i class="bi bi-book-half"></i> 寓言故事
              </button>
              <button class="quick-nav-dropdown-item" 
                      :class="{ active: currentSubject.key === 'chinese' && activeChineseTab === 'riddles' }"
                      @click="selectSubjectAndTab('chinese', 'riddles')">
                <i class="bi bi-question-circle"></i> 谜语
              </button>
            </div>
          </div>
          
          <!-- 数学学科下拉菜单 -->
          <div class="quick-nav-item">
            <button class="btn quick-nav-btn" 
                    :class="{ active: currentSubject.key === 'math' }"
                    @click="selectSubject('math')">
              <i class="bi bi-calculator"></i> 数学
            </button>
            <div class="quick-nav-dropdown">
              <button class="quick-nav-dropdown-item" 
                      :class="{ active: currentSubject.key === 'math' && activeMathTab === 'numbers' }"
                      @click="selectSubjectAndTab('math', 'numbers')">
                <i class="bi bi-123"></i> 数字认知
              </button>
              <button class="quick-nav-dropdown-item" 
                      :class="{ active: currentSubject.key === 'math' && activeMathTab === 'counting' }"
                      @click="selectSubjectAndTab('math', 'counting')">
                <i class="bi bi-list-ol"></i> 数数练习
              </button>
              <button class="quick-nav-dropdown-item" 
                      :class="{ active: currentSubject.key === 'math' && activeMathTab === 'addition' }"
                      @click="selectSubjectAndTab('math', 'addition')">
                <i class="bi bi-plus-circle"></i> 20以内加法
              </button>
              <button class="quick-nav-dropdown-item" 
                      :class="{ active: currentSubject.key === 'math' && activeMathTab === 'subtraction' }"
                      @click="selectSubjectAndTab('math', 'subtraction')">
                <i class="bi bi-dash-circle"></i> 20以内减法
              </button>
              <a class="quick-nav-dropdown-item" href="math-advanced-training.html" target="_blank">
                <i class="bi bi-calculator-fill"></i> 高级数学训练
              </a>
              <button class="quick-nav-dropdown-item" 
                      :class="{ active: currentSubject.key === 'math' && activeMathTab === 'shapes' }"
                      @click="selectSubjectAndTab('math', 'shapes')">
                <i class="bi bi-hexagon"></i> 图形认知
              </button>
            </div>
          </div>
          
          <!-- 英语学科下拉菜单 -->
          <div class="quick-nav-item">
            <button class="btn quick-nav-btn" 
                    :class="{ active: currentSubject.key === 'english' }"
                    @click="selectSubject('english')">
              <i class="bi bi-globe"></i> 英语
            </button>
            <div class="quick-nav-dropdown">
              <button class="quick-nav-dropdown-item" 
                      :class="{ active: currentSubject.key === 'english' && activeEnglishTab === 'alphabet' }"
                      @click="selectSubjectAndTab('english', 'alphabet')">
                <i class="bi bi-alphabet"></i> 字母学习
              </button>
              <button class="quick-nav-dropdown-item" 
                      :class="{ active: currentSubject.key === 'english' && activeEnglishTab === 'words' }"
                      @click="selectSubjectAndTab('english', 'words')">
                <i class="bi bi-translate"></i> 单词学习
              </button>
            </div>
          </div>
          
          <!-- 主页按钮 -->
          <div class="quick-nav-item ms-3">
            <button class="btn quick-nav-btn" @click="goHome">
              <i class="bi bi-house-door"></i> 主页
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 主页 -->
    <div v-if="currentPage === 'home'" class="fade-in page-content">
      <div class="header text-center py-4 mb-4">
        <h1><i class="bi bi-stars"></i> 幼儿园大班学习乐园 <i class="bi bi-stars"></i></h1>
        <p class="lead">欢迎来到快乐学习世界！</p>
      </div>
      
      <div class="container">
        <div class="row">
          <div class="col-md-4 mb-4">
            <div class="subject-card card bg-primary text-white" @click="selectSubject('chinese')">
              <div class="card-body text-center">
                <div class="subject-icon">
                  <i class="bi bi-book"></i>
                </div>
                <h3 class="card-title">语文</h3>
                <p class="card-text">学习汉字、拼音和词语</p>
              </div>
            </div>
          </div>
          
          <div class="col-md-4 mb-4">
            <div class="subject-card card bg-success text-white" @click="selectSubject('math')">
              <div class="card-body text-center">
                <div class="subject-icon">
                  <i class="bi bi-calculator"></i>
                </div>
                <h3 class="card-title">数学</h3>
                <p class="card-text">学习数字、计算和图形</p>
              </div>
            </div>
          </div>

          <!-- 数学训练 -->
          <div class="col-md-4 mb-4">
            <div class="subject-card card bg-info text-white position-relative">
              <div class="card-body text-center">
                <div class="subject-icon">
                  <i class="bi bi-123"></i>
                </div>
                <h3 class="card-title">加减法训练</h3>
                <p class="card-text">30以内智能加减法训练</p>
                <div class="d-flex justify-content-center gap-2 mt-3">
                  <button class="btn btn-light btn-sm" onclick="window.open('math-training.html', '_blank')">
                    标准版
                  </button>
                  <button class="btn btn-warning btn-sm" onclick="window.open('math-training-optimized.html', '_blank')">
                    ⚡极速版
                  </button>
                </div>
                <span class="badge bg-light text-info ms-2">新功能</span>
              </div>
            </div>
          </div>
          
          <div class="col-md-4 mb-4">
            <div class="subject-card card bg-warning text-white" @click="selectSubject('english')">
              <div class="card-body text-center">
                <div class="subject-icon">
                  <i class="bi bi-globe"></i>
                </div>
                <h3 class="card-title">英语</h3>
                <p class="card-text">学习字母、单词和简单句子</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 学科页面 -->
    <div v-else class="fade-in page-content" v-cloak> 
      <div class="header text-center py-4 mb-4">
        <h1>{{ currentSubject.title }}</h1>
      </div>
      
      <div class="container">
        <div class="content-area">
          <!-- 语文内容 -->
          <div v-if="currentSubject.key === 'chinese'">
            <div class="nav-tabs-sticky">
              <ul class="nav nav-tabs" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link" 
                        :class="{ active: activeChineseTab === 'pinyin' }"
                        data-bs-toggle="tab" 
                        data-bs-target="#pinyin" 
                        type="button" 
                        role="tab"
                        @click="setActiveTab('chinese', 'pinyin')">拼音学习</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" 
                        :class="{ active: activeChineseTab === 'characters' }"
                        data-bs-toggle="tab" 
                        data-bs-target="#characters" 
                        type="button" 
                        role="tab"
                        @click="setActiveTab('chinese', 'characters')">汉字学习</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" 
                        :class="{ active: activeChineseTab === 'words' }"
                        data-bs-toggle="tab" 
                        data-bs-target="#words" 
                        type="button" 
                        role="tab"
                        @click="setActiveTab('chinese', 'words')">词语学习</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" 
                        :class="{ active: activeChineseTab === 'idioms' }"
                        data-bs-toggle="tab" 
                        data-bs-target="#idioms" 
                        type="button" 
                        role="tab"
                        @click="setActiveTab('chinese', 'idioms')">成语学习</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link"
                        :class="{ active: activeChineseTab === 'poems' }"
                        data-bs-toggle="tab"
                        data-bs-target="#poems"
                        type="button"
                        role="tab"
                        @click="setActiveTab('chinese', 'poems')">古诗词学习</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link"
                        :class="{ active: activeChineseTab === 'test' }"
                        data-bs-toggle="tab"
                        data-bs-target="#test"
                        type="button"
                        role="tab"
                        @click="setActiveTab('chinese', 'test')">识字测试</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link"
                        :class="{ active: activeChineseTab === 'sayings' }"
                        data-bs-toggle="tab"
                        data-bs-target="#sayings"
                        type="button"
                        role="tab"
                        @click="setActiveTab('chinese', 'sayings')">歇后语</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link"
                        :class="{ active: activeChineseTab === 'fables' }"
                        data-bs-toggle="tab"
                        data-bs-target="#fables"
                        type="button"
                        role="tab"
                        @click="setActiveTab('chinese', 'fables')">寓言故事</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link"
                        :class="{ active: activeChineseTab === 'riddles' }"
                        data-bs-toggle="tab"
                        data-bs-target="#riddles"
                        type="button"
                        role="tab"
                        @click="setActiveTab('chinese', 'riddles')">谜语</button>
              </li>
            </ul>
            </div>
            <div class="tab-content">
              <div class="tab-pane fade" 
                   :class="{ 'show active': activeChineseTab === 'pinyin' }" 
                   id="pinyin" 
                   role="tabpanel">
                <h3 class="mt-3">声母学习</h3>
                <div class="row">
                  <div v-for="initial in chinese.initials" :key="initial" class="col-2 mb-3">
                    <div class="alphabet-card bg-light" @click="speak(initial)">
                      {{ initial }}
                    </div>
                  </div>
                </div>
                
                <h3 class="mt-4">韵母学习</h3>
                <div class="row">
                  <div v-for="final in chinese.finals" :key="final" class="col-2 mb-3">
                    <div class="alphabet-card bg-light" @click="speak(final)">
                      {{ final }}
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="tab-pane fade" 
                   :class="{ 'show active': activeChineseTab === 'characters' }" 
                   id="characters" 
                   role="tabpanel">
                <h3 class="mt-3">基础汉字</h3>
                <div class="row">
                  <div v-for="character in chinese.characters" :key="character.char" class="col-3 col-md-2 mb-3">
                    <div class="number-card bg-light" @click="speak(character.pinyin)">
                      <div class="character">{{ character.char }}</div>
                      <div class="pinyin text-muted small">{{ character.pinyin }}</div>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="tab-pane fade" 
                   :class="{ 'show active': activeChineseTab === 'words' }" 
                   id="words" 
                   role="tabpanel">
                <h3 class="mt-3">常用词语</h3>
                <div class="row">
                  <div v-for="word in chinese.words" :key="word.word" class="col-6 col-md-3 mb-3">
                    <div class="word-card bg-light" @click="speak(word.word)">
                      <div class="word">{{ word.word }}</div>
                      <div class="pinyin text-muted small">{{ word.pinyin }}</div>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="tab-pane fade" 
                   :class="{ 'show active': activeChineseTab === 'idioms' }" 
                   id="idioms" 
                   role="tabpanel">
                <h3 class="mt-3">常用成语</h3>
                <div class="row">
                  <div v-for="idiom in chinese.idioms" :key="idiom.idiom" class="col-6 col-md-3 mb-3">
                    <div class="word-card bg-light" @click="speak(idiom.idiom)">
                      <div class="word">{{ idiom.idiom }}</div>
                      <div class="pinyin text-muted small">{{ idiom.pinyin }}</div>
                      <div class="meaning text-muted small">{{ idiom.meaning }}</div>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="tab-pane fade"
                   :class="{ 'show active': activeChineseTab === 'sayings' }"
                   id="sayings"
                   role="tabpanel">
                <h3 class="mt-3">经典歇后语</h3>
                <div class="row">
                  <div v-for="saying in chinese.sayings" :key="saying.first" class="col-12 col-md-6 mb-3">
                    <div class="word-card bg-light" @click="speak(saying.first + '，' + saying.second)">
                      <div class="word fw-bold">{{ saying.first }}</div>
                      <div class="second mt-2">{{ saying.second }}</div>
                      <div class="explanation text-muted small mt-2" v-if="saying.explanation">{{ saying.explanation }}</div>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="tab-pane fade"
                   :class="{ 'show active': activeChineseTab === 'fables' }"
                   id="fables"
                   role="tabpanel">
                <h3 class="mt-3">寓言故事</h3>
                <div class="row">
                  <div v-for="fable in chinese.fables" :key="fable.title" class="col-12 mb-4">
                    <div class="card h-100 shadow-sm">
                      <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">{{ fable.title }}</h5>
                      </div>
                      <div class="card-body">
                        <p class="card-text">{{ fable.content }}</p>
                        <div class="mt-3 p-3 bg-light rounded">
                          <h6 class="mb-2"><i class="bi bi-lightbulb"></i> 寓意</h6>
                          <p class="mb-0">{{ fable.moral }}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="tab-pane fade"
                   :class="{ 'show active': activeChineseTab === 'riddles' }"
                   id="riddles"
                   role="tabpanel">
                <h3 class="mt-3">趣味谜语</h3>
                <div class="row">
                  <div class="col-12 mb-4">
                    <ul class="nav nav-pills mb-3" id="riddle-tabs" role="tablist">
                      <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="word-riddles-tab" data-bs-toggle="pill" data-bs-target="#word-riddles" type="button" role="tab">字谜</button>
                      </li>
                      <li class="nav-item" role="presentation">
                        <button class="nav-link" id="object-riddles-tab" data-bs-toggle="pill" data-bs-target="#object-riddles" type="button" role="tab">物谜</button>
                      </li>
                      <li class="nav-item" role="presentation">
                        <button class="nav-link" id="animal-riddles-tab" data-bs-toggle="pill" data-bs-target="#animal-riddles" type="button" role="tab">动物谜</button>
                      </li>
                    </ul>
                  </div>
                </div>
                
                <div class="tab-content" id="riddle-content">
                  <div class="tab-pane fade show active" id="word-riddles" role="tabpanel">
                    <div class="row">
                      <div v-for="riddle in chinese.loadRiddles()?.word || []" :key="riddle.question" class="col-12 col-md-6 mb-3">
                        <div class="card h-100">
                          <div class="card-body">
                            <h5 class="card-title">{{ riddle.question }}</h5>
                            <div class="mt-3">
                              <button class="btn btn-sm btn-outline-primary" @click="riddle.showAnswer = !riddle.showAnswer">
                                {{ riddle.showAnswer ? '隐藏答案' : '查看答案' }}
                              </button>
                              <div v-if="riddle.showAnswer" class="mt-2">
                                <p class="text-success fw-bold">答案：{{ riddle.answer }}</p>
                                <p v-if="riddle.explanation" class="text-muted small">解释：{{ riddle.explanation }}</p>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <div class="tab-pane fade" id="object-riddles" role="tabpanel">
                    <div class="row">
                      <div v-for="riddle in chinese.loadRiddles()?.object || []" :key="riddle.question" class="col-12 col-md-6 mb-3">
                        <div class="card h-100">
                          <div class="card-body">
                            <h5 class="card-title">{{ riddle.question }}</h5>
                            <div class="mt-3">
                              <button class="btn btn-sm btn-outline-primary" @click="riddle.showAnswer = !riddle.showAnswer">
                                {{ riddle.showAnswer ? '隐藏答案' : '查看答案' }}
                              </button>
                              <div v-if="riddle.showAnswer" class="mt-2">
                                <p class="text-success fw-bold">答案：{{ riddle.answer }}</p>
                                <p v-if="riddle.explanation" class="text-muted small">解释：{{ riddle.explanation }}</p>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <div class="tab-pane fade" id="animal-riddles" role="tabpanel">
                    <div class="row">
                      <div v-for="riddle in chinese.loadRiddles()?.animal || []" :key="riddle.question" class="col-12 col-md-6 mb-3">
                        <div class="card h-100">
                          <div class="card-body">
                            <h5 class="card-title">{{ riddle.question }}</h5>
                            <div class="mt-3">
                              <button class="btn btn-sm btn-outline-primary" @click="riddle.showAnswer = !riddle.showAnswer">
                                {{ riddle.showAnswer ? '隐藏答案' : '查看答案' }}
                              </button>
                              <div v-if="riddle.showAnswer" class="mt-2">
                                <p class="text-success fw-bold">答案：{{ riddle.answer }}</p>
                                <p v-if="riddle.explanation" class="text-muted small">解释：{{ riddle.explanation }}</p>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="tab-pane fade"
                   :class="{ 'show active': activeChineseTab === 'poems' }"
                   id="poems"
                   role="tabpanel">
                <h3 class="mt-3">经典古诗词</h3>
                <div class="row">
                  <div v-for="poem in chinese.poems" :key="poem.title" class="col-12 col-md-6 mb-4">
                    <div class="poem-card bg-light p-3 h-100">
                      <div class="poem-title fw-bold fs-5 mb-2">{{ poem.title }}</div>
                      <div class="poem-author text-muted small mb-2">{{ poem.author }}</div>
                      <div class="poem-content mb-2">{{ poem.content }}</div>
                      <div class="poem-meaning text-muted">{{ poem.meaning }}</div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="tab-pane fade"
                   :class="{ 'show active': activeChineseTab === 'test' }"
                   id="test"
                   role="tabpanel">
                <h3 class="mt-3">识字测试</h3>

                <!-- 练习区域 -->
                <div class="practice-area">
                  <div class="text-center my-4">
                    <div class="question-display">
                      <h2 class="character-display">{{ characterQuestion.char }}</h2>
                      <p class="text-muted">请选择这个汉字的正确拼音</p>
                    </div>

                    <div class="options mt-4">
                      <div v-for="option in characterQuestion.options" :key="option"
                           class="question-option d-inline-block mx-2"
                           :class="{ selected: selectedCharacterAnswer === option }"
                           @click="selectCharacterAnswer(option)">
                        {{ option }}
                      </div>
                    </div>

                    <div class="mt-3" v-if="characterResult !== null">
                      <div v-if="characterResult" class="text-success">
                        <i class="bi bi-check-circle-fill result-icon"></i>
                        <h4>答对了！真棒！</h4>
                      </div>
                      <div v-else class="text-danger">
                        <i class="bi bi-x-circle-fill result-icon"></i>
                        <h4>再试试看哦！</h4>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- 统计卡片 -->
                <div class="stats-section mt-5">
                  <h4 class="mb-3">
                    <i class="bi bi-calendar-day"></i> 今日测试统计
                    <small class="text-muted ms-2">{{ getCurrentDateString() }}</small>
                  </h4>
                  <div class="row">
                    <div class="col-md-3 col-6 mb-3">
                      <div class="card bg-primary text-white">
                        <div class="card-body text-center">
                          <h5>总题数</h5>
                          <h3>{{ characterStats.totalQuestions }}</h3>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                      <div class="card bg-success text-white">
                        <div class="card-body text-center">
                          <h5>答对</h5>
                          <h3>{{ characterStats.correctAnswers }}</h3>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                      <div class="card bg-danger text-white">
                        <div class="card-body text-center">
                          <h5>答错</h5>
                          <h3>{{ characterStats.wrongAnswers }}</h3>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                      <div class="card bg-info text-white">
                        <div class="card-body text-center">
                          <h5>正确率</h5>
                          <h3>{{ characterStats.accuracy }}%</h3>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- 历史记录展开区域 -->
                <div class="history-section mt-5">
                  <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="mb-0">
                      <i class="bi bi-clock-history"></i> 测试历史
                    </h4>
                    <div>
                      <button class="btn btn-outline-primary btn-sm me-2"
                              @click="toggleHistoryExpanded">
                        <i class="bi" :class="historyExpanded ? 'bi-chevron-up' : 'bi-chevron-down'"></i>
                        {{ historyExpanded ? '收起' : '展开' }}详细记录
                      </button>
                      <button class="btn btn-outline-info btn-sm me-2"
                              @click="resetTodayStats('character')"
                              v-if="characterStats.totalQuestions > 0">
                        <i class="bi bi-arrow-clockwise"></i> 重置今日
                      </button>
                      <button class="btn btn-outline-warning btn-sm"
                              @click="clearPracticeHistory('character')"
                              v-if="Object.keys(characterHistory).length > 0">
                        <i class="bi bi-trash"></i> 清空全部
                      </button>
                    </div>
                  </div>

                  <!-- 简要统计 -->
                  <div class="history-summary p-3 bg-light rounded">
                    <div class="row text-center">
                      <div class="col-3">
                        <div class="fw-bold text-primary">{{ Object.keys(characterHistory).length }}</div>
                        <small class="text-muted">累计题目</small>
                      </div>
                      <div class="col-3">
                        <div class="fw-bold text-success">{{ characterAllTimeStats.correctAnswers }}</div>
                        <small class="text-muted">累计答对</small>
                      </div>
                      <div class="col-3">
                        <div class="fw-bold text-danger">{{ characterAllTimeStats.wrongAnswers }}</div>
                        <small class="text-muted">累计答错</small>
                      </div>
                      <div class="col-3">
                        <div class="fw-bold text-info">{{ characterAllTimeStats.accuracy }}%</div>
                        <small class="text-muted">累计正确率</small>
                      </div>
                    </div>
                  </div>

                  <!-- 详细历史记录 -->
                  <div v-show="historyExpanded" class="history-details mt-3">
                    <div v-if="Object.keys(characterHistory).length === 0" class="text-center text-muted py-5">
                      <i class="bi bi-clipboard-x" style="font-size: 3rem;"></i>
                      <h5 class="mt-3">暂无历史记录</h5>
                      <p>开始识字测试后，这里会显示你的测试历史</p>
                    </div>

                    <div v-else class="table-responsive">
                      <table class="table table-striped table-hover">
                        <thead class="table-dark">
                          <tr>
                            <th>汉字</th>
                            <th>拼音</th>
                            <th>正确次数</th>
                            <th>错误次数</th>
                            <th>总次数</th>
                            <th>正确率</th>
                            <th>最后测试时间</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr v-for="(record, question) in sortedCharacterHistory" :key="question">
                            <td class="fw-bold fs-5">{{ question.split(' - ')[0] }}</td>
                            <td class="text-primary">{{ question.split(' - ')[1] }}</td>
                            <td class="text-success">{{ record.correct }}</td>
                            <td class="text-danger">{{ record.wrong }}</td>
                            <td>{{ record.correct + record.wrong }}</td>
                            <td>
                              <span class="badge" :class="getAccuracyBadgeClass(record.correct, record.wrong)">
                                {{ Math.round(record.correct / (record.correct + record.wrong) * 100) }}%
                              </span>
                            </td>
                            <td class="text-muted">{{ formatTime(record.lastTime) }}</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- 数学内容 -->
          <div v-if="currentSubject.key === 'math'">
            <div class="nav-tabs-sticky">
              <ul class="nav nav-tabs" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link" 
                        :class="{ active: activeMathTab === 'numbers' }"
                        data-bs-toggle="tab" 
                        data-bs-target="#numbers" 
                        type="button" 
                        role="tab"
                        @click="setActiveTab('math', 'numbers')">数字认知</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" 
                        :class="{ active: activeMathTab === 'counting' }"
                        data-bs-toggle="tab" 
                        data-bs-target="#counting" 
                        type="button" 
                        role="tab"
                        @click="setActiveTab('math', 'counting')">数数练习</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link"
                        :class="{ active: activeMathTab === 'addition' }"
                        data-bs-toggle="tab"
                        data-bs-target="#addition"
                        type="button"
                        role="tab"
                        @click="setActiveTab('math', 'addition')">20以内加法</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link"
                        :class="{ active: activeMathTab === 'subtraction' }"
                        data-bs-toggle="tab"
                        data-bs-target="#subtraction"
                        type="button"
                        role="tab"
                        @click="setActiveTab('math', 'subtraction')">20以内减法</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link"
                        :class="{ active: activeMathTab === 'shapes' }"
                        data-bs-toggle="tab"
                        data-bs-target="#shapes"
                        type="button"
                        role="tab"
                        @click="setActiveTab('math', 'shapes')">图形认知</button>
              </li>
            </ul>
            </div>
            <div class="tab-content">
              <div class="tab-pane fade" 
                   :class="{ 'show active': activeMathTab === 'numbers' }" 
                   id="numbers" 
                   role="tabpanel">
                <h3 class="mt-3">数字1-20</h3>
                <div class="row">
                  <div v-for="n in 20" :key="n" class="col-3 col-md-2 mb-3">
                    <div class="number-card bg-light" @click="speak(n.toString())">
                      <div class="number">{{ n }}</div>
                      <div class="chinese-number text-muted small">{{ chineseNumbers[n-1] }}</div>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="tab-pane fade" 
                   :class="{ 'show active': activeMathTab === 'counting' }" 
                   id="counting" 
                   role="tabpanel">
                <h3 class="mt-3">数一数有几个？</h3>
                <div class="text-center my-4">
                  <div class="question-display">
                    <div class="d-flex justify-content-center flex-wrap">
                      <i v-for="i in countingQuestion.count" :key="i" class="bi bi-apple" style="font-size: 2rem; color: red; margin: 5px;"></i>
                    </div>
                  </div>
                  
                  <div class="options mt-4">
                    <div v-for="option in countingQuestion.options" :key="option" 
                         class="question-option d-inline-block mx-2" 
                         :class="{ selected: selectedCountingAnswer === option }"
                         @click="selectCountingAnswer(option)">
                      {{ option }}
                    </div>
                  </div>
                  
                  <div class="mt-3" v-if="countingResult !== null">
                    <div v-if="countingResult" class="text-success">
                      <i class="bi bi-check-circle-fill result-icon"></i>
                      <h4>答对了！真棒！</h4>
                    </div>
                    <div v-else class="text-danger">
                      <i class="bi bi-x-circle-fill result-icon"></i>
                      <h4>再试试看哦！</h4>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="tab-pane fade"
                   :class="{ 'show active': activeMathTab === 'addition' }"
                   id="addition"
                   role="tabpanel">
                <h3 class="mt-3">20以内加法练习</h3>

                <!-- 练习区域 -->
                <div class="practice-area">
                  <div class="text-center my-4">
                    <div class="question-display">
                      <h4>{{ additionQuestion.a }} + {{ additionQuestion.b }} = ?</h4>
                    </div>

                    <div class="options mt-4">
                      <div v-for="option in additionQuestion.options" :key="option"
                           class="question-option d-inline-block mx-2"
                           :class="{ selected: selectedAdditionAnswer === option }"
                           @click="selectAdditionAnswer(option)">
                        {{ option }}
                      </div>
                    </div>

                    <div class="mt-3" v-if="additionResult !== null">
                      <div v-if="additionResult" class="text-success">
                        <i class="bi bi-check-circle-fill result-icon"></i>
                        <h4>答对了！真棒！</h4>
                      </div>
                      <div v-else class="text-danger">
                        <i class="bi bi-x-circle-fill result-icon"></i>
                        <h4>再试试看哦！</h4>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- 统计卡片 -->
                <div class="stats-section mt-5">
                  <h4 class="mb-3">
                    <i class="bi bi-calendar-day"></i> 今日练习统计
                    <small class="text-muted ms-2">{{ getCurrentDateString() }}</small>
                  </h4>
                  <div class="row">
                    <div class="col-md-3 col-6 mb-3">
                      <div class="card bg-primary text-white">
                        <div class="card-body text-center">
                          <h5>总题数</h5>
                          <h3>{{ additionStats.totalQuestions }}</h3>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                      <div class="card bg-success text-white">
                        <div class="card-body text-center">
                          <h5>答对</h5>
                          <h3>{{ additionStats.correctAnswers }}</h3>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                      <div class="card bg-danger text-white">
                        <div class="card-body text-center">
                          <h5>答错</h5>
                          <h3>{{ additionStats.wrongAnswers }}</h3>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                      <div class="card bg-info text-white">
                        <div class="card-body text-center">
                          <h5>正确率</h5>
                          <h3>{{ additionStats.accuracy }}%</h3>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- 历史记录展开区域 -->
                <div class="history-section mt-5">
                  <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="mb-0">
                      <i class="bi bi-clock-history"></i> 答题历史
                    </h4>
                    <div>
                      <button class="btn btn-outline-primary btn-sm me-2"
                              @click="toggleHistoryExpanded">
                        <i class="bi" :class="historyExpanded ? 'bi-chevron-up' : 'bi-chevron-down'"></i>
                        {{ historyExpanded ? '收起' : '展开' }}详细记录
                      </button>
                      <button class="btn btn-outline-info btn-sm me-2"
                              @click="resetTodayStats"
                              v-if="additionStats.totalQuestions > 0">
                        <i class="bi bi-arrow-clockwise"></i> 重置今日
                      </button>
                      <button class="btn btn-outline-warning btn-sm"
                              @click="clearPracticeHistory('addition')"
                              v-if="Object.keys(additionHistory).length > 0">
                        <i class="bi bi-trash"></i> 清空全部
                      </button>
                    </div>
                  </div>

                  <!-- 简要统计 -->
                  <div class="history-summary p-3 bg-light rounded">
                    <div class="row text-center">
                      <div class="col-3">
                        <div class="fw-bold text-primary">{{ Object.keys(additionHistory).length }}</div>
                        <small class="text-muted">累计题目</small>
                      </div>
                      <div class="col-3">
                        <div class="fw-bold text-success">{{ allTimeStats.correctAnswers }}</div>
                        <small class="text-muted">累计答对</small>
                      </div>
                      <div class="col-3">
                        <div class="fw-bold text-danger">{{ allTimeStats.wrongAnswers }}</div>
                        <small class="text-muted">累计答错</small>
                      </div>
                      <div class="col-3">
                        <div class="fw-bold text-info">{{ allTimeStats.accuracy }}%</div>
                        <small class="text-muted">累计正确率</small>
                      </div>
                    </div>
                  </div>

                  <!-- 详细历史记录 -->
                  <div v-show="historyExpanded" class="history-details mt-3">
                    <div v-if="Object.keys(additionHistory).length === 0" class="text-center text-muted py-5">
                      <i class="bi bi-clipboard-x" style="font-size: 3rem;"></i>
                      <h5 class="mt-3">暂无历史记录</h5>
                      <p>开始练习加法题目后，这里会显示你的答题历史</p>
                    </div>

                    <div v-else class="table-responsive">
                      <table class="table table-striped table-hover">
                        <thead class="table-dark">
                          <tr>
                            <th>题目</th>
                            <th>正确次数</th>
                            <th>错误次数</th>
                            <th>总次数</th>
                            <th>正确率</th>
                            <th>最后答题时间</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr v-for="(record, question) in sortedAdditionHistory" :key="question">
                            <td class="fw-bold">{{ question }}</td>
                            <td class="text-success">{{ record.correct }}</td>
                            <td class="text-danger">{{ record.wrong }}</td>
                            <td>{{ record.correct + record.wrong }}</td>
                            <td>
                              <span class="badge" :class="getAccuracyBadgeClass(record.correct, record.wrong)">
                                {{ Math.round(record.correct / (record.correct + record.wrong) * 100) }}%
                              </span>
                            </td>
                            <td class="text-muted">{{ formatTime(record.lastTime) }}</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>

              <div class="tab-pane fade"
                   :class="{ 'show active': activeMathTab === 'subtraction' }"
                   id="subtraction"
                   role="tabpanel">
                <h3 class="mt-3">20以内减法练习</h3>

                <!-- 练习区域 -->
                <div class="practice-area">
                  <div class="text-center my-4">
                    <div class="question-display">
                      <h4>{{ subtractionQuestion.a }} - {{ subtractionQuestion.b }} = ?</h4>
                    </div>

                    <div class="options mt-4">
                      <div v-for="option in subtractionQuestion.options" :key="option"
                           class="question-option d-inline-block mx-2"
                           :class="{ selected: selectedSubtractionAnswer === option }"
                           @click="selectSubtractionAnswer(option)">
                        {{ option }}
                      </div>
                    </div>

                    <div class="mt-3" v-if="subtractionResult !== null">
                      <div v-if="subtractionResult" class="text-success">
                        <i class="bi bi-check-circle-fill result-icon"></i>
                        <h4>答对了！真棒！</h4>
                      </div>
                      <div v-else class="text-danger">
                        <i class="bi bi-x-circle-fill result-icon"></i>
                        <h4>再试试看哦！</h4>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- 统计卡片 -->
                <div class="stats-section mt-5">
                  <h4 class="mb-3">
                    <i class="bi bi-calendar-day"></i> 今日练习统计
                    <small class="text-muted ms-2">{{ getCurrentDateString() }}</small>
                  </h4>
                  <div class="row">
                    <div class="col-md-3 col-6 mb-3">
                      <div class="card bg-primary text-white">
                        <div class="card-body text-center">
                          <h5>总题数</h5>
                          <h3>{{ subtractionStats.totalQuestions }}</h3>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                      <div class="card bg-success text-white">
                        <div class="card-body text-center">
                          <h5>答对</h5>
                          <h3>{{ subtractionStats.correctAnswers }}</h3>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                      <div class="card bg-danger text-white">
                        <div class="card-body text-center">
                          <h5>答错</h5>
                          <h3>{{ subtractionStats.wrongAnswers }}</h3>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                      <div class="card bg-info text-white">
                        <div class="card-body text-center">
                          <h5>正确率</h5>
                          <h3>{{ subtractionStats.accuracy }}%</h3>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- 历史记录展开区域 -->
                <div class="history-section mt-5">
                  <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="mb-0">
                      <i class="bi bi-clock-history"></i> 答题历史
                    </h4>
                    <div>
                      <button class="btn btn-outline-primary btn-sm me-2"
                              @click="toggleHistoryExpanded">
                        <i class="bi" :class="historyExpanded ? 'bi-chevron-up' : 'bi-chevron-down'"></i>
                        {{ historyExpanded ? '收起' : '展开' }}详细记录
                      </button>
                      <button class="btn btn-outline-info btn-sm me-2"
                              @click="resetTodayStats('subtraction')"
                              v-if="subtractionStats.totalQuestions > 0">
                        <i class="bi bi-arrow-clockwise"></i> 重置今日
                      </button>
                      <button class="btn btn-outline-warning btn-sm"
                              @click="clearPracticeHistory('subtraction')"
                              v-if="Object.keys(subtractionHistory).length > 0">
                        <i class="bi bi-trash"></i> 清空全部
                      </button>
                    </div>
                  </div>

                  <!-- 简要统计 -->
                  <div class="history-summary p-3 bg-light rounded">
                    <div class="row text-center">
                      <div class="col-3">
                        <div class="fw-bold text-primary">{{ Object.keys(subtractionHistory).length }}</div>
                        <small class="text-muted">累计题目</small>
                      </div>
                      <div class="col-3">
                        <div class="fw-bold text-success">{{ subtractionAllTimeStats.correctAnswers }}</div>
                        <small class="text-muted">累计答对</small>
                      </div>
                      <div class="col-3">
                        <div class="fw-bold text-danger">{{ subtractionAllTimeStats.wrongAnswers }}</div>
                        <small class="text-muted">累计答错</small>
                      </div>
                      <div class="col-3">
                        <div class="fw-bold text-info">{{ subtractionAllTimeStats.accuracy }}%</div>
                        <small class="text-muted">累计正确率</small>
                      </div>
                    </div>
                  </div>

                  <!-- 详细历史记录 -->
                  <div v-show="historyExpanded" class="history-details mt-3">
                    <div v-if="Object.keys(subtractionHistory).length === 0" class="text-center text-muted py-5">
                      <i class="bi bi-clipboard-x" style="font-size: 3rem;"></i>
                      <h5 class="mt-3">暂无历史记录</h5>
                      <p>开始练习减法题目后，这里会显示你的答题历史</p>
                    </div>

                    <div v-else class="table-responsive">
                      <table class="table table-striped table-hover">
                        <thead class="table-dark">
                          <tr>
                            <th>题目</th>
                            <th>正确次数</th>
                            <th>错误次数</th>
                            <th>总次数</th>
                            <th>正确率</th>
                            <th>最后答题时间</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr v-for="(record, question) in sortedSubtractionHistory" :key="question">
                            <td class="fw-bold">{{ question }}</td>
                            <td class="text-success">{{ record.correct }}</td>
                            <td class="text-danger">{{ record.wrong }}</td>
                            <td>{{ record.correct + record.wrong }}</td>
                            <td>
                              <span class="badge" :class="getAccuracyBadgeClass(record.correct, record.wrong)">
                                {{ Math.round(record.correct / (record.correct + record.wrong) * 100) }}%
                              </span>
                            </td>
                            <td class="text-muted">{{ formatTime(record.lastTime) }}</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- 图形认知标签页内容 -->
              <div class="tab-pane fade"
                   :class="{ 'show active': activeMathTab === 'shapes' }"
                   id="shapes"
                   role="tabpanel">
                <h3 class="mt-3">图形认知</h3>
                <div class="row">
                  <div class="col-md-3 col-6 mb-4">
                    <div class="shape-card bg-light" @click="speak('圆形')">
                      <div class="shape-circle"></div>
                      <div class="shape-name text-center mt-2">圆形</div>
                    </div>
                  </div>
                  <div class="col-md-3 col-6 mb-4">
                    <div class="shape-card bg-light" @click="speak('正方形')">
                      <div class="shape-square"></div>
                      <div class="shape-name text-center mt-2">正方形</div>
                    </div>
                  </div>
                  <div class="col-md-3 col-6 mb-4">
                    <div class="shape-card bg-light" @click="speak('三角形')">
                      <div class="shape-triangle"></div>
                      <div class="shape-name text-center mt-2">三角形</div>
                    </div>
                  </div>
                  <div class="col-md-3 col-6 mb-4">
                    <div class="shape-card bg-light" @click="speak('长方形')">
                      <div class="shape-rectangle"></div>
                      <div class="shape-name text-center mt-2">长方形</div>
                    </div>
                  </div>
                  <div class="col-md-3 col-6 mb-4">
                    <div class="shape-card bg-light" @click="speak('椭圆形')">
                      <div class="shape-oval"></div>
                      <div class="shape-name text-center mt-2">椭圆形</div>
                    </div>
                  </div>
                  <div class="col-md-3 col-6 mb-4">
                    <div class="shape-card bg-light" @click="speak('五边形')">
                      <div class="shape-pentagon"></div>
                      <div class="shape-name text-center mt-2">五边形</div>
                    </div>
                  </div>
                  <div class="col-md-3 col-6 mb-4">
                    <div class="shape-card bg-light" @click="speak('六边形')">
                      <div class="shape-hexagon"></div>
                      <div class="shape-name text-center mt-2">六边形</div>
                    </div>
                  </div>
                  <div class="col-md-3 col-6 mb-4">
                    <div class="shape-card bg-light" @click="speak('星形')">
                      <div class="shape-star"></div>
                      <div class="shape-name text-center mt-2">星形</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- 英语内容 -->
          <div v-if="currentSubject.key === 'english'">
            <div class="nav-tabs-sticky">
              <ul class="nav nav-tabs" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link" 
                        :class="{ active: activeEnglishTab === 'alphabet' }"
                        data-bs-toggle="tab" 
                        data-bs-target="#alphabet" 
                        type="button" 
                        role="tab"
                        @click="setActiveTab('english', 'alphabet')">字母学习</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" 
                        :class="{ active: activeEnglishTab === 'words' }"
                        data-bs-toggle="tab" 
                        data-bs-target="#english-words" 
                        type="button" 
                        role="tab"
                        @click="setActiveTab('english', 'words')">单词学习</button>
              </li>
            </ul>
            </div>
            <div class="tab-content">
              <div class="tab-pane fade" 
                   :class="{ 'show active': activeEnglishTab === 'alphabet' }" 
                   id="alphabet" 
                   role="tabpanel">
                <h3 class="mt-3">英文字母</h3>
                <div class="row">
                  <div v-for="letter in english.alphabet" :key="letter" class="col-2 mb-3">
                    <div class="alphabet-card bg-light" @click="speak(letter)">
                      {{ letter }}
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="tab-pane fade" 
                   :class="{ 'show active': activeEnglishTab === 'words' }" 
                   id="english-words" 
                   role="tabpanel">
                <h3 class="mt-3">基础单词</h3>
                <div class="row">
                  <div v-for="word in english.loadWords() || []" :key="word.word" class="col-6 col-md-3 mb-3">
                    <div class="word-card bg-light" @click="speak(word.word)">
                      <img :data-emoji-code="word.emojiCode" 
                           :alt="word.word" 
                           class="word-image" 
                           loading="lazy"
                           @error="handleImageError($event, word.emojiCode)"
                           ref="lazyImage">
                      <div class="word">{{ word.word }}</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 页脚 -->
    <footer class="footer">
      <div class="container">
        <div class="row">
          <div class="col-md-6">
            <h5><i class="bi bi-info-circle"></i> 关于我们</h5>
            <p>幼儿园大班学习乐园致力于为孩子们提供有趣、互动、有效的学习体验。</p>
            <p>通过游戏化的学习方式，让孩子们在快乐中掌握基础知识。</p>
          </div>
          <div class="col-md-6">
            <h5><i class="bi bi-envelope"></i> 联系我们</h5>
            <div class="contact-info">
              <div class="contact-item">
                <i class="bi bi-qq"></i>
                <span>QQ号码：<strong>1638988</strong>（可添加微信）</span>
              </div>
              <div class="contact-item">
                <i class="bi bi-envelope"></i>
                <span>邮箱：<a href="mailto:1638988@qq.com">1638988@qq.com</a></span>
              </div>
              <div class="contact-item">
                <i class="bi bi-envelope"></i>
                <span>备用邮箱：<a href="mailto:chenping@live.cn">chenping@live.cn</a></span>
              </div>
              <div class="contact-item">
                <i class="bi bi-chat-dots"></i>
                <span>欢迎反馈问题或提出建议！</span>
              </div>
            </div>
          </div>
        </div>
        <div class="row mt-3">
          <div class="col-12 text-center">
            <p class="mb-0">&copy; 2025 幼儿园大班学习乐园. 让学习变得更有趣！</p>
          </div>
        </div>
      </div>
    </footer>
  </div>

  <script>
    // 全局定义防抖和节流函数，确保在Vue组件中可用
    // 简化的防抖函数
    const debounce = (fn, delay = 200) => {
      let timer = null;
      
      return function(...args) {
        if (timer) {
          clearTimeout(timer);
        }
        
        timer = setTimeout(() => {
          fn.apply(this, args);
        }, delay);
      };
    };

    // 简化的节流函数
    const throttle = (fn, delay = 300) => {
      let lastCall = 0;
      
      return function(...args) {
        const now = Date.now();
        if (now - lastCall >= delay) {
          lastCall = now;
          fn.apply(this, args);
        }
      };
    };
    
    // 页面加载时使用智能资源管理器加载资源
    document.addEventListener('DOMContentLoaded', function() {
      console.log('页面加载完成，开始智能加载资源...');
      
      if (window.smartResourceManager) {
        // 使用智能资源管理器重新加载CSS（会覆盖备用方案）
        setTimeout(() => {
          window.smartResourceManager.loadCSS('bootstrap-css');
          window.smartResourceManager.loadCSS('bootstrap-icons');
        }, 100);
        
        // 使用智能资源管理器加载JS
        window.smartResourceManager.loadJS('vue-js');
        window.smartResourceManager.loadJS('bootstrap-js');
        
        // 等待Vue.js加载完成后初始化应用
        const checkVueLoaded = setInterval(() => {
          if (window.Vue) {
            clearInterval(checkVueLoaded);
            console.log('Vue.js加载完成，初始化应用...');
            initializeApp();
          }
        }, 100);
      } else {
        console.warn('智能资源管理器未找到，使用备用方案...');
        // 备用方案 - 直接加载JS
        const fallbackJS = [
          'https://cdn.jsdelivr.net/npm/vue@3.3.4/dist/vue.global.min.js',
          'https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js'
        ];
        
        let loadedCount = 0;
        fallbackJS.forEach(src => {
          const script = document.createElement('script');
          script.src = src;
          script.onload = () => {
            loadedCount++;
            if (loadedCount === fallbackJS.length) {
              initializeApp();
            }
          };
          document.head.appendChild(script);
        });
      }
    });
  </script>
  
  <script>
    // 简化的Vue应用初始化
    function initializeApp() {
      if (!window.Vue) {
        console.error('Vue未加载，无法初始化应用');
        return;
      }
      
      const { createApp, ref, reactive, computed, onMounted, nextTick } = Vue;
      
      createApp({
        setup() {
          // 页面状态
          const currentPage = ref('home');
          const currentSubject = ref(null);
          
          // 标签页状态
          const activeChineseTab = ref('pinyin');
          const activeMathTab = ref('numbers');
          const activeEnglishTab = ref('alphabet');
          
          // 学科数据
          const subjects = {
            chinese: {
              key: 'chinese',
              title: '语文学习',
              icon: 'book'
            },
            math: {
              key: 'math',
              title: '数学学习',
              icon: 'calculator'
            },
            english: {
              key: 'english',
              title: '英语学习',
              icon: 'globe'
            }
          };
          
          // 语文内容 - 延迟加载优化
          const chinese = {
            // 基础数据立即加载
            initials: ['b', 'p', 'm', 'f', 'd', 't', 'n', 'l', 'g', 'k', 'h', 'j', 'q', 'x', 'zh', 'ch', 'sh', 'r', 'z', 'c', 's', 'y', 'w'],
            finals: ['a', 'o', 'e', 'i', 'u', 'ü', 'ai', 'ei', 'ui', 'ao', 'ou', 'iu', 'ie', 'üe', 'er', 'an', 'en', 'in', 'un', 'ün', 'ang', 'eng', 'ing', 'ong'],
            // 大数据集延迟加载
            _charactersLoaded: false,
            _wordsLoaded: false,
            _poemsLoaded: false,
            _idiomsLoaded: false,
            _sayingsLoaded: false,
            _fablesLoaded: false,
            _riddlesLoaded: false,
            characters: [
              // 数字汉字
              { char: '一', pinyin: 'yī' },
              { char: '二', pinyin: 'èr' },
              { char: '三', pinyin: 'sān' },
              { char: '四', pinyin: 'sì' },
              { char: '五', pinyin: 'wǔ' },
              { char: '六', pinyin: 'liù' },
              { char: '七', pinyin: 'qī' },
              { char: '八', pinyin: 'bā' },
              { char: '九', pinyin: 'jiǔ' },
              { char: '十', pinyin: 'shí' },
              { char: '百', pinyin: 'bǎi' },
              { char: '千', pinyin: 'qiān' },

              // 基础汉字
              { char: '人', pinyin: 'rén' },
              { char: '口', pinyin: 'kǒu' },
              { char: '手', pinyin: 'shǒu' },
              { char: '足', pinyin: 'zú' },
              { char: '目', pinyin: 'mù' },
              { char: '耳', pinyin: 'ěr' },
              { char: '心', pinyin: 'xīn' },
              { char: '头', pinyin: 'tóu' },

              // 自然类
              { char: '水', pinyin: 'shuǐ' },
              { char: '火', pinyin: 'huǒ' },
              { char: '山', pinyin: 'shān' },
              { char: '石', pinyin: 'shí' },
              { char: '田', pinyin: 'tián' },
              { char: '土', pinyin: 'tǔ' },
              { char: '木', pinyin: 'mù' },
              { char: '林', pinyin: 'lín' },
              { char: '森', pinyin: 'sēn' },
              { char: '日', pinyin: 'rì' },
              { char: '月', pinyin: 'yuè' },
              { char: '星', pinyin: 'xīng' },
              { char: '云', pinyin: 'yún' },
              { char: '雨', pinyin: 'yǔ' },
              { char: '风', pinyin: 'fēng' },
              { char: '雪', pinyin: 'xuě' },

              // 动物类
              { char: '牛', pinyin: 'niú' },
              { char: '马', pinyin: 'mǎ' },
              { char: '羊', pinyin: 'yáng' },
              { char: '猪', pinyin: 'zhū' },
              { char: '狗', pinyin: 'gǒu' },
              { char: '猫', pinyin: 'māo' },
              { char: '鸟', pinyin: 'niǎo' },
              { char: '鱼', pinyin: 'yú' },
              { char: '虫', pinyin: 'chóng' },

              // 植物类
              { char: '花', pinyin: 'huā' },
              { char: '草', pinyin: 'cǎo' },
              { char: '叶', pinyin: 'yè' },
              { char: '果', pinyin: 'guǒ' },

              // 家庭类
              { char: '爸', pinyin: 'bà' },
              { char: '妈', pinyin: 'mā' },
              { char: '爷', pinyin: 'yé' },
              { char: '奶', pinyin: 'nǎi' },
              { char: '哥', pinyin: 'gē' },
              { char: '姐', pinyin: 'jiě' },
              { char: '弟', pinyin: 'dì' },
              { char: '妹', pinyin: 'mèi' },

              // 常用字
              { char: '大', pinyin: 'dà' },
              { char: '小', pinyin: 'xiǎo' },
              { char: '多', pinyin: 'duō' },
              { char: '少', pinyin: 'shǎo' },
              { char: '好', pinyin: 'hǎo' },
              { char: '坏', pinyin: 'huài' },
              { char: '上', pinyin: 'shàng' },
              { char: '下', pinyin: 'xià' },
              { char: '左', pinyin: 'zuǒ' },
              { char: '右', pinyin: 'yòu' },
              { char: '前', pinyin: 'qián' },
              { char: '后', pinyin: 'hòu' },
              { char: '里', pinyin: 'lǐ' },
              { char: '外', pinyin: 'wài' },
              { char: '中', pinyin: 'zhōng' },
              { char: '来', pinyin: 'lái' },
              { char: '去', pinyin: 'qù' },
              { char: '有', pinyin: 'yǒu' },
              { char: '无', pinyin: 'wú' },
              { char: '是', pinyin: 'shì' },
              { char: '不', pinyin: 'bù' }
            ],
            words: [
              // 自然类
              { word: '太阳', pinyin: 'tài yáng' },
              { word: '月亮', pinyin: 'yuè liàng' },
              { word: '星星', pinyin: 'xīng xīng' },
              { word: '白云', pinyin: 'bái yún' },
              { word: '彩虹', pinyin: 'cǎi hóng' },
              { word: '大海', pinyin: 'dà hǎi' },
              { word: '河流', pinyin: 'hé liú' },
              { word: '高山', pinyin: 'gāo shān' },

              // 植物类
              { word: '花朵', pinyin: 'huā duǒ' },
              { word: '草地', pinyin: 'cǎo dì' },
              { word: '大树', pinyin: 'dà shù' },
              { word: '森林', pinyin: 'sēn lín' },
              { word: '果实', pinyin: 'guǒ shí' },
              { word: '种子', pinyin: 'zhǒng zi' },

              // 动物类
              { word: '小鸟', pinyin: 'xiǎo niǎo' },
              { word: '小鱼', pinyin: 'xiǎo yú' },
              { word: '蝴蝶', pinyin: 'hú dié' },
              { word: '蜜蜂', pinyin: 'mì fēng' },
              { word: '小猫', pinyin: 'xiǎo māo' },
              { word: '小狗', pinyin: 'xiǎo gǒu' },
              { word: '兔子', pinyin: 'tù zi' },
              { word: '熊猫', pinyin: 'xióng māo' },

              // 家庭类
              { word: '妈妈', pinyin: 'mā ma' },
              { word: '爸爸', pinyin: 'bà ba' },
              { word: '爷爷', pinyin: 'yé ye' },
              { word: '奶奶', pinyin: 'nǎi nai' },
              { word: '哥哥', pinyin: 'gē ge' },
              { word: '姐姐', pinyin: 'jiě jie' },
              { word: '弟弟', pinyin: 'dì di' },
              { word: '妹妹', pinyin: 'mèi mei' },
              { word: '家庭', pinyin: 'jiā tíng' },

              // 学习类
              { word: '老师', pinyin: 'lǎo shī' },
              { word: '学校', pinyin: 'xué xiào' },
              { word: '同学', pinyin: 'tóng xué' },
              { word: '朋友', pinyin: 'péng yǒu' },
              { word: '书本', pinyin: 'shū běn' },
              { word: '铅笔', pinyin: 'qiān bǐ' },
              { word: '橡皮', pinyin: 'xiàng pí' },
              { word: '课堂', pinyin: 'kè táng' },

              // 生活类
              { word: '房子', pinyin: 'fáng zi' },
              { word: '汽车', pinyin: 'qì chē' },
              { word: '玩具', pinyin: 'wán jù' },
              { word: '衣服', pinyin: 'yī fu' },
              { word: '鞋子', pinyin: 'xié zi' },
              { word: '帽子', pinyin: 'mào zi' },
              { word: '食物', pinyin: 'shí wù' },
              { word: '水果', pinyin: 'shuǐ guǒ' },
              { word: '蔬菜', pinyin: 'shū cài' },
              { word: '牛奶', pinyin: 'niú nǎi' }
            ],
            poems: [
              { title: '静夜思', author: '李白', content: '床前明月光，疑是地上霜。举头望明月，低头思故乡。', meaning: '这首诗描写了秋日夜晚，诗人看到月光洒在床前，以为是地上的霜，抬头望月，低头思念故乡的情景。' },
              { title: '春晓', author: '孟浩然', content: '春眠不觉晓，处处闻啼鸟。夜来风雨声，花落知多少。', meaning: '这首诗描写了春天早晨醒来后，听到鸟儿啼叫，想起夜里风雨声，不知有多少花儿被吹落的情景。' },
              { title: '咏鹅', author: '骆宾王', content: '鹅，鹅，鹅，曲项向天歌。白毛浮绿水，红掌拨清波。', meaning: '这首诗描写了鹅的形象，鹅弯曲着脖子向天鸣叫，白色的羽毛浮在绿色的水面上，红色的脚掌拨动着清澈的水波。' },
              { title: '登鹳雀楼', author: '王之涣', content: '白日依山尽，黄河入海流。欲穷千里目，更上一层楼。', meaning: '这首诗描写了诗人登楼远眺的所见所感，太阳依着山峦落下，黄河奔流入海，要想看到更远的景色，就要再上一层楼。' },
              { title: '悯农', author: '李绅', content: '锄禾日当午，汗滴禾下土。谁知盘中餐，粒粒皆辛苦。', meaning: '这首诗描写了农民在烈日下锄禾的辛苦劳作，表达了对农民辛勤劳动的同情和对粮食来之不易的感慨。' },
              { title: '江雪', author: '柳宗元', content: '千山鸟飞绝，万径人踪灭。孤舟蓑笠翁，独钓寒江雪。', meaning: '这首诗描绘了一幅江雪独钓的画面，千山万径都没有鸟飞人行的踪迹，只有一位老翁独自在江上雪中垂钓。' },
              { title: '草', author: '白居易', content: '离离原上草，一岁一枯荣。野火烧不尽，春风吹又生。', meaning: '这首诗描写了草原上的野草，一年一度枯萎又繁荣，野火烧不完，春风一吹又重新生长，赞美了草的顽强生命力。' },
              { title: '望庐山瀑布', author: '李白', content: '日照香炉生紫烟，遥看瀑布挂前川。飞流直下三千尺，疑是银河落九天。', meaning: '这首诗描写了庐山瀑布的壮观景象，阳光照射下香炉峰升起紫色烟雾，远看瀑布像挂在山前的白练，飞流直下，好像银河从天上落下来。' },
              { title: '早发白帝城', author: '李白', content: '朝辞白帝彩云间，千里江陵一日还。两岸猿声啼不住，轻舟已过万重山。', meaning: '这首诗描写了诗人从白帝城出发，乘船顺流而下的愉快心情，两岸猿猴的叫声还在耳边，轻快的小船已经穿过了万重山峦。' },
              { title: '黄鹤楼送孟浩然之广陵', author: '李白', content: '故人西辞黄鹤楼，烟花三月下扬州。孤帆远影碧空尽，唯见长江天际流。', meaning: '这首诗描写了诗人在黄鹤楼送别好友孟浩然去扬州，在烟花盛开的三月，看着朋友的船帆渐渐消失在碧空中，只见长江水滚滚流向天边。' },
              { title: '山行', author: '杜牧', content: '远上寒山石径斜，白云深处有人家。停车坐爱枫林晚，霜叶红于二月花。', meaning: '这首诗描写了秋天山中的美景，沿着弯曲的石径上山，白云深处有人家居住，停下车来欣赏枫林晚景，经霜的红叶比二月的花还要红艳。' },
              { title: '小池', author: '杨万里', content: '泉眼无声惜细流，树阴照水爱晴柔。小荷才露尖尖角，早有蜻蜓立上头。', meaning: '这首诗描写了初夏小池的美景，泉眼悄无声息地流淌着细流，树荫倒映在水中，小荷花刚刚露出尖尖的角，就有蜻蜓停在上面了。' },
              { title: '村居', author: '高鼎', content: '草长莺飞二月天，拂堤杨柳醉春烟。儿童散学归来早，忙趁东风放纸鸢。', meaning: '这首诗描写了二月春天的乡村景象，草木茂盛，黄莺飞舞，杨柳拂堤，孩子们放学回来得早，趁着东风放风筝。' },
              { title: '所见', author: '袁枚', content: '牧童骑黄牛，歌声振林樾。意欲捕鸣蝉，忽然闭口立。', meaning: '这首诗描写了一个牧童骑着黄牛，唱着歌，歌声在树林中回荡，突然想要捕捉鸣蝉，立刻停止歌唱，静静地站着的情景。' },
              { title: '赠汪伦', author: '李白', content: '李白乘舟将欲行，忽闻岸上踏歌声。桃花潭水深千尺，不及汪伦送我情。', meaning: '这首诗表达了诗人对朋友汪伦的深厚友谊，李白乘船要走时，听到岸上汪伦踏歌送别，桃花潭水虽然深达千尺，也比不上汪伦送别的深情。' }
            ],
            idioms: [
              // 数字成语
              { idiom: '一心一意', pinyin: 'yī xīn yī yì', meaning: '形容做事专心一意，一门心思。' },
              { idiom: '二话不说', pinyin: 'èr huà bù shuō', meaning: '形容说话干脆，行动果断。' },
              { idiom: '三心二意', pinyin: 'sān xīn èr yì', meaning: '形容意志不坚定，犹豫不决。' },
              { idiom: '四面八方', pinyin: 'sì miàn bā fāng', meaning: '形容各个方向，到处都是。' },
              { idiom: '五颜六色', pinyin: 'wǔ yán liù sè', meaning: '形容颜色繁多，色彩丰富。' },
              { idiom: '七上八下', pinyin: 'qī shàng bā xià', meaning: '形容心里慌乱不安。' },
              { idiom: '九牛一毛', pinyin: 'jiǔ niú yī máo', meaning: '形容极小的部分，微不足道。' },
              { idiom: '十全十美', pinyin: 'shí quán shí měi', meaning: '形容事物完美无缺。' },

              // 动物成语
              { idiom: '画龙点睛', pinyin: 'huà lóng diǎn jīng', meaning: '比喻在关键地方加上一笔，使作品更加生动。' },
              { idiom: '守株待兔', pinyin: 'shǒu zhū dài tù', meaning: '比喻不主动努力，只想不劳而获。' },
              { idiom: '亡羊补牢', pinyin: 'wáng yáng bǔ láo', meaning: '比喻出了问题及时补救，还不算晚。' },
              { idiom: '狐假虎威', pinyin: 'hú jiǎ hǔ wēi', meaning: '比喻依仗别人的威势欺压人。' },
              { idiom: '鸡鸣狗盗', pinyin: 'jī míng gǒu dào', meaning: '比喻有一技之长的人。' },

              // 自然成语
              { idiom: '春暖花开', pinyin: 'chūn nuǎn huā kāi', meaning: '形容春天气候温暖，花朵盛开。' },
              { idiom: '秋高气爽', pinyin: 'qiū gāo qì shuǎng', meaning: '形容秋天天空高远，气候凉爽。' },
              { idiom: '风和日丽', pinyin: 'fēng hé rì lì', meaning: '形容天气晴朗温和。' },
              { idiom: '鸟语花香', pinyin: 'niǎo yǔ huā xiāng', meaning: '形容春天美好的景象。' },

              // 品德成语
              { idiom: '助人为乐', pinyin: 'zhù rén wéi lè', meaning: '形容乐于帮助别人。' },
              { idiom: '诚实守信', pinyin: 'chéng shí shǒu xìn', meaning: '形容为人诚实，遵守诺言。' },
              { idiom: '勤学苦练', pinyin: 'qín xué kǔ liàn', meaning: '形容学习勤奋刻苦。' },
              { idiom: '团结友爱', pinyin: 'tuán jié yǒu ài', meaning: '形容大家和睦相处，互相关爱。' },

              // 学习成语
              { idiom: '学而时习', pinyin: 'xué ér shí xí', meaning: '形容经常复习学过的知识。' },
              { idiom: '温故知新', pinyin: 'wēn gù zhī xīn', meaning: '复习旧知识能够获得新的理解。' },
              { idiom: '百折不挠', pinyin: 'bǎi zhé bù náo', meaning: '形容意志坚强，不怕困难。' },
              { idiom: '持之以恒', pinyin: 'chí zhī yǐ héng', meaning: '形容做事有恒心，能够坚持。' }
            ],
            sayings: [
              { first: '八仙过海', second: '各显神通', explanation: '比喻各人有各人的本领或办法。' },
              { first: '小葱拌豆腐', second: '一清二白', explanation: '比喻为人清白纯洁。' },
              { first: '泥菩萨过河', second: '自身难保', explanation: '比喻自己都难以保全，更不用说保护别人了。' },
              { first: '猴子捞月亮', second: '空忙一场', explanation: '比喻做无法实现的事情，白费力气。' },
              { first: '孔夫子搬家', second: '尽是书(输)', explanation: '双关语，一方面指孔子家中书多，另一方面暗示总是失败。' },
              { first: '老太太吃汤圆', second: '囫囵吞', explanation: '比喻做事不细致，粗枝大叶。' },
              { first: '打破砂锅', second: '问到底', explanation: '比喻追根究底，一定要弄清楚。' },
              { first: '王八吃西瓜', second: '不知从哪下口', explanation: '比喻遇事犹豫不决，不知如何着手。' },
              { first: '竹篮打水', second: '一场空', explanation: '比喻白费力气，没有收获。' },
              { first: '和尚打伞', second: '无法无天', explanation: '双关语，和尚没有头发，打伞没有天，引申为不讲规矩法度。' },
              { first: '铁打的公鸡', second: '下不了蛋', explanation: '比喻不可能完成的事情。' },
              { first: '外甥打灯笼', second: '照旧(舅)', explanation: '双关语，照旧和照舅谐音，意思是按老规矩办事。' },
              { first: '猪八戒照镜子', second: '里外不是人', explanation: '比喻无论怎样都不讨好。' },
              { first: '秃子打伞', second: '无法(发)遮', explanation: '双关语，无法和无发谐音，比喻没有办法掩饰。' },
              { first: '偷鸡不成', second: '蚀把米', explanation: '比喻想占便宜反而吃了亏。' }
            ],
            fables: [
              { title: '守株待兔', content: '从前有个农夫，在田里耕作时，看见一只兔子撞在树桩上死了。他很高兴，捡起兔子就回家了。他想：如果每天都有兔子撞死在树桩上，那我就不用耕田了。于是他天天守在树桩旁，等待兔子撞树，结果田也荒了，兔子也没等到。', moral: '告诉我们不能坐等机会，而要通过自己的努力去创造机会。' },
              { title: '揠苗助长', content: '宋国有个农夫，很着急自己的禾苗长得太慢。有一天，他把禾苗一棵棵拔高一些，累得筋疲力尽。他回到家对家人说："今天真累啊，我帮助禾苗长高了。"他儿子跑去田里一看，禾苗都已经枯死了。', moral: '告诉我们做事不能违背自然规律，揠苗助长只会适得其反。' },
              { title: '滥竽充数', content: '齐宣王喜欢听300人一起吹竽。有个叫南郭的人不会吹竽，但他想得到俸禄，就混在吹竽的人群中假装吹奏。宣王死后，齐湣王即位，喜欢听独奏，要求300名吹竽者一个个表演。南郭害怕露馅，连夜逃走了。', moral: '告诉我们不要弄虚作假，否则总有露馅的一天。' },
              { title: '刻舟求剑', content: '春秋时期，一个楚国人坐船渡河，不小心把宝剑掉进河里。他立刻在船舷上刻了个记号，说："这是我的剑掉下去的地方。"船靠岸后，他从刻记号的地方跳入水中找剑。船已经向前行驶，而剑却沉在原地，这样找剑当然找不到。', moral: '告诉我们做事要懂得变通，不能死板教条。' },
              { title: '画蛇添足', content: '楚国有个祭祀的地方，几个人在那里喝酒。主人说谁先画完蛇就可以喝一杯酒。一个人很快画完了蛇，看别人还没画完，就得意地说："我还可以给蛇画脚呢！"他刚开始画脚，另一个人画完了蛇，抢过酒杯说："蛇本来没有脚，你画什么脚？"于是第二个人喝了酒。', moral: '告诉我们做事不要多此一举，否则会弄巧成拙。' },
              { title: '狐假虎威', content: '一只老虎抓到一只狐狸。狐狸说："你不能吃我，因为我是上天派来管理百兽的。如果你不信，我走在前面，你跟在后面，看看百兽是不是都害怕我。"老虎信以为真，跟在狐狸后面走。所有的动物看到它们都跑了。老虎以为是因为狐狸的威风，却不知道动物们是害怕它自己。', moral: '告诉我们不要被表象迷惑，要看清事物的本质。' },
              { title: '掩耳盗铃', content: '有个人想偷别人的铃铛，但他担心铃声会被别人听到。于是他捂住自己的耳朵，以为这样别人就听不到铃声了，结果当然是被发现了。', moral: '告诉我们自欺欺人是没有用的，逃避现实只会害了自己。' },
              { title: '亡羊补牢', content: '有个人养了很多羊，但羊圈有破洞，羊经常跑出去丢失。有人劝他修补羊圈，他说："已经丢了那么多羊了，现在修还有什么用？"后来他改变主意，把羊圈修好了，果然没有再丢羊。', moral: '告诉我们即使已经造成了损失，及时补救仍然可以避免更大的损失。' },
              { title: '塞翁失马', content: '边塞有个老人，他的马跑到胡人那里去了。大家都来安慰他，他却说："这未必不是福。"几个月后，那匹马带回来许多胡人的好马。大家都来祝贺他，他却说："这未必不是祸。"他的儿子喜欢骑马，结果从马上摔下来，摔断了腿。大家都来安慰他，他却说："这未必不是福。"一年后，胡人入侵，年轻人都去打仗，十个有九个死了，他儿子因为腿瘸没去，保住了性命。', moral: '告诉我们祸福相依，塞翁失马焉知非福。' },
              { title: '愚公移山', content: '太行山和王屋山之间住着一个九十岁的老人，名叫愚公。这两座山挡住了他家的出路，他决定带领全家人把山移走。有人笑他愚蠢，他说："我死了有儿子，儿子死了有孙子，子子孙孙无穷尽，而山不会增高，总有一天会被我们铲平。"天帝被他的决心感动，命令两位大力神把山搬走了。', moral: '告诉我们只要有坚定的信念和不懈的努力，再大的困难也能克服。' }
            ],
            // 谜语数据延迟加载
            riddles: null,
            
            // 延迟加载谜语数据的方法
            loadRiddles() {
              if (!this._riddlesLoaded) {
                this.riddles = {
                  word: [
                    { question: '一加一', answer: '王', explanation: '一横加一横成"王"字', showAnswer: false },
                     { question: '一人在内', answer: '囚', explanation: '人字在口字内', showAnswer: false },
                     { question: '一口吃掉牛尾巴', answer: '告', explanation: '口字吃掉牛字的尾巴', showAnswer: false },
                     { question: '八十八', answer: '米', explanation: '八十八写在一起像"米"字', showAnswer: false },
                     { question: '言字底下一张口', answer: '话', explanation: '言字底下加口字', showAnswer: false },
                     { question: '一个礼拜七天', answer: '周', explanation: '一个"礼拜"有七"天"，即"周"字', showAnswer: false },
                     { question: '一个人搬两个土', answer: '佳', explanation: '人字旁加两个土字', showAnswer: false },
                     { question: '一个口，两个口，三个口，四个口', answer: '吕', explanation: '两个口字叠在一起', showAnswer: false }
                  ],
                  object: [
                    { question: '远看像座山，近看一条线，从小到老都有它，没有它就缺半边', answer: '鼻子', explanation: '鼻子从远处看像座山，侧面看像一条线，人人都有', showAnswer: false },
                     { question: '一物生得巧，地位比人高，戴上御风寒，脱下有烦恼', answer: '帽子', explanation: '帽子戴在头上，可以御寒', showAnswer: false },
                     { question: '薄薄一张口，能啃硬骨头，吃肉不喝汤，吃瓜不嚼豆', answer: '菜刀', explanation: '菜刀可以切硬的东西，但不能盛汤', showAnswer: false },
                     { question: '身穿绿衣裳，肚里水汪汪，生的子儿多，个个黑脸膛', answer: '西瓜', explanation: '西瓜外皮绿色，里面多汁，籽多且黑', showAnswer: false },
                     { question: '头戴红缨帽，身穿绿罗袍，小时候是哑巴，老来咯咯叫', answer: '公鸡', explanation: '公鸡头上有红冠，小时候不会叫，长大后会打鸣', showAnswer: false },
                     { question: '一物像葫芦，肚里水常满，要是下得早，地上水汪汪', answer: '水壶', explanation: '水壶形状像葫芦，装满水，如果放下不小心会洒水', showAnswer: false }
                  ],
                  animal: [
                    { question: '说马不像马，路上没有它，若用它做药，要到海中抓', answer: '海马', explanation: '海马是海洋生物，形状像马但不是马，可入药', showAnswer: false },
                     { question: '黑黑皮肤黑眼珠，长长鼻子扫地溜，一身粗皮像穿铠，大象见了让三分', answer: '犀牛', explanation: '犀牛皮肤黑，鼻子长，皮厚，体型大', showAnswer: false },
                     { question: '身穿白袍子，头戴红帽子，走起路来一摇一摆，说话叽叽喳喳', answer: '鹅', explanation: '鹅身体白色，头上有红色部分，走路摇摆，叫声嘎嘎', showAnswer: false },
                     { question: '头顶两只角，身披大棉袄，农民好伙伴，耕地不用刀', answer: '黄牛', explanation: '黄牛有两只角，毛厚，是农民耕地的好帮手', showAnswer: false },
                     { question: '小小飞行员，嗡嗡满天飞，飞到西瓜上，搬不动西瓜尾', answer: '蜜蜂', explanation: '蜜蜂会飞，发出嗡嗡声，但力气小搬不动西瓜', showAnswer: false },
                     { question: '远看像只猫，近看不是猫，山中称大王，百兽都怕它', answer: '老虎', explanation: '老虎外形像大猫，是山中之王，百兽之王', showAnswer: false }
                  ]
                };
                this._riddlesLoaded = true;
              }
              return this.riddles;
            }
          };
          
          // 英语内容
          const english = {
            alphabet: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split(''),
            // 英语单词延迟加载
            words: null,
            _wordsLoaded: false,
            
            // 延迟加载英语单词数据的方法
            loadWords() {
              if (!this._wordsLoaded) {
                this.words = [
                  // 动物类
                  { word: 'Cat', emojiCode: '1f431' },
                  { word: 'Dog', emojiCode: '1f436' },
                  { word: 'Fish', emojiCode: '1f41f' },
                  { word: 'Bird', emojiCode: '1f426' },
                  { word: 'Rabbit', emojiCode: '1f430' },
                  { word: 'Bear', emojiCode: '1f43b' },
                  { word: 'Lion', emojiCode: '1f981' },
                  { word: 'Tiger', emojiCode: '1f405' },
                  { word: 'Elephant', emojiCode: '1f418' },
                  { word: 'Giraffe', emojiCode: '1f992' },
                  { word: 'Monkey', emojiCode: '1f412' },
                  { word: 'Pig', emojiCode: '1f437' },

                  // 食物类
                  { word: 'Apple', emojiCode: '1f34e' },
                  { word: 'Banana', emojiCode: '1f34c' },
                  { word: 'Orange', emojiCode: '1f34a' },
                  { word: 'Cake', emojiCode: '1f370' },
                  { word: 'Bread', emojiCode: '1f35e' },
                  { word: 'Milk', emojiCode: '1f95b' },
                  { word: 'Egg', emojiCode: '1f95a' },
                  { word: 'Ice cream', emojiCode: '1f368' },
                  { word: 'Cookie', emojiCode: '1f36a' },

                  // 颜色类
                  { word: 'Red', emojiCode: '1f534' },
                  { word: 'Blue', emojiCode: '1f535' },
                  { word: 'Yellow', emojiCode: '1f7e1' },
                  { word: 'Green', emojiCode: '1f7e2' },

                  // 身体部位
                  { word: 'Eye', emojiCode: '1f441' },
                  { word: 'Hand', emojiCode: '270b' },
                  { word: 'Foot', emojiCode: '1f9b6' },

                  // 家庭成员
                  { word: 'Mom', emojiCode: '1f469' },
                  { word: 'Dad', emojiCode: '1f468' },
                  { word: 'Baby', emojiCode: '1f476' },

                  // 物品类
                  { word: 'Ball', emojiCode: '1f3c0' },
                  { word: 'Book', emojiCode: '1f4d6' },
                  { word: 'Car', emojiCode: '1f697' },
                  { word: 'House', emojiCode: '1f3e0' },
                  { word: 'Tree', emojiCode: '1f333' },
                  { word: 'Flower', emojiCode: '1f33c' },
                  { word: 'Sun', emojiCode: '2600' },
                  { word: 'Moon', emojiCode: '1f319' },
                  { word: 'Star', emojiCode: '2b50' },
                  { word: 'Water', emojiCode: '1f4a7' },
                  { word: 'Fire', emojiCode: '1f525' }
                ];
                this._wordsLoaded = true;
              }
              return this.words;
            }
          };
          
          // 数学内容
          const chineseNumbers = ['一', '二', '三', '四', '五', '六', '七', '八', '九', '十', '十一', '十二', '十三', '十四', '十五', '十六', '十七', '十八', '十九', '二十'];
          
          // 数数练习题目
          const countingQuestion = reactive({
            count: 0,
            options: []
          });
          
          // 加法练习题目
          const additionQuestion = reactive({
            a: 0,
            b: 0,
            options: []
          });

          // 减法练习题目
          const subtractionQuestion = reactive({
            a: 0,
            b: 0,
            options: []
          });

          // 识字测试题目
          const characterQuestion = reactive({
            char: '',
            pinyin: '',
            options: []
          });

          // 用户选择的答案
          const selectedCountingAnswer = ref(null);
          const selectedAdditionAnswer = ref(null);
          const selectedSubtractionAnswer = ref(null);
          const selectedCharacterAnswer = ref(null);

          // 答题结果
          const countingResult = ref(null);
          const additionResult = ref(null);
          const subtractionResult = ref(null);
          const characterResult = ref(null);

          // 历史记录展开状态
          const historyExpanded = ref(false);

          // 加法练习历史记录
          const additionHistory = reactive({});

          // 加法练习统计数据（今日）
          const additionStats = reactive({
            totalQuestions: 0,
            correctAnswers: 0,
            wrongAnswers: 0,
            accuracy: 0
          });

          // 加法练习今日记录
          const additionTodayHistory = reactive({});

          // 加法练习累计统计数据
          const allTimeStats = reactive({
            totalQuestions: 0,
            correctAnswers: 0,
            wrongAnswers: 0,
            accuracy: 0
          });

          // 减法练习历史记录和统计数据
          const subtractionHistory = reactive({});
          const subtractionTodayHistory = reactive({});
          const subtractionStats = reactive({
            totalQuestions: 0,
            correctAnswers: 0,
            wrongAnswers: 0,
            accuracy: 0
          });
          const subtractionAllTimeStats = reactive({
            totalQuestions: 0,
            correctAnswers: 0,
            wrongAnswers: 0,
            accuracy: 0
          });

          // 识字测试历史记录和统计数据
          const characterHistory = reactive({});
          const characterTodayHistory = reactive({});
          const characterStats = reactive({
            totalQuestions: 0,
            correctAnswers: 0,
            wrongAnswers: 0,
            accuracy: 0
          });
          const characterAllTimeStats = reactive({
            totalQuestions: 0,
            correctAnswers: 0,
            wrongAnswers: 0,
            accuracy: 0
          });

          // 未来扩展示例：减法练习历史记录和统计数据
          // const subtractionHistory = reactive({});
          // const subtractionStats = reactive({
          //   totalQuestions: 0,
          //   correctAnswers: 0,
          //   wrongAnswers: 0,
          //   accuracy: 0
          // });

          // 未来扩展示例：数数练习历史记录和统计数据
          // const countingHistory = reactive({});
          // const countingStats = reactive({
          //   totalQuestions: 0,
          //   correctAnswers: 0,
          //   wrongAnswers: 0,
          //   accuracy: 0
          // });
          
          // 设置活动标签页（添加防抖功能，使用立即执行模式提高响应速度）
          // 简化的标签页设置函数
          const setActiveTab = debounce((subject, tab) => {
            // 检查是否是相同的标签页
            let currentTab = '';
            switch(subject) {
              case 'chinese':
                currentTab = activeChineseTab.value;
                break;
              case 'math':
                currentTab = activeMathTab.value;
                break;
              case 'english':
                currentTab = activeEnglishTab.value;
                break;
            }
            
            if (currentTab === tab) {
              return; // 如果是同一个标签页，不做任何操作
            }
            
            // 更新UI状态
            switch(subject) {
              case 'chinese':
                activeChineseTab.value = tab;
                break;
              case 'math':
                activeMathTab.value = tab;
                break;
              case 'english':
                activeEnglishTab.value = tab;
                break;
            }
            
            // 保存标签页状态到localStorage
            try {
              localStorage.setItem(`activeTab_${subject}`, tab);
            } catch (e) {
              console.warn('保存标签页状态失败:', e);
            }
            
            // 更新URL参数
            if (currentSubject.value) {
              try {
                const url = new URL(window.location);
                      url.searchParams.set('subject', currentSubject.value.key);
                
                switch(currentSubject.value.key) {
                  case 'chinese':
                    url.searchParams.set('tab', activeChineseTab.value);
                    break;
                  case 'math':
                    url.searchParams.set('tab', activeMathTab.value);
                    break;
                  case 'english':
                    url.searchParams.set('tab', activeEnglishTab.value);
                    break;
                }
                
                window.history.replaceState({}, '', url);
              } catch (e) {
                console.warn('更新URL参数失败:', e);
              }
            }
          }, 200); // 简化的防抖延迟
          
          // 从localStorage恢复标签页状态
          const restoreTabState = () => {
            const chineseTab = localStorage.getItem('activeTab_chinese');
            const mathTab = localStorage.getItem('activeTab_math');
            const englishTab = localStorage.getItem('activeTab_english');
            
            if (chineseTab) activeChineseTab.value = chineseTab;
            if (mathTab) activeMathTab.value = mathTab;
            if (englishTab) activeEnglishTab.value = englishTab;
          };
          
          
          
          // 防止快速点击学科选择的标志
          let isSelectingSubject = false;
          let lastSubjectSelectTime = 0;
          
          // 选择学科（添加防抖功能，使用立即执行模式提高响应速度）
          // 简化的学科选择函数
          const selectSubject = debounce((subjectKey, updateUrl = true) => {
            // 防止重复选择同一学科
            if (currentSubject.value && currentSubject.value.key === subjectKey) {
              return;
            }
            
            // 防止快速连续点击
            const now = Date.now();
            if (isSelectingSubject || (now - lastSubjectSelectTime < 300)) {
              return;
            }
            
            // 设置选择标志
            isSelectingSubject = true;
            lastSubjectSelectTime = now;
            
            // 更新UI状态
            currentSubject.value = subjects[subjectKey];
            currentPage.value = 'subject';
            
            // 延迟初始化题目，避免阻塞UI
            setTimeout(() => {
              if (subjectKey === 'math') {
                generateCountingQuestion();
                generateAdditionQuestion();
                generateSubtractionQuestion();
              } else if (subjectKey === 'chinese') {
                generateCharacterQuestion();
              }
              
              // 重置选择标志
              isSelectingSubject = false;
            }, 100); // 延迟100ms执行
            
            // 更新URL参数
            if (updateUrl) {
              try {
                const url = new URL(window.location);
                url.searchParams.set('subject', subjectKey);

                // 设置默认标签页
                let defaultTab = '';
                switch(subjectKey) {
                  case 'chinese':
                    defaultTab = activeChineseTab.value;
                    break;
                  case 'math':
                    defaultTab = activeMathTab.value;
                    break;
                  case 'english':
                    defaultTab = activeEnglishTab.value;
                    break;
                }

                url.searchParams.set('tab', defaultTab);
                window.history.replaceState({}, '', url);
              } catch (e) {
                console.warn('更新URL参数失败:', e);
              }
            }
          }, 200); // 简化的防抖延迟
          
          // 防止快速点击的标志
          let isSwitchingSubject = false;
          
          // 简化的学科和标签页选择函数
          const selectSubjectAndTab = debounce((subjectKey, tabKey) => {
            // 如果正在切换中，忽略新的点击
            if (isSwitchingSubject) {
              return;
            }
            
            // 检查是否是相同的学科和标签页
            if (currentSubject.value && currentSubject.value.key === subjectKey) {
              let currentTab = '';
              switch(subjectKey) {
                case 'chinese':
                  currentTab = activeChineseTab.value;
                  break;
                case 'math':
                  currentTab = activeMathTab.value;
                  break;
                case 'english':
                  currentTab = activeEnglishTab.value;
                  break;
              }
              
              if (currentTab === tabKey) {
                return; // 如果是同一个标签页，不做任何操作
              }
            }
            
            // 设置切换标志
            isSwitchingSubject = true;
            
            // 更新UI状态
            currentSubject.value = subjects[subjectKey];
            currentPage.value = 'subject';
            
            // 设置活动标签页
            switch(subjectKey) {
              case 'chinese':
                activeChineseTab.value = tabKey;
                break;
              case 'math':
                activeMathTab.value = tabKey;
                break;
              case 'english':
                activeEnglishTab.value = tabKey;
                break;
            }
            
            // 延迟初始化题目，避免阻塞UI
            setTimeout(() => {
              if (subjectKey === 'math') {
                generateCountingQuestion();
                generateAdditionQuestion();
                generateSubtractionQuestion();
              } else if (subjectKey === 'chinese') {
                generateCharacterQuestion();
              }
            }, 50); // 延迟50ms执行
            
            // 更新URL参数和本地存储
            try {
              // 保存标签页状态到localStorage
              localStorage.setItem(`activeTab_${subjectKey}`, tabKey);
              
              // 更新URL参数
              const url = new URL(window.location);
              url.searchParams.set('subject', subjectKey);
              url.searchParams.set('tab', tabKey);
              window.history.replaceState({}, '', url);
            } catch (e) {
              console.warn('更新URL参数或本地存储失败:', e);
            }
            
            // 预加载相关图片资源
            if (subjectKey === 'english' && tabKey === 'words') {
              setTimeout(() => {
                if (english.loadWords) {
                  const words = english.loadWords();
                  if (words && words.length > 0) {
                    const emojiCodes = words.map(word => word.emojiCode);
                    preloadImages(emojiCodes).then(() => {
                      console.log('英语单词图片预加载完成');
                    });
                  }
                }
              }, 100);
            }
            
            // 重置切换标志，允许下一次点击
            setTimeout(() => {
              isSwitchingSubject = false;
            }, 300); // 稍微长一点的延迟确保所有操作完成
          }, 200); // 简化的防抖延迟
          
          
          // 返回主页
          const goHome = () => {
            currentPage.value = 'home';
            currentSubject.value = null;
            
            // 清理URL参数
            const url = new URL(window.location);
            url.searchParams.delete('subject');
            url.searchParams.delete('tab');
            window.history.replaceState({}, '', url);
          };
          
          // 生成数数题目（优化版本）
          const generateCountingQuestion = () => {
            countingQuestion.count = Math.floor(Math.random() * 10) + 1; // 1-10
            const correctAnswer = countingQuestion.count;
            
            // 生成3个错误选项（更高效的方法）
            const options = new Set([correctAnswer]);
            const possibleWrongAnswers = [];
            
            // 预先生成可能的错误答案范围
            for (let i = 1; i <= 12; i++) {
              if (i !== correctAnswer) {
                possibleWrongAnswers.push(i);
              }
            }
            
            // 随机选择3个错误答案
            while (options.size < 4 && possibleWrongAnswers.length > 0) {
              const randomIndex = Math.floor(Math.random() * possibleWrongAnswers.length);
              options.add(possibleWrongAnswers[randomIndex]);
              possibleWrongAnswers.splice(randomIndex, 1);
            }
            
            countingQuestion.options = Array.from(options).sort(() => Math.random() - 0.5);
            selectedCountingAnswer.value = null;
            countingResult.value = null;
          };
          
          // 生成加法题目（优化版本）
          const generateAdditionQuestion = () => {
            additionQuestion.a = Math.floor(Math.random() * 10) + 1; // 1-10
            additionQuestion.b = Math.floor(Math.random() * 10) + 1; // 1-10，允许和超过10但不超过20
            const correctAnswer = additionQuestion.a + additionQuestion.b;
            
            // 生成3个错误选项（更高效的方法）
            const options = new Set([correctAnswer]);
            const possibleWrongAnswers = [];
            
            // 预先生成可能的错误答案范围
            for (let i = 0; i <= 20; i++) {
              if (i !== correctAnswer) {
                possibleWrongAnswers.push(i);
              }
            }
            
            // 随机选择3个错误答案
            while (options.size < 4 && possibleWrongAnswers.length > 0) {
              const randomIndex = Math.floor(Math.random() * possibleWrongAnswers.length);
              options.add(possibleWrongAnswers[randomIndex]);
              possibleWrongAnswers.splice(randomIndex, 1);
            }

            additionQuestion.options = Array.from(options).sort(() => Math.random() - 0.5);
            selectedAdditionAnswer.value = null;
            additionResult.value = null;
          };

          // 生成减法题目（优化版本）
          const generateSubtractionQuestion = () => {
            subtractionQuestion.a = Math.floor(Math.random() * 20) + 1; // 1-20
            subtractionQuestion.b = Math.floor(Math.random() * subtractionQuestion.a); // 0到a-1，确保结果不小于0
            const correctAnswer = subtractionQuestion.a - subtractionQuestion.b;
            
            // 生成3个错误选项（更高效的方法）
            const options = new Set([correctAnswer]);
            const possibleWrongAnswers = [];
            
            // 预先生成可能的错误答案范围
            for (let i = 0; i <= 20; i++) {
              if (i !== correctAnswer) {
                possibleWrongAnswers.push(i);
              }
            }
            
            // 随机选择3个错误答案
            while (options.size < 4 && possibleWrongAnswers.length > 0) {
              const randomIndex = Math.floor(Math.random() * possibleWrongAnswers.length);
              options.add(possibleWrongAnswers[randomIndex]);
              possibleWrongAnswers.splice(randomIndex, 1);
            }

            subtractionQuestion.options = Array.from(options).sort(() => Math.random() - 0.5);
            selectedSubtractionAnswer.value = null;
            subtractionResult.value = null;
          };

          // 生成识字测试题目（优化版本）
          const generateCharacterQuestion = () => {
            const characters = chinese.characters;
            const randomIndex = Math.floor(Math.random() * characters.length);
            const selectedChar = characters[randomIndex];

            characterQuestion.char = selectedChar.char;
            characterQuestion.pinyin = selectedChar.pinyin;

            const options = new Set([selectedChar.pinyin]);
            const possibleWrongPinyins = [];
            
            // 预先生成可能的错误拼音选项
            for (let i = 0; i < characters.length; i++) {
              if (characters[i].pinyin !== selectedChar.pinyin) {
                possibleWrongPinyins.push(characters[i].pinyin);
              }
            }

            // 随机选择3个错误选项
            while (options.size < 4 && possibleWrongPinyins.length > 0) {
              const randomIndex = Math.floor(Math.random() * possibleWrongPinyins.length);
              options.add(possibleWrongPinyins[randomIndex]);
              possibleWrongPinyins.splice(randomIndex, 1);
            }

            characterQuestion.options = Array.from(options).sort(() => Math.random() - 0.5);
            selectedCharacterAnswer.value = null;
            characterResult.value = null;
          };
          
          // 选择答案并立即提交
          const selectCountingAnswer = (answer) => {
            selectedCountingAnswer.value = answer;
            // 自动检查答案
            checkCountingAnswer();
            // 1.5秒后自动进入下一题
            setTimeout(() => {
              nextCountingQuestion();
            }, 1500);
          };
          
          const selectAdditionAnswer = (answer) => {
            selectedAdditionAnswer.value = answer;
            // 自动检查答案
            checkAdditionAnswer();
            // 记录答题历史
            recordAdditionAnswer(answer);
            // 1.5秒后自动进入下一题
            setTimeout(() => {
              nextAdditionQuestion();
            }, 1500);
          };

          const selectSubtractionAnswer = (answer) => {
            selectedSubtractionAnswer.value = answer;
            // 自动检查答案
            checkSubtractionAnswer();
            // 记录答题历史
            recordSubtractionAnswer(answer);
            // 1.5秒后自动进入下一题
            setTimeout(() => {
              nextSubtractionQuestion();
            }, 1500);
          };

          const selectCharacterAnswer = (answer) => {
            selectedCharacterAnswer.value = answer;
            // 自动检查答案
            checkCharacterAnswer();
            // 记录答题历史
            recordCharacterAnswer(answer);
            // 1.5秒后自动进入下一题
            setTimeout(() => {
              nextCharacterQuestion();
            }, 1500);
          };
          
          // 检查答案
          const checkCountingAnswer = () => {
            countingResult.value = selectedCountingAnswer.value === countingQuestion.count;
          };

          const checkAdditionAnswer = () => {
            additionResult.value = selectedAdditionAnswer.value === (additionQuestion.a + additionQuestion.b);
          };

          const checkSubtractionAnswer = () => {
            subtractionResult.value = selectedSubtractionAnswer.value === (subtractionQuestion.a - subtractionQuestion.b);
          };

          const checkCharacterAnswer = () => {
            characterResult.value = selectedCharacterAnswer.value === characterQuestion.pinyin;
          };
          
          // 下一题
          const nextCountingQuestion = () => {
            generateCountingQuestion();
          };

          const nextAdditionQuestion = () => {
            generateAdditionQuestion();
          };

          const nextSubtractionQuestion = () => {
            generateSubtractionQuestion();
          };

          const nextCharacterQuestion = () => {
            generateCharacterQuestion();
          };
          
          // 通用的练习答题记录方法
          const recordPracticeAnswer = (practiceType, question, userAnswer, correctAnswer) => {
            let history, saveFunction;

            // 根据练习类型选择对应的数据结构
            switch(practiceType) {
              case 'addition':
                history = additionHistory;
                saveFunction = saveAdditionHistory;
                break;
              case 'subtraction':
                history = subtractionHistory;
                saveFunction = saveSubtractionHistory;
                break;
              case 'character':
                history = characterHistory;
                saveFunction = saveCharacterHistory;
                break;
              default:
                console.warn(`未知的练习类型: ${practiceType}`);
                return;
            }

            const isCorrect = userAnswer === correctAnswer;

            // 初始化题目记录
            if (!history[question]) {
              history[question] = {
                correct: 0,
                wrong: 0,
                lastTime: null
              };
            }

            // 更新记录
            if (isCorrect) {
              history[question].correct++;
            } else {
              history[question].wrong++;
            }

            history[question].lastTime = new Date().toISOString();

            // 保存到localStorage
            saveFunction();

            // 重新计算今日统计
            switch(practiceType) {
              case 'addition':
                calculateTodayStats();
                break;
              case 'subtraction':
                calculateSubtractionStats();
                break;
              case 'character':
                calculateCharacterStats();
                break;
            }
          };

          // 专用的记录方法
          const recordAdditionAnswer = (answer) => {
            const question = `${additionQuestion.a} + ${additionQuestion.b}`;
            const correctAnswer = additionQuestion.a + additionQuestion.b;
            recordPracticeAnswer('addition', question, answer, correctAnswer);
          };

          const recordSubtractionAnswer = (answer) => {
            const question = `${subtractionQuestion.a} - ${subtractionQuestion.b}`;
            const correctAnswer = subtractionQuestion.a - subtractionQuestion.b;
            recordPracticeAnswer('subtraction', question, answer, correctAnswer);
          };

          const recordCharacterAnswer = (answer) => {
            const question = `${characterQuestion.char} - ${characterQuestion.pinyin}`;
            const correctAnswer = characterQuestion.pinyin;
            recordPracticeAnswer('character', question, answer, correctAnswer);
          };

          // 保存历史记录到localStorage
          const saveAdditionHistory = () => {
            localStorage.setItem('additionHistory', JSON.stringify(additionHistory));
          };

          const saveSubtractionHistory = () => {
            localStorage.setItem('subtractionHistory', JSON.stringify(subtractionHistory));
          };

          const saveCharacterHistory = () => {
            localStorage.setItem('characterHistory', JSON.stringify(characterHistory));
          };

          // 从localStorage加载历史记录
          const loadAdditionHistory = () => {
            const savedHistory = localStorage.getItem('additionHistory');
            const savedExpanded = localStorage.getItem('historyExpanded');

            if (savedHistory) {
              const parsedHistory = JSON.parse(savedHistory);
              Object.assign(additionHistory, parsedHistory);
            }

            if (savedExpanded) {
              historyExpanded.value = savedExpanded === 'true';
            }

            // 加载完成后计算今日统计
            calculateTodayStats();
          };

          const loadSubtractionHistory = () => {
            const savedHistory = localStorage.getItem('subtractionHistory');

            if (savedHistory) {
              const parsedHistory = JSON.parse(savedHistory);
              Object.assign(subtractionHistory, parsedHistory);
            }

            // 加载完成后计算统计
            calculateSubtractionStats();
          };

          const loadCharacterHistory = () => {
            const savedHistory = localStorage.getItem('characterHistory');

            if (savedHistory) {
              const parsedHistory = JSON.parse(savedHistory);
              Object.assign(characterHistory, parsedHistory);
            }

            // 加载完成后计算统计
            calculateCharacterStats();
          };

          // 切换历史记录展开状态
          const toggleHistoryExpanded = () => {
            historyExpanded.value = !historyExpanded.value;
            // 保存展开状态到localStorage
            localStorage.setItem('historyExpanded', historyExpanded.value.toString());
          };

          // 重置今日统计（清除今日的答题记录）
          const resetTodayStats = (practiceType = 'addition') => {
            const practiceNames = {
              'addition': '加法练习',
              'subtraction': '减法练习',
              'character': '识字测试'
            };

            const practiceName = practiceNames[practiceType] || '练习';

            if (confirm(`确定要重置今日${practiceName}统计吗？这将清除今天的所有答题记录，但保留历史记录。`)) {
              let history, saveFunction, calculateFunction;

              switch(practiceType) {
                case 'addition':
                  history = additionHistory;
                  saveFunction = saveAdditionHistory;
                  calculateFunction = calculateTodayStats;
                  break;
                case 'subtraction':
                  history = subtractionHistory;
                  saveFunction = saveSubtractionHistory;
                  calculateFunction = calculateSubtractionStats;
                  break;
                case 'character':
                  history = characterHistory;
                  saveFunction = saveCharacterHistory;
                  calculateFunction = calculateCharacterStats;
                  break;
                default:
                  return;
              }

              // 遍历历史记录，清除今日的答题次数
              Object.entries(history).forEach(([question, record]) => {
                if (isToday(record.lastTime)) {
                  delete history[question];
                }
              });

              // 保存更改并重新计算统计
              saveFunction();
              calculateFunction();
            }
          };

          // 通用的练习历史记录清空方法
          const clearPracticeHistory = (practiceType) => {
            const practiceNames = {
              'addition': '加法练习',
              'subtraction': '减法练习',
              'character': '识字测试'
            };

            const practiceName = practiceNames[practiceType] || '练习';

            if (confirm(`确定要清空${practiceName}的所有历史记录吗？此操作不可恢复。`)) {
              switch(practiceType) {
                case 'addition':
                  Object.keys(additionHistory).forEach(key => delete additionHistory[key]);
                  Object.keys(additionTodayHistory).forEach(key => delete additionTodayHistory[key]);
                  additionStats.totalQuestions = 0;
                  additionStats.correctAnswers = 0;
                  additionStats.wrongAnswers = 0;
                  additionStats.accuracy = 0;
                  allTimeStats.totalQuestions = 0;
                  allTimeStats.correctAnswers = 0;
                  allTimeStats.wrongAnswers = 0;
                  allTimeStats.accuracy = 0;
                  saveAdditionHistory();
                  break;
                case 'subtraction':
                  Object.keys(subtractionHistory).forEach(key => delete subtractionHistory[key]);
                  Object.keys(subtractionTodayHistory).forEach(key => delete subtractionTodayHistory[key]);
                  subtractionStats.totalQuestions = 0;
                  subtractionStats.correctAnswers = 0;
                  subtractionStats.wrongAnswers = 0;
                  subtractionStats.accuracy = 0;
                  subtractionAllTimeStats.totalQuestions = 0;
                  subtractionAllTimeStats.correctAnswers = 0;
                  subtractionAllTimeStats.wrongAnswers = 0;
                  subtractionAllTimeStats.accuracy = 0;
                  saveSubtractionHistory();
                  break;
                case 'character':
                  Object.keys(characterHistory).forEach(key => delete characterHistory[key]);
                  Object.keys(characterTodayHistory).forEach(key => delete characterTodayHistory[key]);
                  characterStats.totalQuestions = 0;
                  characterStats.correctAnswers = 0;
                  characterStats.wrongAnswers = 0;
                  characterStats.accuracy = 0;
                  characterAllTimeStats.totalQuestions = 0;
                  characterAllTimeStats.correctAnswers = 0;
                  characterAllTimeStats.wrongAnswers = 0;
                  characterAllTimeStats.accuracy = 0;
                  saveCharacterHistory();
                  break;
              }
            }
          };

          // 获取正确率徽章样式
          const getAccuracyBadgeClass = (correct, wrong) => {
            const accuracy = correct / (correct + wrong) * 100;
            if (accuracy >= 90) return 'bg-success';
            if (accuracy >= 70) return 'bg-warning';
            return 'bg-danger';
          };

          // 格式化时间显示
          const formatTime = (timeString) => {
            if (!timeString) return '未知';
            const date = new Date(timeString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);

            if (diffMins < 1) return '刚刚';
            if (diffMins < 60) return `${diffMins}分钟前`;
            if (diffHours < 24) return `${diffHours}小时前`;
            if (diffDays < 7) return `${diffDays}天前`;

            return date.toLocaleDateString('zh-CN', {
              year: 'numeric',
              month: 'short',
              day: 'numeric',
              hour: '2-digit',
              minute: '2-digit'
            });
          };

          // 获取当前日期字符串（YYYY-MM-DD格式）
          const getCurrentDateString = () => {
            const today = new Date();
            return today.toLocaleDateString('zh-CN', {
              year: 'numeric',
              month: '2-digit',
              day: '2-digit'
            }).replace(/\//g, '-');
          };

          // 检查是否为今天的记录
          const isToday = (timeString) => {
            if (!timeString) return false;
            const recordDate = new Date(timeString);
            const today = new Date();
            return recordDate.toDateString() === today.toDateString();
          };

          // 计算今日统计和累计统计数据
          const calculateTodayStats = () => {
            let todayCorrect = 0;
            let todayWrong = 0;
            let todayTotal = 0;

            let allTimeCorrect = 0;
            let allTimeWrong = 0;
            let allTimeTotal = 0;

            // 清空今日历史记录
            Object.keys(additionTodayHistory).forEach(key => delete additionTodayHistory[key]);

            // 遍历所有历史记录
            Object.entries(additionHistory).forEach(([question, record]) => {
              // 累计所有时间的统计
              allTimeCorrect += record.correct;
              allTimeWrong += record.wrong;
              allTimeTotal += record.correct + record.wrong;

              // 筛选今日的记录
              if (isToday(record.lastTime)) {
                // 添加到今日历史记录
                additionTodayHistory[question] = { ...record };

                // 累计今日统计
                todayCorrect += record.correct;
                todayWrong += record.wrong;
                todayTotal += record.correct + record.wrong;
              }
            });

            // 更新今日统计数据
            additionStats.totalQuestions = todayTotal;
            additionStats.correctAnswers = todayCorrect;
            additionStats.wrongAnswers = todayWrong;
            additionStats.accuracy = todayTotal > 0
              ? Math.round((todayCorrect / todayTotal) * 100)
              : 0;

            // 更新累计统计数据
            allTimeStats.totalQuestions = allTimeTotal;
            allTimeStats.correctAnswers = allTimeCorrect;
            allTimeStats.wrongAnswers = allTimeWrong;
            allTimeStats.accuracy = allTimeTotal > 0
              ? Math.round((allTimeCorrect / allTimeTotal) * 100)
              : 0;
          };

          // 计算减法练习统计数据
          const calculateSubtractionStats = () => {
            let todayCorrect = 0, todayWrong = 0, todayTotal = 0;
            let allTimeCorrect = 0, allTimeWrong = 0, allTimeTotal = 0;

            Object.keys(subtractionTodayHistory).forEach(key => delete subtractionTodayHistory[key]);

            Object.entries(subtractionHistory).forEach(([question, record]) => {
              allTimeCorrect += record.correct;
              allTimeWrong += record.wrong;
              allTimeTotal += record.correct + record.wrong;

              if (isToday(record.lastTime)) {
                subtractionTodayHistory[question] = { ...record };
                todayCorrect += record.correct;
                todayWrong += record.wrong;
                todayTotal += record.correct + record.wrong;
              }
            });

            subtractionStats.totalQuestions = todayTotal;
            subtractionStats.correctAnswers = todayCorrect;
            subtractionStats.wrongAnswers = todayWrong;
            subtractionStats.accuracy = todayTotal > 0 ? Math.round((todayCorrect / todayTotal) * 100) : 0;

            subtractionAllTimeStats.totalQuestions = allTimeTotal;
            subtractionAllTimeStats.correctAnswers = allTimeCorrect;
            subtractionAllTimeStats.wrongAnswers = allTimeWrong;
            subtractionAllTimeStats.accuracy = allTimeTotal > 0 ? Math.round((allTimeCorrect / allTimeTotal) * 100) : 0;
          };

          // 计算识字测试统计数据
          const calculateCharacterStats = () => {
            let todayCorrect = 0, todayWrong = 0, todayTotal = 0;
            let allTimeCorrect = 0, allTimeWrong = 0, allTimeTotal = 0;

            Object.keys(characterTodayHistory).forEach(key => delete characterTodayHistory[key]);

            Object.entries(characterHistory).forEach(([question, record]) => {
              allTimeCorrect += record.correct;
              allTimeWrong += record.wrong;
              allTimeTotal += record.correct + record.wrong;

              if (isToday(record.lastTime)) {
                characterTodayHistory[question] = { ...record };
                todayCorrect += record.correct;
                todayWrong += record.wrong;
                todayTotal += record.correct + record.wrong;
              }
            });

            characterStats.totalQuestions = todayTotal;
            characterStats.correctAnswers = todayCorrect;
            characterStats.wrongAnswers = todayWrong;
            characterStats.accuracy = todayTotal > 0 ? Math.round((todayCorrect / todayTotal) * 100) : 0;

            characterAllTimeStats.totalQuestions = allTimeTotal;
            characterAllTimeStats.correctAnswers = allTimeCorrect;
            characterAllTimeStats.wrongAnswers = allTimeWrong;
            characterAllTimeStats.accuracy = allTimeTotal > 0 ? Math.round((allTimeCorrect / allTimeTotal) * 100) : 0;
          };

          // 语音播放功能（简化版）
          const speak = (text) => {
            console.log("播放语音: " + text);
          };

          // 图片预加载缓存
          const imageCache = new Map();
          const preloadQueue = new Set();
          
          // 获取emoji图片URL（使用可靠的CDN）
          const getEmojiImageUrl = (emojiCode) => {
            return `https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/${emojiCode}.png`;
          };

          // 预加载图片
          const preloadImage = (emojiCode) => {
            return new Promise((resolve, reject) => {
              if (imageCache.has(emojiCode)) {
                resolve(imageCache.get(emojiCode));
                return;
              }
              
              if (preloadQueue.has(emojiCode)) {
                // 如果正在加载，等待加载完成
                const checkLoaded = setInterval(() => {
                  if (imageCache.has(emojiCode)) {
                    clearInterval(checkLoaded);
                    resolve(imageCache.get(emojiCode));
                  }
                }, 50);
                return;
              }
              
              preloadQueue.add(emojiCode);
              const img = new Image();
              const url = getEmojiImageUrl(emojiCode);
              
              img.onload = () => {
                imageCache.set(emojiCode, url);
                preloadQueue.delete(emojiCode);
                resolve(url);
              };
              
              img.onerror = () => {
                preloadQueue.delete(emojiCode);
                reject(new Error(`图片加载失败: ${emojiCode}`));
              };
              
              img.src = url;
            });
          };
          
          // 批量预加载图片
          const preloadImages = (emojiCodes) => {
            const promises = emojiCodes.map(code => 
              preloadImage(code).catch(err => {
                console.warn(err.message);
                return null;
              })
            );
            return Promise.allSettled(promises);
          };

          // 处理图片加载错误
          const handleImageError = (event, emojiCode) => {
            console.warn(`图片加载失败: ${emojiCode}`);
            // 显示占位符
            event.target.style.display = 'none';
            const placeholder = document.createElement('div');
            placeholder.className = 'image-placeholder';
            placeholder.innerHTML = '<i class="bi bi-image"></i>';
            event.target.parentNode.insertBefore(placeholder, event.target);
          };
          
          // 懒加载图片观察器
          const imageObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
              if (entry.isIntersecting) {
                const img = entry.target;
                const emojiCode = img.dataset.emojiCode;
                
                if (emojiCode && !img.src) {
                  // 从缓存获取或加载图片
                  if (imageCache.has(emojiCode)) {
                    img.src = imageCache.get(emojiCode);
                  } else {
                    preloadImage(emojiCode)
                      .then(url => {
                        if (img.dataset.emojiCode === emojiCode) {
                          img.src = url;
                        }
                      })
                      .catch(() => {
                        handleImageError({ target: img }, emojiCode);
                      });
                  }
                  
                  imageObserver.unobserve(img);
                }
              }
            });
          }, {
            rootMargin: '50px'
          });
          
          // 计算属性：按最后答题时间排序的历史记录
          const sortedAdditionHistory = computed(() => {
            const entries = Object.entries(additionHistory);
            return entries.sort((a, b) => {
              const timeA = new Date(a[1].lastTime || 0);
              const timeB = new Date(b[1].lastTime || 0);
              return timeB - timeA; // 最新的在前
            }).reduce((obj, [key, value]) => {
              obj[key] = value;
              return obj;
            }, {});
          });

          const sortedSubtractionHistory = computed(() => {
            const entries = Object.entries(subtractionHistory);
            return entries.sort((a, b) => {
              const timeA = new Date(a[1].lastTime || 0);
              const timeB = new Date(b[1].lastTime || 0);
              return timeB - timeA;
            }).reduce((obj, [key, value]) => {
              obj[key] = value;
              return obj;
            }, {});
          });

          const sortedCharacterHistory = computed(() => {
            const entries = Object.entries(characterHistory);
            return entries.sort((a, b) => {
              const timeA = new Date(a[1].lastTime || 0);
              const timeB = new Date(b[1].lastTime || 0);
              return timeB - timeA;
            }).reduce((obj, [key, value]) => {
              obj[key] = value;
              return obj;
            }, {});
          });

          // 组件挂载时恢复状态
          onMounted(() => {
            restoreTabState();
            loadAdditionHistory(); // 加载加法练习历史记录
            loadSubtractionHistory(); // 加载减法练习历史记录
            loadCharacterHistory(); // 加载识字测试历史记录

            // 从URL参数恢复状态
            const urlParams = new URLSearchParams(window.location.search);
            const subjectParam = urlParams.get('subject');
            const tabParam = urlParams.get('tab');

            if (subjectParam && subjects[subjectParam]) {
              selectSubject(subjectParam, false); // 不更新URL，因为我们正在从URL恢复

              if (tabParam) {
                setTimeout(() => {
                  setActiveTab(subjectParam, tabParam);
                }, 0);
              }
            }
            
            // 初始化懒加载观察器
            nextTick(() => {
              const initLazyImages = () => {
                const lazyImages = document.querySelectorAll('img[data-emoji-code]:not([data-lazy-observed])');
                lazyImages.forEach(img => {
                  img.setAttribute('data-lazy-observed', 'true');
                  imageObserver.observe(img);
                });
              };
              
              // 初始化现有图片
              initLazyImages();
              
              // 监听DOM变化，处理动态添加的图片
              const mutationObserver = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                  if (mutation.type === 'childList') {
                    mutation.addedNodes.forEach((node) => {
                      if (node.nodeType === Node.ELEMENT_NODE) {
                        // 检查新添加的节点是否包含需要懒加载的图片
                        const newImages = node.querySelectorAll ? 
                          node.querySelectorAll('img[data-emoji-code]:not([data-lazy-observed])') : [];
                        newImages.forEach(img => {
                          img.setAttribute('data-lazy-observed', 'true');
                          imageObserver.observe(img);
                        });
                        
                        // 检查节点本身是否是需要懒加载的图片
                        if (node.tagName === 'IMG' && node.hasAttribute('data-emoji-code') && !node.hasAttribute('data-lazy-observed')) {
                          node.setAttribute('data-lazy-observed', 'true');
                          imageObserver.observe(node);
                        }
                      }
                    });
                  }
                });
              });
              
              // 开始观察DOM变化
              mutationObserver.observe(document.body, {
                childList: true,
                subtree: true
              });
              
              // 预加载当前可见区域的图片
              if (english.loadWords) {
                const words = english.loadWords();
                if (words && words.length > 0) {
                  // 预加载前8个图片（通常在首屏显示）
                  const firstScreenEmojis = words.slice(0, 8).map(word => word.emojiCode);
                  preloadImages(firstScreenEmojis).then(() => {
                    console.log('首屏图片预加载完成');
                  });
                  
                  // 延迟预加载其余图片
                  setTimeout(() => {
                    const remainingEmojis = words.slice(8).map(word => word.emojiCode);
                    preloadImages(remainingEmojis).then(() => {
                      console.log('所有图片预加载完成');
                    });
                  }, 2000);
                }
              }
            });
          });
          
          return {
            currentPage,
            currentSubject,
            activeChineseTab,
            activeMathTab,
            activeEnglishTab,
            chinese,
            english,
            chineseNumbers,
            countingQuestion,
            additionQuestion,
            subtractionQuestion,
            characterQuestion,
            selectedCountingAnswer,
            selectedAdditionAnswer,
            selectedSubtractionAnswer,
            selectedCharacterAnswer,
            countingResult,
            additionResult,
            subtractionResult,
            characterResult,
            historyExpanded,
            additionHistory,
            additionTodayHistory,
            additionStats,
            allTimeStats,
            subtractionHistory,
            subtractionTodayHistory,
            subtractionStats,
            subtractionAllTimeStats,
            characterHistory,
            characterTodayHistory,
            characterStats,
            characterAllTimeStats,
            sortedAdditionHistory,
            sortedSubtractionHistory,
            sortedCharacterHistory,
            selectSubject,
            selectSubjectAndTab,
            goHome,
            generateCountingQuestion,
            generateAdditionQuestion,
            generateSubtractionQuestion,
            generateCharacterQuestion,
            selectCountingAnswer,
            selectAdditionAnswer,
            selectSubtractionAnswer,
            selectCharacterAnswer,
            checkCountingAnswer,
            checkAdditionAnswer,
            checkSubtractionAnswer,
            checkCharacterAnswer,
            nextCountingQuestion,
            nextAdditionQuestion,
            nextSubtractionQuestion,
            nextCharacterQuestion,
            setActiveTab,
            speak,
            getEmojiImageUrl,
            handleImageError,
            recordAdditionAnswer,
            recordSubtractionAnswer,
            recordCharacterAnswer,
            recordPracticeAnswer,
            toggleHistoryExpanded,
            resetTodayStats,
            clearPracticeHistory,
            getAccuracyBadgeClass,
            formatTime,
            getCurrentDateString,
            calculateTodayStats,
            calculateSubtractionStats,
            calculateCharacterStats
          };
        }
      }).mount('#app');
    }
  </script>
  <!-- 返回顶部按钮 -->
  <div class="back-to-top" id="backToTop" v-cloak>
    <i class="bi bi-arrow-up"></i>
  </div>

  <script>
    // 返回顶部功能
    document.addEventListener('DOMContentLoaded', function() {
      const backToTopBtn = document.getElementById('backToTop');
      
      // 监听滚动事件，控制按钮显示/隐藏
      window.addEventListener('scroll', function() {
        if (window.pageYOffset > 10) {
          backToTopBtn.style.display = 'flex';
        } else {
          backToTopBtn.style.display = 'none';
        }
      });
      
      // 初始状态隐藏按钮
      backToTopBtn.style.display = 'none';
      
      // 点击返回顶部
      backToTopBtn.addEventListener('click', function() {
        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      });
    });
  </script>
</body>
</html>